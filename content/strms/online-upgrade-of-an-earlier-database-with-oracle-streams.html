<!DOCTYPE html
  SYSTEM "about:legacy-compat">

<!-- saved from url=(0023)https://docs.oracle.com -->

<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Online Upgrade of an Earlier Database with Oracle Streams</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Concepts and Administration ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Concepts and Administration">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.1.1">
      <link rel="alternate" href="streams-concepts-and-administration.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-01-25T21:40:57-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E83781-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      <meta name="dcterms.release" content="Release 18">
      <link rel="prev" href="online-upgrade-and-maintenance-with-oracle-streams.html" title="Previous" type="text/html">
      <link rel="next" href="strms_glossary.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Streams Concepts and Administration">
    <meta name="dcterms.isVersionOf" content="STRMS">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="online-upgrade-and-maintenance-with-oracle-streams.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="strms_glossary.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Concepts and Administration </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="appendixes.html" property="item" typeof="WebPage"><span property="name">   Appendixes </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Online Upgrade of an Earlier Database with Oracle Streams</li>
            </ol>
            <a id="GUID-BAEDD568-51DA-4E58-BFB0-C90046D6581D" name="GUID-BAEDD568-51DA-4E58-BFB0-C90046D6581D"></a><a id="STRMS140"></a>
            
            <h2 id="STRMS-GUID-BAEDD568-51DA-4E58-BFB0-C90046D6581D" class="sect2"><span class="enumeration_chapter">E </span> Online Upgrade of an Earlier Database with Oracle Streams
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d158292e125" class="indexterm-anchor"></a><a id="d158292e129" class="indexterm-anchor"></a>This appendix describes how to perform a database upgrade from one of the following Oracle Database releases with Oracle Streams:
               </p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p>Oracle Database 10<span class="italic">g</span> Release 1 (10.1)
                     </p>
                  </li>
                  <li>
                     <p>Oracle9<span class="italic">i</span> Release 2 (9.2)
                     </p>
                  </li>
               </ul>
               <p>The database upgrade operation described in this appendix uses the features of Oracle Streams to achieve little or no database down time.</p>
               <p>The following topics describe performing an online database upgrade with Oracle Streams:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-C3C2B66D-253E-4898-8D48-B358FCB57DB8">Overview of Using Oracle Streams in the Database Upgrade Process</a></p>
                  </li>
                  <li>
                     <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-41A59A2E-3FE3-4322-954B-FDFD1B8DDEBC">Preparing for a Database Upgrade Using Oracle Streams</a></p>
                  </li>
                  <li>
                     <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-90ABA30F-A5C5-4497-B0EA-B606E518A771">Performing a Database Upgrade Using Oracle Streams</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-BAEDD568-51DA-4E58-BFB0-C90046D6581D__GUID-1DEF0A10-09E3-4B85-8428-0A35D3207FFB">
                  <p class="notep1">See Also:</p>
                  <p><a href="online-upgrade-and-maintenance-with-oracle-streams.html#GUID-72101E94-83C1-468E-856D-382862162449"> Online Database Upgrade and Maintenance with Oracle Streams</a> for information about upgrading from Oracle Database 10<span class="italic">g</span> Release 2 (10.2) or later and for information about performing other database maintenance operations with Oracle Streams
                  </p>
               </div>
            </div><a id="STRMS1231"></a><a id="STRMS1230"></a><div class="props_rev_3"><a id="GUID-C3C2B66D-253E-4898-8D48-B358FCB57DB8" name="GUID-C3C2B66D-253E-4898-8D48-B358FCB57DB8"></a><h3 id="STRMS-GUID-C3C2B66D-253E-4898-8D48-B358FCB57DB8" class="sect3"><span class="enumeration_section">E.1 </span>Overview of Using Oracle Streams in the Database Upgrade Process
               </h3>
               <div>
                  <p>An Oracle database upgrade is the process of transforming an existing, prior release of an Oracle database into the current release. A database upgrade typically requires substantial database down time, but you can perform a database upgrade with little or no down time by using the features of Oracle Streams. To do so, you use Oracle Streams to configure a <a href="strms_glossary.html#GUID-5BC36291-C075-4244-905A-ACDAB250E825"><span class="xrefglossterm">replication</span></a> environment with the following databases:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><span class="bold">Source Database:</span> The original database that is being upgraded.
                        </p>
                     </li>
                     <li>
                        <p><span class="bold">Capture Database:</span> The database where a <a href="strms_glossary.html#GUID-7E24C191-B4E0-45F2-A55B-9F76D4F9E8B0"><span class="xrefglossterm">capture process</span></a> captures changes made to the source database during the upgrade.
                        </p>
                     </li>
                     <li>
                        <p><span class="bold">Destination Database:</span> The copy of the source database where an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> applies changes made to the source database during the upgrade process.
                        </p>
                     </li>
                  </ul>
                  <p>Specifically, you can use the following general steps to perform a database upgrade while the database is online:</p>
                  <ol>
                     <li>
                        <p>Create an empty <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a>.
                        </p>
                     </li>
                     <li>
                        <p>Configure an Oracle Streams replication environment where the original database is the source database and a copy of the database is the destination database for the changes made at the source.</p>
                     </li>
                     <li>
                        <p>Perform the database upgrade on the destination database. During this time the original source database is available online.</p>
                     </li>
                     <li>
                        <p>Use Oracle Streams to apply the changes made at the source database to the destination database.</p>
                     </li>
                     <li>
                        <p>When the destination database has caught up with the changes made at the source database, take the source database offline and make the destination database available for applications and users.</p>
                     </li>
                  </ol>
                  <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-C3C2B66D-253E-4898-8D48-B358FCB57DB8__CHDHHEBB">Figure E-1</a> provides an overview of this process.
                  </p>
                  <div class="figure" id="GUID-C3C2B66D-253E-4898-8D48-B358FCB57DB8__CHDHHEBB">
                     <p class="titleinfigure">Figure E-1 Online Database Upgrade with Oracle Streams</p><img width="464" src="img/strms052.gif" alt="Description of Figure E-1 follows" title="Description of Figure E-1 follows" longdesc="img_text/strms052.html"><br><a href="img_text/strms052.html">Description of "Figure E-1 Online Database Upgrade with Oracle Streams"</a></div>
                  <!-- class="figure" -->
               </div><a id="STRMS1233"></a><a id="STRMS1232"></a><div class="props_rev_3"><a id="GUID-60102850-CD63-40C7-BCC0-0C8F39091702" name="GUID-60102850-CD63-40C7-BCC0-0C8F39091702"></a><h4 id="STRMS-GUID-60102850-CD63-40C7-BCC0-0C8F39091702" class="sect4"><span class="enumeration_section">E.1.1 </span>The Capture Database During the Upgrade Process
                  </h4>
                  <div>
                     <p>During the upgrade process, the capture database is the database where the <a href="strms_glossary.html#GUID-7E24C191-B4E0-45F2-A55B-9F76D4F9E8B0"><span class="xrefglossterm">capture process</span></a> is created. Downstream capture was introduced in Oracle Database 10<span class="italic">g</span> Release 1 (10.1). If you are upgrading a database from Oracle Database 10<span class="italic">g</span> Release 1, then you have the following options:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>A <a href="strms_glossary.html#GUID-B03D3B40-9AE1-4C52-BC23-C8496CB5548F"><span class="xrefglossterm">local capture process</span></a> can be created at the source database during the upgrade process.
                           </p>
                        </li>
                        <li>
                           <p>A <a href="strms_glossary.html#GUID-5AC0675A-963F-4A19-A210-24184EE61C7E"><span class="xrefglossterm">downstream capture process</span></a> can be created at the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a>. If the destination database is the capture database, then a <a href="strms_glossary.html#GUID-13E35632-96B9-4A58-8990-EF95ECE9746E"><span class="xrefglossterm">propagation</span></a> from the capture database to the destination database is not needed.
                           </p>
                        </li>
                        <li>
                           <p>A third database can be the capture database. In this case, the third database can be an Oracle Database 10<span class="italic">g</span> Release 1 or later database.
                           </p>
                        </li>
                     </ul>
                     <p>However, if you are upgrading a database from Oracle9<span class="italic">i</span> Release 2 (9.2) to Oracle Database 11<span class="italic">g</span> Release 2 or later, then downstream capture is not supported, and a local capture process must be created at the source database.
                     </p>
                     <p>A downstream capture process reduces the resources required at the source database during the upgrade process, but a local capture process is easier to configure. <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-60102850-CD63-40C7-BCC0-0C8F39091702__CHDEJAAC" title="This table describes whether the source database, destination database, or a third database can be the capture database based on the release being upgraded.">Table E-1</a> describes which database can be the capture database during the upgrade process.
                     </p>
                     <div class="tblformal" id="GUID-60102850-CD63-40C7-BCC0-0C8F39091702__CHDEJAAC">
                        <p class="titleintable">Table E-1 Supported Capture Database During Upgrade</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Supported Capture Database During Upgrade" summary="This table describes whether the source database, destination database, or a third database can be the capture database based on the release being upgraded." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="22%" id="d158292e568">Existing Database Release</th>
                                 <th align="left" valign="bottom" width="26%" id="d158292e571">Capture Database Can Be Source Database?</th>
                                 <th align="left" valign="bottom" width="26%" id="d158292e574">Capture Database Can Be Destination Database?</th>
                                 <th align="left" valign="bottom" width="26%" id="d158292e577">Capture Database Can Be Third Database?</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="22%" id="d158292e582" headers="d158292e568 ">
                                    <p>9.2</p>
                                 </td>
                                 <td align="left" valign="top" width="26%" headers="d158292e582 d158292e571 ">
                                    <p>Yes</p>
                                 </td>
                                 <td align="left" valign="top" width="26%" headers="d158292e582 d158292e574 ">
                                    <p>No</p>
                                 </td>
                                 <td align="left" valign="top" width="26%" headers="d158292e582 d158292e577 ">
                                    <p>No</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="22%" id="d158292e595" headers="d158292e568 ">
                                    <p>10.1</p>
                                 </td>
                                 <td align="left" valign="top" width="26%" headers="d158292e595 d158292e571 ">
                                    <p>Yes</p>
                                 </td>
                                 <td align="left" valign="top" width="26%" headers="d158292e595 d158292e574 ">
                                    <p>Yes</p>
                                 </td>
                                 <td align="left" valign="top" width="26%" headers="d158292e595 d158292e577 ">
                                    <p>Yes</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="infoboxnote" id="GUID-60102850-CD63-40C7-BCC0-0C8F39091702__GUID-ADAE6609-3E32-45AF-9A36-7A559194B65A">
                        <p class="notep1">Note:</p>
                        <p>If you are upgrading from Oracle Database 10<span class="italic">g</span> Release 1 (10.1), then, before you begin the upgrade, decide which database will be the capture database.
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-60102850-CD63-40C7-BCC0-0C8F39091702__GUID-08832633-93F1-432D-9D2D-ED0A82445CF8">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="oracle-streams-information-capture.html#GUID-5C1059F3-DA6E-4B0A-8179-D5304423656E">Local Capture and Downstream Capture</a>"</span></p>
                     </div>
                  </div>
               </div><a id="STRMS1234"></a><div class="props_rev_3"><a id="GUID-D09E7A48-1561-48B5-956E-5DF8580C5814" name="GUID-D09E7A48-1561-48B5-956E-5DF8580C5814"></a><h4 id="STRMS-GUID-D09E7A48-1561-48B5-956E-5DF8580C5814" class="sect4"><span class="enumeration_section">E.1.2 </span>Assumptions for the Database Being Upgraded
                  </h4>
                  <div>
                     <p>The instructions in this appendix assume that all of the following statements are true for the database being upgraded:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The database is not part of an existing Oracle Streams environment.</p>
                        </li>
                        <li>
                           <p>The database is not part of an existing logical standby environment.</p>
                        </li>
                        <li>
                           <p>No tables at the database are master tables for materialized views in other databases.</p>
                        </li>
                        <li>
                           <p>No messages are enqueued into user-created <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a>s during the upgrade process.
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="STRMS1235"></a><div class="props_rev_3"><a id="GUID-060439BD-616F-478E-801D-0E60008CE687" name="GUID-060439BD-616F-478E-801D-0E60008CE687"></a><h4 id="STRMS-GUID-060439BD-616F-478E-801D-0E60008CE687" class="sect4"><span class="enumeration_section">E.1.3 </span>Considerations for Job Queue Processes and PL/SQL Package Subprograms
                  </h4>
                  <div>
                     <p>If possible, ensure that no job queue processes are created, modified, or deleted during the upgrade process, and that no Oracle-supplied PL/SQL package subprograms are invoked during the upgrade process that modify both user data and dictionary metadata at the same time. The following packages contain subprograms that modify both user data and dictionary metadata at the same time: <code class="codeph">DBMS_RLS</code>, <code class="codeph">DBMS_STATS</code>, and <code class="codeph">DBMS_JOB</code>.
                     </p>
                     <p>It might be possible to perform such actions on the database if you ensure that the same actions are performed on the source database and <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a> in Steps <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__CHDJIFEA">13</a> and <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__CHDBDBDC">14</a> in <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09">Task 5: Finishing the Upgrade and Removing Oracle Streams</a>"</span>. For example, if a PL/SQL procedure gathers statistics on the source database during the upgrade process, then the same PL/SQL procedure should be invoked at the destination database in Step&nbsp;<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__CHDBDBDC">14</a>.
                     </p>
                  </div>
               </div>
            </div><a id="STRMS1236"></a><div class="props_rev_3"><a id="GUID-41A59A2E-3FE3-4322-954B-FDFD1B8DDEBC" name="GUID-41A59A2E-3FE3-4322-954B-FDFD1B8DDEBC"></a><h3 id="STRMS-GUID-41A59A2E-3FE3-4322-954B-FDFD1B8DDEBC" class="sect3"><span class="enumeration_section">E.2 </span>Preparing for a Database Upgrade Using Oracle Streams
               </h3>
               <div>
                  <p>The following sections describe tasks to complete before starting the database upgrade with Oracle Streams:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4">Preparing to Upgrade a Database with User-Defined Types</a></p>
                     </li>
                     <li>
                        <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-7D4EAEC1-7D1A-4377-B5F1-965F0AD26AEB">Deciding Which Utility to Use for Instantiation</a></p>
                     </li>
                  </ul>
               </div><a id="STRMS1237"></a><div class="props_rev_3"><a id="GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4" name="GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4"></a><h4 id="STRMS-GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4" class="sect4"><span class="enumeration_section">E.2.1 </span>Preparing to Upgrade a Database with User-Defined Types
                  </h4>
                  <div>
                     <div class="section">
                        <p>User-defined types include object types, <code class="codeph">REF</code> values, varrays, and nested tables. Currently, Oracle Streams <a href="strms_glossary.html#GUID-7E24C191-B4E0-45F2-A55B-9F76D4F9E8B0"><span class="xrefglossterm">capture process</span></a>es and <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>es do not support user-defined types. This section discusses using Oracle Streams to perform a database upgrade on a database that has user-defined types.
                        </p>
                        <p>One option is to ensure that no data manipulation language (DML) or data definition language (DDL) changes are made to the tables that contain user-defined types during the database upgrade. In this case, these tables are instantiated at the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a>, and no changes are made to these tables during the entire operation. After the upgrade is complete, make the tables that contain user-defined types read/write at the destination database.
                        </p>
                        <p>If tables that contain user-defined types must remain open during the upgrade, then use the following general steps to retain changes to these tables during the upgrade:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li id="GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4__CHDGFJAA"><span>Before you begin the upgrade process described in <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-90ABA30F-A5C5-4497-B0EA-B606E518A771">Performing a Database Upgrade Using Oracle Streams</a>"</span>, create one or more logging tables to store row changes to tables at the source database that include user-defined types. Each column in the logging table must use a data type that is supported by Oracle Streams in the source database release.</span></li>
                        <li><span>Before you begin the upgrade process described in <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-90ABA30F-A5C5-4497-B0EA-B606E518A771">Performing a Database Upgrade Using Oracle Streams</a>"</span>, create a DML trigger at the source database that fires on the tables that contain the user-defined data types. The trigger converts each row change into relational equivalents and logs the modified row in a logging table created in Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4__CHDGFJAA">1</a>.</span></li>
                        <li><span>When the instructions in <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-90ABA30F-A5C5-4497-B0EA-B606E518A771">Performing a Database Upgrade Using Oracle Streams</a>"</span> say to configure a capture process and <a href="strms_glossary.html#GUID-13E35632-96B9-4A58-8990-EF95ECE9746E"><span class="xrefglossterm">propagation</span></a>, configure the capture process and propagation to capture changes to the logging table and propagate these changes to the destination database. Changes to tables that contain user-defined types must not be captured or propagated.</span></li>
                        <li><span>When the instructions in <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-90ABA30F-A5C5-4497-B0EA-B606E518A771">Performing a Database Upgrade Using Oracle Streams</a>"</span> say to configure a an apply process on the destination database, configure the apply process to use a <a href="strms_glossary.html#GUID-8F26223B-B771-4E5B-9C57-0F748A0904F1"><span class="xrefglossterm">procedure DML handler</span></a> that processes the changes to the logging tables. The procedure DML handler reconstructs the user-defined types from the relational equivalents and applies the modified changes to the tables that contain user-defined types.</span></li>
                     </ol>
                     <div class="section">
                        <p>For instructions, go to the My Oracle Support (formerly Oracle<span class="italic">MetaLink</span>) Web site using a Web browser:
                        </p><pre class="oac_no_warn" dir="ltr"><a href="http://support.oracle.com/"><code class="codeph">http://support.oracle.com/</code></a>
</pre><p>Database bulletin 556742.1 describes additional data type support for Oracle Streams.</p>
                        <div class="infoboxnotealso" id="GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4__GUID-29B3BAE2-A33C-4B9D-B017-9EBFD1A0B499">
                           <p class="notep1">See Also:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=LNPLS020"><span class="italic">Oracle Database PL/SQL Language Reference</span></a> for more information about creating triggers
                                 </p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-A6074063-2D66-4FB9-864D-D5228624732A">Managing a DML Handler</a>"</span></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS1239"></a><a id="STRMS1238"></a><div class="props_rev_3"><a id="GUID-7D4EAEC1-7D1A-4377-B5F1-965F0AD26AEB" name="GUID-7D4EAEC1-7D1A-4377-B5F1-965F0AD26AEB"></a><h4 id="STRMS-GUID-7D4EAEC1-7D1A-4377-B5F1-965F0AD26AEB" class="sect4"><span class="enumeration_section">E.2.2 </span>Deciding Which Utility to Use for Instantiation
                  </h4>
                  <div>
                     <div class="section">
                        <p>Before you begin the database upgrade, decide whether you want to use the Export/Import utilities (Data Pump or original) or the Recovery Manager (RMAN) utility to instantiate the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a> during the operation. The destination database will replace the existing database that is being upgraded.
                        </p>
                        <p>Consider the following factors when you make this decision:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>If you use original Export/Import or Data Pump Export/Import, then you can make the destination database an Oracle Database 11<span class="italic">g</span> Release 2 (11.2) or later database at the beginning of the operation. Therefore, you do not need to upgrade the destination database after the <a href="strms_glossary.html#GUID-8B2165CC-97F5-415E-8C7B-A356C6D26841"><span class="xrefglossterm">instantiation</span></a>.
                              </p>
                              <p>If you use Export/Import for instantiation, and Data Pump is supported, then Oracle recommends using Data Pump. Data Pump can perform the instantiation faster than original Export/Import.</p>
                           </li>
                           <li>
                              <p>If you use the RMAN <code class="codeph">DUPLICATE</code> command, then the instantiation might be faster than with Export/Import, especially if the database is large, but the database release must be the same for RMAN instantiation. Therefore, the following conditions must be met:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If the database is an Oracle9<span class="italic">i</span> Release 2 (9.2) database, then the destination database is an Oracle9<span class="italic">i</span> Database Release 2 database when it is instantiated.
                                    </p>
                                 </li>
                                 <li>
                                    <p>If the database is an Oracle Database 10<span class="italic">g</span> Release&nbsp;1 (10.1) database, then the destination database is an Oracle Database 10<span class="italic">g</span> Release 1 database when it is instantiated.
                                    </p>
                                 </li>
                              </ul>
                              <p>After the instantiation, you must upgrade the destination database.</p>
                              <p>Also, Oracle recommends that you do not use RMAN for instantiation in an environment where distributed transactions are possible. Doing so might cause in-doubt transactions that must be corrected manually.</p>
                           </li>
                        </ul>
                        <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-7D4EAEC1-7D1A-4377-B5F1-965F0AD26AEB__CHDGHFDH" title="This table describes when each instantiation method is supported based on the release being upgraded, whether the platform at the source and destination are the same or different, and whether the character set at the source and destination are the same or different.">Table E-2</a> describes whether each instantiation method is supported based on the release being upgraded, whether the platform at the source and destination databases are different, and whether the character set at the source and destination databases are different. Each instantiation method is supported when the platform and character set are the same at the source and destination databases.
                        </p>
                        <div class="tblformal" id="GUID-7D4EAEC1-7D1A-4377-B5F1-965F0AD26AEB__CHDGHFDH">
                           <p class="titleintable">Table E-2 Instantiation Methods for Database Upgrade with Oracle Streams</p>
                           <table cellpadding="4" cellspacing="0" class="Formal" title="Instantiation Methods for Database Upgrade with Oracle Streams" summary="This table describes when each instantiation method is supported based on the release being upgraded, whether the platform at the source and destination are the same or different, and whether the character set at the source and destination are the same or different." width="100%" frame="hsides" border="1" rules="rows">
                              <thead>
                                 <tr align="left" valign="top">
                                    <th align="left" valign="bottom" width="34%" id="d158292e1544">Instantiation Method</th>
                                    <th align="left" valign="bottom" width="22%" id="d158292e1547">Supported When Upgrading From</th>
                                    <th align="left" valign="bottom" width="22%" id="d158292e1550">Different Platforms Supported?</th>
                                    <th align="left" valign="bottom" width="22%" id="d158292e1553">Different Character Sets Supported?</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="34%" id="d158292e1558" headers="d158292e1544 ">
                                       <p>Original Export/Import</p>
                                    </td>
                                    <td align="left" valign="top" width="22%" headers="d158292e1558 d158292e1547 ">
                                       <p>9.2 or 10.1</p>
                                    </td>
                                    <td align="left" valign="top" width="22%" headers="d158292e1558 d158292e1550 ">
                                       <p>Yes</p>
                                    </td>
                                    <td align="left" valign="top" width="22%" headers="d158292e1558 d158292e1553 ">
                                       <p>Yes</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="34%" id="d158292e1571" headers="d158292e1544 ">
                                       <p>Data Pump Export/Import</p>
                                    </td>
                                    <td align="left" valign="top" width="22%" headers="d158292e1571 d158292e1547 ">
                                       <p>10.1</p>
                                    </td>
                                    <td align="left" valign="top" width="22%" headers="d158292e1571 d158292e1550 ">
                                       <p>Yes</p>
                                    </td>
                                    <td align="left" valign="top" width="22%" headers="d158292e1571 d158292e1553 ">
                                       <p>Yes</p>
                                    </td>
                                 </tr>
                                 <tr align="left" valign="top">
                                    <td align="left" valign="top" width="34%" id="d158292e1584" headers="d158292e1544 ">
                                       <p>RMAN <code class="codeph">DUPLICATE</code></p>
                                    </td>
                                    <td align="left" valign="top" width="22%" headers="d158292e1584 d158292e1547 ">
                                       <p>9.2 or 10.1</p>
                                    </td>
                                    <td align="left" valign="top" width="22%" headers="d158292e1584 d158292e1550 ">
                                       <p>No</p>
                                    </td>
                                    <td align="left" valign="top" width="22%" headers="d158292e1584 d158292e1553 ">
                                       <p>No</p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                        </div>
                        <!-- class="inftblhruleinformal" -->
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="STRMS1240"></a><div class="props_rev_3"><a id="GUID-90ABA30F-A5C5-4497-B0EA-B606E518A771" name="GUID-90ABA30F-A5C5-4497-B0EA-B606E518A771"></a><h3 id="STRMS-GUID-90ABA30F-A5C5-4497-B0EA-B606E518A771" class="sect3"><span class="enumeration_section">E.3 </span>Performing a Database Upgrade Using Oracle Streams
               </h3>
               <div>
                  <p>This section contains instructions for performing a database upgrade using Oracle Streams. These instructions describe using Oracle Streams to upgrade one of the following Oracle Database releases: Oracle9<span class="italic">i</span> Release 2 (9.2) or Oracle Database 10<span class="italic">g</span> Release 1 (10.1).
                  </p>
                  <p>Complete the following tasks to upgrade a database using Oracle Streams:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-C3897B4C-BBCD-4143-8681-2E5A3C74C009">Task 1: Beginning the Upgrade</a></p>
                     </li>
                     <li>
                        <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-BE0B088F-728F-4699-8085-3953B57D83BD">Task 2: Setting Up Oracle Streams Before Instantiation</a></p>
                     </li>
                     <li>
                        <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-DB0416DC-CB0E-4F02-B407-389A19CEB9EC">Task 3: Instantiating the Database</a></p>
                     </li>
                     <li>
                        <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-4ABB51C9-9277-47A5-ABC9-8FA4D71F78E8">Task 4: Setting Up Oracle Streams After Instantiation</a></p>
                     </li>
                     <li>
                        <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09">Task 5: Finishing the Upgrade and Removing Oracle Streams</a></p>
                     </li>
                  </ul>
               </div><a id="STRMS1241"></a><div class="props_rev_3"><a id="GUID-C3897B4C-BBCD-4143-8681-2E5A3C74C009" name="GUID-C3897B4C-BBCD-4143-8681-2E5A3C74C009"></a><h4 id="STRMS-GUID-C3897B4C-BBCD-4143-8681-2E5A3C74C009" class="sect4"><span class="enumeration_section">E.3.1 </span>Task 1: Beginning the Upgrade
                  </h4>
                  <div>
                     <div class="section">
                        <p>Complete the following steps to begin the upgrade using Oracle Streams:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Create an empty <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a>. Ensure that this database has a different global name than the source database. This example assumes that the global name of the source database is <code class="codeph">orcl.example.com</code> and the global name of the destination database during the upgrade is <code class="codeph">updb.example.com</code>. The global name of the destination database is changed when the destination database replaces the source database at the end of the upgrade process.</span><div>
                              <p>The release of the empty database you create depends on the <a href="strms_glossary.html#GUID-8B2165CC-97F5-415E-8C7B-A356C6D26841"><span class="xrefglossterm">instantiation</span></a> method you decided to use in <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-7D4EAEC1-7D1A-4377-B5F1-965F0AD26AEB">Deciding Which Utility to Use for Instantiation</a>"</span>:
                              </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you decided to use export/import for instantiation, then create an empty Oracle Database 11<span class="italic">g</span> Release 2 or later database. This database will be the destination database during the upgrade process.
                                    </p>
                                    <p>See the Oracle Database installation guide for your operating system if you must install Oracle Database, and see the<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ADMIN002"><span class="italic"> Oracle Database Administrator's Guide </span></a>for information about creating a database.
                                    </p>
                                 </li>
                                 <li>
                                    <p>If you decided to use RMAN for instantiation, then create an empty Oracle database that is the same release as the database you are upgrading.</p>
                                    <p>Specifically, if you are upgrading an Oracle9<span class="italic">i</span> Release 2 (9.2) database, then create an Oracle9<span class="italic">i</span> Release 2 database. Alternatively, if you are upgrading an Oracle Database 10<span class="italic">g</span> Release 1 (10.1) database, then create an Oracle Database 10<span class="italic">g</span> Release 1 database.
                                    </p>
                                    <p>This database will be the destination database during the upgrade process. Both the source database that is being upgraded and the destination database must be the same release of Oracle when you start the upgrade process.</p>
                                    <p>See the Oracle installation guide for your operating system if you must install Oracle, and see the Oracle <span class="italic">Database Administrator's Guide</span> for the release for information about creating a database.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Ensure that the source database is running in <code class="codeph">ARCHIVELOG</code> mode. See the Oracle <span class="italic">Database Administrator's Guide</span> for the source database release for information about running a database in <code class="codeph">ARCHIVELOG</code> mode.</span></li>
                        <li class="stepexpand"><span>Ensure that the initialization parameters are set properly at each database to support an Oracle Streams environment. For the source database, see the Oracle Streams documentation for the source database release. For the destination database, see <a href="../strep/preparing-for-oracle-streams-replication.html#STREP201"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about setting initialization parameters that are relevant to Oracle Streams. If the capture database is a third database, then see the Oracle Streams documentation for the capture database release.</span></li>
                        <li class="stepexpand"><span>At the source database, ensure that no changes are made during the upgrade process to any database objects that were not supported by Oracle Streams in the release you are upgrading:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you are upgrading an Oracle9<span class="italic">i</span> Release 2 (9.2) database, then tables with columns of the following data types are not supported: <code class="codeph">NCLOB</code>, <code class="codeph">LONG</code>, <code class="codeph">LONG</code> <code class="codeph">RAW</code>, <code class="codeph">BFILE</code>, <code class="codeph">ROWID</code>, and <code class="codeph">UROWID</code>, and user-defined types (including object types, REFs, varrays, and nested tables). In addition, the following types of tables are not supported: temporary tables, index-organized tables, and object tables. See <span class="italic">Oracle9i Streams</span> for complete information about unsupported database objects.
                                    </p>
                                 </li>
                                 <li>
                                    <p>If you are upgrading an Oracle Database 10<span class="italic">g</span> Release 1 (10.1) database, then query the <code class="codeph">DBA_STREAMS_UNSUPPORTED</code> data dictionary view to list the database objects that are not supported by Oracle Streams. Ensure that no changes are made to these database objects during the upgrade process.
                                    </p>
                                 </li>
                              </ul>
                              <p><span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4">Preparing to Upgrade a Database with User-Defined Types</a>"</span> discusses a method for retaining changes to tables that contain user-defined types during the upgrade. If you are using this method, then tables that contain user-defined types can remain open during the upgrade.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>At the source database, configure an Oracle Streams administrator:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>If you are upgrading an Oracle9<span class="italic">i</span> Release 2 (9.2) database, then see <span class="italic">Oracle9i Streams</span> for more information.
                                    </p>
                                 </li>
                                 <li>
                                    <p>If you are upgrading an Oracle Database 10<span class="italic">g</span> Release 1 database, then see <span class="italic">Oracle Streams Concepts and Administration</span> for that release for more information.
                                    </p>
                                 </li>
                              </ul>
                              <p>These instructions assume that the name of the Oracle Streams administrator at the source database is <code class="codeph">strmadmin</code>. This Oracle Streams administrator will be copied automatically to the destination database during instantiation.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>In SQL*Plus, connect to the source database <code class="codeph">orcl.example.com</code> as an administrative user.</span><div>
                              <p>See the Oracle <span class="italic">Database Administrator's Guide</span> for the source database release for information about connecting to a database in SQL*Plus.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Specify <a href="strms_glossary.html#GUID-F07A6AB2-5AA0-45FA-8B00-862DD2D087DB"><span class="xrefglossterm">database supplemental logging</span></a> of primary keys, unique keys, and foreign keys for all updates. For example:</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE ADD SUPPLEMENTAL LOG DATA 
   (PRIMARY KEY, UNIQUE, FOREIGN KEY) COLUMNS; 
</pre></div>
                        </li>
                     </ol>
                  </div>
               </div><a id="STRMS1242"></a><div class="props_rev_3"><a id="GUID-BE0B088F-728F-4699-8085-3953B57D83BD" name="GUID-BE0B088F-728F-4699-8085-3953B57D83BD"></a><h4 id="STRMS-GUID-BE0B088F-728F-4699-8085-3953B57D83BD" class="sect4"><span class="enumeration_section">E.3.2 </span>Task 2: Setting Up Oracle Streams Before Instantiation
                  </h4>
                  <div>
                     <p>The specific instructions for setting up Oracle Streams before <a href="strms_glossary.html#GUID-8B2165CC-97F5-415E-8C7B-A356C6D26841"><span class="xrefglossterm">instantiation</span></a> depend on which database is the capture database. Follow the instructions in the appropriate section:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-13B4AEA3-BE6B-4519-AD45-23229EF73DF7">The Source Database Is the Capture Database</a></p>
                        </li>
                        <li>
                           <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-3C7BC7E2-2782-4408-901B-3721859BA874">The Destination Database Is the Capture Database</a></p>
                        </li>
                        <li>
                           <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-206A6119-E016-48BB-8019-8BB7A380BCAF">A Third Database Is the Capture Database</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-BE0B088F-728F-4699-8085-3953B57D83BD__GUID-1ADE8538-C458-4076-B2C3-2A31549E76FC">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-C3C2B66D-253E-4898-8D48-B358FCB57DB8">Overview of Using Oracle Streams in the Database Upgrade Process</a>"</span> for information about the capture database
                        </p>
                     </div>
                  </div><a id="STRMS1243"></a><div class="props_rev_3"><a id="GUID-13B4AEA3-BE6B-4519-AD45-23229EF73DF7" name="GUID-13B4AEA3-BE6B-4519-AD45-23229EF73DF7"></a><h5 id="STRMS-GUID-13B4AEA3-BE6B-4519-AD45-23229EF73DF7" class="sect5"><span class="enumeration_section">E.3.2.1 </span>The Source Database Is the Capture Database
                     </h5>
                     <div>
                        <div class="section">
                           <p>Complete the following steps to set up Oracle Streams before instantiation when the source database is the capture database:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Configure your network and Oracle Net so that the source database can communicate with the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a>. See<a href="../netag/index.html"><span class="italic"> Oracle Database Net Services Administrator's Guide </span></a>for more information.</span></li>
                           <li class="stepexpand"><span>In SQL*Plus, connect to the source database <code class="codeph">orcl.example.com</code> as the Oracle Streams administrator.</span><div>
                                 <p>Seethe Oracle <span class="italic">Database Administrator's Guide</span> for the source database release for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-13B4AEA3-BE6B-4519-AD45-23229EF73DF7__CHDCHAEC"><span>Create an <code class="codeph">ANYDATA</code> queue that will stage changes made to the source database during the upgrade process. For example:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; 'strmadmin.capture_queue_table',
    queue_name  =&gt; 'strmadmin.capture_queue');
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Configure a <a href="strms_glossary.html#GUID-7E24C191-B4E0-45F2-A55B-9F76D4F9E8B0"><span class="xrefglossterm">capture process</span></a> that will capture all supported changes made to the source database and stage these changes in the <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> created in Step&nbsp;<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-13B4AEA3-BE6B-4519-AD45-23229EF73DF7__CHDCHAEC">3</a>. Do not start the capture process. For example:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_RULES(
    streams_type       =&gt; 'capture',
    streams_name       =&gt; 'capture_upgrade',
    queue_name         =&gt; 'strmadmin.capture_queue',
    include_dml        =&gt; TRUE,
    include_ddl        =&gt; TRUE,
    include_tagged_lcr =&gt; FALSE,
    source_database    =&gt; 'orcl.example.com',
    inclusion_rule     =&gt; TRUE);
END;
/
</pre><p><span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4">Preparing to Upgrade a Database with User-Defined Types</a>"</span> discusses a method for retaining changes to tables that contain user-defined types during the maintenance operation. If you are using this method, then ensure that the capture process does not attempt to capture changes to tables with user-defined types. See the Oracle Streams documentation for the source database release for information about excluding database objects from an Oracle Streams configuration with <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a>s.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Proceed to <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-DB0416DC-CB0E-4F02-B407-389A19CEB9EC">Task 3: Instantiating the Database</a>"</span>.</span></li>
                        </ol>
                     </div>
                  </div><a id="STRMS1244"></a><div class="props_rev_3"><a id="GUID-3C7BC7E2-2782-4408-901B-3721859BA874" name="GUID-3C7BC7E2-2782-4408-901B-3721859BA874"></a><h5 id="STRMS-GUID-3C7BC7E2-2782-4408-901B-3721859BA874" class="sect5"><span class="enumeration_section">E.3.2.2 </span>The Destination Database Is the Capture Database
                     </h5>
                     <div>
                        <div class="section">
                           <p>The database being upgraded must be an Oracle Database 10<span class="italic">g</span> Release 1 (10.1) database to use this option. Complete the following steps to set up Oracle Streams before instantiation when the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a> is the capture database:
                           </p>
                           <ol>
                              <li>
                                 <p>Configure your network and Oracle Net so that the source database and destination database can communicate with each other. See<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=NETAG"><span class="italic"> Oracle Database Net Services Administrator's Guide </span></a>for more information.
                                 </p>
                              </li>
                              <li id="GUID-3C7BC7E2-2782-4408-901B-3721859BA874__CHDFEIDH">
                                 <p>Follow the instructions in the appropriate section based on the method you are using for instantiation:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-3C7BC7E2-2782-4408-901B-3721859BA874__CHDHGCGD">Export/Import</a></p>
                                    </li>
                                    <li>
                                       <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-3C7BC7E2-2782-4408-901B-3721859BA874__CHDEABJA">RMAN</a></p>
                                    </li>
                                 </ul>
                                 <p id="GUID-3C7BC7E2-2782-4408-901B-3721859BA874__CHDHGCGD"><span class="bold">Export/Import</span></p>
                                 <p>Complete the following steps if you are using export/import for instantiation:</p>
                                 <ol type="a">
                                    <li>
                                       <p>In SQL*Plus, connect to the destination database <code class="codeph">updb.example.com</code> as the Oracle Streams administrator.
                                       </p>
                                       <p>See <a href="../admin/index.html"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                       </p>
                                    </li>
                                    <li id="GUID-3C7BC7E2-2782-4408-901B-3721859BA874__CHDGGGAB">
                                       <p>Create an <code class="codeph">ANYDATA</code> queue that will stage changes made to the source database during the upgrade process. For example:
                                       </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; 'strmadmin.destination_queue_table',
    queue_name  =&gt; 'strmadmin.destination_queue');
END;
/
</pre></li>
                                    <li>
                                       <p>Configure a downstream <a href="strms_glossary.html#GUID-7E24C191-B4E0-45F2-A55B-9F76D4F9E8B0"><span class="xrefglossterm">capture process</span></a> that will capture all supported changes made to the source database and stage these changes in the <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> created in Step&nbsp;<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-3C7BC7E2-2782-4408-901B-3721859BA874__CHDGGGAB">2.b</a>. Ensure that the capture process uses a database link to the source database. The capture process can be a <a href="strms_glossary.html#GUID-06A0A2F0-B289-468B-83DD-FA912214CB2F"><span class="xrefglossterm">real-time downstream capture process</span></a> or an <a href="strms_glossary.html#GUID-B12B203D-0E31-47EE-9B29-AAF4C9E593C2"><span class="xrefglossterm">archived-log downstream capture process</span></a>. See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=STREP209"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information. Do not start the capture process.
                                       </p>
                                       <p><span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4">Preparing to Upgrade a Database with User-Defined Types</a>"</span> discusses a method for retaining changes to tables that contain user-defined types during the maintenance operation. If you are using this method, then ensure that the capture process does not attempt to capture changes to tables with user-defined types. See the Oracle Streams documentation for the source database for information about excluding database objects from an Oracle Streams configuration with <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a>s.
                                       </p>
                                    </li>
                                 </ol>
                                 <p id="GUID-3C7BC7E2-2782-4408-901B-3721859BA874__CHDEABJA"><span class="bold">RMAN</span></p>
                                 <p>Complete the following steps if you are using RMAN for instantiation:</p>
                                 <ol type="a">
                                    <li>
                                       <p>In SQL*Plus, connect to the source database <code class="codeph">orcl.example.com</code> as the Oracle Streams administrator.
                                       </p>
                                       <p>See <a href="../admin/index.html"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                       </p>
                                    </li>
                                    <li id="GUID-3C7BC7E2-2782-4408-901B-3721859BA874__CHDIFHCC">
                                       <p>Perform a build of the data dictionary in the redo log:</p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON
DECLARE
  scn  NUMBER;
BEGIN
  DBMS_CAPTURE_ADM.BUILD(
    first_scn =&gt; scn);
  DBMS_OUTPUT.PUT_LINE('First SCN Value = ' || scn);
END;
/
First SCN Value = 1122610
</pre><p>This procedure displays the valid <a href="strms_glossary.html#GUID-BE3F0D47-11A1-46BD-BF54-F395591C3464"><span class="xrefglossterm">first SCN</span></a> value for the capture process that will be created at the destination database. Make a note of the SCN value returned because you will use it when you create the capture process at the destination database.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Prepare the source database for instantiation:</p><pre class="oac_no_warn" dir="ltr">exec DBMS_CAPTURE_ADM.PREPARE_GLOBAL_INSTANTIATION();
</pre></li>
                                 </ol>
                              </li>
                              <li>
                                 <p>Proceed to <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-DB0416DC-CB0E-4F02-B407-389A19CEB9EC">Task 3: Instantiating the Database</a>"</span>.
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS1245"></a><div class="props_rev_3"><a id="GUID-206A6119-E016-48BB-8019-8BB7A380BCAF" name="GUID-206A6119-E016-48BB-8019-8BB7A380BCAF"></a><h5 id="STRMS-GUID-206A6119-E016-48BB-8019-8BB7A380BCAF" class="sect5"><span class="enumeration_section">E.3.2.3 </span>A Third Database Is the Capture Database
                     </h5>
                     <div>
                        <div class="section">
                           <p>To use this option, meet the following requirements:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The database being upgraded must be an Oracle Database 10<span class="italic">g</span> Release 1 (10.1) database.
                                 </p>
                              </li>
                              <li>
                                 <p>The third database must be an Oracle Database 10<span class="italic">g</span> Release 1 or later database.
                                 </p>
                              </li>
                           </ul>
                           <p>This example assumes that the global name of the third database is <code class="codeph">thrd.example.com</code>. Complete the following steps to set up Oracle Streams before instantiation when a third database is the capture database:
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Configure your network and Oracle Net so that the source database, <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a>, and third database can communicate with each other. See<a href="../netag/index.html"><span class="italic"> Oracle Database Net Services Administrator's Guide </span></a>for more information.</span></li>
                           <li class="stepexpand"><span>In SQL*Plus, connect to the third database <code class="codeph">thrd.example.com</code> as an administrative user.</span><div>
                                 <p>See <a href="../admin/index.html"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Create an Oracle Streams administrator:</span><div>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>If the third database is an Oracle Database 10<span class="italic">g</span> database or an Oracle Database 11<span class="italic">g</span> Release 1 database, then see the <span class="italic">Oracle Streams Concepts and Administration</span> book for that release for more information.
                                       </p>
                                    </li>
                                    <li>
                                       <p>If the third database is an Oracle Database 11<span class="italic">g</span> Release 2 or later database, then see <a href="../strep/preparing-for-oracle-streams-replication.html#STREP200"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information.
                                       </p>
                                    </li>
                                 </ul>
                                 <p>These instructions assume that the name of the Oracle Streams administrator at the third database is <code class="codeph">strmadmin</code>.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-206A6119-E016-48BB-8019-8BB7A380BCAF__CHDEDJJH"><span>While still connected to the third database as the Oracle Streams administrator, create an <code class="codeph">ANYDATA</code> queue that will stage changes made to the source database during the upgrade process. For example:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; 'strmadmin.capture_queue_table',
    queue_name  =&gt; 'strmadmin.capture_queue');
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Configure a downstream <a href="strms_glossary.html#GUID-7E24C191-B4E0-45F2-A55B-9F76D4F9E8B0"><span class="xrefglossterm">capture process</span></a> that will capture all supported changes made to the source database and stage these changes in the <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> created in Step&nbsp;<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-206A6119-E016-48BB-8019-8BB7A380BCAF__CHDEDJJH">4</a>. Ensure that the capture process uses a database link to the source database. Do not start the capture process.</span><div>
                                 <p>See the following documentation for more information:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>If the capture database is an Oracle Database 10<span class="italic">g</span> database or an Oracle Database 11<span class="italic">g</span> Release 1 database, then see the <span class="italic">Oracle Streams Concepts and Administration</span> book for that release for more information.
                                       </p>
                                    </li>
                                    <li>
                                       <p>If the capture database is an Oracle Database 11<span class="italic">g</span> Release 2 or later database, then see <a href="../strep/configuring-implicit-capture.html#STREP209"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a>.
                                       </p>
                                    </li>
                                 </ul>
                                 <p>The capture process can be a <a href="strms_glossary.html#GUID-06A0A2F0-B289-468B-83DD-FA912214CB2F"><span class="xrefglossterm">real-time downstream capture process</span></a> or an <a href="strms_glossary.html#GUID-B12B203D-0E31-47EE-9B29-AAF4C9E593C2"><span class="xrefglossterm">archived-log downstream capture process</span></a>.
                                 </p>
                                 <p><span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4">Preparing to Upgrade a Database with User-Defined Types</a>"</span> discusses a method for retaining changes to tables that contain user-defined types during the upgrade operation. If you are using this method, then ensure that the capture process does not attempt to capture changes to tables with user-defined types. See the Oracle Streams documentation for the source database for information about excluding database objects from an Oracle Streams configuration with <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a>s.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Proceed to <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-DB0416DC-CB0E-4F02-B407-389A19CEB9EC">Task 3: Instantiating the Database</a>"</span>.</span></li>
                        </ol>
                     </div>
                  </div>
               </div><a id="STRMS1246"></a><div class="props_rev_3"><a id="GUID-DB0416DC-CB0E-4F02-B407-389A19CEB9EC" name="GUID-DB0416DC-CB0E-4F02-B407-389A19CEB9EC"></a><h4 id="STRMS-GUID-DB0416DC-CB0E-4F02-B407-389A19CEB9EC" class="sect4"><span class="enumeration_section">E.3.3 </span>Task 3: Instantiating the Database
                  </h4>
                  <div>
                     <p><span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-7D4EAEC1-7D1A-4377-B5F1-965F0AD26AEB">Deciding Which Utility to Use for Instantiation</a>"</span> discusses different options for instantiating an entire database. Complete the steps in the appropriate section based on the <a href="strms_glossary.html#GUID-8B2165CC-97F5-415E-8C7B-A356C6D26841"><span class="xrefglossterm">instantiation</span></a> option you are using:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-7365BDF7-0D4B-4406-A148-83D74D18A4F6">Instantiating the Database Using Export/Import</a></p>
                        </li>
                        <li>
                           <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-FD77DA56-99CB-4998-9004-C6A6F3522190">Instantiating the Database Using RMAN</a></p>
                        </li>
                     </ul>
                  </div><a id="STRMS1247"></a><div class="props_rev_3"><a id="GUID-7365BDF7-0D4B-4406-A148-83D74D18A4F6" name="GUID-7365BDF7-0D4B-4406-A148-83D74D18A4F6"></a><h5 id="STRMS-GUID-7365BDF7-0D4B-4406-A148-83D74D18A4F6" class="sect5"><span class="enumeration_section">E.3.3.1 </span>Instantiating the Database Using Export/Import
                     </h5>
                     <div>
                        <div class="section">
                           <p>Complete the following steps to instantiate the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a> using export/import:
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Instantiate the destination database using Export/Import. See<a href="../strep/instantiation-and-oracle-streams-replication.html#STREP342"><span class="italic"> Oracle Streams Replication Administrator's Guide </span></a>for more information about performing instantiations, and see<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=SUTIL"><span class="italic"> Oracle Database Utilities </span></a>for information about performing an export/import using the Export and Import utilities.</span><div>
                                 <p>If you use Oracle Data Pump or original Export/Import to instantiate the destination database, then ensure that the following parameters are set to the appropriate values:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Set the <code class="codeph">STREAMS_CONFIGURATION</code> import parameter to <code class="codeph">n</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>If you use original Export/Import, then set the <code class="codeph">CONSISTENT</code> export parameter to <code class="codeph">y</code>. This parameter does not apply to Data Pump exports.
                                       </p>
                                    </li>
                                    <li>
                                       <p>If you use original Export/Import, then set the <code class="codeph">STREAMS_INSTANTIATION</code> import parameter to <code class="codeph">y</code>. This parameter does not apply to Data Pump imports.
                                       </p>
                                    </li>
                                 </ul>
                                 <p>If you are upgrading an Oracle9<span class="italic">i</span> Release 2 (9.2) database, then you must use original Export/Import.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>At the destination database, disable any imported jobs that modify data that will be replicated from the source database. Query the <code class="codeph">DBA_JOBS</code> data dictionary view to list the jobs.</span></li>
                           <li class="stepexpand"><span>Proceed to <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-4ABB51C9-9277-47A5-ABC9-8FA4D71F78E8">Task 4: Setting Up Oracle Streams After Instantiation</a>"</span>.</span></li>
                        </ol>
                     </div>
                  </div><a id="STRMS1248"></a><div class="props_rev_3"><a id="GUID-FD77DA56-99CB-4998-9004-C6A6F3522190" name="GUID-FD77DA56-99CB-4998-9004-C6A6F3522190"></a><h5 id="STRMS-GUID-FD77DA56-99CB-4998-9004-C6A6F3522190" class="sect5"><span class="enumeration_section">E.3.3.2 </span>Instantiating the Database Using RMAN
                     </h5>
                     <div>
                        <div class="section">
                           <p>Complete the following steps to instantiate the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a> using the RMAN <code class="codeph">DUPLICATE</code> command:
                           </p>
                           <div class="infoboxnote" id="GUID-FD77DA56-99CB-4998-9004-C6A6F3522190__GUID-0B4E8D19-FD62-479B-9C45-0B109E7A2D43">
                              <p class="notep1">Note:</p>
                              <p>These steps provide a general outline for using RMAN to duplicate a database. If you are upgrading an Oracle9<span class="italic">i</span> Release 2 database, then see the <span class="italic">Oracle9i Recovery Manager User's Guide</span> for detailed information about using RMAN in that release. If you upgrading an Oracle Database 10<span class="italic">g</span> Release 1 (10.1) database, then see the <span class="italic">Oracle Database Backup and Recovery Advanced User's Guide</span> for that release.
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Create a backup of the source database if one does not exist. RMAN requires a valid backup for duplication. In this example, create a backup of <code class="codeph">orcl.example.com</code> if one does not exist.</span></li>
                           <li class="stepexpand"><span>In SQL*Plus, connect to the source database <code class="codeph">orcl.example.com</code> as an administrative user.</span><div>
                                 <p>Seethe Oracle <span class="italic">Database Administrator's Guide</span> for the source database release for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-FD77DA56-99CB-4998-9004-C6A6F3522190__i637292"><span>Determine the until SCN for the RMAN <code class="codeph">DUPLICATE</code> command. For example:</span><div><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON SIZE 1000000
DECLARE
  until_scn NUMBER;
BEGIN
  until_scn:= DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER;
      DBMS_OUTPUT.PUT_LINE('Until SCN: ' || until_scn);
END;
/
</pre><p>Make a note of the until SCN value. This example assumes that the until SCN value is <code class="codeph">439882</code>. You will set the <code class="codeph">UNTIL</code> <code class="codeph">SCN</code> option to this value when you use RMAN to duplicate the database in Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-FD77DA56-99CB-4998-9004-C6A6F3522190__i637379">7</a>.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-FD77DA56-99CB-4998-9004-C6A6F3522190__i640742"><span>While still connected as an administrative user in SQL*Plus to the source database, archive the current online redo log. For example:</span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM ARCHIVE LOG CURRENT;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Prepare your environment for database duplication, which includes preparing the destination database as an auxiliary instance for duplication. See the documentation for the release from which you are upgrading for more information. Specifically, see the "Duplicating a Database with Recovery Manager" chapter in the <span class="italic">Oracle9i Recovery Manager User's Guide</span> or <span class="italic">Oracle Database Backup and Recovery Advanced User's Guide</span> (10<span class="italic">g</span>) for more information. </span></li>
                           <li class="stepexpand"><span>Start the RMAN client, and connect to the database <code class="codeph">orcl.example.com</code> as <code class="codeph">TARGET</code> and to the <code class="codeph">updb.example.com</code> database as <code class="codeph">AUXILIARY</code>. Connect to each database as an administrative user.</span><div>
                                 <p>See the RMAN documentation for your Oracle Database release for more information about the RMAN <code class="codeph">CONNECT</code> command.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-FD77DA56-99CB-4998-9004-C6A6F3522190__i637379"><span>Use the RMAN <code class="codeph">DUPLICATE</code> command with the <code class="codeph">OPEN</code> <code class="codeph">RESTRICTED</code> option to instantiate the source database at the destination database. The <code class="codeph">OPEN</code> <code class="codeph">RESTRICTED</code> option is required. This option enables a restricted session in the duplicate database by issuing the following SQL statement: <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">ENABLE</code> <code class="codeph">RESTRICTED</code> <code class="codeph">SESSION</code>. RMAN issues this statement immediately before the duplicate database is opened.</span><div>
                                 <p>You can use the <code class="codeph">UNTIL</code> <code class="codeph">SCN</code> clause to specify an SCN for the duplication. Use the until SCN determined in Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-FD77DA56-99CB-4998-9004-C6A6F3522190__i637292">3</a> for this clause. Archived redo logs must be available for the until SCN specified and for higher SCN values. Therefore, Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-FD77DA56-99CB-4998-9004-C6A6F3522190__i640742">4</a> archived the redo log containing the until SCN.
                                 </p>
                                 <p>Ensure that you use <code class="codeph">TO</code> <span class="italic"><code class="codeph">database_name</code></span> in the <code class="codeph">DUPLICATE</code> command to specify the database name of the duplicate database. In this example, the database name of the duplicate database is <code class="codeph">updb</code>. Therefore, the <code class="codeph">DUPLICATE</code> command for this example includes <code class="codeph">TO</code> <code class="codeph">updb</code>.
                                 </p>
                                 <p>The following is an example of an RMAN <code class="codeph">DUPLICATE</code> command:
                                 </p><pre class="oac_no_warn" dir="ltr">RMAN&gt; RUN
      { 
        SET UNTIL SCN 439882;
        ALLOCATE AUXILIARY CHANNEL updb DEVICE TYPE sbt; 
        DUPLICATE TARGET DATABASE TO updb 
        NOFILENAMECHECK
        OPEN RESTRICTED;
      }
</pre></div>
                           </li>
                           <li class="stepexpand"><span>In SQL*Plus, connect to the destination database as an administrative user.</span></li>
                           <li class="stepexpand"><span>Use the <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> statement to disable the <code class="codeph">RESTRICTED</code> <code class="codeph">SESSION</code>:</span><div><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM DISABLE RESTRICTED SESSION;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>While still connected as an administrative user in SQL*Plus to the destination database, rename the database global name. After the RMAN <code class="codeph">DUPLICATE</code> command, the destination database has the same global name as the source database, but the destination database must have its original name until the end of the upgrade. For example:</span><div><pre class="oac_no_warn" dir="ltr">ALTER DATABASE RENAME GLOBAL_NAME TO updb.example.com;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>At the destination database, disable any jobs that modify data that will be replicated from the source database. Query the <code class="codeph">DBA_JOBS</code> data dictionary view to list the jobs.</span></li>
                           <li class="stepexpand"><span>Upgrade the destination database to Oracle Database 11<span class="italic">g</span> Release 2 or later. See the<a href="../upgrd/index.html"><span class="italic"> Oracle Database Upgrade Guide </span></a>for more information.</span></li>
                           <li class="stepexpand"><span>If you have not done so already, configure your network and Oracle Net so that the source database and destination database can communicate with each other. See<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=NETAG"><span class="italic"> Oracle Database Net Services Administrator's Guide </span></a>for more information.</span></li>
                           <li class="stepexpand"><span>Connect to the destination database as the Oracle Streams administrator in SQL*Plus. In this example, the destination database is <code class="codeph">updb.example.com</code>.</span></li>
                           <li class="stepexpand"><span>Create a database link to the source database. For example:</span><div><pre class="oac_no_warn" dir="ltr">CREATE DATABASE LINK orcl.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING 'orcl.example.com';
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Set the <a href="strms_glossary.html#GUID-4387E4F0-4979-48B7-A155-03592511B7FF"><span class="xrefglossterm">instantiation SCN</span></a> for the entire database and all of the database objects. The RMAN <code class="codeph">DUPLICATE</code> command duplicates the database up to one less than the SCN value specified in the <code class="codeph">UNTIL</code> <code class="codeph">SCN</code> clause. Therefore, you should subtract one from the until SCN value that you specified when you ran the <code class="codeph">DUPLICATE</code> command in Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-FD77DA56-99CB-4998-9004-C6A6F3522190__i637379">7</a>. In this example, the until SCN was set to <code class="codeph">439882</code>. Therefore, the instantiation SCN should be set to <code class="codeph">439882</code> <code class="codeph">-</code> <code class="codeph">1</code>, or&nbsp;<code class="codeph">439881</code>.</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_GLOBAL_INSTANTIATION_SCN(
    source_database_name =&gt; 'orcl.example.com',
    instantiation_scn    =&gt; 439881,
    recursive            =&gt; TRUE);
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Proceed to <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-4ABB51C9-9277-47A5-ABC9-8FA4D71F78E8">Task 4: Setting Up Oracle Streams After Instantiation</a>"</span>.</span></li>
                        </ol>
                     </div>
                  </div>
               </div><a id="STRMS1249"></a><div class="props_rev_3"><a id="GUID-4ABB51C9-9277-47A5-ABC9-8FA4D71F78E8" name="GUID-4ABB51C9-9277-47A5-ABC9-8FA4D71F78E8"></a><h4 id="STRMS-GUID-4ABB51C9-9277-47A5-ABC9-8FA4D71F78E8" class="sect4"><span class="enumeration_section">E.3.4 </span>Task 4: Setting Up Oracle Streams After Instantiation
                  </h4>
                  <div>
                     <p>The specific instructions for setting up Oracle Streams after <a href="strms_glossary.html#GUID-8B2165CC-97F5-415E-8C7B-A356C6D26841"><span class="xrefglossterm">instantiation</span></a> depend on which database is the capture database. Follow the instructions in the appropriate section:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-FD96E745-8BB3-4470-9B36-1BE1EC179C2D">The Source Database Is the Capture Database</a></p>
                        </li>
                        <li>
                           <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-A802C51D-31B4-4D41-BAFF-F2BE239CF0BD">The Destination Database Is the Capture Database</a></p>
                        </li>
                        <li>
                           <p><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-33304FD7-B077-4A17-A596-12E911634268">A Third Database Is the Capture Database</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-4ABB51C9-9277-47A5-ABC9-8FA4D71F78E8__GUID-3B6F54CC-03CC-49F5-92AB-69D8CBD519CA">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-C3C2B66D-253E-4898-8D48-B358FCB57DB8">Overview of Using Oracle Streams in the Database Upgrade Process</a>"</span> for information about the capture database
                        </p>
                     </div>
                  </div><a id="STRMS1250"></a><div class="props_rev_3"><a id="GUID-FD96E745-8BB3-4470-9B36-1BE1EC179C2D" name="GUID-FD96E745-8BB3-4470-9B36-1BE1EC179C2D"></a><h5 id="STRMS-GUID-FD96E745-8BB3-4470-9B36-1BE1EC179C2D" class="sect5"><span class="enumeration_section">E.3.4.1 </span>The Source Database Is the Capture Database
                     </h5>
                     <div>
                        <div class="section">
                           <p>Complete the following steps to set up Oracle Streams after instantiation when the source database is the capture database:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>In SQL*Plus, connect to the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a> as the Oracle Streams administrator. In this example, the destination database is <code class="codeph">updb.example.com</code>.</span><div>
                                 <p>See <a href="../admin/index.html"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Remove the Oracle Streams components that were cloned from the source database during instantiation:</span><div>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>If export/import was used for instantiation, then remove the <code class="codeph">ANYDATA</code> queue that was cloned from the source database.
                                       </p>
                                    </li>
                                    <li>
                                       <p>If RMAN was used for instantiation, then remove the <code class="codeph">ANYDATA</code> queue and the capture process that were cloned from the source database.
                                       </p>
                                    </li>
                                 </ul>
                                 <p>To remove the <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> that was cloned from the source database, run the <code class="codeph">REMOVE_QUEUE</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package. For example:
                                 </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.REMOVE_QUEUE(
&nbsp;&nbsp;&nbsp; queue_name &nbsp;           &nbsp;=&gt; 'strmadmin.capture_queue',
    cascade                 =&gt; FALSE,
 &nbsp;&nbsp;&nbsp;drop_unused_queue_table&nbsp;=&gt; TRUE);
END;
/
</pre><p>To remove the capture process that was cloned from the source database, run the <code class="codeph">DROP_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package. For example:
                                 </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_CAPTURE_ADM.DROP_CAPTURE(
 &nbsp;&nbsp;&nbsp;capture_name          =&gt; 'capture_upgrade',
    drop_unused_rule_sets =&gt; TRUE);
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand" id="GUID-FD96E745-8BB3-4470-9B36-1BE1EC179C2D__CHDGABFH"><span>Create an <code class="codeph">ANYDATA</code> queue. This queue will stage changes propagated from the source database. For example:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; 'strmadmin.destination_queue_table',
    queue_name  =&gt; 'strmadmin.destination_queue');
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Connect to the source database as the Oracle Streams administrator. In this example, the source database is <code class="codeph">orcl.example.com</code>.</span></li>
                           <li class="stepexpand"><span>Create a database link to the destination database. For example:</span><div><pre class="oac_no_warn" dir="ltr">CREATE DATABASE LINK updb.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING 'updb.example.com';
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Create a <a href="strms_glossary.html#GUID-13E35632-96B9-4A58-8990-EF95ECE9746E"><span class="xrefglossterm">propagation</span></a> that propagates all changes from the <a href="strms_glossary.html#GUID-FF907FD2-BD9E-4622-A33C-A6D400ED2CAF"><span class="xrefglossterm">source queue</span></a> to the destination database created in Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-FD96E745-8BB3-4470-9B36-1BE1EC179C2D__CHDGABFH">3</a>. For example:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_PROPAGATION_RULES(
&nbsp;&nbsp;&nbsp;&nbsp;streams_name            =&gt; 'to_updb',
&nbsp;&nbsp;&nbsp;&nbsp;source_queue_name       =&gt; 'strmadmin.capture_queue',
&nbsp;&nbsp;&nbsp;&nbsp;destination_queue_name  =&gt; 'strmadmin.destination_queue@updb.example.com', 
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;          =&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;          =&gt; TRUE,
    include_tagged_lcr      =&gt; TRUE,
    source_database         =&gt; 'orcl.example.com');
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Connect to the destination database as the Oracle Streams administrator.</span></li>
                           <li class="stepexpand"><span>Create an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> that applies all changes in the queue created in Step&nbsp;<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-FD96E745-8BB3-4470-9B36-1BE1EC179C2D__CHDGABFH">3</a>. For example:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_RULES(
    streams_type       =&gt; 'apply',
&nbsp;&nbsp;&nbsp;&nbsp;streams_name       =&gt; 'apply_upgrade',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name         =&gt; 'strmadmin.destination_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;     =&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;     =&gt; TRUE,
    include_tagged_lcr =&gt; TRUE,
    source_database    =&gt; 'orcl.example.com');
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Proceed to <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09">Task 5: Finishing the Upgrade and Removing Oracle Streams</a>"</span>.</span></li>
                        </ol>
                     </div>
                  </div><a id="STRMS1251"></a><div class="props_rev_3"><a id="GUID-A802C51D-31B4-4D41-BAFF-F2BE239CF0BD" name="GUID-A802C51D-31B4-4D41-BAFF-F2BE239CF0BD"></a><h5 id="STRMS-GUID-A802C51D-31B4-4D41-BAFF-F2BE239CF0BD" class="sect5"><span class="enumeration_section">E.3.4.2 </span>The Destination Database Is the Capture Database
                     </h5>
                     <div>
                        <div class="section">
                           <p>Complete the following steps to set up Oracle Streams after instantiation when the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a> is the capture database:
                           </p>
                           <ol>
                              <li>
                                 <p>Complete the following steps if you used RMAN for instantiation. If you used export/import for instantiation, then proceed to Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-A802C51D-31B4-4D41-BAFF-F2BE239CF0BD__CHDDHECB">2</a>.
                                 </p>
                                 <ol type="a">
                                    <li>
                                       <p>In SQL*Plus, connect to the destination database as the Oracle Streams administrator. In this example, the destination database is <code class="codeph">updb.example.com</code>.
                                       </p>
                                       <p>See <a href="../admin/index.html"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                       </p>
                                    </li>
                                    <li id="GUID-A802C51D-31B4-4D41-BAFF-F2BE239CF0BD__CHDBAAII">
                                       <p>Create an <code class="codeph">ANYDATA</code> queue that will stage changes made to the source database during the upgrade process. For example:
                                       </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; 'strmadmin.destination_queue_table',
    queue_name  =&gt; 'strmadmin.destination_queue');
END;
/
</pre></li>
                                    <li>
                                       <p>Configure a <a href="strms_glossary.html#GUID-5AC0675A-963F-4A19-A210-24184EE61C7E"><span class="xrefglossterm">downstream capture process</span></a> that will capture all supported changes made to the source database and stage these changes in the <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> created in Step&nbsp;<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-A802C51D-31B4-4D41-BAFF-F2BE239CF0BD__CHDBAAII">1.b</a>.
                                       </p>
                                       <p>Ensure that you set the <code class="codeph">first_scn</code> parameter in the <code class="codeph">CREATE_CAPTURE</code> procedure to the value obtained for the data dictionary build in Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-3C7BC7E2-2782-4408-901B-3721859BA874__CHDFEIDH">2</a><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-3C7BC7E2-2782-4408-901B-3721859BA874__CHDIFHCC">2.b</a> in <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-3C7BC7E2-2782-4408-901B-3721859BA874">The Destination Database Is the Capture Database</a>"</span>. In this example, the <code class="codeph">first_scn</code> parameter should be set to <code class="codeph">1122610</code>.
                                       </p>
                                       <p>The capture process can be a <a href="strms_glossary.html#GUID-06A0A2F0-B289-468B-83DD-FA912214CB2F"><span class="xrefglossterm">real-time downstream capture process</span></a> or an <a href="strms_glossary.html#GUID-B12B203D-0E31-47EE-9B29-AAF4C9E593C2"><span class="xrefglossterm">archived-log downstream capture process</span></a>. See <a href="../strep/configuring-implicit-capture.html#STREP209"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information. Do not start the capture process.
                                       </p>
                                       <p><span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-1B8575E8-8516-4C81-83B8-45B116C3F5D4">Preparing to Upgrade a Database with User-Defined Types</a>"</span> discusses a method for retaining changes to tables that contain user-defined types during the maintenance operation. If you are using this method, then ensure that the capture process does not attempt to capture changes to tables with user-defined types. See the Oracle Streams documentation for the source database for information about excluding database objects from an Oracle Streams configuration with <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a>s.
                                       </p>
                                    </li>
                                 </ol>
                              </li>
                              <li id="GUID-A802C51D-31B4-4D41-BAFF-F2BE239CF0BD__CHDDHECB">
                                 <p>Create an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> that applies all changes in the queue used by the downstream capture process. For example:
                                 </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_RULES(
    streams_type       =&gt; 'apply',
&nbsp;&nbsp;&nbsp;&nbsp;streams_name       =&gt; 'apply_upgrade',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name         =&gt; 'strmadmin.destination_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;     =&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;     =&gt; TRUE,
    include_tagged_lcr =&gt; TRUE,
    source_database    =&gt; 'orcl.example.com');
END;
/
</pre></li>
                              <li>
                                 <p>Proceed to <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09">Task 5: Finishing the Upgrade and Removing Oracle Streams</a>"</span>.
                                 </p>
                              </li>
                           </ol>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS1252"></a><div class="props_rev_3"><a id="GUID-33304FD7-B077-4A17-A596-12E911634268" name="GUID-33304FD7-B077-4A17-A596-12E911634268"></a><h5 id="STRMS-GUID-33304FD7-B077-4A17-A596-12E911634268" class="sect5"><span class="enumeration_section">E.3.4.3 </span>A Third Database Is the Capture Database
                     </h5>
                     <div>
                        <div class="section">
                           <p>This example assumes that the global name of the third database is <code class="codeph">thrd.example.com</code>. Complete the following steps to set up Oracle Streams after instantiation when a third database is the capture database:
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>In SQL*Plus, connect to the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a> as the Oracle Streams administrator. In this example, the destination database is <code class="codeph">updb.example.com</code>.</span><div>
                                 <p>See <a href="../admin/index.html"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-33304FD7-B077-4A17-A596-12E911634268__CHDFIJDA"><span>Create an <code class="codeph">ANYDATA</code> queue. This <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> will stage changes propagated from the capture database. For example:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_UP_QUEUE(
    queue_table =&gt; 'strmadmin.destination_queue_table',
    queue_name  =&gt; 'strmadmin.destination_queue');
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Connect to the capture database as the Oracle Streams administrator. In this example, the capture database is <code class="codeph">thrd.example.com</code>.</span></li>
                           <li class="stepexpand"><span>Create a database link to the destination database. For example:</span><div><pre class="oac_no_warn" dir="ltr">CREATE DATABASE LINK updb.example.com CONNECT TO strmadmin 
   IDENTIFIED BY <span class="italic">password</span> 
   USING 'updb.example.com';
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Create a <a href="strms_glossary.html#GUID-13E35632-96B9-4A58-8990-EF95ECE9746E"><span class="xrefglossterm">propagation</span></a> that propagates all changes from the <a href="strms_glossary.html#GUID-FF907FD2-BD9E-4622-A33C-A6D400ED2CAF"><span class="xrefglossterm">source queue</span></a> at the capture database to the <a href="strms_glossary.html#GUID-584772DA-C868-4F6B-9B7F-9E665F2D6F85"><span class="xrefglossterm">destination queue</span></a> created in Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-33304FD7-B077-4A17-A596-12E911634268__CHDFIJDA">2</a>. For example:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_PROPAGATION_RULES(
&nbsp;&nbsp;&nbsp;&nbsp;streams_name            =&gt; 'to_updb',
&nbsp;&nbsp;&nbsp;&nbsp;source_queue_name       =&gt; 'strmadmin.capture_queue',
&nbsp;&nbsp;&nbsp;&nbsp;destination_queue_name  =&gt; 'strmadmin.destination_queue@updb.example.com', 
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;          =&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;          =&gt; TRUE,
    include_tagged_lcr      =&gt; TRUE,
    source_database         =&gt; 'orcl.example.com');
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Connect to the destination database as the Oracle Streams administrator. In this example, the destination database is <code class="codeph">updb.example.com</code>.</span></li>
                           <li class="stepexpand"><span>Create an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> that applies all changes in the queue created in Step&nbsp;<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-33304FD7-B077-4A17-A596-12E911634268__CHDFIJDA">2</a>. For example:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_GLOBAL_RULES(
    streams_type       =&gt; 'apply',
&nbsp;&nbsp;&nbsp;&nbsp;streams_name       =&gt; 'apply_upgrade',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name         =&gt; 'strmadmin.destination_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;     =&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;     =&gt; TRUE,
    include_tagged_lcr =&gt; TRUE,
    source_database    =&gt; 'orcl.example.com');
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Complete the steps in <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09">Task 5: Finishing the Upgrade and Removing Oracle Streams</a>"</span>.</span></li>
                        </ol>
                     </div>
                  </div>
               </div><a id="STRMS1253"></a><div class="props_rev_3"><a id="GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09" name="GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09"></a><h4 id="STRMS-GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09" class="sect4"><span class="enumeration_section">E.3.5 </span>Task 5: Finishing the Upgrade and Removing Oracle Streams
                  </h4>
                  <div>
                     <div class="section">
                        <p>Complete the following steps to finish the upgrade operation using Oracle Streams and remove Oracle Streams components:</p>
                        <ol>
                           <li>
                              <p>Connect to the <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a> as the Oracle Streams administrator. In this example, the destination database is <code class="codeph">updb.example.com</code>.
                              </p>
                              <p>See <a href="../admin/index.html"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                              </p>
                           </li>
                           <li>
                              <p>Start the apply process. For example:</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; 'apply_upgrade');
END;
/
</pre></li>
                           <li>
                              <p>Connect to the capture database as the Oracle Streams administrator.</p>
                           </li>
                           <li>
                              <p>Start the capture process. For example:</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_CAPTURE_ADM.START_CAPTURE(
    capture_name  =&gt; 'capture_upgrade');
END;
/
</pre><p>This step begins the process of replicating changes that were made to the source database during instantiation of the destination database.</p>
                           </li>
                           <li id="GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__i640253">
                              <p>While still connected as the Oracle Streams administrator in SQL*Plus to the capture database, monitor the Oracle Streams environment until the apply process at the destination database has applied most of the changes from the source database.</p>
                              <p>To determine whether the apply process at the destination database has applied most of the changes from the source database, complete the following steps:</p>
                              <ol type="a">
                                 <li id="GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__BABBJHFE">
                                    <p>Query the enqueue message number of the capture process and the message number with the oldest system change number (SCN) for the apply process to see if they are nearly equal.</p>
                                    <p>For example, if the name of the capture process is <code class="codeph">capture_upgrade</code>, and the name of the apply process is <code class="codeph">apply_upgrade</code>, then run the following query at the capture database:
                                    </p><pre class="oac_no_warn" dir="ltr">COLUMN ENQUEUE_MESSAGE_NUMBER HEADING 'Captured SCN' FORMAT 99999999999
COLUMN OLDEST_SCN_NUM HEADING 'Oldest Applied SCN' FORMAT 99999999999

SELECT c.ENQUEUE_MESSAGE_NUMBER, a.OLDEST_SCN_NUM
  FROM V$STREAMS_CAPTURE c, V$STREAMS_APPLY_READER@updb.example.com a
  WHERE c.CAPTURE_NAME = 'CAPTURE_UPGRADE'
    AND a.APPLY_NAME   = 'APPLY_UPGRADE';
</pre><p>When the two values returned by this query are nearly equal, most of the changes from the source database have been applied at the destination database, and you can proceed to the next step. At this point in the process, the values returned by this query might never be equal because the source database still allows changes.</p>
                                    <p>If this query returns no results, then ensure that the <a href="strms_glossary.html#GUID-1ADE5718-8C94-4762-85E9-6B032F124365"><span class="xrefglossterm">Oracle Streams client</span></a>s in the environment are enabled by querying the <code class="codeph">STATUS</code> column in the <code class="codeph">DBA_CAPTURE</code> view at the capture database and the <code class="codeph">DBA_APPLY</code> view at the destination database. If a <a href="strms_glossary.html#GUID-13E35632-96B9-4A58-8990-EF95ECE9746E"><span class="xrefglossterm">propagation</span></a> is used, you can check the status of the propagation by running the query in <span class="q">"<a href="monitoring-oracle-streams-queues-and-propagations.html#GUID-B1599124-455A-4716-9DBC-88D64E098FB3">Displaying Information About the Schedules for Propagation Jobs</a>"</span>. 
                                    </p>
                                    <p>If an Oracle Streams client is disabled, then try restarting it. If an Oracle Streams client will not restart, then troubleshoot the environment using the information in <a href="identifying-problems-in-an-oracle-streams-environment.html#GUID-AA72B004-1B11-4851-978B-33C1EA401CF9"> Identifying Problems in an Oracle Streams Environment</a>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Query the state of the apply process apply servers at the destination database to determine whether they have finished applying changes.</p>
                                    <p>For example, if the name of the apply process is <code class="codeph">apply_upgrade</code>, then run the following query at the capture database:
                                    </p><pre class="oac_no_warn" dir="ltr">COLUMN STATE HEADING 'Apply Server State' FORMAT A20
 
SELECT STATE
  FROM V$STREAMS_APPLY_SERVER@updb.example.com
  WHERE APPLY_NAME = 'APPLY_UPGRADE';
</pre><p>When the state for all apply servers is <code class="codeph">IDLE</code>, you can proceed to the next step.
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li>
                              <p>Connect to the destination database as the Oracle Streams administrator. In this example, the destination database is <code class="codeph">updb.example.com</code>.
                              </p>
                           </li>
                           <li id="GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__i640262">
                              <p>Ensure that there are no apply errors by running the following query:</p><pre class="oac_no_warn" dir="ltr">SELECT COUNT(*) FROM DBA_APPLY_ERROR;
</pre><p>If this query returns zero, then proceed to the next step. If this query shows errors in the error queue, then resolve these errors before continuing. See <span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-3C45493C-6DD6-478F-98D7-71A857D17FDD">Managing Apply Errors</a>"</span> for more information.
                              </p>
                           </li>
                           <li>
                              <p>Disconnect all applications and users from the source database.</p>
                           </li>
                           <li>
                              <p>Connect as an administrative user to the source database. In this example, the source database is <code class="codeph">orcl.example.com</code>.
                              </p>
                           </li>
                           <li>
                              <p>Restrict access to the database. For example:</p><pre class="oac_no_warn" dir="ltr">ALTER SYSTEM ENABLE RESTRICTED SESSION;
</pre></li>
                           <li>
                              <p>Connect as an administrative user in SQL*Plus to the capture database, and repeat the query you ran in Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__i640253">5</a><a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__BABBJHFE">5.a</a>. When the two values returned by the query are equal, all of the changes from the source database have been applied at the destination database, and you can proceed to the next step.
                              </p>
                           </li>
                           <li>
                              <p>Connect as the Oracle Streams administrator in SQL*Plus to the destination database, and repeat the query you ran in Step <a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__i640262">7</a>. If this query returns zero, then move on to the next step. If this query shows errors in the error queue, then resolve these errors before continuing. See <span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-3C45493C-6DD6-478F-98D7-71A857D17FDD">Managing Apply Errors</a>"</span> for more information.
                              </p>
                           </li>
                           <li id="GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__CHDJIFEA">
                              <p>If you performed any actions that created, modified, or deleted job queue processes at the source database during the upgrade process, then perform the same actions at the destination database. See <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-060439BD-616F-478E-801D-0E60008CE687">Considerations for Job Queue Processes and PL/SQL Package Subprograms</a>"</span> for more information.
                              </p>
                           </li>
                           <li id="GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__CHDBDBDC">
                              <p>If you invoked any Oracle-supplied PL/SQL package subprograms at the source database during the upgrade process that modified both user data and dictionary metadata at the same time, then invoke the same subprograms at the destination database. See <span class="q">"<a href="online-upgrade-of-an-earlier-database-with-oracle-streams.html#GUID-060439BD-616F-478E-801D-0E60008CE687">Considerations for Job Queue Processes and PL/SQL Package Subprograms</a>"</span> for more information.
                              </p>
                           </li>
                           <li>
                              <p>Shut down the source database. This database should not be opened again.</p>
                           </li>
                           <li>
                              <p>Connect to the destination database as an administrative user.</p>
                           </li>
                           <li>
                              <p>Change the global name of the database to match the source database. For example:</p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE RENAME GLOBAL_NAME TO orcl.example.com;
</pre></li>
                           <li>
                              <p>At the destination database, enable any jobs that you disabled earlier.</p>
                           </li>
                           <li>
                              <p>Make the destination database available for applications and users. Redirect any applications and users that were connecting to the source database to the destination database. If necessary, reconfigure your network and Oracle Net so that systems that communicated with the source database now communicate with the destination database. See<a href="../netag/index.html"><span class="italic"> Oracle Database Net Services Administrator's Guide </span></a>for more information.
                              </p>
                           </li>
                           <li>
                              <p>At the destination database, remove the Oracle Streams components that are no longer needed. Connect as an administrative user to the destination database, and run the following procedure:</p>
                              <div class="infoboxnote" id="GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__GUID-579B576B-212E-42FD-82E4-9309DB95B125">
                                 <p class="notep1">Note:</p>
                                 <p>Running this procedure is dangerous. It removes the local Oracle Streams configuration. Ensure that you are ready to remove the Oracle Streams configuration at the destination database before running this procedure.</p>
                              </div><pre class="oac_no_warn" dir="ltr">EXEC DBMS_STREAMS_ADM.REMOVE_STREAMS_CONFIGURATION();
</pre><p>If you no longer need <a href="strms_glossary.html#GUID-F07A6AB2-5AA0-45FA-8B00-862DD2D087DB"><span class="xrefglossterm">database supplemental logging</span></a> at the destination database, then run the following statement to drop it:
                              </p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DROP SUPPLEMENTAL LOG DATA 
  (PRIMARY KEY, UNIQUE, FOREIGN KEY) COLUMNS;
</pre><p>If you no longer need the Oracle Streams administrator at the destination database, then run the following statement:</p><pre class="oac_no_warn" dir="ltr">DROP USER strmadmin CASCADE;
</pre></li>
                           <li>
                              <p>If the capture database was a third database, then, at the third database, remove the Oracle Streams components that are no longer needed. Connect as an administrative user to the third database, and run the following procedure:</p>
                              <div class="infoboxnote" id="GUID-8D4F5309-1C49-43F0-858C-77285CD9DF09__GUID-981029FD-670E-4362-91B7-62FF2DBE0260">
                                 <p class="notep1">Note:</p>
                                 <p>Running this procedure is dangerous. It removes the local Oracle Streams configuration. Ensure that you are ready to remove the Oracle Streams configuration at the third database before running this procedure.</p>
                              </div><pre class="oac_no_warn" dir="ltr">EXEC DBMS_STREAMS_ADM.REMOVE_STREAMS_CONFIGURATION();
</pre><p>If you no longer need database <a href="strms_glossary.html#GUID-27DA88A1-EDB9-4AC5-ACD0-BD514172385F"><span class="xrefglossterm">supplemental logging</span></a> at the third database, then run the following statement to drop it:
                              </p><pre class="oac_no_warn" dir="ltr">ALTER DATABASE DROP SUPPLEMENTAL LOG DATA 
  (PRIMARY KEY, UNIQUE, FOREIGN KEY) COLUMNS;
</pre><p>If you no longer need the Oracle Streams administrator at the destination database, then run the following statement:</p><pre class="oac_no_warn" dir="ltr">DROP USER strmadmin CASCADE;
</pre></li>
                        </ol>
                        <p>The database upgrade is complete.</p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>