<!DOCTYPE html
  SYSTEM "about:legacy-compat">

<!-- saved from url=(0023)https://docs.oracle.com -->

<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Managing Oracle Streams Information Consumption</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Concepts and Administration ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Concepts and Administration">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.1.1">
      <link rel="alternate" href="streams-concepts-and-administration.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-01-25T21:40:57-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E83781-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      <meta name="dcterms.release" content="Release 18">
      <link rel="prev" href="managing-staging-and-propagation.html" title="Previous" type="text/html">
      <link rel="next" href="managing-rules.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Streams Concepts and Administration">
    <meta name="dcterms.isVersionOf" content="STRMS">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-staging-and-propagation.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="managing-rules.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Concepts and Administration </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="oracle-streams-administration.html" property="item" typeof="WebPage"><span property="name">    Oracle Streams Administration </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Managing Oracle Streams Information Consumption</li>
            </ol>
            <a id="GUID-9DEB34C0-21DC-41E0-96CE-699D279F8C42" name="GUID-9DEB34C0-21DC-41E0-96CE-699D279F8C42"></a><a id="STRMS009"></a><a id="STRMS_MANAGING_APPLY"></a>
            
            <h2 id="STRMS-GUID-9DEB34C0-21DC-41E0-96CE-699D279F8C42" class="sect2"><span class="enumeration_chapter">17 </span> Managing Oracle Streams Information Consumption
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d78429e127" class="indexterm-anchor"></a><a id="d78429e131" class="indexterm-anchor"></a><a id="d78429e133" class="indexterm-anchor"></a>An <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> implicitly consumes information in an Oracle Streams environment. An apply process dequeues logical change records (LCRs) and <a href="strms_glossary.html#GUID-7613B49E-9B03-4C9E-9A00-C92C6B2CEC9A"><span class="xrefglossterm">user message</span></a>s from a specific <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> and either applies each one directly or passes it as a parameter to a user-defined procedure.
               </p>
               <p>The following topics describe managing Oracle Streams apply processes:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-99793C11-1703-4A3A-BA60-80F91E5E4448">Starting an Apply Process</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-458C5D9F-EE99-45BE-A94A-E1BC0F4A92C3">Stopping an Apply Process</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-BA7226BF-7A45-4EC5-A36F-152DFAE20020">Managing the Rule Set for an Apply Process</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-A24A2FCA-845A-43EA-A7E2-033335CBE558">Setting an Apply Process Parameter</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-4E252DDA-71C1-4C75-9F30-BD4EBED05275">Setting the Apply User for an Apply Process</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-A6074063-2D66-4FB9-864D-D5228624732A">Managing a DML Handler</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-78F7035F-FAC9-4DB0-9336-A5C8833902E3">Managing a DDL Handler</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-B6EDB895-EAF9-449D-A4CC-475317A43AD9">Managing the Message Handler for an Apply Process</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-B61BF83E-0B0A-45FD-89A0-3E58AB42118A">Managing the Precommit Handler for an Apply Process</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-80FC2523-4B43-42D1-80F0-2A796BA81938">Specifying That Apply Processes Enqueue Messages</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-C9D9ABD3-392A-4AF6-BD91-6A75E050AEFA">Specifying Execute Directives for Apply Processes</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-B753BE7F-596C-496B-82E5-C0F24947420A">Managing an Error Handler</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-3C45493C-6DD6-478F-98D7-71A857D17FDD">Managing Apply Errors</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-F893917F-8877-4A42-BF8F-43C832F2AE8A">Managing the Substitute Key Columns for a Table</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-4102EAC2-B30D-491A-9736-BFCDA41B4B0E">Using Virtual Dependency Definitions</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-information-consumption.html#GUID-ADDA7BD3-3D52-41B5-944B-2E4E324ECE4F">Dropping an Apply Process</a></p>
                  </li>
               </ul>
               <p>Each task described in this chapter should be completed by an Oracle Streams administrator that has been granted the appropriate privileges, unless specified otherwise.</p>
               <div class="infoboxnotealso" id="GUID-9DEB34C0-21DC-41E0-96CE-699D279F8C42__GUID-72B883DC-E71E-42B6-9CD6-D7EFCB128E79">
                  <p class="notep1">See Also:</p>
                  <p></p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="oracle-streams-information-consumption.html#GUID-2AB34D95-F1F8-400B-881E-7D2E9B7768B0"> Oracle Streams Information Consumption</a></p>
                     </li>
                     <li>
                        <p><span class="q">"<a href="monitoring-oracle-streams-apply-processes.html#GUID-F371ACB8-C66F-4580-9DD0-491997F6DF80"> Monitoring Oracle Streams Apply Processes</a>"</span></p>
                     </li>
                     <li>
                        <p><a href="troubleshooting-apply.html#GUID-D65CBC5C-5C21-4D02-89B9-D08C75F829F2"> Troubleshooting Apply</a></p>
                     </li>
                     <li>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=STREP200"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for information about creating an Oracle Streams administrator
                        </p>
                     </li>
                     <li>
                        <p>The Oracle Enterprise Manager Cloud Control online Help for instructions on managing an apply process with Oracle Enterprise Manager Cloud Control</p>
                     </li>
                  </ul>
               </div>
            </div><a id="STRMS216"></a><div class="props_rev_3"><a id="GUID-99793C11-1703-4A3A-BA60-80F91E5E4448" name="GUID-99793C11-1703-4A3A-BA60-80F91E5E4448"></a><h3 id="STRMS-GUID-99793C11-1703-4A3A-BA60-80F91E5E4448" class="sect3"><span class="enumeration_section">17.1 </span>Starting an Apply Process
               </h3>
               <div>
                  <div class="section">
                     <p>You run the <code class="codeph">START_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to start an existing <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>. For example, the following procedure starts an apply process named <code class="codeph">strm01_apply</code>:
                     </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.START_APPLY(
 &nbsp;&nbsp;&nbsp;apply_name =&gt; 'strm01_apply');
END;
/
</pre><div class="infoboxnotealso" id="GUID-99793C11-1703-4A3A-BA60-80F91E5E4448__GUID-E4CE27B1-587D-4CF9-A1F9-29ABE757F37A">
                        <p class="notep1">See Also:</p>
                        <p>The Oracle Enterprise Manager Cloud Control online help for instructions about starting an apply process with Oracle Enterprise Manager Cloud Control</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STRMS718"></a><div class="props_rev_3"><a id="GUID-458C5D9F-EE99-45BE-A94A-E1BC0F4A92C3" name="GUID-458C5D9F-EE99-45BE-A94A-E1BC0F4A92C3"></a><h3 id="STRMS-GUID-458C5D9F-EE99-45BE-A94A-E1BC0F4A92C3" class="sect3"><span class="enumeration_section">17.2 </span>Stopping an Apply Process
               </h3>
               <div>
                  <div class="section">
                     <p>You run the <code class="codeph">STOP_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to stop an existing <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>. For example, the following procedure stops an apply process named <code class="codeph">strm01_apply</code>:
                     </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.STOP_APPLY(
 &nbsp;&nbsp;&nbsp;apply_name =&gt; 'strm01_apply');
END;
/
</pre><div class="infoboxnotealso" id="GUID-458C5D9F-EE99-45BE-A94A-E1BC0F4A92C3__GUID-B65B3988-5EDC-40D6-BF69-69DE3A7FAE46">
                        <p class="notep1">See Also:</p>
                        <p>The Oracle Enterprise Manager Cloud Control online help for instructions about stopping an apply process with Oracle Enterprise Manager Cloud Control</p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STRMS719"></a><div class="props_rev_3"><a id="GUID-BA7226BF-7A45-4EC5-A36F-152DFAE20020" name="GUID-BA7226BF-7A45-4EC5-A36F-152DFAE20020"></a><h3 id="STRMS-GUID-BA7226BF-7A45-4EC5-A36F-152DFAE20020" class="sect3"><span class="enumeration_section">17.3 </span>Managing the Rule Set for an Apply Process
               </h3>
               <div>
                  <p>This section contains instructions for completing the following tasks:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-A51060A0-59D8-4F25-AF70-FBF1CF469DFB">Specifying the Rule Set for an Apply Process</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-7133707B-0977-48F9-9431-3C30751274C1">Adding Rules to the Rule Set for an Apply Process</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-DE8FC200-A143-483A-BE0F-C56562AA2A3E">Removing a Rule from the Rule Set for an Apply Process</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-F5A8517E-AB9C-4521-B348-CB415544DEC1">Removing a Rule Set for an Apply Process</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-BA7226BF-7A45-4EC5-A36F-152DFAE20020__GUID-7706E101-D736-4844-B48C-5917F073C758">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="how-rules-are-used-in-oracle-streams.html#GUID-FBC295B1-E3CD-428C-A3BF-69F74214DA14"> How Rules Are Used in Oracle Streams</a></p>
                        </li>
                        <li>
                           <p><a href="advanced-rule-concepts.html#GUID-5E6F0B16-C959-46EC-984E-1B5FC642A16D"> Advanced Rule Concepts</a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="STRMS720"></a><div class="props_rev_3"><a id="GUID-A51060A0-59D8-4F25-AF70-FBF1CF469DFB" name="GUID-A51060A0-59D8-4F25-AF70-FBF1CF469DFB"></a><h4 id="STRMS-GUID-A51060A0-59D8-4F25-AF70-FBF1CF469DFB" class="sect4"><span class="enumeration_section">17.3.1 </span>Specifying the Rule Set for an Apply Process
                  </h4>
                  <div>
                     <p>You can specify one <a href="strms_glossary.html#GUID-A810B839-61A2-4DEB-85C9-8F2F09455268"><span class="xrefglossterm">positive rule set</span></a> and one <a href="strms_glossary.html#GUID-F44D0886-397B-4E00-A666-A19F96F3C242"><span class="xrefglossterm">negative rule set</span></a> for an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>. The apply process applies a <a href="strms_glossary.html#GUID-62ABA207-07D4-453A-AC59-B0C780A3FB59"><span class="xrefglossterm">message</span></a> if it evaluates to <code class="codeph">TRUE</code> for at least one <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a> in the positive rule set and discards a message if it evaluates to <code class="codeph">TRUE</code> for at least one rule in the negative rule set. The negative rule set is evaluated before the positive rule set.
                     </p>
                  </div><a id="STRMS721"></a><div class="props_rev_3"><a id="GUID-336B6BE2-3407-474B-9634-460B8A500F5B" name="GUID-336B6BE2-3407-474B-9634-460B8A500F5B"></a><h5 id="STRMS-GUID-336B6BE2-3407-474B-9634-460B8A500F5B" class="sect5"><span class="enumeration_section">17.3.1.1 </span>Specifying a Positive Rule Set for an Apply Process
                     </h5>
                     <div>
                        <div class="section">
                           <p>You specify an existing <a href="strms_glossary.html#GUID-36BC41F8-E073-4AFE-ADF1-5036DD323379"><span class="xrefglossterm">rule set</span></a> as the positive rule set for an existing apply process using the <code class="codeph">rule_set_name</code> parameter in the <code class="codeph">ALTER_APPLY</code> procedure. This procedure is in the <code class="codeph">DBMS_APPLY_ADM</code> package. 
                           </p>
                           <p>For example, the following procedure sets the positive rule set for an apply process named <code class="codeph">strm01_apply</code> to <code class="codeph">strm02_rule_set</code>.
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name    =&gt; 'strm01_apply',
    rule_set_name =&gt; 'strmadmin.strm02_rule_set');
END;
/</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS722"></a><div class="props_rev_3"><a id="GUID-D66CBFFE-925D-4FF9-A918-8ECFB6CD04F7" name="GUID-D66CBFFE-925D-4FF9-A918-8ECFB6CD04F7"></a><h5 id="STRMS-GUID-D66CBFFE-925D-4FF9-A918-8ECFB6CD04F7" class="sect5"><span class="enumeration_section">17.3.1.2 </span>Specifying a Negative Rule Set for an Apply Process
                     </h5>
                     <div>
                        <div class="section">
                           <p>You specify an existing rule set as the negative rule set for an existing apply process using the <code class="codeph">negative_rule_set_name</code> parameter in the <code class="codeph">ALTER_APPLY</code> procedure. This procedure is in the <code class="codeph">DBMS_APPLY_ADM</code> package. 
                           </p>
                           <p>For example, the following procedure sets the negative rule set for an apply process named <code class="codeph">strm01_apply</code> to <code class="codeph">strm03_rule_set</code>.
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name             =&gt; 'strm01_apply',
    negative_rule_set_name =&gt; 'strmadmin.strm03_rule_set');
END;
/</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="STRMS723"></a><div class="props_rev_3"><a id="GUID-7133707B-0977-48F9-9431-3C30751274C1" name="GUID-7133707B-0977-48F9-9431-3C30751274C1"></a><h4 id="STRMS-GUID-7133707B-0977-48F9-9431-3C30751274C1" class="sect4"><span class="enumeration_section">17.3.2 </span>Adding Rules to the Rule Set for an Apply Process
                  </h4>
                  <div>
                     <p>To add <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a>s to the <a href="strms_glossary.html#GUID-36BC41F8-E073-4AFE-ADF1-5036DD323379"><span class="xrefglossterm">rule set</span></a> for an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>, you can run one of the following procedures:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ARPLS308"><code class="codeph">DBMS_STREAMS_ADM.ADD_TABLE_RULES</code></a></p>
                        </li>
                        <li>
                           <p><a href="../arpls/DBMS_STREAMS_ADM.html#ARPLS329"><code class="codeph">DBMS_STREAMS_ADM.ADD_SUBSET_RULES</code></a></p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ARPLS309"><code class="codeph">DBMS_STREAMS_ADM.ADD_SCHEMA_RULES</code></a></p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ARPLS310"><code class="codeph">DBMS_STREAMS_ADM.ADD_GLOBAL_RULES</code></a></p>
                        </li>
                     </ul>
                     <p>Excluding the <code class="codeph">ADD_SUBSET_RULES</code> procedure, these procedures can add rules to the <a href="strms_glossary.html#GUID-A810B839-61A2-4DEB-85C9-8F2F09455268"><span class="xrefglossterm">positive rule set</span></a> or <a href="strms_glossary.html#GUID-F44D0886-397B-4E00-A666-A19F96F3C242"><span class="xrefglossterm">negative rule set</span></a> for an apply process. The <code class="codeph">ADD_SUBSET_RULES</code> procedure can add rules only to the positive rule set for an apply process.
                     </p>
                     <div class="infoboxnotealso" id="GUID-7133707B-0977-48F9-9431-3C30751274C1__GUID-CA41C89E-5CBD-45E0-ACF1-DD91E5EC8C04">
                        <p class="notep1">See Also:</p>
                        <p><span class="q">"<a href="how-rules-are-used-in-oracle-streams.html#GUID-979FB5C9-7EE7-4E0B-9D28-15696A78DC89">System-Created Rules</a>"</span></p>
                     </div>
                  </div><a id="STRMS724"></a><div class="props_rev_3"><a id="GUID-C4257B61-3CE0-4F4A-A7EB-6D04FAA6E33D" name="GUID-C4257B61-3CE0-4F4A-A7EB-6D04FAA6E33D"></a><h5 id="STRMS-GUID-C4257B61-3CE0-4F4A-A7EB-6D04FAA6E33D" class="sect5"><span class="enumeration_section">17.3.2.1 </span>Adding Rules to the Positive Rule Set for an Apply Process
                     </h5>
                     <div>
                        <div class="section">
                           <p>The following example runs the <code class="codeph">ADD_TABLE_RULES</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package to add rules to the positive rule set of an apply process named <code class="codeph">strm01_apply</code>:
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
 &nbsp;&nbsp;&nbsp;table_name       =&gt; 'hr.departments',
 &nbsp;&nbsp;&nbsp;streams_type     =&gt; 'apply',
 &nbsp;&nbsp;&nbsp;streams_name     =&gt; 'strm01_apply',
 &nbsp;&nbsp;&nbsp;queue_name &nbsp;&nbsp;&nbsp;   =&gt; 'streams_queue',
 &nbsp;&nbsp;&nbsp;include_dml &nbsp;    =&gt; TRUE,
&nbsp; &nbsp;&nbsp;include_ddl      =&gt; TRUE,
    source_database  =&gt; 'dbs1.example.com',
    inclusion_rule   =&gt; TRUE);
END;
/
</pre><p>Running this procedure performs the following actions:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Creates one rule that evaluates to <code class="codeph">TRUE</code> for row LCRs that contain the results of DML changes to the <code class="codeph">hr.departments</code> table. The rule name is system generated.
                                 </p>
                              </li>
                              <li>
                                 <p>Creates one rule that evaluates to <code class="codeph">TRUE</code> for DDL LCRs that contain DDL changes to the <code class="codeph">hr.departments</code> table. The rule name is system generated.
                                 </p>
                              </li>
                              <li>
                                 <p>Specifies that both rules evaluate to <code class="codeph">TRUE</code> only for LCRs whose changes originated at the <code class="codeph">dbs1.example.com</code> <a href="strms_glossary.html#GUID-B5BB35D0-9179-4301-BA50-5B9CE22E362D"><span class="xrefglossterm">source database</span></a>.
                                 </p>
                              </li>
                              <li>
                                 <p>Adds the rules to the positive rule set associated with the apply process because the <code class="codeph">inclusion_rule</code> parameter is set to <code class="codeph">TRUE</code>.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS725"></a><div class="props_rev_3"><a id="GUID-ACE81360-B28E-4C00-8BE2-EA4CB8964808" name="GUID-ACE81360-B28E-4C00-8BE2-EA4CB8964808"></a><h5 id="STRMS-GUID-ACE81360-B28E-4C00-8BE2-EA4CB8964808" class="sect5"><span class="enumeration_section">17.3.2.2 </span>Adding Rules to the Negative Rule Set for an Apply Process
                     </h5>
                     <div>
                        <div class="section">
                           <p>The following example runs the <code class="codeph">ADD_TABLE_RULES</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package to add rules to the negative rule set of an apply process named <code class="codeph">strm01_apply</code>:
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
 &nbsp;&nbsp;&nbsp;table_name       =&gt; 'hr.regions',
 &nbsp;&nbsp;&nbsp;streams_type     =&gt; 'apply',
 &nbsp;&nbsp;&nbsp;streams_name     =&gt; 'strm01_apply',
 &nbsp;&nbsp;&nbsp;queue_name &nbsp;&nbsp;&nbsp;   =&gt; 'streams_queue',
 &nbsp;&nbsp;&nbsp;include_dml &nbsp;    =&gt; TRUE,
&nbsp; &nbsp;&nbsp;include_ddl      =&gt; TRUE,
    source_database  =&gt; 'dbs1.example.com',
    inclusion_rule   =&gt; FALSE);
END;
/
</pre><p>Running this procedure performs the following actions:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Creates one rule that evaluates to <code class="codeph">TRUE</code> for row LCRs that contain the results of DML changes to the <code class="codeph">hr.regions</code> table. The rule name is system generated.
                                 </p>
                              </li>
                              <li>
                                 <p>Creates one rule that evaluates to <code class="codeph">TRUE</code> for DDL LCRs that contain DDL changes to the <code class="codeph">hr.regions</code> table. The rule name is system generated.
                                 </p>
                              </li>
                              <li>
                                 <p>Specifies that both rules evaluate to <code class="codeph">TRUE</code> only for LCRs whose changes originated at the <code class="codeph">dbs1.example.com</code> source database.
                                 </p>
                              </li>
                              <li>
                                 <p>Adds the rules to the negative rule set associated with the apply process because the <code class="codeph">inclusion_rule</code> parameter is set to <code class="codeph">FALSE</code>.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="STRMS726"></a><div class="props_rev_3"><a id="GUID-DE8FC200-A143-483A-BE0F-C56562AA2A3E" name="GUID-DE8FC200-A143-483A-BE0F-C56562AA2A3E"></a><h4 id="STRMS-GUID-DE8FC200-A143-483A-BE0F-C56562AA2A3E" class="sect4"><span class="enumeration_section">17.3.3 </span>Removing a Rule from the Rule Set for an Apply Process
                  </h4>
                  <div>
                     <div class="section">
                        <p>You remove a <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a> from a <a href="strms_glossary.html#GUID-36BC41F8-E073-4AFE-ADF1-5036DD323379"><span class="xrefglossterm">rule set</span></a> for an existing <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> by running the <code class="codeph">REMOVE_RULE</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package. For example, the following procedure removes a rule named <code class="codeph">departments3</code> from the <a href="strms_glossary.html#GUID-A810B839-61A2-4DEB-85C9-8F2F09455268"><span class="xrefglossterm">positive rule set</span></a> of an apply process named <code class="codeph">strm01_apply</code>.
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.REMOVE_RULE(
&nbsp; &nbsp;&nbsp;rule_name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 'departments3',
&nbsp; &nbsp; streams_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; 'apply',
  &nbsp;&nbsp;streams_name&nbsp;&nbsp; &nbsp;&nbsp;=&gt; 'strm01_apply',
    drop_unused_rule&nbsp;=&gt; TRUE,
    inclusion_rule   =&gt; TRUE);
END;
/
</pre><p>In this example, the <code class="codeph">drop_unused_rule</code> parameter in the <code class="codeph">REMOVE_RULE</code> procedure is set to <code class="codeph">TRUE</code>, which is the default setting. Therefore, if the rule being removed is not in any other rule set, then it will be dropped from the database. If the <code class="codeph">drop_unused_rule</code> parameter is set to <code class="codeph">FALSE</code>, then the rule is removed from the rule set, but it is not dropped from the database even if it is not in any other rule set.
                        </p>
                        <p>If the <code class="codeph">inclusion_rule</code> parameter is set to <code class="codeph">FALSE</code>, then the <code class="codeph">REMOVE_RULE</code> procedure removes the rule from the <a href="strms_glossary.html#GUID-F44D0886-397B-4E00-A666-A19F96F3C242"><span class="xrefglossterm">negative rule set</span></a> for the apply process, not from the positive rule set.
                        </p>
                        <p>To remove all of the rules in a rule set for the apply process, then specify <code class="codeph">NULL</code> for the <code class="codeph">rule_name</code> parameter when you run the <code class="codeph">REMOVE_RULE</code> procedure.
                        </p>
                        <div class="infoboxnotealso" id="GUID-DE8FC200-A143-483A-BE0F-C56562AA2A3E__GUID-6F97EDE3-8A43-4FDF-96EC-EF73D03E3CDE">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="how-rules-are-used-in-oracle-streams.html#GUID-594815E2-3F64-4BC2-92D1-EE7A7C4CA88E">Oracle Streams Client with One or More Empty Rule Sets</a>"</span></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS727"></a><div class="props_rev_3"><a id="GUID-F5A8517E-AB9C-4521-B348-CB415544DEC1" name="GUID-F5A8517E-AB9C-4521-B348-CB415544DEC1"></a><h4 id="STRMS-GUID-F5A8517E-AB9C-4521-B348-CB415544DEC1" class="sect4"><span class="enumeration_section">17.3.4 </span>Removing a Rule Set for an Apply Process
                  </h4>
                  <div>
                     <div class="section">
                        <p>You remove a <a href="strms_glossary.html#GUID-36BC41F8-E073-4AFE-ADF1-5036DD323379"><span class="xrefglossterm">rule set</span></a> from an existing <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> using the <code class="codeph">ALTER_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. This procedure can remove the <a href="strms_glossary.html#GUID-A810B839-61A2-4DEB-85C9-8F2F09455268"><span class="xrefglossterm">positive rule set</span></a>, <a href="strms_glossary.html#GUID-F44D0886-397B-4E00-A666-A19F96F3C242"><span class="xrefglossterm">negative rule set</span></a>, or both. Specify <code class="codeph">TRUE</code> for the <code class="codeph">remove_rule_set</code> parameter to remove the positive rule set for the apply process. Specify <code class="codeph">TRUE</code> for the <code class="codeph">remove_negative_rule_set</code> parameter to remove the negative rule set for the apply process.
                        </p>
                        <p>For example, the following procedure removes both the positive and negative rule sets from an apply process named <code class="codeph">strm01_apply</code>.
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name               =&gt; 'strm01_apply',
    remove_rule_set          =&gt; TRUE,
    remove_negative_rule_set =&gt; TRUE);
END;
/</pre><div class="infoboxnote" id="GUID-F5A8517E-AB9C-4521-B348-CB415544DEC1__GUID-7298112E-577F-4E4E-9079-C7890C8CF9F6">
                           <p class="notep1">Note:</p>
                           <p>If an apply process that dequeues messages from a <a href="strms_glossary.html#GUID-9ABDA00F-83A1-435F-8E93-315D3D05E4B7"><span class="xrefglossterm">buffered queue</span></a>s does not have a positive or negative rule set, then the apply process dequeues all <a href="strms_glossary.html#GUID-0D2E5DAF-804E-4089-9E0E-987C96F59706"><span class="xrefglossterm">captured LCR</span></a>s in its <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a>. Similarly, if an apply process that dequeues messages from a <a href="strms_glossary.html#GUID-8D447372-AA6C-4326-8A8F-2E13F9350AF1"><span class="xrefglossterm">persistent queue</span></a> does not have a positive or negative rule set, the apply process dequeues all <a href="strms_glossary.html#GUID-32700BD5-7584-46D3-8224-B534FAC20DD7"><span class="xrefglossterm">persistent LCR</span></a>s and <a href="strms_glossary.html#GUID-8F1FA1C4-ADB5-4A4D-9374-B50AADB53066"><span class="xrefglossterm">persistent user message</span></a>s in its queue.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="STRMS728"></a><div class="props_rev_3"><a id="GUID-A24A2FCA-845A-43EA-A7E2-033335CBE558" name="GUID-A24A2FCA-845A-43EA-A7E2-033335CBE558"></a><h3 id="STRMS-GUID-A24A2FCA-845A-43EA-A7E2-033335CBE558" class="sect3"><span class="enumeration_section">17.4 </span>Setting an Apply Process Parameter
               </h3>
               <div>
                  <div class="section">
                     <p>Set an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> parameter using the <code class="codeph">SET_PARAMETER</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. Apply process parameters control the way an apply process operates.
                     </p>
                     <p>For example, the following procedure sets the <code class="codeph">commit_serialization</code> parameter for an apply process named <code class="codeph">strm01_apply</code> to <code class="codeph">DEPENDENT_TRANSACTIONS</code>. This setting for the <code class="codeph">commit_serialization</code> parameter enables the apply process to commit transactions in any order.
                     </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name   =&gt; 'strm01_apply',
    parameter    =&gt; 'commit_serialization',
    value        =&gt; 'DEPENDENT_TRANSACTIONS');
END;
/
</pre><div class="infoboxnote" id="GUID-A24A2FCA-845A-43EA-A7E2-033335CBE558__GUID-EDE64846-BC7C-4074-948A-F81653AD7BCA">
                        <p class="notep1">Note:</p>
                        <p></p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The <code class="codeph">value</code> parameter is always entered as a <code class="codeph">VARCHAR2</code> value, even if the parameter value is a number.
                              </p>
                           </li>
                           <li>
                              <p>If the <code class="codeph">value</code> parameter is set to <code class="codeph">NULL</code> or is not specified, then the parameter is set to its default value.
                              </p>
                           </li>
                           <li>
                              <p>If you set the <code class="codeph">parallelism</code> apply process parameter to a value greater than <code class="codeph">1</code>, then you must specify a conditional <a href="strms_glossary.html#GUID-23D2F665-5088-4E75-BD12-EA9DC0A1FC07"><span class="xrefglossterm">supplemental log group</span></a> at the <a href="strms_glossary.html#GUID-B5BB35D0-9179-4301-BA50-5B9CE22E362D"><span class="xrefglossterm">source database</span></a> for all of the unique key and foreign key columns in the tables for which an apply process applies changes. <a href="strms_glossary.html#GUID-27DA88A1-EDB9-4AC5-ACD0-BD514172385F"><span class="xrefglossterm">supplemental logging</span></a> might be required for other columns in these tables as well, depending on your configuration.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <div class="infoboxnotealso" id="GUID-A24A2FCA-845A-43EA-A7E2-033335CBE558__GUID-45CAB6E4-B45D-4E03-88A9-BD547D49AF48">
                        <p class="notep1">See Also:</p>
                        <p></p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-8222F401-A0FD-405D-85BA-FCD0C7DB929C">Apply Process Parameters</a>"</span></p>
                           </li>
                           <li>
                              <p>The Oracle Enterprise Manager Cloud Control online help for instructions about setting an apply process parameter with Oracle Enterprise Manager Cloud Control</p>
                           </li>
                           <li>
                              <p>The <code class="codeph">DBMS_APPLY_ADM.SET_PARAMETER</code> procedure in the<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ARPLS314"><span class="italic"> Oracle Database PL/SQL Packages and Types Reference </span></a>for detailed information about the apply process parameters
                              </p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=STREP107"><span class="italic">Oracle Streams Replication Administrator's Guide </span></a>for more information about specifying supplemental logging
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STRMS729"></a><div class="props_rev_3"><a id="GUID-4E252DDA-71C1-4C75-9F30-BD4EBED05275" name="GUID-4E252DDA-71C1-4C75-9F30-BD4EBED05275"></a><h3 id="STRMS-GUID-4E252DDA-71C1-4C75-9F30-BD4EBED05275" class="sect3"><span class="enumeration_section">17.5 </span>Setting the Apply User for an Apply Process
               </h3>
               <div>
                  <div class="section">
                     <p>The <a href="strms_glossary.html#GUID-87C6D214-6D80-452F-87A2-EA39B884189E"><span class="xrefglossterm">apply user</span></a> is the user who applies all DML changes and DDL changes that satisfy the <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> <a href="strms_glossary.html#GUID-36BC41F8-E073-4AFE-ADF1-5036DD323379"><span class="xrefglossterm">rule set</span></a>s and who runs user-defined <a href="strms_glossary.html#GUID-4CEA651A-4197-4731-93D4-315BCB5CBE70"><span class="xrefglossterm">apply handler</span></a>s. Set the apply user for an apply process using the <code class="codeph">apply_user</code> parameter in the <code class="codeph">ALTER_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. 
                     </p>
                     <p>To change the apply user, the user who invokes the <code class="codeph">ALTER_APPLY</code> procedure must be granted <code class="codeph">DBA</code> role. Only the <code class="codeph">SYS</code> user can set the <code class="codeph">apply_user</code> to <code class="codeph">SYS</code>.
                     </p>
                     <p>For example, the following procedure sets the apply user for an apply process named <code class="codeph">strm03_apply</code> to <code class="codeph">hr</code>.
                     </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name =&gt; 'strm03_apply',
    apply_user =&gt; 'hr');
END;
/
</pre><p>Running this procedure grants the new apply user dequeue privilege on the <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> used by the apply process and configures the user as a <a href="strms_glossary.html#GUID-B70AC3A1-F93B-445D-9BD1-342A94A9EDDE"><span class="xrefglossterm">secure queue</span></a> user of the queue. In addition, ensure that the apply user has the following privileges:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The necessary privileges to perform DML and DDL changes on the apply objects</p>
                        </li>
                        <li>
                           <p><code class="codeph">EXECUTE</code> privilege on the rule sets used by the apply process
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">EXECUTE</code> privilege on all <a href="strms_glossary.html#GUID-0E99A3FC-C59B-46D3-9908-A5E26A7AA91A"><span class="xrefglossterm">custom rule-based transformation</span></a> functions used in the rule set
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">EXECUTE</code> privilege on all apply handler procedures
                           </p>
                        </li>
                     </ul>
                     <p>These privileges can be granted to the apply user directly or through roles.</p>
                     <p>In addition, the apply user must be granted <code class="codeph">EXECUTE</code> privilege on all packages, including Oracle-supplied packages, that are invoked in subprograms run by the apply process. These privileges must be granted directly to the apply user. They cannot be granted through roles.
                     </p>
                     <div class="infoboxnote" id="GUID-4E252DDA-71C1-4C75-9F30-BD4EBED05275__GUID-05C82749-1E73-4BC8-A98B-CF52B5EF72B9">
                        <p class="notep1">Note:</p>
                        <p>If Oracle Database Vault is installed, then the user who changes the apply user must be granted the <code class="codeph">BECOME</code> <code class="codeph">USER</code> system privilege. Granting this privilege to the user is not required if Oracle Database Vault is not installed. You can revoke the <code class="codeph">BECOME</code> <code class="codeph">USER</code> system privilege from the user after apply user is changed, if necessary.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STRMS204"></a><div class="props_rev_3"><a id="GUID-A6074063-2D66-4FB9-864D-D5228624732A" name="GUID-A6074063-2D66-4FB9-864D-D5228624732A"></a><h3 id="STRMS-GUID-A6074063-2D66-4FB9-864D-D5228624732A" class="sect3"><span class="enumeration_section">17.6 </span>Managing a DML Handler
               </h3>
               <div>
                  <p>DML handlers process row logical change records (row LCRs) dequeued by an apply process. There are two types of DML handlers: statement DML handlers and procedure DML handlers. A statement DML handler uses a collection of SQL statements to process row LCRs, while a procedure DML handler uses a PL/SQL procedure to process row LCRs.</p>
                  <p>This section contains instructions for managing a DML handler:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-52FFD329-6D03-4389-A7B2-F00088248092">Managing a Statement DML Handler</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-61A2086D-5464-458D-BE20-858B002D98F9">Managing a Procedure DML Handler</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-A6074063-2D66-4FB9-864D-D5228624732A__GUID-CD434853-FE1A-48AB-A3AC-D29DC8BA94C8">
                     <p class="notep1">See Also:</p>
                     <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-91C26D01-385D-4BD0-A29F-C2A0BFED0360">Message Processing Options for an Apply Process</a>"</span></p>
                  </div>
               </div><a id="STRMS1468"></a><div class="props_rev_3"><a id="GUID-52FFD329-6D03-4389-A7B2-F00088248092" name="GUID-52FFD329-6D03-4389-A7B2-F00088248092"></a><h4 id="STRMS-GUID-52FFD329-6D03-4389-A7B2-F00088248092" class="sect4"><span class="enumeration_section">17.6.1 </span>Managing a Statement DML Handler
                  </h4>
                  <div>
                     <p>This section contains the following instructions for managing a statement DML handler:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-7FDF1FF1-85A1-45EA-B259-C52CD7B08E1E">Creating a Statement DML Handler and Adding It to an Apply Process</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-BA86C3A4-98B1-463E-9AF0-4E683E57E6D2">Adding Statements to a Statement DML Handler</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-C19F994E-53E2-4E69-839E-6E11CE8D98F1">Modifying a Statement in a Statement DML Handler</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-0B10F67F-F175-40CE-AB0E-E93A02BE0382">Removing Statements from a Statement DML Handler</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-7949BC66-E9BC-4A7D-BE8F-EBDFC4D28AB5">Removing a Statement DML Handler from an Apply Process</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-D59CB80C-F66B-4315-8F7B-32D63461F447">Dropping a Statement DML Handler</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-52FFD329-6D03-4389-A7B2-F00088248092__GUID-465A0A89-6119-43E3-B476-953A8C00FA72">
                        <p class="notep1">See Also:</p>
                        <p></p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-B0A12CDB-8207-4AA5-8093-A0EA0FCF9C22">Statement DML Handlers</a>"</span></p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="monitoring-oracle-streams-apply-processes.html#GUID-9365EAA5-67EF-4095-B70B-3D52100F6977">Displaying Information About Statement DML Handlers</a>"</span></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="STRMS1469"></a><div class="props_rev_3"><a id="GUID-7FDF1FF1-85A1-45EA-B259-C52CD7B08E1E" name="GUID-7FDF1FF1-85A1-45EA-B259-C52CD7B08E1E"></a><h5 id="STRMS-GUID-7FDF1FF1-85A1-45EA-B259-C52CD7B08E1E" class="sect5"><span class="enumeration_section">17.6.1.1 </span>Creating a Statement DML Handler and Adding It to an Apply Process
                     </h5>
                     <div>
                        <p>There are two ways to create a statement DML handler and add it to an apply process:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>One way creates the statement DML handler, adds one statement to it, and adds the statement DML handler to an apply process all in one step.</p>
                           </li>
                           <li>
                              <p>The other way uses distinct steps to create the statement DML handler, add one or more statements to it, and add the statement DML handler to an apply process.</p>
                           </li>
                        </ul>
                        <p>Typically, the one-step method is best when a statement DML handler will have only one statement. The multiple-step method is best when a statement DML handler will have several statements.</p>
                        <p>The following sections include examples that illustrate each method in detail:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="managing-oracle-streams-information-consumption.html#GUID-3A35D7A5-70EC-4248-815A-EC56891AF1F8">Creating a Statement DML Handler With One Statement</a></p>
                           </li>
                           <li>
                              <p><a href="managing-oracle-streams-information-consumption.html#GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F">Creating a Statement DML Handler With More Than One Statement</a></p>
                           </li>
                        </ul>
                     </div><a id="STRMS1470"></a><div class="props_rev_3"><a id="GUID-3A35D7A5-70EC-4248-815A-EC56891AF1F8" name="GUID-3A35D7A5-70EC-4248-815A-EC56891AF1F8"></a><h6 id="STRMS-GUID-3A35D7A5-70EC-4248-815A-EC56891AF1F8" class="sect6"><span class="enumeration_section">17.6.1.1.1 </span>Creating a Statement DML Handler With One Statement
                        </h6>
                        <div>
                           <div class="section">
                              <p>In some Oracle Streams replication environments, a replicated table is not exactly the same at the databases that share the table. In such environments, a statement DML handler can modify the DML change performed by row LCRs. Statement DML handlers cannot change the values of the columns in a row LCR. However, statement DML handlers can use SQL to insert a row or update a row with column values that are different than the ones in the row LCR.</p>
                              <p>The example in this section makes the following assumptions:</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>An Oracle Streams replication environment is configured to replicate changes to the <code class="codeph">oe.orders</code> table between a source database and a destination database. Changes to the <code class="codeph">oe.orders</code> table are captured by a capture process or a synchronous capture at the source database, sent to the destination database by a propagation, and applied by an apply process at the destination database.
                                    </p>
                                 </li>
                                 <li>
                                    <p>At the source database, the <code class="codeph">oe.orders</code> table includes an <code class="codeph">order_status</code> column. Assume that when an insert with an <code class="codeph">order_status</code> of <code class="codeph">1</code> is applied at the destination database, the <code class="codeph">order_status</code> should be changed to <code class="codeph">2</code>. The statement DML handler in this example makes this change. For inserts with an <code class="codeph">order_status</code> that is not equal to <code class="codeph">1</code>, the statement DML handler applies the original change in the row LCR without changing the <code class="codeph">order_status</code> value.
                                    </p>
                                 </li>
                              </ul>
                              <p>To create a statement DML handler that modifies inserts to the <code class="codeph">oe.orders</code> table, complete the following steps:
                              </p>
                              <ol>
                                 <li>
                                    <p>For the purposes of this example, specify the required supplemental logging at the source database:</p>
                                    <ol type="a">
                                       <li>
                                          <p>Connect to the source database as the Oracle Streams administrator.</p>
                                          <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                          </p>
                                       </li>
                                       <li>
                                          <p>Specify an unconditional supplemental log group that includes the <code class="codeph">order_status</code> column in the <code class="codeph">oe.orders</code> table:
                                          </p><pre class="oac_no_warn" dir="ltr">ALTER TABLE oe.orders ADD SUPPLEMENTAL LOG GROUP log_group_ord_stat  (order_status) ALWAYS;
</pre><p>Any columns used by a statement DML handler at a destination database must be in an unconditional log group at the source database.</p>
                                       </li>
                                    </ol>
                                 </li>
                                 <li>
                                    <p>Connect to the destination database the Oracle Streams administrator.</p>
                                 </li>
                                 <li>
                                    <p>Create the statement DML handler and add it to the apply process:</p><pre class="oac_no_warn" dir="ltr">DECLARE
  stmt CLOB;
BEGIN
  stmt := 'INSERT INTO oe.orders(
             order_id,
             order_date, 
             order_mode,
             customer_id,
             order_status,
             order_total,
             sales_rep_id,
             promotion_id) 
           VALUES(
             :new.order_id,
             :new.order_date, 
             :new.order_mode,
             :new.customer_id,
             DECODE(:new.order_status, 1, 2, :new.order_status),
             :new.order_total,
             :new.sales_rep_id,
             :new.promotion_id)';
  DBMS_APPLY_ADM.ADD_STMT_HANDLER(
    object_name        =&gt; 'oe.orders',
    operation_name     =&gt; 'INSERT',
    handler_name       =&gt; 'modify_orders',
    statement          =&gt; stmt,
    apply_name         =&gt; 'apply$_sta_2',
    comment            =&gt; 'Modifies inserts into the orders table');
END;
/
</pre><p>Notice that the <code class="codeph">DECODE</code> function changes an <code class="codeph">order_status</code> of <code class="codeph">1</code> to <code class="codeph">2</code>. If the <code class="codeph">order_status</code> in the row LCR is not <code class="codeph">1</code>, then the <code class="codeph">DECODE</code> function uses the original <code class="codeph">order_status</code> value by specifying <code class="codeph">:new.order_status</code> for the default in the <code class="codeph">DECODE</code> function.
                                    </p>
                                    <p>The <code class="codeph">ADD_STMT_HANDLER</code> procedure creates the <code class="codeph">modify_orders</code> statement DML handler and adds it to the <code class="codeph">apply$_sta_2</code> apply process. The statement DML handler is invoked when this apply process dequeues a row LCR that performs an insert on the <code class="codeph">oe.orders</code> table. To modify row LCRs that perform updates and deletes made to this table, separate statement DML handlers are required.
                                    </p>
                                 </li>
                              </ol>
                              <div class="infoboxnote" id="GUID-3A35D7A5-70EC-4248-815A-EC56891AF1F8__GUID-0C634FF5-0934-428A-99AF-281774391AF0">
                                 <p class="notep1">Note:</p>
                                 <p></p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>This statement in the <code class="codeph">modify_orders</code> statement DML handler performs the row change on the destination table. Therefore, you do not need to add an execute statement to the statement DML handler. The row change performed by the statement is committed when the apply process dequeues a commit directive for the row LCR's transaction.
                                       </p>
                                    </li>
                                    <li>
                                       <p>The <code class="codeph">ADD_STMT_HANDLER</code> procedure in this example adds the statement DML handler to the <code class="codeph">apply$_sta_2</code> apply process. To add a general statement DML handler that is used by all of the apply processes in the database, omit the <code class="codeph">apply_name</code> parameter in this procedure or set the <code class="codeph">apply_name</code> parameter to <code class="codeph">NULL</code>.
                                       </p>
                                    </li>
                                 </ul>
                              </div>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div><a id="STRMS1471"></a><div class="props_rev_3"><a id="GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F" name="GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F"></a><h6 id="STRMS-GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F" class="sect6"><span class="enumeration_section">17.6.1.1.2 </span>Creating a Statement DML Handler With More Than One Statement
                        </h6>
                        <div>
                           <div class="section">
                              <p>A statement DML handler can track the changes made to a table. The statement DML handler in this example tracks the updates made to the <code class="codeph">hr.jobs</code> table.
                              </p>
                              <p>The example in this section makes the following assumptions:</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>An Oracle Streams replication environment is configured to replicate changes to the <code class="codeph">hr.jobs</code> table between a source database and a destination database. Changes to the <code class="codeph">hr.jobs</code> table are captured by a capture process or a synchronous capture at the source database, sent to the destination database by a propagation, and applied by an apply process at the destination database. The <code class="codeph">hr.jobs</code> table contains the minimum and maximum salary for various jobs at an organization.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The goal is to track the updates to the salary information and when these updates were made. To accomplish this goal, the statement DML handler inserts rows into the <code class="codeph">hr.track_jobs</code> table.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The apply process must also execute the row LCRs to replicate the changes to the <code class="codeph">hr.jobs</code> table.
                                    </p>
                                 </li>
                              </ul>
                              <p>To create a statement DML handler that tracks updates to the <code class="codeph">hr.jobs</code>, complete the following steps:
                              </p>
                           </div>
                           <!-- class="section" -->
                           <ol>
                              <li class="stepexpand"><span>Connect to the source database as the Oracle Streams administrator.</span><div>
                                    <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                    </p>
                                 </div>
                              </li>
                              <li class="stepexpand"><span>Specify an unconditional supplemental log group that includes all of the columns in the <code class="codeph">hr.jobs</code> table. For example:</span><div><pre class="oac_no_warn" dir="ltr">ALTER TABLE hr.jobs ADD SUPPLEMENTAL LOG DATA (ALL) COLUMNS;
</pre><p>Any columns used by a statement DML handler at a destination database must be in an unconditional log group at the source database.</p>
                                 </div>
                              </li>
                              <li class="stepexpand"><span>Connect to the destination database as the <code class="codeph">hr</code> user.</span></li>
                              <li class="stepexpand" id="GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F__BGBGEADB"><span>Create a sequence for the tracking table:</span><div><pre class="oac_no_warn" dir="ltr">CREATE SEQUENCE hr.track_jobs_seq 
   START WITH 1
   INCREMENT BY 1;
</pre></div>
                              </li>
                              <li class="stepexpand"><span>Create the table that will track the changes to the <code class="codeph">hr.jobs</code> table:</span><div><pre class="oac_no_warn" dir="ltr">CREATE TABLE hr.track_jobs( 
   change_id       NUMBER  CONSTRAINT track_jobs_pk PRIMARY KEY,
   job_id          VARCHAR2(10), 
   job_title       VARCHAR2(35),
   min_salary_old  NUMBER(6),
   min_salary_new  NUMBER(6),
   max_salary_old  NUMBER(6),
   max_salary_new  NUMBER(6),
   timestamp       TIMESTAMP);
</pre><p>The statement DML handler will use the sequence created in Step <a href="managing-oracle-streams-information-consumption.html#GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F__BGBGEADB">4</a> to insert a unique value for each change that it tracks into the <code class="codeph">change_id</code> column of the <code class="codeph">hr.track_jobs</code> table.
                                    </p>
                                 </div>
                              </li>
                              <li class="stepexpand"><span>Connect to the destination database as the Oracle Streams administrator.</span></li>
                              <li class="stepexpand"><span>Create the statement DML handler:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_HANDLER_ADM.CREATE_STMT_HANDLER(
    handler_name =&gt; 'track_jobs',
    comment      =&gt; 'Tracks updates to the jobs table');
END;
/
</pre></div>
                              </li>
                              <li class="stepexpand"><span>Add a statement to the statement DML handler that executes the row LCR:</span><div><pre class="oac_no_warn" dir="ltr">DECLARE
  stmt CLOB;
BEGIN
  stmt := ':lcr.execute TRUE';
  DBMS_STREAMS_HANDLER_ADM.ADD_STMT_TO_HANDLER(
    handler_name       =&gt; 'track_jobs',
    statement          =&gt; stmt,
    execution_sequence =&gt; 10);
END;
/
</pre><p>The <code class="codeph">TRUE</code> argument is for the <code class="codeph">conflict_resolution</code> parameter in the <code class="codeph">EXECUTE</code> member procedure for the <code class="codeph">LCR$_ROW_RECORD</code> type. The <code class="codeph">TRUE</code> argument indicates that any conflict resolution defined for the table is used when the row LCR is executed. Specify <code class="codeph">FALSE</code> if you do not want conflict resolution to be used when the row LCR is executed.
                                    </p>
                                    <div class="infoboxnotealso" id="GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F__GUID-03D53571-A39E-4E2C-8608-7CD6BA2B8AAF">
                                       <p class="notep1">Tip:</p>
                                       <p>If you want to track the changes to a table without replicating them, then do not include an execute statement in the statement DML handler.</p>
                                    </div>
                                    <div class="infoboxnotealso" id="GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F__GUID-9D34F0D6-FA8C-4423-B637-86610757D506">
                                       <p class="notep1">See Also:</p>
                                       <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ARPLS72028"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
                                    </div>
                                 </div>
                              </li>
                              <li class="stepexpand"><span>Add a statement to the statement DML handler that tracks the changes the row LCR:</span><div><pre class="oac_no_warn" dir="ltr">DECLARE
  stmt CLOB;
BEGIN
  stmt := 'INSERT INTO hr.track_jobs(
             change_id,
             job_id, 
             job_title,
             min_salary_old,
             min_salary_new,
             max_salary_old,
             max_salary_new,
             timestamp) 
           VALUES(
             hr.track_jobs_seq.NEXTVAL,
             :new.job_id,
             :new.job_title,
             :old.min_salary,
             :new.min_salary,
             :old.max_salary,
             :new.max_salary,
             :source_time)';
  DBMS_STREAMS_HANDLER_ADM.ADD_STMT_TO_HANDLER(
    handler_name       =&gt; 'track_jobs',
    statement          =&gt; stmt,
    execution_sequence =&gt; 20);
END;
/
</pre><p>This statement inserts a row into the <code class="codeph">hr.track_jobs</code> table for each row LCR that updates a row in the <code class="codeph">hr.jobs</code> table. Notice that the values inserted into the <code class="codeph">hr.track_jobs</code> table use the old and new values in the row LCR to track the old and new value for each salary column. Also, notice that the <code class="codeph">source_time</code> attribute in the row LCR is used to populate the <code class="codeph">timestamp</code> column.
                                    </p>
                                 </div>
                              </li>
                              <li class="stepexpand"><span>Add the statement DML handler to the apply process. For example, the following procedure adds the statement DML handler to an apply process named <code class="codeph">apply$_sta_2</code>:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ADD_STMT_HANDLER(
    object_name    =&gt; 'hr.jobs',
    operation_name =&gt; 'UPDATE',
    handler_name   =&gt; 'track_jobs',
    apply_name     =&gt; 'apply$_sta_2');
END;
/
</pre><div class="infoboxnote" id="GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F__GUID-6BAA4755-BA7F-4015-AC3D-3ED1F74B1096">
                                       <p class="notep1">Note:</p>
                                       <p>The <code class="codeph">ADD_STMT_HANDLER</code> procedure in this example adds the statement DML handler to the <code class="codeph">apply$_sta_2</code> apply process. To add a general statement DML handler that is used by all of the apply processes in the database, omit the <code class="codeph">apply_name</code> parameter in this procedure or set the <code class="codeph">apply_name</code> parameter to <code class="codeph">NULL</code>.
                                       </p>
                                    </div>
                                 </div>
                              </li>
                           </ol>
                        </div>
                     </div>
                  </div><a id="STRMS1472"></a><div class="props_rev_3"><a id="GUID-BA86C3A4-98B1-463E-9AF0-4E683E57E6D2" name="GUID-BA86C3A4-98B1-463E-9AF0-4E683E57E6D2"></a><h5 id="STRMS-GUID-BA86C3A4-98B1-463E-9AF0-4E683E57E6D2" class="sect5"><span class="enumeration_section">17.6.1.2 </span>Adding Statements to a Statement DML Handler
                     </h5>
                     <div>
                        <div class="section">
                           <p>To add statements to a statement DML handler, run the <code class="codeph">ADD_STMT_TO_HANDLER</code> procedure in the <code class="codeph">DBMS_STREAMS_HANDLER_ADM</code> package and specify an execution sequence number that has not been specified for the statement DML handler.
                           </p>
                           <p>The example in this section adds a statement to the <code class="codeph">modify_orders</code> statement DML handler. This statement DML handler is created in <span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-3A35D7A5-70EC-4248-815A-EC56891AF1F8">Creating a Statement DML Handler With One Statement</a>"</span>. It modifies inserts into the <code class="codeph">oe.orders</code> table.
                           </p>
                           <p>For the example in this section, assume that the destination database should discount orders by 10% for a specific customer. This customer has a <code class="codeph">customer_id</code> value of <code class="codeph">118</code> in the <code class="codeph">oe.orders</code> table. To do this, the SQL statement in the statement DML handler multiplies the <code class="codeph">order_total</code> value by <code class="codeph">.9</code> for inserts into the <code class="codeph">oe.orders</code> table with a <code class="codeph">customer_id</code> value of <code class="codeph">118</code>.
                           </p>
                           <p>Complete the following steps to add a statement to the <code class="codeph">modify_orders</code> statement DML handler:
                           </p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Connect to the destination database where the apply process is configured as the Oracle Streams administrator.</span><div>
                                 <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-BA86C3A4-98B1-463E-9AF0-4E683E57E6D2__BGBDDBAG"><span>Check the execution sequence numbers that are already used by the statements in the statement DML handler:</span><div><pre class="oac_no_warn" dir="ltr">COLUMN HANDLER_NAME HEADING 'Statement|Handler' FORMAT A15
COLUMN EXECUTION_SEQUENCE HEADING 'Execution|Sequence' FORMAT 999999
COLUMN STATEMENT HEADING 'Statement' FORMAT A50

SET LONG  8000
SET PAGES 8000
SELECT HANDLER_NAME,
       EXECUTION_SEQUENCE,
       STATEMENT
  FROM DBA_STREAMS_STMTS
  WHERE HANDLER_NAME = 'MODIFY_ORDERS'
  ORDER BY EXECUTION_SEQUENCE;
</pre><p>Your output is similar to the following:</p><pre class="oac_no_warn" dir="ltr">Statement       Execution
Handler          Sequence Statement
--------------- --------- --------------------------------------------------
MODIFY_ORDERS           1 INSERT INTO oe.orders(
                                       order_id,
                                       order_date,
                                       order_mode,
                                       customer_id,
                                       order_status,
                                       order_total,
                                       sales_rep_id,
                                       promotion_id)
                                     VALUES(
                                       :new.order_id,
                                       :new.order_date,
                                       :new.order_mode,
                                       :new.customer_id,
                                       DECODE(:new.order_status, 1, 2, :new.
                          order_status),
                                       :new.order_total,
                                       :new.sales_rep_id,
                                       :new.promotion_id)
</pre><p>This output shows that the statement DML handler has only one statement, and this one statement is at execution sequence number <code class="codeph">1</code>.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Add a statement to the statement DML handler that discounts all orders by 10%:</span><div><pre class="oac_no_warn" dir="ltr">DECLARE
  stmt CLOB;
BEGIN
  stmt := 'UPDATE oe.orders SET order_total=order_total*.9
             WHERE order_id=:new.order_id AND :new.customer_id=118';
  DBMS_STREAMS_HANDLER_ADM.ADD_STMT_TO_HANDLER(
    handler_name       =&gt; 'modify_orders',
    statement          =&gt; stmt,
    execution_sequence =&gt; 10);
END;
/
</pre><p>This statement updates the row that was inserted by the statement with execution sequence number <code class="codeph">1</code>. Therefore, this statement must have an execution sequence number that is greater than <code class="codeph">1</code>. This example specifies <code class="codeph">10</code> for the execution sequence number of the added statement.
                                 </p>
                                 <div class="infoboxnotealso" id="GUID-BA86C3A4-98B1-463E-9AF0-4E683E57E6D2__GUID-BEE29474-0397-43C4-B7E8-FE8E94FFB239">
                                    <p class="notep1">Tip:</p>
                                    <p>When the <code class="codeph">execution_sequence</code> parameter is set to <code class="codeph">NULL</code> in the <code class="codeph">ADD_STMT_TO_HANDLER</code> procedure, the statement is added to the statement DML handler with an execution sequence number that is larger than the execution sequence number for any statement in the statement DML handler. Therefore, in this example, the <code class="codeph">execution_sequence</code> parameter can be omitted or set to <code class="codeph">NULL</code>.
                                    </p>
                                 </div>
                              </div>
                           </li>
                        </ol>
                        <div class="section">
                           <p>After completing these steps, the output for the query in Step <a href="managing-oracle-streams-information-consumption.html#GUID-BA86C3A4-98B1-463E-9AF0-4E683E57E6D2__BGBDDBAG">2</a> shows:
                           </p><pre class="oac_no_warn" dir="ltr">Statement       Execution
Handler          Sequence Statement
--------------- --------- --------------------------------------------------
MODIFY_ORDERS           1 INSERT INTO oe.orders(
                                       order_id,
                                       order_date,
                                       order_mode,
                                       customer_id,
                                       order_status,
                                       order_total,
                                       sales_rep_id,
                                       promotion_id)
                                     VALUES(
                                       :new.order_id,
                                       :new.order_date,
                                       :new.order_mode,
                                       :new.customer_id,
                                       DECODE(:new.order_status, 1, 2, :new.
                          order_status),
                                       :new.order_total,
                                       :new.sales_rep_id,
                                       :new.promotion_id)
 
MODIFY_ORDERS          10 UPDATE oe.orders SET order_total=order_total*.9
                                       WHERE order_id=:new.order_id AND :new.
                          customer_id=118
</pre><p>This output shows that the new statement with execution sequence number <code class="codeph">10</code> is added to the statement DML handler.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS1473"></a><div class="props_rev_3"><a id="GUID-C19F994E-53E2-4E69-839E-6E11CE8D98F1" name="GUID-C19F994E-53E2-4E69-839E-6E11CE8D98F1"></a><h5 id="STRMS-GUID-C19F994E-53E2-4E69-839E-6E11CE8D98F1" class="sect5"><span class="enumeration_section">17.6.1.3 </span>Modifying a Statement in a Statement DML Handler
                     </h5>
                     <div>
                        <div class="section">
                           <p>To modify a statement in a statement DML handler, run the <code class="codeph">ADD_STMT_TO_HANDLER</code> procedure in the <code class="codeph">DBMS_STREAMS_HANDLER_ADM</code> package and specify the execution sequence number of the statement you are modifying.
                           </p>
                           <p>The example in this section modifies the statement with execution sequence number <code class="codeph">20</code> in the <code class="codeph">track_jobs</code> statement DML handler. This statement DML handler is created in <span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F">Creating a Statement DML Handler With More Than One Statement</a>"</span>. It uses the <code class="codeph">hr.track_jobs</code> table to track changes to the <code class="codeph">hr.jobs</code> table.
                           </p>
                           <p>For the example in this section, assume that you also want to track which user updated the <code class="codeph">hr.jobs</code> table. To do this, you must add this information to the row LCRs captured at the source database, add a <code class="codeph">user_name</code> column to the <code class="codeph">hr.track_jobs</code> table, and modify the statement in the statement DML handler to track the user.
                           </p>
                           <p>Complete the following steps to modify the statement in the statement DML handler:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Connect to the source database as the Oracle Streams administrator.</span><div>
                                 <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Add the username to the row LCR information captured at the source database:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_CAPTURE_ADM.INCLUDE_EXTRA_ATTRIBUTE(
    capture_name   =&gt; 'sta$cap',
    attribute_name =&gt; 'username',
    include        =&gt; TRUE);
END;
/
</pre><p>In the <code class="codeph">capture_name</code> parameter, specify the capture process or synchronous capture that captures the changes that will be processed by the statement DML handler.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Connect to the destination database as the Oracle Streams administrator.</span></li>
                           <li class="stepexpand"><span>Add the <code class="codeph">user_name</code> column to the <code class="codeph">hr.track_jobs</code> table:</span><div><pre class="oac_no_warn" dir="ltr">ALTER TABLE hr.track_jobs
  ADD (user_name VARCHAR2(30));
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Modify the statement with execution sequence number <code class="codeph">20</code> in the <code class="codeph">track_jobs</code> statement DML handler:</span><div><pre class="oac_no_warn" dir="ltr">DECLARE
  stmt CLOB;
BEGIN
  stmt := 'INSERT INTO hr.track_jobs(
             change_id,
             job_id, 
             job_title,
             min_salary_old,
             min_salary_new,
             max_salary_old,
             max_salary_new,
             timestamp,
             user_name) 
           VALUES(
             hr.track_jobs_seq.NEXTVAL,
             :new.job_id,
             :new.job_title,
             :old.min_salary,
             :new.min_salary,
             :old.max_salary,
             :new.max_salary,
             :source_time,
             :extra_attribute.username)';
  DBMS_STREAMS_HANDLER_ADM.ADD_STMT_TO_HANDLER(
    handler_name       =&gt; 'track_jobs',
    statement          =&gt; stmt,
    execution_sequence =&gt; 20);
END;
/
</pre><p>The modified statement adds user tracking by inserting the <code class="codeph">username</code> information in the row LCR into the <code class="codeph">user_name</code> column in the <code class="codeph">hr.track_jobs</code> table. Notice that <code class="codeph">username</code> is an extra LCR attribute and must be specified using the following syntax:
                                 </p><pre class="oac_no_warn" dir="ltr">:extra_attribute.username</pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <div class="infoboxnotealso" id="GUID-C19F994E-53E2-4E69-839E-6E11CE8D98F1__GUID-85DAE85D-B9CB-4634-A10E-11247B7F5510">
                              <p class="notep1">See Also:</p>
                              <p><span class="q">"<a href="oracle-streams-information-capture.html#GUID-7CAA1711-DC69-469A-A54B-30629C3FCE2F">Extra Information in LCRs</a>"</span></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS1474"></a><div class="props_rev_3"><a id="GUID-0B10F67F-F175-40CE-AB0E-E93A02BE0382" name="GUID-0B10F67F-F175-40CE-AB0E-E93A02BE0382"></a><h5 id="STRMS-GUID-0B10F67F-F175-40CE-AB0E-E93A02BE0382" class="sect5"><span class="enumeration_section">17.6.1.4 </span>Removing Statements from a Statement DML Handler
                     </h5>
                     <div>
                        <div class="section">
                           <p>To remove a statement from a statement DML handler, run the <code class="codeph">REMOVE_STMT_FROM_HANDLER</code> procedure in the <code class="codeph">DBMS_STREAMS_HANDLER_ADM</code> package and specify the execution sequence number of the statement you are removing.
                           </p>
                           <p>The example in this section removes the statement with execution sequence number <code class="codeph">10</code> from the <code class="codeph">track_jobs</code> statement DML handler. This statement DML handler is created in <span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F">Creating a Statement DML Handler With More Than One Statement</a>"</span>. It uses the <code class="codeph">hr.track_jobs</code> table to track changes to the <code class="codeph">hr.jobs</code> table.
                           </p>
                           <p>For the example in this section, assume that you no longer want to execute the row LCRs with updates to the <code class="codeph">hr.jobs</code> table. To do this, you must remove the statement that executes the row LCRs, and this statement uses execution sequence number <code class="codeph">10</code> in the <code class="codeph">track_jobs</code> statement DML handler.
                           </p>
                           <p>Complete the following steps to remove the statement from the statement DML handler:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Connect to the database that contains the statement DML handler as the Oracle Streams administrator.</span><div>
                                 <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Remove the statement from the statement DML handler:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_HANDLER_ADM.REMOVE_STMT_FROM_HANDLER(
    handler_name       =&gt; 'track_jobs',
    execution_sequence =&gt; 10);
END;
/
</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="STRMS1475"></a><div class="props_rev_3"><a id="GUID-7949BC66-E9BC-4A7D-BE8F-EBDFC4D28AB5" name="GUID-7949BC66-E9BC-4A7D-BE8F-EBDFC4D28AB5"></a><h5 id="STRMS-GUID-7949BC66-E9BC-4A7D-BE8F-EBDFC4D28AB5" class="sect5"><span class="enumeration_section">17.6.1.5 </span>Removing a Statement DML Handler from an Apply Process
                     </h5>
                     <div>
                        <div class="section">
                           <p>To remove a statement DML handler from an apply process, run the <code class="codeph">REMOVE_STMT_HANDLER</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package.
                           </p>
                           <p>The example in this section removes the <code class="codeph">track_jobs</code> statement DML handler from the <code class="codeph">apply$_sta_2</code> apply process. This statement DML handler is created in <span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F">Creating a Statement DML Handler With More Than One Statement</a>"</span>. It uses the <code class="codeph">hr.track_jobs</code> table to track changes to the <code class="codeph">hr.jobs</code> table.
                           </p>
                           <p>Complete the following steps to remove the statement DML handler from the apply process:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Connect to the database that contains the apply process as the Oracle Streams administrator.</span><div>
                                 <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Remove the statement DML handler from the apply process:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.REMOVE_STMT_HANDLER(
    object_name    =&gt; 'hr.jobs',
    operation_name =&gt; 'UPDATE',
    handler_name   =&gt; 'track_jobs',
    apply_name     =&gt; 'apply$_sta_2');
END;
/
</pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <p>After the statement DML handler is removed from the apply process, the statement DML handler still exists in the database.</p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS1476"></a><div class="props_rev_3"><a id="GUID-D59CB80C-F66B-4315-8F7B-32D63461F447" name="GUID-D59CB80C-F66B-4315-8F7B-32D63461F447"></a><h5 id="STRMS-GUID-D59CB80C-F66B-4315-8F7B-32D63461F447" class="sect5"><span class="enumeration_section">17.6.1.6 </span>Dropping a Statement DML Handler
                     </h5>
                     <div>
                        <div class="section">
                           <p>To drop a statement DML handler from a database, run the <code class="codeph">DROP_STMT_HANDLER</code> procedure in the <code class="codeph">DBMS_STREAMS_HANDLER_ADM</code> package.
                           </p>
                           <p>The example in this section drops the <code class="codeph">track_jobs</code> statement DML handler. This statement DML handler is created in <span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-F4AE8554-DEDD-421E-9498-D28EAFF9A03F">Creating a Statement DML Handler With More Than One Statement</a>"</span>. It uses the <code class="codeph">hr.track_jobs</code> table to track changes to the <code class="codeph">hr.jobs</code> table.
                           </p>
                           <p>Complete the following steps to drop the statement DML handler:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Connect to the database that contains the statement DML handler as the Oracle Streams administrator.</span><div>
                                 <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Drop the statement DML handler:</span><div><pre class="oac_no_warn" dir="ltr">exec DBMS_STREAMS_HANDLER_ADM.DROP_STMT_HANDLER('track_jobs');</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div>
               </div><a id="STRMS1518"></a><div class="props_rev_3"><a id="GUID-61A2086D-5464-458D-BE20-858B002D98F9" name="GUID-61A2086D-5464-458D-BE20-858B002D98F9"></a><h4 id="STRMS-GUID-61A2086D-5464-458D-BE20-858B002D98F9" class="sect4"><span class="enumeration_section">17.6.2 </span>Managing a Procedure DML Handler
                  </h4>
                  <div>
                     <p>This section contains the following instructions for managing a procedure DML handler:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-EC007F49-7EEA-4C26-959F-1F001C97CA71">Creating a Procedure DML Handler</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-E7BF7C90-3EBB-418F-9F07-3F91E4C01632">Setting a Procedure DML Handler</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-812D6232-15E6-4414-B7E5-6B10BA5F32C4">Unsetting a Procedure DML Handler</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-61A2086D-5464-458D-BE20-858B002D98F9__GUID-C1DFB3A6-74EC-41CB-9B01-0094BCD043FB">
                        <p class="notep1">See Also:</p>
                        <p></p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-B408C059-4044-4B42-9C50-1BD77BB57050">Procedure DML Handlers</a>"</span></p>
                           </li>
                           <li>
                              <p><span class="q">"<a href="monitoring-oracle-streams-apply-processes.html#GUID-DA9BF9F8-9752-436C-BB4E-08E4A46A2BCA">Displaying Information About DML Handlers</a>"</span></p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="STRMS748"></a><div class="props_rev_3"><a id="GUID-EC007F49-7EEA-4C26-959F-1F001C97CA71" name="GUID-EC007F49-7EEA-4C26-959F-1F001C97CA71"></a><h5 id="STRMS-GUID-EC007F49-7EEA-4C26-959F-1F001C97CA71" class="sect5"><span class="enumeration_section">17.6.2.1 </span>Creating a Procedure DML Handler
                     </h5>
                     <div>
                        <div class="section">
                           <p>A procedure DML handler must have the following signature:</p><pre class="oac_no_warn" dir="ltr">PROCEDURE <span class="italic">user_procedure</span> (
   <span class="italic">parameter_name</span>   IN  ANYDATA);
</pre><p>Here, <span class="italic"><code class="codeph">user_procedure</code></span> stands for the name of the procedure and <span class="italic"><code class="codeph">parameter_name</code></span> stands for the name of the parameter passed to the procedure. The parameter passed to the procedure is an <code class="codeph">ANYDATA</code> encapsulation of a row&nbsp;logical change record (row LCR).
                           </p>
                           <p>The following restrictions apply to the user procedure:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Do not execute <code class="codeph">COMMIT</code> or <code class="codeph">ROLLBACK</code> statements. Doing so can endanger the consistency of the transaction that contains the row LCR.
                                 </p>
                              </li>
                              <li>
                                 <p>If you are manipulating a row using the <code class="codeph">EXECUTE</code> member procedure for the row LCR, then do not attempt to manipulate more than one row in a row operation. You must construct and execute manually any DML statements that manipulate more than one row.
                                 </p>
                              </li>
                              <li>
                                 <p>If the command type is <code class="codeph">UPDATE</code> or <code class="codeph">DELETE</code>, then row operations resubmitted using the <code class="codeph">EXECUTE</code> member procedure for the LCR must include the entire key in the list of old values. The key is the primary key or the smallest unique key that has at least one <code class="codeph">NOT</code> <code class="codeph">NULL</code> column, unless a substitute key has been specified by the <code class="codeph">SET_KEY_COLUMNS</code> procedure. If there is no specified key, then the key consists of all table columns, except for columns of the following data types: LOB, <code class="codeph">LONG</code>, <code class="codeph">LONG</code> <code class="codeph">RAW</code>, user-defined types (including object types, REFs, varrays, nested tables), and Oracle-supplied types (including Any types, XML types, spatial types, and media types).
                                 </p>
                              </li>
                              <li>
                                 <p>If the command type is <code class="codeph">INSERT</code>, then row operations resubmitted using the <code class="codeph">EXECUTE</code> member procedure for the LCR should include the entire key in the list of new values. Otherwise, duplicate rows are possible. The key is the primary key or the smallest unique key that has at least one <code class="codeph">NOT</code> <code class="codeph">NULL</code> column, unless a substitute key has been specified by the <code class="codeph">SET_KEY_COLUMNS</code> procedure. If there is no specified key, then the key consists of all non LOB, non <code class="codeph">LONG</code>, and non <code class="codeph">LONG</code> <code class="codeph">RAW</code> columns.
                                 </p>
                              </li>
                           </ul>
                           <p>A procedure DML handler can be used for any customized processing of row LCRs. For example, the handler can modify an LCR and then execute it using the <code class="codeph">EXECUTE</code> member procedure for the LCR. When you execute a row LCR in a procedure DML handler, the apply process applies the LCR without calling the procedure DML handler again.
                           </p>
                           <p>You can also use SQL generation in a procedure DML handler to record the DML changes made to a table. You can record these changes in a table or in a file. For example, the sample procedure DML handler in this section uses SQL generation to record each <code class="codeph">UPDATE</code> SQL statement made to the <code class="codeph">hr.departments</code> table using the <code class="codeph">GET_ROW_TEXT</code> member procedure. The procedure DML handler also applies the row LCR using the <code class="codeph">EXECUTE</code> member procedure.
                           </p>
                           <p>To create the procedure used in this procedure DML handler, complete the following steps:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>In SQL*Plus, connect to the database as the Oracle Streams administrator.</span><div>
                                 <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-EC007F49-7EEA-4C26-959F-1F001C97CA71__BGBDHBDB"><span>Create the directory object for the directory that contains the text file.</span><div>
                                 <p>In this example, the apply process writes the <code class="codeph">UPDATE</code> SQL statements performed on the <code class="codeph">hr.departments</code> table to the text file in this directory.
                                 </p>
                                 <p>For example, to create a directory object named <code class="codeph">SQL_GEN_DIR</code> for the /usr/sql_gen directory, enter the following SQL statement:
                                 </p><pre class="oac_no_warn" dir="ltr">CREATE DIRECTORY SQL_GEN_DIR AS '/usr/sql_gen';
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Ensure that the text file to which the SQL statements will be written exists in the directory specified in Step <a href="managing-oracle-streams-information-consumption.html#GUID-EC007F49-7EEA-4C26-959F-1F001C97CA71__BGBDHBDB">2</a>.</span><div>
                                 <p>In this example, ensure that the <code class="codeph">sql_gen_file.txt</code> file exists in the /usr/sql_gen directory on the file system.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Create the procedure for the procedure DML handler:</span><div><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE PROCEDURE strmadmin.sql_gen_dep(lcr_anydata IN SYS.ANYDATA) IS
  lcr          SYS.LCR$_ROW_RECORD;
  int          PLS_INTEGER;
  row_txt_clob CLOB;
  fp           UTL_FILE.FILE_TYPE;
BEGIN
  int   := lcr_anydata.GETOBJECT(lcr);
  DBMS_LOB.CREATETEMPORARY(row_txt_clob, TRUE);
  -- Generate SQL from row LCR and save to file
  lcr.GET_ROW_TEXT(row_txt_clob);
  fp := UTL_FILE.FOPEN (
     location     =&gt; 'SQL_GEN_DIR',
     filename     =&gt; 'sql_gen_file.txt',
     open_mode    =&gt; 'a',
     max_linesize =&gt; 5000);
  UTL_FILE.PUT_LINE(
     file      =&gt; fp,
     buffer    =&gt; row_txt_clob,
     autoflush =&gt; TRUE);
  DBMS_LOB.TRIM(row_txt_clob, 0);
  UTL_FILE.FCLOSE(fp); 
  --  Apply row LCR
  lcr.EXECUTE(TRUE);
END;
/
</pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <p>After you create the procedure, you can set it as a procedure DML handler by following the instructions in <span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-E7BF7C90-3EBB-418F-9F07-3F91E4C01632">Setting a Procedure DML Handler</a>"</span>.
                           </p>
                           <div class="infoboxnote" id="GUID-EC007F49-7EEA-4C26-959F-1F001C97CA71__GUID-E71B9490-1B85-4DD9-A0F4-4040968F67E8">
                              <p class="notep1">Note:</p>
                              <p></p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>You must specify an unconditional supplemental log group at the source database for any columns needed by a procedure DML handler at the destination database. This sample procedure DML handler does not require any additional supplemental logging because it records the SQL statement and does not manipulate the row&nbsp;LCR in any other way.</p>
                                 </li>
                                 <li>
                                    <p>To test a procedure DML handler before using it, or to debug a procedure DML handler, you can construct row LCRs and run the procedure DML handler procedure outside the context of an apply process.</p>
                                 </li>
                              </ul>
                           </div>
                           <div class="infoboxnotealso" id="GUID-EC007F49-7EEA-4C26-959F-1F001C97CA71__GUID-B1DEDA50-3C0C-4636-8595-1A751C190074">
                              <p class="notep1">See Also:</p>
                              <p></p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-254DBAF4-21ED-462B-9488-854ADF84E9A1">SQL Generation</a>"</span></p>
                                 </li>
                                 <li>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ARPLS71863"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code class="codeph">GET_ROW_TEXT</code> row LCR member function
                                    </p>
                                 </li>
                                 <li>
                                    <p><span class="q">"<a href="oracle-streams-information-capture.html#GUID-57570826-D941-4820-977D-D60092EAD599">Supplemental Logging in an Oracle Streams Environment</a>"</span></p>
                                 </li>
                                 <li>
                                    <p><a href="../strep/managing-lcrs.html#STREP009"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
                                 </li>
                                 <li>
                                    <p><span class="q">"<a href="troubleshooting-apply.html#GUID-329ED4AF-750C-456D-994D-B1103729B4EE">Are There Any Apply Errors in the Error Queue?</a>"</span> for information about common apply errors that you might want to handle in a procedure DML handler
                                    </p>
                                 </li>
                                 <li>
                                    <p><a href="../sqlrf/Data-Types.html#SQLRF0021"><span class="italic">Oracle Database SQL Language Reference</span></a> for information about data types
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS749"></a><div class="props_rev_3"><a id="GUID-E7BF7C90-3EBB-418F-9F07-3F91E4C01632" name="GUID-E7BF7C90-3EBB-418F-9F07-3F91E4C01632"></a><h5 id="STRMS-GUID-E7BF7C90-3EBB-418F-9F07-3F91E4C01632" class="sect5"><span class="enumeration_section">17.6.2.2 </span>Setting a Procedure DML Handler
                     </h5>
                     <div>
                        <div class="section">
                           <p>A procedure DML handler processes each row LCR dequeued by any apply process that contains a specific operation on a specific table. You can specify multiple procedure DML handlers on the same table, to handle different operations on the table. All apply processes that apply changes to the specified table in the local database use the specified procedure DML handler. </p>
                           <p>Set the procedure DML handler using the <code class="codeph">SET_DML_HANDLER</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. For example, the following procedure sets the procedure DML handler for <code class="codeph">UPDATE</code> operations on the <code class="codeph">hr.departments</code> table. Therefore, when any apply process that applies changes locally dequeues a row LCR containing an <code class="codeph">UPDATE</code> operation on the <code class="codeph">hr.departments</code> table, the apply process sends the row LCR to the <code class="codeph">sql_gen_dep</code> PL/SQL procedure in the <code class="codeph">strmadmin</code> schema for processing. The apply process does not apply a row LCR containing such a change directly.
                           </p>
                           <p>In this example, the <code class="codeph">apply_name</code> parameter is set to <code class="codeph">NULL</code>. Therefore, the procedure DML handler is a general procedure DML handler that is used by all of the apply processes in the database.
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_DML_HANDLER(
    object_name         =&gt; 'hr.departments',
    object_type         =&gt; 'TABLE',
    operation_name      =&gt; 'UPDATE',
    error_handler       =&gt; FALSE,
    user_procedure      =&gt; 'strmadmin.sql_gen_dep',
    apply_database_link =&gt; NULL,
    apply_name          =&gt; NULL);
END;
/
</pre><div class="infoboxnote" id="GUID-E7BF7C90-3EBB-418F-9F07-3F91E4C01632__GUID-B94DD22B-8CFC-4C5C-9A3A-E920E208D0B7">
                              <p class="notep1">Note:</p>
                              <p></p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>To specify the procedure DML handler for only one apply process, specify the apply process name in the <code class="codeph">apply_name</code> parameter.
                                    </p>
                                 </li>
                                 <li>
                                    <p>If an apply process applies changes to a remote non-Oracle database, then it can use a different procedure DML handler for the same table. You can run the <code class="codeph">SET_DML_HANDLER</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to specify a procedure DML handler for changes that will be applied to a remote non-Oracle database by setting the <code class="codeph">apply_database_link</code> parameter to a non-<code class="codeph">NULL</code> value.
                                    </p>
                                 </li>
                                 <li>
                                    <p>You can specify <code class="codeph">DEFAULT</code> for the <code class="codeph">operation_name</code> parameter to set the procedure as the default procedure DML handler for the database object. In this case, the procedure DML handler is used for any <code class="codeph">INSERT</code>, <code class="codeph">UPDATE</code>, <code class="codeph">DELETE</code>, and <code class="codeph">LOB_WRITE</code> on the database object, if another procedure DML handler is not specifically set for the operation on the database object.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                           <div class="infoboxnotealso" id="GUID-E7BF7C90-3EBB-418F-9F07-3F91E4C01632__GUID-5EB52BA2-F0AA-463A-8821-2416EAE403C5">
                              <p class="notep1">See Also:</p>
                              <p><a href="../strep/oracle-streams-heterogeneous-information-sharing.html#STREP105"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS750"></a><div class="props_rev_3"><a id="GUID-812D6232-15E6-4414-B7E5-6B10BA5F32C4" name="GUID-812D6232-15E6-4414-B7E5-6B10BA5F32C4"></a><h5 id="STRMS-GUID-812D6232-15E6-4414-B7E5-6B10BA5F32C4" class="sect5"><span class="enumeration_section">17.6.2.3 </span>Unsetting a Procedure DML Handler
                     </h5>
                     <div>
                        <div class="section">
                           <p>You unset a procedure DML handler using the <code class="codeph">SET_DML_HANDLER</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. When you run that procedure, set the <code class="codeph">user_procedure</code> parameter to <code class="codeph">NULL</code> for a specific operation on a specific table. After the procedure DML handler is unset, any apply process that applies changes locally will apply a row LCR containing such a change directly.
                           </p>
                           <p>For example, the following procedure unsets the procedure DML handler for <code class="codeph">UPDATE</code> operations on the <code class="codeph">hr.departments</code> table:
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_DML_HANDLER(
    object_name    =&gt; 'hr.departments',
    object_type    =&gt; 'TABLE',
    operation_name =&gt; 'UPDATE',
    error_handler  =&gt; FALSE,
    user_procedure =&gt; NULL,
    apply_name     =&gt; NULL);
END;
/</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="STRMS206"></a><div class="props_rev_3"><a id="GUID-78F7035F-FAC9-4DB0-9336-A5C8833902E3" name="GUID-78F7035F-FAC9-4DB0-9336-A5C8833902E3"></a><h3 id="STRMS-GUID-78F7035F-FAC9-4DB0-9336-A5C8833902E3" class="sect3"><span class="enumeration_section">17.7 </span>Managing a DDL Handler
               </h3>
               <div>
                  <p>This section contains instructions for creating, specifying, and removing the DDL handler for an apply process.</p>
                  <div class="infoboxnote" id="GUID-78F7035F-FAC9-4DB0-9336-A5C8833902E3__GUID-9C52F09A-CC74-4492-B029-A5ECDADC28BF">
                     <p class="notep1">Note:</p>
                     <p>All applied DDL LCRs commit automatically. Therefore, if a DDL handler calls the <code class="codeph">EXECUTE</code> member procedure of a DDL LCR, then a commit is performed automatically.
                     </p>
                  </div>
                  <div class="infoboxnotealso" id="GUID-78F7035F-FAC9-4DB0-9336-A5C8833902E3__GUID-C0CA4048-19DD-4641-A041-AFF9E1BF9AE8">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-91C26D01-385D-4BD0-A29F-C2A0BFED0360">Message Processing Options for an Apply Process</a>"</span></p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ARPLS307"><span class="italic">Oracle Database PL/SQL Packages and Types Reference </span></a>for more information about the <code class="codeph">EXECUTE</code> member procedure for LCR types
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="STRMS751"></a><div class="props_rev_3"><a id="GUID-E59CAE5F-86B8-4A2E-AD1D-CB507651BAE8" name="GUID-E59CAE5F-86B8-4A2E-AD1D-CB507651BAE8"></a><h4 id="STRMS-GUID-E59CAE5F-86B8-4A2E-AD1D-CB507651BAE8" class="sect4"><span class="enumeration_section">17.7.1 </span>Creating a DDL Handler for an Apply Process
                  </h4>
                  <div>
                     <div class="section">
                        <p>A DDL handler must have the following signature:</p><pre class="oac_no_warn" dir="ltr">PROCEDURE <span class="italic">handler_procedure</span> (
   <span class="italic">parameter_name</span>   IN  ANYDATA);
</pre><p>Here, <span class="italic"><code class="codeph">handler_procedure</code></span> stands for the name of the procedure and <span class="italic"><code class="codeph">parameter_name</code></span> stands for the name of the parameter passed to the procedure. The parameter passed to the procedure is an <code class="codeph">ANYDATA</code> encapsulation of a DDL&nbsp;LCR.
                        </p>
                        <p>A DDL handler can be used for any customized processing of DDL LCRs. For example, the handler can modify the LCR and then execute it using the <code class="codeph">EXECUTE</code> member procedure for the LCR. When you execute a DDL LCR in a DDL handler, the apply process applies the LCR without calling the DDL handler again.
                        </p>
                        <p>You can also use a DDL handler to record the history of DDL changes. For example, a DDL handler can insert information about an LCR it processes into a table and then apply the LCR using the <code class="codeph">EXECUTE</code> member procedure. 
                        </p>
                        <p>To create such a DDL handler, first create a table to hold the history information:</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE strmadmin.history_ddl_lcrs(
  timestamp             DATE,
  source_database_name  VARCHAR2(128),
&nbsp;&nbsp;command_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VARCHAR2(30),
&nbsp;&nbsp;object_owner&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VARCHAR2(32),
&nbsp;&nbsp;object_name           VARCHAR2(32),
  object_type           VARCHAR2(18),
  ddl_text              CLOB,
  logon_user            VARCHAR2(32),
  current_schema        VARCHAR2(32),
  base_table_owner      VARCHAR2(32),
  base_table_name       VARCHAR2(32),
  tag                   RAW(10),
  transaction_id        VARCHAR2(10),
  scn                   NUMBER);
</pre><pre class="oac_no_warn" dir="ltr"><a id="d78429e6150" class="indexterm-anchor"></a><a id="d78429e6152" class="indexterm-anchor"></a><a id="d78429e6154" class="indexterm-anchor"></a><a id="d78429e6156" class="indexterm-anchor"></a><a id="d78429e6158" class="indexterm-anchor"></a><a id="d78429e6160" class="indexterm-anchor"></a><a id="d78429e6164" class="indexterm-anchor"></a><a id="d78429e6166" class="indexterm-anchor"></a>CREATE OR REPLACE PROCEDURE history_ddl(in_any IN ANYDATA)  
 IS
   lcr       SYS.LCR$_DDL_RECORD;
   rc        PLS_INTEGER;
   ddl_text  CLOB;
 BEGIN
   -- Access the LCR
   rc := in_any.GETOBJECT(lcr);
   DBMS_LOB.CREATETEMPORARY(ddl_text, TRUE);
   lcr.GET_DDL_TEXT(ddl_text);
   --  Insert DDL LCR information into history_ddl_lcrs table
   INSERT INTO strmadmin.history_ddl_lcrs VALUES( 
     SYSDATE, lcr.GET_SOURCE_DATABASE_NAME(), lcr.GET_COMMAND_TYPE(), 
     lcr.GET_OBJECT_OWNER(), lcr.GET_OBJECT_NAME(), lcr.GET_OBJECT_TYPE(), 
     ddl_text, lcr.GET_LOGON_USER(), lcr.GET_CURRENT_SCHEMA(), 
     lcr.GET_BASE_TABLE_OWNER(), lcr.GET_BASE_TABLE_NAME(), lcr.GET_TAG(), 
     lcr.GET_TRANSACTION_ID(), lcr.GET_SCN());
   --  Apply DDL LCR
   lcr.EXECUTE();
   -- Free temporary LOB space
   DBMS_LOB.FREETEMPORARY(ddl_text);
END;
/</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS752"></a><div class="props_rev_3"><a id="GUID-E87CABB5-B42A-4726-9B49-CCC7D23E7D07" name="GUID-E87CABB5-B42A-4726-9B49-CCC7D23E7D07"></a><h4 id="STRMS-GUID-E87CABB5-B42A-4726-9B49-CCC7D23E7D07" class="sect4"><span class="enumeration_section">17.7.2 </span>Setting the DDL Handler for an Apply Process
                  </h4>
                  <div>
                     <div class="section">
                        <p>A DDL handler processes all DDL LCRs dequeued by an apply process. Set the DDL handler for an apply process using the <code class="codeph">ddl_handler</code> parameter in the <code class="codeph">ALTER_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. For example, the following procedure sets the DDL handler for an apply process named <code class="codeph">strep01_apply</code> to the <code class="codeph">history_ddl</code> procedure in the <code class="codeph">strmadmin</code> schema.
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name  =&gt; 'strep01_apply',
    ddl_handler =&gt; 'strmadmin.history_ddl');
END;
/</pre></div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS753"></a><div class="props_rev_3"><a id="GUID-A98DE862-CF64-4991-ACCF-55F7B2FE1B69" name="GUID-A98DE862-CF64-4991-ACCF-55F7B2FE1B69"></a><h4 id="STRMS-GUID-A98DE862-CF64-4991-ACCF-55F7B2FE1B69" class="sect4"><span class="enumeration_section">17.7.3 </span>Removing the DDL Handler for an Apply Process
                  </h4>
                  <div>
                     <div class="section">
                        <p>A DDL handler processes all DDL LCRs dequeued by an apply process. You remove the DDL handler for an apply process by setting the <code class="codeph">remove_ddl_handler</code> parameter to <code class="codeph">TRUE</code> in the <code class="codeph">ALTER_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. For example, the following procedure removes the DDL handler from an apply process named <code class="codeph">strep01_apply</code>.
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name         =&gt; 'strep01_apply',
    remove_ddl_handler =&gt; TRUE);
END;
/</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="STRMS759"></a><div class="props_rev_3"><a id="GUID-B6EDB895-EAF9-449D-A4CC-475317A43AD9" name="GUID-B6EDB895-EAF9-449D-A4CC-475317A43AD9"></a><h3 id="STRMS-GUID-B6EDB895-EAF9-449D-A4CC-475317A43AD9" class="sect3"><span class="enumeration_section">17.8 </span>Managing the Message Handler for an Apply Process
               </h3>
               <div>
                  <p>A message handler is an <a href="strms_glossary.html#GUID-4CEA651A-4197-4731-93D4-315BCB5CBE70"><span class="xrefglossterm">apply handler</span></a> that processes <a href="strms_glossary.html#GUID-8F1FA1C4-ADB5-4A4D-9374-B50AADB53066"><span class="xrefglossterm">persistent user message</span></a>s. The following sections contain instructions for setting and unsetting the message handler for an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-CADD7CB4-BA1D-4461-8542-C28661C9DAFC">Setting the Message Handler for an Apply Process</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-EDD1C401-7BED-453B-9804-79D5CA3F5910">Unsetting the Message Handler for an Apply Process</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-B6EDB895-EAF9-449D-A4CC-475317A43AD9__GUID-21554020-DD90-4588-A2EF-0C87D11E91E2">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-E540231B-9063-4F4E-BE79-72349800F720">Types of Messages That Can Be Processed with an Apply Process</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-A296EDB6-C3A7-4AD3-BB7B-52BC205ABB71">Message Handlers</a>"</span></p>
                        </li>
                        <li>
                           <p><a href="../adque/streams-messaging-examples.html#ADQUE025"><span class="italic">Oracle Database Advanced Queuing User's Guide </span></a>for an example that creates a message handler
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="STRMS760"></a><div class="props_rev_3"><a id="GUID-CADD7CB4-BA1D-4461-8542-C28661C9DAFC" name="GUID-CADD7CB4-BA1D-4461-8542-C28661C9DAFC"></a><h4 id="STRMS-GUID-CADD7CB4-BA1D-4461-8542-C28661C9DAFC" class="sect4"><span class="enumeration_section">17.8.1 </span>Setting the Message Handler for an Apply Process
                  </h4>
                  <div>
                     <div class="section">
                        <p>Set the <a href="strms_glossary.html#GUID-28E08694-4A8E-4D30-A805-876E82C4906A"><span class="xrefglossterm">message handler</span></a> for an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> using the <code class="codeph">message_handler</code> parameter in the <code class="codeph">ALTER_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. For example, the following procedure sets the message handler for an apply process named <code class="codeph">strm03_apply</code> to the <code class="codeph">mes_handler</code> procedure in the <code class="codeph">oe</code> schema.
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name      =&gt; 'strm03_apply',
    message_handler =&gt; 'oe.mes_handler');
END;
/
</pre><p>The user who runs the <code class="codeph">ALTER_APPLY</code> procedure must have <code class="codeph">EXECUTE</code> privilege on the specified message handler. If the message handler is already set for an apply process, then you can run the <code class="codeph">ALTER_APPLY</code> procedure to change the message handler for the apply process.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS762"></a><div class="props_rev_3"><a id="GUID-EDD1C401-7BED-453B-9804-79D5CA3F5910" name="GUID-EDD1C401-7BED-453B-9804-79D5CA3F5910"></a><h4 id="STRMS-GUID-EDD1C401-7BED-453B-9804-79D5CA3F5910" class="sect4"><span class="enumeration_section">17.8.2 </span>Unsetting the Message Handler for an Apply Process
                  </h4>
                  <div>
                     <div class="section">
                        <p>You unset the <a href="strms_glossary.html#GUID-28E08694-4A8E-4D30-A805-876E82C4906A"><span class="xrefglossterm">message handler</span></a> for an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> by setting the <code class="codeph">remove_message_handler</code> parameter to <code class="codeph">TRUE</code> in the <code class="codeph">ALTER_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. For example, the following procedure unsets the message handler for an apply process named <code class="codeph">strm03_apply</code>.
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name             =&gt; 'strm03_apply',
    remove_message_handler =&gt; TRUE);
END;
/
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="STRMS127"></a><div class="props_rev_3"><a id="GUID-B61BF83E-0B0A-45FD-89A0-3E58AB42118A" name="GUID-B61BF83E-0B0A-45FD-89A0-3E58AB42118A"></a><h3 id="STRMS-GUID-B61BF83E-0B0A-45FD-89A0-3E58AB42118A" class="sect3"><span class="enumeration_section">17.9 </span>Managing the Precommit Handler for an Apply Process
               </h3>
               <div>
                  <p>A precommit handler is an <a href="strms_glossary.html#GUID-4CEA651A-4197-4731-93D4-315BCB5CBE70"><span class="xrefglossterm">apply handler</span></a> that can receive the commit information for a transaction and process the commit information in any customized way.
                  </p>
                  <p>The following sections contain instructions for creating, setting, and unsetting the precommit handler for an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-3AF2BF7F-3EA5-4A5A-B87D-8350B2E28F30">Creating a Precommit Handler for an Apply Process</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-3ECA13CF-D430-40CA-835F-8748B073709D">Setting the Precommit Handler for an Apply Process</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-74EEDAD5-0276-4EE2-A1AE-7DEB40CAF010">Unsetting the Precommit Handler for an Apply Process</a></p>
                     </li>
                  </ul>
               </div><a id="STRMS764"></a><div class="props_rev_3"><a id="GUID-3AF2BF7F-3EA5-4A5A-B87D-8350B2E28F30" name="GUID-3AF2BF7F-3EA5-4A5A-B87D-8350B2E28F30"></a><h4 id="STRMS-GUID-3AF2BF7F-3EA5-4A5A-B87D-8350B2E28F30" class="sect4"><span class="enumeration_section">17.9.1 </span>Creating a Precommit Handler for an Apply Process
                  </h4>
                  <div>
                     <div class="section">
                        <p>A <a href="strms_glossary.html#GUID-7BE64BB2-BE69-47CC-9D6D-CE065A04E22F"><span class="xrefglossterm">precommit handler</span></a> must have the following signature:
                        </p><pre class="oac_no_warn" dir="ltr">PROCEDURE <span class="italic">handler_procedure</span> (
   <span class="italic">parameter_name</span>   IN  NUMBER);
</pre><p>Here, <span class="italic"><code class="codeph">handler_procedure</code></span> stands for the name of the procedure and <span class="italic"><code class="codeph">parameter_name</code></span> stands for the name of the parameter passed to the procedure. The parameter passed to the procedure is a commit SCN from an internal commit directive in the <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> used by the <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>. 
                        </p>
                        <p>You can use a precommit handler to record information about commits processed by an apply process. The apply process can apply <a href="strms_glossary.html#GUID-0D2E5DAF-804E-4089-9E0E-987C96F59706"><span class="xrefglossterm">captured LCR</span></a>s, <a href="strms_glossary.html#GUID-32700BD5-7584-46D3-8224-B534FAC20DD7"><span class="xrefglossterm">persistent LCR</span></a>s, or <a href="strms_glossary.html#GUID-8F1FA1C4-ADB5-4A4D-9374-B50AADB53066"><span class="xrefglossterm">persistent user message</span></a>s. For a captured row LCR, a commit directive contains the commit SCN of the transaction from the <a href="strms_glossary.html#GUID-B5BB35D0-9179-4301-BA50-5B9CE22E362D"><span class="xrefglossterm">source database</span></a>. For a persistent LCRs and persistent user messages, the commit SCN is generated by the apply process.
                        </p>
                        <p>The precommit handler procedure must conform to the following restrictions:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Any work that commits must be an autonomous transaction. </p>
                           </li>
                           <li>
                              <p>Any rollback must be to a named save point created in the procedure.</p>
                           </li>
                        </ul>
                        <p>If a precommit handler raises an exception, then the entire apply transaction is rolled back, and all of the messages in the transaction are moved to the error queue.</p>
                        <p>For example, a precommit handler can be used for auditing the row LCRs applied by an apply process. Such a precommit handler is used with one or more separate <a href="strms_glossary.html#GUID-8F26223B-B771-4E5B-9C57-0F748A0904F1"><span class="xrefglossterm">procedure DML handler</span></a>s to record the source database commit SCN for a transaction, and possibly the time when the apply process applies the transaction, in an audit table.
                        </p>
                        <p>Specifically, this example creates a precommit handler that is used with a procedure DML handler that records information about row LCRs in the following table:</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE strmadmin.history_row_lcrs(
  timestamp             DATE,
  source_database_name  VARCHAR2(128),
  command_type          VARCHAR2(30),
  object_owner          VARCHAR2(32),
  object_name           VARCHAR2(32),
  tag                   RAW(10),
  transaction_id        VARCHAR2(10),
  scn                   NUMBER,
  commit_scn            NUMBER,
  old_values            SYS.LCR$_ROW_LIST,
  new_values            SYS.LCR$_ROW_LIST)
    NESTED TABLE old_values STORE AS old_values_ntab
    NESTED TABLE new_values STORE AS new_values_ntab;
</pre><p>The procedure DML handler inserts a row in the <code class="codeph">strmadmin.history_row_lcrs</code> table for each row LCR processed by an apply process. The precommit handler created in this example inserts a row into the <code class="codeph">strmadmin.history_row_lcrs</code> table when a transaction commits.
                        </p>
                        <p>Create the procedure that inserts the commit information into the <code class="codeph">history_row_lcrs</code> table:
                        </p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE PROCEDURE strmadmin.history_commit(commit_number IN NUMBER)  
 IS
 BEGIN
  -- Insert commit information into the history_row_lcrs table
  INSERT INTO strmadmin.history_row_lcrs (timestamp, commit_scn) 
    VALUES (SYSDATE, commit_number);
END;
/</pre><div class="infoboxnotealso" id="GUID-3AF2BF7F-3EA5-4A5A-B87D-8350B2E28F30__GUID-D16AAE87-0F7A-4FDE-9934-DEFFD4555590">
                           <p class="notep1">See Also:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-C5B45C16-4C39-4BB3-8835-23852B6CD23C">Precommit Handlers</a>"</span></p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-A6074063-2D66-4FB9-864D-D5228624732A">Managing a DML Handler</a>"</span></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS765"></a><div class="props_rev_3"><a id="GUID-3ECA13CF-D430-40CA-835F-8748B073709D" name="GUID-3ECA13CF-D430-40CA-835F-8748B073709D"></a><h4 id="STRMS-GUID-3ECA13CF-D430-40CA-835F-8748B073709D" class="sect4"><span class="enumeration_section">17.9.2 </span>Setting the Precommit Handler for an Apply Process
                  </h4>
                  <div>
                     <div class="section">
                        <p>A precommit handler processes all commit directives dequeued by an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>. When you set a precommit handler for an apply process, the apply process uses it to process all of the commit directives that it dequeues. An apply process can have only one precommit handler.
                        </p>
                        <p>Set the precommit handler for an apply process using the <code class="codeph">precommit_handler</code> parameter in the <code class="codeph">ALTER_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. For example, the following procedure sets the precommit handler for an apply process named <code class="codeph">strm01_apply</code> to the <code class="codeph">history_commit</code> procedure in the <code class="codeph">strmadmin</code> schema.
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name        =&gt; 'strm01_apply',
    precommit_handler =&gt; 'strmadmin.history_commit');
END;
/
</pre><p>You can also specify a precommit handler when you create an apply process using the <code class="codeph">CREATE_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. If the precommit handler is already set for an apply process, then you can run the <code class="codeph">ALTER_APPLY</code> procedure to change the precommit handler for the apply process.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS767"></a><div class="props_rev_3"><a id="GUID-74EEDAD5-0276-4EE2-A1AE-7DEB40CAF010" name="GUID-74EEDAD5-0276-4EE2-A1AE-7DEB40CAF010"></a><h4 id="STRMS-GUID-74EEDAD5-0276-4EE2-A1AE-7DEB40CAF010" class="sect4"><span class="enumeration_section">17.9.3 </span>Unsetting the Precommit Handler for an Apply Process
                  </h4>
                  <div>
                     <div class="section">
                        <p>You unset the <a href="strms_glossary.html#GUID-7BE64BB2-BE69-47CC-9D6D-CE065A04E22F"><span class="xrefglossterm">precommit handler</span></a> for an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> by setting the <code class="codeph">remove_precommit_handler</code> parameter to <code class="codeph">TRUE</code> in the <code class="codeph">ALTER_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. For example, the following procedure unsets the precommit handler for an apply process named <code class="codeph">strm01_apply</code>.
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name               =&gt; 'strm01_apply',
    remove_precommit_handler =&gt; TRUE);
END;
/
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="STRMS128"></a><div class="props_rev_3"><a id="GUID-80FC2523-4B43-42D1-80F0-2A796BA81938" name="GUID-80FC2523-4B43-42D1-80F0-2A796BA81938"></a><h3 id="STRMS-GUID-80FC2523-4B43-42D1-80F0-2A796BA81938" class="sect3"><span class="enumeration_section">17.10 </span>Specifying That Apply Processes Enqueue Messages
               </h3>
               <div>
                  <p>This section contains instructions for setting a destination <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> into which <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>es that use a specified <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a> in a <a href="strms_glossary.html#GUID-A810B839-61A2-4DEB-85C9-8F2F09455268"><span class="xrefglossterm">positive rule set</span></a> will enqueue <a href="strms_glossary.html#GUID-62ABA207-07D4-453A-AC59-B0C780A3FB59"><span class="xrefglossterm">message</span></a>s that satisfy the rule. This section also contains instructions for removing destination queue settings.
                  </p>
                  <div class="infoboxnotealso" id="GUID-80FC2523-4B43-42D1-80F0-2A796BA81938__GUID-08FC85C3-ABDB-4E69-AC07-0E39F84EA04B">
                     <p class="notep1">See Also:</p>
                     <p><span class="q">"<a href="monitoring-oracle-streams-apply-processes.html#GUID-B843B830-9CB7-44BB-9C88-47196ECF342B">Viewing Rules that Specify a Destination Queue on Apply</a>"</span></p>
                  </div>
               </div><a id="STRMS769"></a><div class="props_rev_3"><a id="GUID-99D54219-E0DE-44AA-94C3-31E571D88070" name="GUID-99D54219-E0DE-44AA-94C3-31E571D88070"></a><h4 id="STRMS-GUID-99D54219-E0DE-44AA-94C3-31E571D88070" class="sect4"><span class="enumeration_section">17.10.1 </span>Setting the Destination Queue for Messages that Satisfy a Rule
                  </h4>
                  <div>
                     <div class="section">
                        <p>You use the <code class="codeph">SET_ENQUEUE_DESTINATION</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to set a destination <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> for <a href="strms_glossary.html#GUID-62ABA207-07D4-453A-AC59-B0C780A3FB59"><span class="xrefglossterm">message</span></a>s that satisfy a specific <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a>. For example, to set the destination queue for a rule named <code class="codeph">employees5</code> to the queue <code class="codeph">hr.change_queue</code>, run the following procedure:
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_ENQUEUE_DESTINATION(
    rule_name               =&gt;  'employees5',
    destination_queue_name  =&gt;  'hr.change_queue');
END;
/
</pre><p>This procedure modifies the <a href="strms_glossary.html#GUID-1F2E6C1D-EA5A-4E0C-BC0F-E4CAEE6F2E5C"><span class="xrefglossterm">action context</span></a> of the rule to specify the queue. Any <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> in the local database with the <code class="codeph">employees5</code> rule in its <a href="strms_glossary.html#GUID-A810B839-61A2-4DEB-85C9-8F2F09455268"><span class="xrefglossterm">positive rule set</span></a> will enqueue a message into <code class="codeph">hr.change_queue</code> if the message satisfies the <code class="codeph">employees5</code> rule. To change the destination queue for the <code class="codeph">employees5</code> rule, run the <code class="codeph">SET_ENQUEUE_DESTINATION</code> procedure again and specify a different queue.
                        </p>
                        <p>The <a href="strms_glossary.html#GUID-87C6D214-6D80-452F-87A2-EA39B884189E"><span class="xrefglossterm">apply user</span></a> of each apply process using the specified rule must have the necessary privileges to enqueue messages into the specified queue. If the queue is a <a href="strms_glossary.html#GUID-B70AC3A1-F93B-445D-9BD1-342A94A9EDDE"><span class="xrefglossterm">secure queue</span></a>, then the apply user must be a secure queue user of the queue.
                        </p>
                        <p>A message that has been enqueued using the <code class="codeph">SET_ENQUEUE_DESTINATION</code> procedure is the same as any other message that is enqueued manually. Such messages can be manually dequeued, applied by an apply process created with the <code class="codeph">apply_captured</code> parameter set to <code class="codeph">FALSE</code>, or propagated to another queue.
                        </p>
                        <div class="infoboxnote" id="GUID-99D54219-E0DE-44AA-94C3-31E571D88070__GUID-342EABA7-C31A-4575-B9C3-02003BEA013D">
                           <p class="notep1">Note:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The specified rule must be in the positive rule set for an apply process. If the rule is in the <a href="strms_glossary.html#GUID-F44D0886-397B-4E00-A666-A19F96F3C242"><span class="xrefglossterm">negative rule set</span></a> for an apply process, then the apply process does not enqueue the message into the destination queue.
                                 </p>
                              </li>
                              <li>
                                 <p>The apply process always enqueues messages into a <a href="strms_glossary.html#GUID-8D447372-AA6C-4326-8A8F-2E13F9350AF1"><span class="xrefglossterm">persistent queue</span></a>. It cannot enqueue messages into a <a href="strms_glossary.html#GUID-9ABDA00F-83A1-435F-8E93-315D3D05E4B7"><span class="xrefglossterm">buffered queue</span></a>.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="infoboxnotealso" id="GUID-99D54219-E0DE-44AA-94C3-31E571D88070__GUID-ADB15D43-B1AE-4E68-A030-7AAE872EC8F5">
                           <p class="notep1">See Also:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="managing-staging-and-propagation.html#GUID-E35C379E-13EF-4031-888E-1F943B7DAF9C">Enabling a User to Perform Operations on a Secure Queue</a>"</span></p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="advanced-rule-concepts.html#GUID-43168977-C0D6-42B2-B0E3-711BDA4BE6AA">Enqueue Destinations for Messages During Apply</a>"</span> for more information about how the <code class="codeph">SET_ENQUEUE_DESTINATION</code> procedure modifies the action context of the specified rule
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS770"></a><div class="props_rev_3"><a id="GUID-4361D10E-0F87-4657-A3C2-5C0689EC004D" name="GUID-4361D10E-0F87-4657-A3C2-5C0689EC004D"></a><h4 id="STRMS-GUID-4361D10E-0F87-4657-A3C2-5C0689EC004D" class="sect4"><span class="enumeration_section">17.10.2 </span>Removing the Destination Queue Setting for a Rule
                  </h4>
                  <div>
                     <div class="section">
                        <p>You use the <code class="codeph">SET_ENQUEUE_DESTINATION</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to remove a destination <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> for <a href="strms_glossary.html#GUID-62ABA207-07D4-453A-AC59-B0C780A3FB59"><span class="xrefglossterm">message</span></a>s that satisfy a specified <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a>. Specifically, you set the <code class="codeph">destination_queue_name</code> parameter in this procedure to <code class="codeph">NULL</code> for the rule. When a destination queue specification is removed for a rule, messages that satisfy the rule are no longer enqueued into the queue by an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>. 
                        </p>
                        <p>For example, to remove the destination queue for a rule named <code class="codeph">employees5</code>, run the following procedure:
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_ENQUEUE_DESTINATION(
    rule_name               =&gt;  'employees5',
    destination_queue_name  =&gt;  NULL);
END;
/
</pre><p>Any apply process in the local database with the <code class="codeph">employees5</code> rule in its <a href="strms_glossary.html#GUID-A810B839-61A2-4DEB-85C9-8F2F09455268"><span class="xrefglossterm">positive rule set</span></a> no longer enqueues a message into <code class="codeph">hr.change_queue</code> if the message satisfies the <code class="codeph">employees5</code> rule.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="STRMS771"></a><div class="props_rev_3"><a id="GUID-C9D9ABD3-392A-4AF6-BD91-6A75E050AEFA" name="GUID-C9D9ABD3-392A-4AF6-BD91-6A75E050AEFA"></a><h3 id="STRMS-GUID-C9D9ABD3-392A-4AF6-BD91-6A75E050AEFA" class="sect3"><span class="enumeration_section">17.11 </span>Specifying Execute Directives for Apply Processes
               </h3>
               <div>
                  <p>This section contains instructions for setting an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> execute directive for <a href="strms_glossary.html#GUID-62ABA207-07D4-453A-AC59-B0C780A3FB59"><span class="xrefglossterm">message</span></a>s that satisfy a specified <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a> in the <a href="strms_glossary.html#GUID-A810B839-61A2-4DEB-85C9-8F2F09455268"><span class="xrefglossterm">positive rule set</span></a> for the apply process.
                  </p>
                  <div class="infoboxnotealso" id="GUID-C9D9ABD3-392A-4AF6-BD91-6A75E050AEFA__GUID-3B8D7DB6-BEC5-4ED7-A3D1-425514711B92">
                     <p class="notep1">See Also:</p>
                     <p><span class="q">"<a href="monitoring-oracle-streams-apply-processes.html#GUID-483418CB-41AD-4438-86BB-DAFC4F1AB2F2">Viewing Rules that Specify No Execution on Apply</a>"</span></p>
                  </div>
               </div><a id="STRMS772"></a><div class="props_rev_3"><a id="GUID-6ADD622A-3DDD-4EEC-A859-3832A3B3AE1A" name="GUID-6ADD622A-3DDD-4EEC-A859-3832A3B3AE1A"></a><h4 id="STRMS-GUID-6ADD622A-3DDD-4EEC-A859-3832A3B3AE1A" class="sect4"><span class="enumeration_section">17.11.1 </span>Specifying that Messages that Satisfy a Rule Are Not Executed
                  </h4>
                  <div>
                     <div class="section">
                        <p>You use the <code class="codeph">SET_EXECUTE</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to specify that <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>es do not execute <a href="strms_glossary.html#GUID-62ABA207-07D4-453A-AC59-B0C780A3FB59"><span class="xrefglossterm">message</span></a>s that satisfy a specified <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a>. Specifically, you set the <code class="codeph">execute</code> parameter in this procedure to <code class="codeph">FALSE</code> for the rule. After setting the execution directive to <code class="codeph">FALSE</code> for a rule, an apply process with the rule in its <a href="strms_glossary.html#GUID-A810B839-61A2-4DEB-85C9-8F2F09455268"><span class="xrefglossterm">positive rule set</span></a> does not execute a message that satisfies the rule.
                        </p>
                        <p>For example, to specify that apply processes do not execute messages that satisfy a rule named <code class="codeph">departments8</code>, run the following procedure:
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_EXECUTE(
    rule_name   =&gt;  'departments8',
    execute     =&gt;  FALSE);
END;
/
</pre><p>This procedure modifies the <a href="strms_glossary.html#GUID-1F2E6C1D-EA5A-4E0C-BC0F-E4CAEE6F2E5C"><span class="xrefglossterm">action context</span></a> of the rule to specify the execution directive. Any apply process in the local database with the <code class="codeph">departments8</code> rule in its positive rule set will not execute a message if the message satisfies the <code class="codeph">departments8</code> rule. That is, if the message is an LCR, then an apply process does not apply the change in the LCR to the relevant database object. Also, an apply process does not send a message that satisfies this rule to any <a href="strms_glossary.html#GUID-4CEA651A-4197-4731-93D4-315BCB5CBE70"><span class="xrefglossterm">apply handler</span></a>.
                        </p>
                        <div class="infoboxnote" id="GUID-6ADD622A-3DDD-4EEC-A859-3832A3B3AE1A__GUID-A5289B17-A4CB-4CB0-AFC2-A83537F9575A">
                           <p class="notep1">Note:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The specified rule must be in the positive rule set for an apply process for the apply process to follow the execution directive. If the rule is in the <a href="strms_glossary.html#GUID-F44D0886-397B-4E00-A666-A19F96F3C242"><span class="xrefglossterm">negative rule set</span></a> for an apply process, then the apply process ignores the execution directive for the rule.
                                 </p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">SET_EXECUTE</code> procedure can be used with the <code class="codeph">SET_ENQUEUE_DESTINATION</code> procedure to enqueue messages that satisfy a particular rule into a destination <a href="strms_glossary.html#GUID-8D7B2770-B1EC-44C7-B861-B78E571CADA6"><span class="xrefglossterm">queue</span></a> without executing these messages. After a message is enqueued using the <code class="codeph">SET_ENQUEUE_DESTINATION</code> procedure, it is the same as any message that is enqueued manually. Therefore, it can be manually dequeued, applied by an apply process, or propagated to another queue.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="infoboxnotealso" id="GUID-6ADD622A-3DDD-4EEC-A859-3832A3B3AE1A__GUID-02F5F9EE-C320-4BE7-A83E-95A776E577B8">
                           <p class="notep1">See Also:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="advanced-rule-concepts.html#GUID-E0657629-9C62-4614-A4CE-C7C4CD9500B7">Execution Directives for Messages During Apply</a>"</span> for more information about how the <code class="codeph">SET_EXECUTE</code> procedure modifies the action context of the specified rule
                                 </p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-80FC2523-4B43-42D1-80F0-2A796BA81938">Specifying That Apply Processes Enqueue Messages</a>"</span></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS773"></a><div class="props_rev_3"><a id="GUID-892BB4ED-2DB3-4D9A-AC1C-CA8995D6A77C" name="GUID-892BB4ED-2DB3-4D9A-AC1C-CA8995D6A77C"></a><h4 id="STRMS-GUID-892BB4ED-2DB3-4D9A-AC1C-CA8995D6A77C" class="sect4"><span class="enumeration_section">17.11.2 </span>Specifying that Messages that Satisfy a Rule Are Executed
                  </h4>
                  <div>
                     <div class="section">
                        <p>You use the <code class="codeph">SET_EXECUTE</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to specify that <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>es execute <a href="strms_glossary.html#GUID-62ABA207-07D4-453A-AC59-B0C780A3FB59"><span class="xrefglossterm">message</span></a>s that satisfy a specified <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a>. Specifically, you set the <code class="codeph">execute</code> parameter in this procedure to <code class="codeph">TRUE</code> for the rule. By default, each apply process executes messages that satisfy a rule in the <a href="strms_glossary.html#GUID-A810B839-61A2-4DEB-85C9-8F2F09455268"><span class="xrefglossterm">positive rule set</span></a> for the apply process, assuming that the message does not satisfy a rule in the <a href="strms_glossary.html#GUID-F44D0886-397B-4E00-A666-A19F96F3C242"><span class="xrefglossterm">negative rule set</span></a> for the apply process. Therefore, you must set the <code class="codeph">execute</code> parameter to <code class="codeph">TRUE</code> for a rule only if this parameter was set to <code class="codeph">FALSE</code> for the rule earlier.
                        </p>
                        <p>For example, to specify that apply processes executes messages that satisfy a rule named <code class="codeph">departments8</code>, run the following procedure:
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_EXECUTE(
    rule_name   =&gt;  'departments8',
    execute     =&gt;  TRUE);
END;
/
</pre><p>Any apply process in the local database with the <code class="codeph">departments8</code> rule in its positive rule set will execute a message if the message satisfies the <code class="codeph">departments8</code> rule. That is, if the message is an LCR, then an apply process applies the change in the LCR to the relevant database object. Also, an apply process sends a message that satisfies this rule to an <a href="strms_glossary.html#GUID-4CEA651A-4197-4731-93D4-315BCB5CBE70"><span class="xrefglossterm">apply handler</span></a> if it is configured to do so.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="STRMS144"></a><div class="props_rev_3"><a id="GUID-B753BE7F-596C-496B-82E5-C0F24947420A" name="GUID-B753BE7F-596C-496B-82E5-C0F24947420A"></a><h3 id="STRMS-GUID-B753BE7F-596C-496B-82E5-C0F24947420A" class="sect3"><span class="enumeration_section">17.12 </span>Managing an Error Handler
               </h3>
               <div>
                  <p>An <a href="strms_glossary.html#GUID-99DD84B0-08E1-4209-8541-C9A4FEE80052"><span class="xrefglossterm">error handler</span></a> handles errors resulting from a row LCR dequeued by any <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> that contains a specific operation on a specific table.
                  </p>
                  <p>The following sections contain instructions for creating, setting, and unsetting an error handler:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-88CF8707-EBF2-4650-ABA2-B44796638975">Creating an Error Handler</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-00635674-7945-420A-9BF5-1B8C1DA550AE">Setting an Error Handler</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-6A304A3F-D6E8-4734-BE05-27143C672EBC">Unsetting an Error Handler</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-B753BE7F-596C-496B-82E5-C0F24947420A__GUID-502D02C6-36ED-4398-8011-769E7E07E4CA">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-E540231B-9063-4F4E-BE79-72349800F720">Types of Messages That Can Be Processed with an Apply Process</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-91C26D01-385D-4BD0-A29F-C2A0BFED0360">Message Processing Options for an Apply Process</a>"</span></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="STRMS774"></a><div class="props_rev_3"><a id="GUID-88CF8707-EBF2-4650-ABA2-B44796638975" name="GUID-88CF8707-EBF2-4650-ABA2-B44796638975"></a><h4 id="STRMS-GUID-88CF8707-EBF2-4650-ABA2-B44796638975" class="sect4"><span class="enumeration_section">17.12.1 </span>Creating an Error Handler
                  </h4>
                  <div>
                     <div class="section">
                        <p>You create an <a href="strms_glossary.html#GUID-99DD84B0-08E1-4209-8541-C9A4FEE80052"><span class="xrefglossterm">error handler</span></a> by running the <code class="codeph">SET_DML_HANDLER</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package and setting the <code class="codeph">error_handler</code> parameter to <code class="codeph">TRUE</code>.
                        </p>
                        <p>An error handler must have the following signature:</p><pre class="oac_no_warn" dir="ltr">PROCEDURE <span class="italic">user_procedure</span> (
     message             IN ANYDATA,
     error_stack_depth   IN NUMBER,
     error_numbers       IN DBMS_UTILITY.NUMBER_ARRAY,
     error_messages      IN emsg_array);
</pre><p>Here, <span class="italic"><code class="codeph">user_procedure</code></span> stands for the name of the procedure. Each parameter is required and must have the specified data type. However, you can change the names of the parameters. The <code class="codeph">emsg_array</code> parameter must be a user-defined array that is a PL/SQL table of type <code class="codeph">VARCHAR2</code> with at least 76 characters.
                        </p>
                        <div class="infoboxnote" id="GUID-88CF8707-EBF2-4650-ABA2-B44796638975__GUID-83AFE138-F26D-4E88-A1DD-9E6EE5CBFE08">
                           <p class="notep1">Note:</p>
                           <p>Some conditions on the user procedure specified in <code class="codeph">SET_DML_HANDLER</code> must be met for error handlers. See <span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-A6074063-2D66-4FB9-864D-D5228624732A">Managing a DML Handler</a>"</span> for information about these conditions.
                           </p>
                        </div>
                        <p>Running an error handler results in one of the following outcomes:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The error handler successfully resolves the error, applies the row LCR if appropriate, and returns control back to the <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>.
                              </p>
                           </li>
                           <li>
                              <p>The error handler fails to resolve the error, and the error is raised. The raised error causes the transaction to be rolled back and placed in the error queue.</p>
                           </li>
                        </ul>
                        <p>If you want to retry the DML operation, then have the error handler procedure run the <code class="codeph">EXECUTE</code> member procedure for the LCR.
                        </p>
                        <p>The following example creates an error handler named <code class="codeph">regions_pk_error</code> that resolves primary key violations for the <code class="codeph">hr.regions</code> table. At a <a href="strms_glossary.html#GUID-C73813B0-D8A7-46D5-85B2-15BAB0A146B5"><span class="xrefglossterm">destination database</span></a>, assume users insert rows into the <code class="codeph">hr.regions</code> table and an apply process applies changes to the <code class="codeph">hr.regions</code> table that originated from a <a href="strms_glossary.html#GUID-7E24C191-B4E0-45F2-A55B-9F76D4F9E8B0"><span class="xrefglossterm">capture process</span></a> at a remote <a href="strms_glossary.html#GUID-B5BB35D0-9179-4301-BA50-5B9CE22E362D"><span class="xrefglossterm">source database</span></a>. In this environment, there is a possibility of errors resulting from users at the destination database inserting a row with the same primary key value as an insert row LCR applied from the source database.
                        </p>
                        <p>This example creates a table in the <code class="codeph">strmadmin</code> schema called <code class="codeph">errorlog</code> to record the following information about each primary key violation error on the <code class="codeph">hr.regions</code> table:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The time stamp when the error occurred</p>
                           </li>
                           <li>
                              <p>The name of the apply process that raised the error</p>
                           </li>
                           <li>
                              <p>The user who caused the error (sender), which is the capture process name for <a href="strms_glossary.html#GUID-0D2E5DAF-804E-4089-9E0E-987C96F59706"><span class="xrefglossterm">captured LCR</span></a>s, the <a href="strms_glossary.html#GUID-5CA58899-A02D-422A-AE15-E8FCD004EB17"><span class="xrefglossterm">synchronous capture</span></a> name for <a href="strms_glossary.html#GUID-32700BD5-7584-46D3-8224-B534FAC20DD7"><span class="xrefglossterm">persistent LCR</span></a>s captured by the synchronous capture, or the name of the Oracle Database Advanced Queuing (AQ) agent for <a href="strms_glossary.html#GUID-32700BD5-7584-46D3-8224-B534FAC20DD7"><span class="xrefglossterm">persistent LCR</span></a>s and <a href="strms_glossary.html#GUID-8F1FA1C4-ADB5-4A4D-9374-B50AADB53066"><span class="xrefglossterm">persistent user message</span></a>s enqueued by an application
                              </p>
                           </li>
                           <li>
                              <p>The name of the object on which the DML operation was run, because errors for other objects might be logged in the future</p>
                           </li>
                           <li>
                              <p>The type of command used in the DML operation</p>
                           </li>
                           <li>
                              <p>The name of the constraint violated</p>
                           </li>
                           <li>
                              <p>The error message</p>
                           </li>
                           <li>
                              <p>The LCR that caused the error</p>
                           </li>
                        </ul>
                        <p>This error handler resolves only errors that are caused by a primary key violation on the <code class="codeph">hr.regions</code> table. To resolve this type of error, the error handler modifies the <code class="codeph">region_id</code> value in the row LCR using a sequence and then executes the row LCR to apply it. If other types of errors occur, then you can use the row LCR you stored in the <code class="codeph">errorlog</code> table to resolve the error manually.
                        </p>
                        <p>For example, the following error is resolved by the error handler:</p>
                        <ol>
                           <li>
                              <p>At the destination database, a user inserts a row into the <code class="codeph">hr.regions</code> table with a <code class="codeph">region_id</code> value of <code class="codeph">6</code> and a <code class="codeph">region_name</code> value of <code class="codeph">'LILLIPUT'</code>. 
                              </p>
                           </li>
                           <li id="GUID-88CF8707-EBF2-4650-ABA2-B44796638975__i1010617">
                              <p>At the source database, a user inserts a row into the <code class="codeph">hr.regions</code> table with a <code class="codeph">region_id</code> value of <code class="codeph">6</code> and a <code class="codeph">region_name</code> value of <code class="codeph">'BROBDINGNAG'</code>.
                              </p>
                           </li>
                           <li>
                              <p>A capture process at the source database captures the change described in Step&nbsp;<a href="managing-oracle-streams-information-consumption.html#GUID-88CF8707-EBF2-4650-ABA2-B44796638975__i1010617">2</a>.
                              </p>
                           </li>
                           <li>
                              <p>A <a href="strms_glossary.html#GUID-13E35632-96B9-4A58-8990-EF95ECE9746E"><span class="xrefglossterm">propagation</span></a> propagates the LCR containing the change from a queue at the source database to the queue used by the apply process at the destination database.
                              </p>
                           </li>
                           <li>
                              <p>When the apply process tries to apply the LCR, an error results because of a primary key violation.</p>
                           </li>
                           <li>
                              <p>The apply process invokes the error handler to handle the error.</p>
                           </li>
                           <li>
                              <p>The error handler logs the error in the <code class="codeph">strmadmin.errorlog</code> table.
                              </p>
                           </li>
                           <li>
                              <p>The error handler modifies the <code class="codeph">region_id</code> value in the LCR using a sequence and executes the LCR to apply it.
                              </p>
                           </li>
                        </ol>
                        <p>Complete the following steps to create the <code class="codeph">regions_pk_error</code> error handler:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>In SQL*Plus, connect to the database as the <code class="codeph">hr</code> user.</span><div>
                              <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strms&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for information about connecting to a database in SQL*Plus.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Create the sequence used by the error handler to assign new primary key values:</span><div><pre class="oac_no_warn" dir="ltr">CREATE SEQUENCE hr.reg_exception_s START WITH 9000;
</pre><p>This example assumes that users at the destination database will never insert a row into the <code class="codeph">hr.regions</code> table with a <code class="codeph">region_id</code> greater than <code class="codeph">8999</code>.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Grant the Oracle Streams administrator <code class="codeph">ALL</code> privilege on the sequence:</span><div><pre class="oac_no_warn" dir="ltr">GRANT ALL ON reg_exception_s TO strmadmin;
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Connect to the database as the Oracle Streams administrator.</span></li>
                        <li class="stepexpand"><span>Create the <code class="codeph">errorlog</code> table:</span><div><pre class="oac_no_warn" dir="ltr">CREATE TABLE strmadmin.errorlog(
  logdate       DATE,
  apply_name    VARCHAR2(30),
  sender        VARCHAR2(100),
  object_name   VARCHAR2(32),
  command_type  VARCHAR2(30),
  errnum        NUMBER,
  errmsg        VARCHAR2(2000),
  text          VARCHAR2(2000),
  lcr           SYS.LCR$_ROW_RECORD);
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Create a package that includes the <code class="codeph">regions_pk_error</code> procedure:</span><div><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE PACKAGE errors_pkg 
AS
 TYPE emsg_array IS TABLE OF VARCHAR2(2000) INDEX BY BINARY_INTEGER;
 PROCEDURE regions_pk_error( 
   message            IN ANYDATA,
   error_stack_depth  IN NUMBER,
   error_numbers      IN DBMS_UTILITY.NUMBER_ARRAY,
   error_messages     IN EMSG_ARRAY);
END errors_pkg ;
/
</pre></div>
                        </li>
                        <li class="stepexpand"><span><a id="d78429e9555" class="indexterm-anchor"></a><a id="d78429e9557" class="indexterm-anchor"></a><a id="d78429e9559" class="indexterm-anchor"></a><a id="d78429e9561" class="indexterm-anchor"></a><a id="d78429e9563" class="indexterm-anchor"></a><a id="d78429e9565" class="indexterm-anchor"></a><a id="d78429e9567" class="indexterm-anchor"></a><a id="d78429e9569" class="indexterm-anchor"></a><a id="d78429e9571" class="indexterm-anchor"></a>Create the package body:</span><div><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE PACKAGE BODY errors_pkg AS
 PROCEDURE regions_pk_error ( 
   message            IN ANYDATA,
   error_stack_depth  IN NUMBER,
   error_numbers      IN DBMS_UTILITY.NUMBER_ARRAY,
   error_messages     IN EMSG_ARRAY )
 IS
  reg_id     NUMBER;
  ad         ANYDATA;
  lcr        SYS.LCR$_ROW_RECORD;
  ret        PLS_INTEGER;
  vc         VARCHAR2(30);
  apply_name VARCHAR2(30);
  errlog_rec errorlog%ROWTYPE ;
  ov2        SYS.LCR$_ROW_LIST;
 BEGIN
  -- Access the error number from the top of the stack.
  -- In case of check constraint violation,
  -- get the name of the constraint violated.
  IF error_numbers(1) IN ( 1 , 2290 ) THEN
   ad  := DBMS_STREAMS.GET_INFORMATION('CONSTRAINT_NAME');
   ret := ad.GetVarchar2(errlog_rec.text);
  ELSE 
   errlog_rec.text := NULL ;
  END IF ;
  -- Get the name of the sender and the name of the apply process.
  ad  := DBMS_STREAMS.GET_INFORMATION('SENDER');
  ret := ad.GETVARCHAR2(errlog_rec.sender);
  apply_name := DBMS_STREAMS.GET_STREAMS_NAME();
  -- Try to access the LCR.
  ret := message.GETOBJECT(lcr);
  errlog_rec.object_name  := lcr.GET_OBJECT_NAME() ;
  errlog_rec.command_type := lcr.GET_COMMAND_TYPE() ;
  errlog_rec.errnum := error_numbers(1) ;
  errlog_rec.errmsg := error_messages(1) ;
  INSERT INTO strmadmin.errorlog VALUES (SYSDATE, apply_name, 
       errlog_rec.sender, errlog_rec.object_name, errlog_rec.command_type, 
       errlog_rec.errnum, errlog_rec.errmsg, errlog_rec.text, lcr);
  -- Add the logic to change the contents of LCR with correct values.
  -- In this example, get a new region_id number 
  -- from the hr.reg_exception_s sequence.
  ov2 := lcr.GET_VALUES('new', 'n');
  FOR i IN 1 .. ov2.count
  LOOP
    IF ov2(i).column_name = 'REGION_ID' THEN
     SELECT hr.reg_exception_s.NEXTVAL INTO reg_id FROM DUAL; 
     ov2(i).data := ANYDATA.ConvertNumber(reg_id) ;
    END IF ;
  END LOOP ;
  -- Set the NEW values in the LCR.
  lcr.SET_VALUES(value_type =&gt; 'NEW', value_list =&gt; ov2);
  -- Execute the modified LCR to apply it.
  lcr.EXECUTE(TRUE);
 END regions_pk_error;
END errors_pkg;
/
</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnote" id="GUID-88CF8707-EBF2-4650-ABA2-B44796638975__GUID-8A894A83-AFE2-493A-B8C6-493386C6AA88">
                           <p class="notep1">Note:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>For subsequent changes to the modified row to be applied successfully, you should converge the rows at the two databases as quickly as possible. That is, you should make the <code class="codeph">region_id</code> for the row match at the source and destination database. If you do not want these manual changes to be recaptured at a database, then use the <code class="codeph">SET_TAG</code> procedure in the <code class="codeph">DBMS_STREAMS</code> package to set the <a href="strms_glossary.html#GUID-D667D798-F9C9-437F-92AB-8C04FAD19B64"><span class="xrefglossterm">tag</span></a> for the session in which you make the change to a value that is not captured.
                                 </p>
                              </li>
                              <li>
                                 <p>This example error handler illustrates the use of the <code class="codeph">GET_VALUES</code> member function and <code class="codeph">SET_VALUES</code> member procedure for the LCR. If you are modifying only one value in the LCR, then the <code class="codeph">GET_VALUE</code> member function and <code class="codeph">SET_VALUE</code> member procedure might be more convenient and more efficient.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="infoboxnotealso" id="GUID-88CF8707-EBF2-4650-ABA2-B44796638975__GUID-FB32D8AF-628E-40B4-8AA3-698E5F491B21">
                           <p class="notep1">See Also:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="../strep/oracle-streams-tags.html#STREP120"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for more information about setting tag values generated by the current session
                                 </p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="troubleshooting-apply.html#GUID-329ED4AF-750C-456D-994D-B1103729B4EE">Are There Any Apply Errors in the Error Queue?</a>"</span> for information about specific error messages to handle in an error handler
                                 </p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS775"></a><div class="props_rev_3"><a id="GUID-00635674-7945-420A-9BF5-1B8C1DA550AE" name="GUID-00635674-7945-420A-9BF5-1B8C1DA550AE"></a><h4 id="STRMS-GUID-00635674-7945-420A-9BF5-1B8C1DA550AE" class="sect4"><span class="enumeration_section">17.12.2 </span>Setting an Error Handler
                  </h4>
                  <div>
                     <div class="section">
                        <p>An <a href="strms_glossary.html#GUID-99DD84B0-08E1-4209-8541-C9A4FEE80052"><span class="xrefglossterm">error handler</span></a> handles errors resulting from a row LCR dequeued by any <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a> that contains a specific operation on a specific table. You can specify multiple error handlers on the same table, to handle errors resulting from different operations on the table. You can either set an error handler for a specific apply process, or you can set an error handler as a general error handler that is used by all apply processes that apply the specified operation to the specified table.
                        </p>
                        <p>Set an error handler using the <code class="codeph">SET_DML_HANDLER</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. When you run this procedure to set an error handler, set the <code class="codeph">error_handler</code> parameter to <code class="codeph">TRUE</code>.
                        </p>
                        <p>For example, the following procedure sets the error handler for <code class="codeph">INSERT</code> operations on the <code class="codeph">hr.regions</code> table. Therefore, when any apply process dequeues a row LCR containing an <code class="codeph">INSERT</code> operation on the local <code class="codeph">hr.regions</code> table, and the row LCR results in an error, the apply process sends the row LCR to the <code class="codeph">strmadmin.errors_pkg.regions_pk_error</code> PL/SQL procedure for processing. If the error handler cannot resolve the error, then the row LCR and all of the other row LCRs in the same transaction are moved to the error queue. 
                        </p>
                        <p>In this example, the <code class="codeph">apply_name</code> parameter is set to <code class="codeph">NULL</code>. Therefore, the error handler is a general error handler that is used by all of the apply processes in the database.
                        </p>
                        <p>Run the following procedure to set the error handler:</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_DML_HANDLER(
    object_name         =&gt; 'hr.regions',
    object_type         =&gt; 'TABLE',
    operation_name      =&gt; 'INSERT',
    error_handler       =&gt; TRUE,
    user_procedure      =&gt; 'strmadmin.errors_pkg.regions_pk_error',
    apply_database_link =&gt; NULL,
    apply_name          =&gt; NULL);
END;
/
</pre><p>If the error handler is already set, then you can run the <code class="codeph">SET_DML_HANDLER</code> procedure to change the error handler.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS776"></a><div class="props_rev_3"><a id="GUID-6A304A3F-D6E8-4734-BE05-27143C672EBC" name="GUID-6A304A3F-D6E8-4734-BE05-27143C672EBC"></a><h4 id="STRMS-GUID-6A304A3F-D6E8-4734-BE05-27143C672EBC" class="sect4"><span class="enumeration_section">17.12.3 </span>Unsetting an Error Handler
                  </h4>
                  <div>
                     <div class="section">
                        <p>You unset an <a href="strms_glossary.html#GUID-99DD84B0-08E1-4209-8541-C9A4FEE80052"><span class="xrefglossterm">error handler</span></a> using the <code class="codeph">SET_DML_HANDLER</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. When you run that procedure, set the <code class="codeph">user_procedure</code> parameter to <code class="codeph">NULL</code> for a specific operation on a specific table. 
                        </p>
                        <p>For example, the following procedure unsets the error handler for <code class="codeph">INSERT</code> operations on the <code class="codeph">hr.regions</code> table:
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_DML_HANDLER(
    object_name    =&gt; 'hr.regions',
    object_type    =&gt; 'TABLE',
    operation_name =&gt; 'INSERT',
    user_procedure =&gt; NULL,
    apply_name     =&gt; NULL);
END;
/
</pre><div class="infoboxnote" id="GUID-6A304A3F-D6E8-4734-BE05-27143C672EBC__GUID-26F2A8D9-79C9-44C6-B652-44A9ADDFEBC0">
                           <p class="notep1">Note:</p>
                           <p>The <code class="codeph">error_handler</code> parameter does not need to be specified.
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="STRMS112"></a><div class="props_rev_3"><a id="GUID-3C45493C-6DD6-478F-98D7-71A857D17FDD" name="GUID-3C45493C-6DD6-478F-98D7-71A857D17FDD"></a><h3 id="STRMS-GUID-3C45493C-6DD6-478F-98D7-71A857D17FDD" class="sect3"><span class="enumeration_section">17.13 </span>Managing Apply Errors
               </h3>
               <div>
                  <p>The following sections contain instructions for retrying and deleting apply errors:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-FDCC01D7-244E-4BEE-B0AB-6D011BC0F487">Retrying Apply Error Transactions</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-B965A832-778D-4D8D-B49D-2519CD6B0433">Deleting Apply Error Transactions</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-3C45493C-6DD6-478F-98D7-71A857D17FDD__GUID-371939B2-F4A7-470E-A64A-851AFC5F0D1D">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="oracle-streams-information-consumption.html#GUID-0996F5C0-F684-4495-A20E-02FD995FDAD8">The Error Queue</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="monitoring-oracle-streams-apply-processes.html#GUID-B3E9BD13-C4A2-4E7F-9571-A9687AEB5E07">Checking for Apply Errors</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="monitoring-oracle-streams-apply-processes.html#GUID-B2BCDB9E-5B7C-457C-8AB1-B5A7F1711148">Displaying Detailed Information About Apply Errors</a>"</span></p>
                        </li>
                        <li>
                           <p>The Oracle Enterprise Manager Cloud Control online help for information about managing apply errors in Oracle Enterprise Manager Cloud Control</p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="advanced-apply-process-concepts.html#GUID-D46B0023-8D39-466A-9EFD-F69EB6F79BA2">Considerations for Applying DML Changes to Tables</a>"</span> for information about the possible causes of apply errors
                           </p>
                        </li>
                     </ul>
                  </div>
               </div><a id="STRMS777"></a><div class="props_rev_3"><a id="GUID-FDCC01D7-244E-4BEE-B0AB-6D011BC0F487" name="GUID-FDCC01D7-244E-4BEE-B0AB-6D011BC0F487"></a><h4 id="STRMS-GUID-FDCC01D7-244E-4BEE-B0AB-6D011BC0F487" class="sect4"><span class="enumeration_section">17.13.1 </span>Retrying Apply Error Transactions
                  </h4>
                  <div>
                     <p>You can retry a specific error transaction or you can retry all error transactions for an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>. You might need to make DML or DDL changes to database objects to correct the conditions that caused one or more apply errors before you retry error transactions. You can also have one or more <a href="strms_glossary.html#GUID-7E24C191-B4E0-45F2-A55B-9F76D4F9E8B0"><span class="xrefglossterm">capture process</span></a>es or <a href="strms_glossary.html#GUID-5CA58899-A02D-422A-AE15-E8FCD004EB17"><span class="xrefglossterm">synchronous capture</span></a>s configured to capture changes to the same database objects, but you might not want the changes captured. In this case, you can set the session <a href="strms_glossary.html#GUID-D667D798-F9C9-437F-92AB-8C04FAD19B64"><span class="xrefglossterm">tag</span></a> to a value that will not be captured for the session that makes the changes.
                     </p>
                     <p>The following topics provide more information about retrying apply error transactions:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-1F53F455-7115-4FCE-962A-8E29790DF767">Retrying a Specific Apply Error Transaction</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-F3D2AC66-31EE-4158-AC3F-6FD6E560E294">Retrying All Error Transactions for an Apply Process</a></p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-FDCC01D7-244E-4BEE-B0AB-6D011BC0F487__GUID-E4F44B09-D51A-419B-981B-EF6FE1E4890A">
                        <p class="notep1">See Also:</p>
                        <p><a href="../strep/oracle-streams-tags.html#STREP120"><span class="italic">Oracle Streams Replication Administrator's Guide </span></a>for more information about setting tag values generated by the current session
                        </p>
                     </div>
                  </div><a id="STRMS778"></a><div class="props_rev_3"><a id="GUID-1F53F455-7115-4FCE-962A-8E29790DF767" name="GUID-1F53F455-7115-4FCE-962A-8E29790DF767"></a><h5 id="STRMS-GUID-1F53F455-7115-4FCE-962A-8E29790DF767" class="sect5"><span class="enumeration_section">17.13.1.1 </span>Retrying a Specific Apply Error Transaction
                     </h5>
                     <div>
                        <p>When you retry an error transaction, you can execute it immediately or send the error transaction to a user procedure for modifications before executing it. The following sections provide instructions for each method:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="managing-oracle-streams-information-consumption.html#GUID-F590AC85-13AB-4AFD-9981-B0FFDDDF282E">Retrying a Specific Apply Error Transaction Without a User Procedure</a></p>
                           </li>
                           <li>
                              <p><a href="managing-oracle-streams-information-consumption.html#GUID-E4AEF7D1-71F9-40E6-B8BE-AFB25E915B0E">Retrying a Specific Apply Error Transaction with a User Procedure</a></p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-1F53F455-7115-4FCE-962A-8E29790DF767__GUID-781822F4-089D-44FC-8444-177FC12A1A30">
                           <p class="notep1">See Also:</p>
                           <p><a href="../arpls/DBMS_APPLY_ADM.html#ARPLS326"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <code class="codeph">EXECUTE_ERROR</code> procedure
                           </p>
                        </div>
                     </div><a id="STRMS779"></a><div class="props_rev_3"><a id="GUID-F590AC85-13AB-4AFD-9981-B0FFDDDF282E" name="GUID-F590AC85-13AB-4AFD-9981-B0FFDDDF282E"></a><h6 id="STRMS-GUID-F590AC85-13AB-4AFD-9981-B0FFDDDF282E" class="sect6"><span class="enumeration_section">17.13.1.1.1 </span>Retrying a Specific Apply Error Transaction Without a User Procedure
                        </h6>
                        <div>
                           <div class="section">
                              <p>After you correct the conditions that caused an apply error, you can retry the transaction by running the <code class="codeph">EXECUTE_ERROR</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package without specifying a user procedure. In this case, the transaction is executed without any custom processing.
                              </p>
                              <p>For example, to retry a transaction with the transaction identifier <code class="codeph">5.4.312</code>, run the following procedure:
                              </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.EXECUTE_ERROR(
    local_transaction_id =&gt; '5.4.312',
    execute_as_user      =&gt; FALSE,
    user_procedure       =&gt; NULL);
END;
/
</pre><p>If <code class="codeph">execute_as_user</code> is <code class="codeph">TRUE</code>, then the apply process executes the transaction in the security context of the current user. If <code class="codeph">execute_as_user</code> is <code class="codeph">FALSE</code>, then the apply process executes the transaction in the security context of the original receiver of the transaction. The original receiver is the user who was processing the transaction when the error was raised.
                              </p>
                              <p>In either case, the user who executes the transaction must have privileges to perform DML and DDL changes on the apply objects and to run any <a href="strms_glossary.html#GUID-4CEA651A-4197-4731-93D4-315BCB5CBE70"><span class="xrefglossterm">apply handler</span></a>s. This user must also have dequeue privileges on the queue used by the apply process.
                              </p>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div><a id="STRMS780"></a><div class="props_rev_3"><a id="GUID-E4AEF7D1-71F9-40E6-B8BE-AFB25E915B0E" name="GUID-E4AEF7D1-71F9-40E6-B8BE-AFB25E915B0E"></a><h6 id="STRMS-GUID-E4AEF7D1-71F9-40E6-B8BE-AFB25E915B0E" class="sect6"><span class="enumeration_section">17.13.1.1.2 </span>Retrying a Specific Apply Error Transaction with a User Procedure
                        </h6>
                        <div>
                           <div class="section">
                              <p>You can retry an error transaction by running the <code class="codeph">EXECUTE_ERROR</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package, and specify a user procedure to modify one or more <a href="strms_glossary.html#GUID-62ABA207-07D4-453A-AC59-B0C780A3FB59"><span class="xrefglossterm">message</span></a>s in the transaction before the transaction is executed. The modifications should enable successful execution of the transaction. The messages in the transaction can be LCRs or <a href="strms_glossary.html#GUID-7613B49E-9B03-4C9E-9A00-C92C6B2CEC9A"><span class="xrefglossterm">user message</span></a>s.
                              </p>
                              <p>For example, consider a case in which an apply error resulted because of a <a href="strms_glossary.html#GUID-60799E10-76F3-475D-B080-FAF5930E6942"><span class="xrefglossterm">conflict</span></a>. Examination of the error transaction reveals that the old value for the <code class="codeph">salary</code> column in a row LCR contained the wrong value. Specifically, the current value of the salary of the employee with <code class="codeph">employee_id</code> of <code class="codeph">197</code> in the <code class="codeph">hr.employees</code> table did not match the old value of the salary for this employee in the row LCR. Assume that the current value for this employee is <code class="codeph">3250</code> in the <code class="codeph">hr.employees</code> table.
                              </p>
                              <p>Given this scenario, the following user procedure modifies the salary in the row LCR that caused the error:</p><pre class="oac_no_warn" dir="ltr">CREATE OR REPLACE PROCEDURE strmadmin.modify_emp_salary(
  in_any                        IN      ANYDATA,
  error_record                  IN      DBA_APPLY_ERROR%ROWTYPE,
  error_message_number          IN      NUMBER,
  messaging_default_processing  IN OUT  BOOLEAN,
  out_any                       OUT     ANYDATA)
AS
  row_lcr          SYS.LCR$_ROW_RECORD;
  row_lcr_changed  BOOLEAN := FALSE;
  res              NUMBER;
  ob_owner         VARCHAR2(32);
  ob_name          VARCHAR2(32);
  cmd_type         VARCHAR2(30);
  employee_id      NUMBER;
BEGIN
  IF in_any.getTypeName() = 'SYS.LCR$_ROW_RECORD' THEN
    -- Access the LCR
    res := in_any.GETOBJECT(row_lcr);
    -- Determine the owner of the database object for the LCR
    ob_owner := row_lcr.GET_OBJECT_OWNER;
    -- Determine the name of the database object for the LCR
    ob_name := row_lcr.GET_OBJECT_NAME;
    -- Determine the type of DML change
    cmd_type := row_lcr.GET_COMMAND_TYPE;
    IF (ob_owner = 'HR' AND ob_name = 'EMPLOYEES' AND cmd_type = 'UPDATE') THEN
      -- Determine the employee_id of the row change
      IF row_lcr.GET_VALUE('old', 'employee_id') IS NOT NULL THEN
        employee_id := row_lcr.GET_VALUE('old', 'employee_id').ACCESSNUMBER();
        IF (employee_id = 197) THEN
          -- error_record.message_number should equal error_message_number
          row_lcr.SET_VALUE(
          value_type =&gt; 'OLD',
          column_name =&gt; 'salary',
          column_value =&gt; ANYDATA.ConvertNumber(3250));
          row_lcr_changed := TRUE;
        END IF;
      END IF;
    END IF;
  END IF;
  -- Specify that the apply process continues to process the current message
  messaging_default_processing := TRUE;
  -- assign out_any appropriately
  IF row_lcr_changed THEN
    out_any := ANYDATA.ConvertObject(row_lcr);
  ELSE
    out_any := in_any;
  END IF;
END;
/
</pre><p>To retry a transaction with the transaction identifier <code class="codeph">5.6.924</code> and process the transaction with the <code class="codeph">modify_emp_salary</code> procedure in the <code class="codeph">strmadmin</code> schema before execution, run the following procedure:
                              </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.EXECUTE_ERROR(
    local_transaction_id =&gt; '5.6.924',
    execute_as_user      =&gt; FALSE,
    user_procedure       =&gt; 'strmadmin.modify_emp_salary');
END;
/
</pre><div class="infoboxnote" id="GUID-E4AEF7D1-71F9-40E6-B8BE-AFB25E915B0E__GUID-5839C838-01AA-4C71-B8F0-48F837908CC4">
                                 <p class="notep1">Note:</p>
                                 <p>The user who runs the procedure must have <code class="codeph">SELECT</code> privilege on <code class="codeph">DBA_APPLY_ERROR</code> data dictionary view.
                                 </p>
                              </div>
                              <div class="infoboxnotealso" id="GUID-E4AEF7D1-71F9-40E6-B8BE-AFB25E915B0E__GUID-8CD28045-22CA-49EA-B029-274992999AF7">
                                 <p class="notep1">See Also:</p>
                                 <p><span class="q">"<a href="monitoring-oracle-streams-apply-processes.html#GUID-B2BCDB9E-5B7C-457C-8AB1-B5A7F1711148">Displaying Detailed Information About Apply Errors</a>"</span></p>
                              </div>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div><a id="STRMS781"></a><div class="props_rev_3"><a id="GUID-F3D2AC66-31EE-4158-AC3F-6FD6E560E294" name="GUID-F3D2AC66-31EE-4158-AC3F-6FD6E560E294"></a><h5 id="STRMS-GUID-F3D2AC66-31EE-4158-AC3F-6FD6E560E294" class="sect5"><span class="enumeration_section">17.13.1.2 </span>Retrying All Error Transactions for an Apply Process
                     </h5>
                     <div>
                        <div class="section">
                           <p>After you correct the conditions that caused all of the apply errors for an apply process, you can retry all of the error transactions by running the <code class="codeph">EXECUTE_ALL_ERRORS</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. For example, to retry all of the error transactions for an apply process named <code class="codeph">strm01_apply</code>, you can run the following procedure:
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.EXECUTE_ALL_ERRORS(
    apply_name       =&gt; 'strm01_apply',
    execute_as_user  =&gt; FALSE);
END;
/
</pre><div class="infoboxnote" id="GUID-F3D2AC66-31EE-4158-AC3F-6FD6E560E294__GUID-5BFBF5D2-B08B-4241-A6E3-0D650B533F27">
                              <p class="notep1">Note:</p>
                              <p>If you specify <code class="codeph">NULL</code> for the <code class="codeph">apply_name</code> parameter, and you have multiple apply processes, then all of the apply errors are retried for all of the apply processes.
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="STRMS782"></a><div class="props_rev_3"><a id="GUID-B965A832-778D-4D8D-B49D-2519CD6B0433" name="GUID-B965A832-778D-4D8D-B49D-2519CD6B0433"></a><h4 id="STRMS-GUID-B965A832-778D-4D8D-B49D-2519CD6B0433" class="sect4"><span class="enumeration_section">17.13.2 </span>Deleting Apply Error Transactions
                  </h4>
                  <div>
                     <p>You can delete a specific error transaction or you can delete all error transactions for an <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>.
                     </p>
                  </div><a id="STRMS783"></a><div class="props_rev_3"><a id="GUID-DE8B990C-68AF-4E22-B1AE-4AA1D303D92E" name="GUID-DE8B990C-68AF-4E22-B1AE-4AA1D303D92E"></a><h5 id="STRMS-GUID-DE8B990C-68AF-4E22-B1AE-4AA1D303D92E" class="sect5"><span class="enumeration_section">17.13.2.1 </span>Deleting a Specific Apply Error Transaction
                     </h5>
                     <div>
                        <div class="section">
                           <p>If an error transaction should not be applied, then you can delete the transaction from the error queue using the <code class="codeph">DELETE_ERROR</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. For example, to delete a transaction with the transaction identifier <code class="codeph">5.4.312</code>, run the following procedure: 
                           </p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_APPLY_ADM.DELETE_ERROR(local_transaction_id =&gt; '5.4.312');</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS784"></a><div class="props_rev_3"><a id="GUID-5502BFFF-DD29-44FF-AF72-EB0BF1B8EC9F" name="GUID-5502BFFF-DD29-44FF-AF72-EB0BF1B8EC9F"></a><h5 id="STRMS-GUID-5502BFFF-DD29-44FF-AF72-EB0BF1B8EC9F" class="sect5"><span class="enumeration_section">17.13.2.2 </span>Deleting All Error Transactions for an Apply Process
                     </h5>
                     <div>
                        <div class="section">
                           <p>If none of the error transactions should be applied, then you can delete all of the error transactions by running the <code class="codeph">DELETE_ALL_ERRORS</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. For example, to delete all of the error transactions for an apply process named <code class="codeph">strm01_apply</code>, you can run the following procedure:
                           </p><pre class="oac_no_warn" dir="ltr">EXEC DBMS_APPLY_ADM.DELETE_ALL_ERRORS(apply_name =&gt; 'strm01_apply');
</pre><div class="infoboxnote" id="GUID-5502BFFF-DD29-44FF-AF72-EB0BF1B8EC9F__GUID-8D8E4F5C-D93C-4CA2-9F51-0E4DDD72003A">
                              <p class="notep1">Note:</p>
                              <p>If you specify <code class="codeph">NULL</code> for the <code class="codeph">apply_name</code> parameter, and you have multiple apply processes, then all of the apply errors are deleted for all of the apply processes.
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="STRMS785"></a><div class="props_rev_3"><a id="GUID-F893917F-8877-4A42-BF8F-43C832F2AE8A" name="GUID-F893917F-8877-4A42-BF8F-43C832F2AE8A"></a><h3 id="STRMS-GUID-F893917F-8877-4A42-BF8F-43C832F2AE8A" class="sect3"><span class="enumeration_section">17.14 </span>Managing the Substitute Key Columns for a Table
               </h3>
               <div>
                  <p>The following topics contain instructions for setting and removing the substitute key columns for a table.</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-C03DD04F-2404-41A4-BA16-9AD21CD7DBC5">Setting Substitute Key Columns for a Table</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-1FB475AF-9BFF-4A26-84C1-50A5174FB591">Removing the Substitute Key Columns for a Table</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-F893917F-8877-4A42-BF8F-43C832F2AE8A__GUID-9A0C1ECF-0D79-475B-A23F-D561830716E6">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="advanced-apply-process-concepts.html#GUID-F98E9A40-8FF4-4E42-A8C4-9DEBD6597340">Substitute Key Columns</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="monitoring-oracle-streams-apply-processes.html#GUID-F7262F64-9F8B-4700-B7E0-4F5AAC7D8C60">Displaying the Substitute Key Columns Specified at a Destination Database</a>"</span></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="STRMS786"></a><div class="props_rev_3"><a id="GUID-C03DD04F-2404-41A4-BA16-9AD21CD7DBC5" name="GUID-C03DD04F-2404-41A4-BA16-9AD21CD7DBC5"></a><h4 id="STRMS-GUID-C03DD04F-2404-41A4-BA16-9AD21CD7DBC5" class="sect4"><span class="enumeration_section">17.14.1 </span>Setting Substitute Key Columns for a Table
                  </h4>
                  <div>
                     <div class="section">
                        <p>When an apply process applies changes to a table, substitute key columns can either replace the primary key columns for a table that has a primary key or act as the primary key columns for a table that does not have a primary key. Set the substitute key columns for a table using the <code class="codeph">SET_KEY_COLUMNS</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. This setting applies to all of the apply processes that apply local changes to the database.
                        </p>
                        <p>For example, to set the substitute key columns for the <code class="codeph">hr.employees</code> table to the <code class="codeph">first_name</code>, <code class="codeph">last_name</code>, and <code class="codeph">hire_date</code> columns, replacing the <code class="codeph">employee_id</code> column, run the following procedure:
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_KEY_COLUMNS(
    object_name  &nbsp;&nbsp;&nbsp;    =&gt; 'hr.employees',
    column_list         =&gt; 'first_name,last_name,hire_date');
END;
/</pre><div class="infoboxnote" id="GUID-C03DD04F-2404-41A4-BA16-9AD21CD7DBC5__GUID-BE519D76-1E43-4432-9C78-702B1AFFF8D2">
                           <p class="notep1">Note:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>You must specify an unconditional supplemental log group at the source database for all of the columns specified as substitute key columns in the <code class="codeph">column_list</code> or <code class="codeph">column_table</code> parameter at the destination database. In this example, you would specify an unconditional supplemental log group including the <code class="codeph">first_name</code>, <code class="codeph">last_name</code>, and <code class="codeph">hire_date</code> columns in the <code class="codeph">hr.employees</code> table.
                                 </p>
                              </li>
                              <li>
                                 <p>If an apply process applies changes to a remote non-Oracle database, then it can use different substitute key columns for the same table. You can run the <code class="codeph">SET_KEY_COLUMNS</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to specify substitute key columns for changes that will be applied to a remote non-Oracle database by setting the <code class="codeph">apply_database_link</code> parameter to a non-<code class="codeph">NULL</code> value.
                                 </p>
                              </li>
                           </ul>
                        </div>
                        <div class="infoboxnotealso" id="GUID-C03DD04F-2404-41A4-BA16-9AD21CD7DBC5__GUID-3E116F81-232E-4645-BB42-EFEC12812516">
                           <p class="notep1">See Also:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="oracle-streams-information-capture.html#GUID-57570826-D941-4820-977D-D60092EAD599">Supplemental Logging in an Oracle Streams Environment</a>"</span></p>
                              </li>
                              <li>
                                 <p><a href="../strep/oracle-streams-heterogeneous-information-sharing.html#STREP105"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STRMS787"></a><div class="props_rev_3"><a id="GUID-1FB475AF-9BFF-4A26-84C1-50A5174FB591" name="GUID-1FB475AF-9BFF-4A26-84C1-50A5174FB591"></a><h4 id="STRMS-GUID-1FB475AF-9BFF-4A26-84C1-50A5174FB591" class="sect4"><span class="enumeration_section">17.14.2 </span>Removing the Substitute Key Columns for a Table
                  </h4>
                  <div>
                     <div class="section">
                        <p>You remove the substitute key columns for a table by specifying <code class="codeph">NULL</code> for the <code class="codeph">column_list</code> or <code class="codeph">column_table</code> parameter in the <code class="codeph">SET_KEY_COLUMNS</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. If the table has a primary key, then the table's primary key is used by any apply process for local changes to the database after you remove the substitute primary key.
                        </p>
                        <p>For example, to remove the substitute key columns for the <code class="codeph">hr.employees</code> table, run the following procedure:
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_KEY_COLUMNS(
    object_name  =&gt; 'hr.employees',
    column_list  =&gt; NULL);
END;
/</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="STRMS788"></a><div class="props_rev_3"><a id="GUID-4102EAC2-B30D-491A-9736-BFCDA41B4B0E" name="GUID-4102EAC2-B30D-491A-9736-BFCDA41B4B0E"></a><h3 id="STRMS-GUID-4102EAC2-B30D-491A-9736-BFCDA41B4B0E" class="sect3"><span class="enumeration_section">17.15 </span>Using Virtual Dependency Definitions
               </h3>
               <div>
                  <p>A virtual dependency definition is a description of a dependency that is used by an apply process to detect dependencies between transactions being applied at a destination database. Virtual dependency definitions are useful when apply process parallelism is greater than 1 and dependencies are not described by constraints in the data dictionary at the destination database. There are two types of virtual dependency definitions: value dependencies and object dependencies.</p>
                  <p>A value dependency defines a table constraint, such as a unique key, or a relationship between the columns of two or more tables. An object dependency defines a parent-child relationship between two objects at a destination database.</p>
                  <p>The following sections describe using virtual dependency definitions:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-F271540D-FCFE-418E-BC7D-242AED151B8A">Setting and Unsetting Value Dependencies</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-information-consumption.html#GUID-A38BEAC6-468B-44AC-B40B-171C0FF5D1C1">Creating and Dropping Object Dependencies</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-4102EAC2-B30D-491A-9736-BFCDA41B4B0E__GUID-F67089AE-03FB-4702-82AB-0DE02DEF7255">
                     <p class="notep1">See Also:</p>
                     <p><span class="q">"<a href="advanced-apply-process-concepts.html#GUID-43293B61-B034-4744-AE93-57A0DAAC39DD">Apply Processes and Dependencies</a>"</span> for more information about virtual dependency definitions
                     </p>
                  </div>
               </div><a id="STRMS789"></a><div class="props_rev_3"><a id="GUID-F271540D-FCFE-418E-BC7D-242AED151B8A" name="GUID-F271540D-FCFE-418E-BC7D-242AED151B8A"></a><h4 id="STRMS-GUID-F271540D-FCFE-418E-BC7D-242AED151B8A" class="sect4"><span class="enumeration_section">17.15.1 </span>Setting and Unsetting Value Dependencies
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">SET_VALUE_DEPENDENCY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to set or unset a value dependency. The following sections describe scenarios for using value dependencies:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-3D15DAFB-98C6-468A-8CCD-BE5CC678369B">Schema Differences and Value Dependencies</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-7AFE6108-3A97-416D-A335-1EBD5C0AD79E">Undefined Constraints at the Destination Database and Value Dependencies</a></p>
                        </li>
                     </ul>
                  </div><a id="STRMS790"></a><div class="props_rev_3"><a id="GUID-3D15DAFB-98C6-468A-8CCD-BE5CC678369B" name="GUID-3D15DAFB-98C6-468A-8CCD-BE5CC678369B"></a><h5 id="STRMS-GUID-3D15DAFB-98C6-468A-8CCD-BE5CC678369B" class="sect5"><span class="enumeration_section">17.15.1.1 </span>Schema Differences and Value Dependencies
                     </h5>
                     <div>
                        <div class="section">
                           <p>This scenario involves an environment that shares many tables between a source database and destination database, but the schema that owns the tables is different at these two databases. Also, in this replication environment, the source database is in the United States and the destination database is in England. A design firm uses dozens of tables to describe product designs, but the tables use United States measurements (inches, feet, and so on) in the source database and metric measurements in the destination database. The name of the schema that owns the database objects at the source database is <code class="codeph">us_designs</code>, while the name of the schema at the destination database is <code class="codeph">uk_designs</code>. Therefore, the schema name of the shared database objects must be changed before apply, and all of the measurements must be converted from United States measurements to metric measurements. Both databases use the same constraints to enforce dependencies between database objects.
                           </p>
                           <p>Rule-based transformations could make the required changes, but the goal is to apply multiple LCRs in parallel. Rule-based transformations must apply LCRs serially. So, a procedure DML handler is configured at the destination database to make the required changes to the LCRs, and apply process parallelism is set to 5. In this environment, the destination database has no information about the schema <code class="codeph">us_designs</code> in the LCRs being sent from the source database. Because an apply process calculates dependencies before passing LCRs to apply handlers, the apply process must be informed about the dependencies between LCRs. Value dependencies can describe these dependencies.
                           </p>
                           <p>In this scenario, suppose several tables describe different designs, and each of these tables has a primary key. One of these tables is <code class="codeph">design_53</code>, and the primary key column is <code class="codeph">key_53</code>. Also, a table named <code class="codeph">all_designs_summary</code> includes a summary of all of the individual designs, and this table has a foreign key column for each design table. The <code class="codeph">all_designs_summary</code> includes a key_53 column, which is a foreign key of the primary key in the <code class="codeph">design_53</code> table. To inform an apply process about the relationship between these tables, run the following procedures to create a value dependency at the destination database:
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_VALUE_DEPENDENCY(
    dependency_name   =&gt; 'key_53_foreign_key',
    object_name       =&gt; 'us_designs.design_53',
    attribute_list    =&gt; 'key_53');
END;
/
</pre><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_VALUE_DEPENDENCY(
    dependency_name   =&gt; 'key_53_foreign_key',
    object_name       =&gt; 'us_designs.all_designs_summary',
    attribute_list    =&gt; 'key_53');
END;
/
</pre><p>Notice that the value dependencies use the schema at the source database (<code class="codeph">us_designs</code>) because LCRs contain the source database schema. The schema will be changed to <code class="codeph">uk_designs</code> by the procedure DML handler after the apply process passes the row LCRs to the handler.
                           </p>
                           <p>To unset a value dependency, run the <code class="codeph">SET_VALUE_DEPENDENCY</code> procedure, and specify the name of the value dependency in the <code class="codeph">dependency_name</code> parameter and <code class="codeph">NULL</code> in the <code class="codeph">object_name</code> parameter. For example, to unset the <code class="codeph">key_53_foreign_key</code> value dependency that was set previously, run the following procedure:
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_VALUE_DEPENDENCY(
    dependency_name   =&gt; 'key_53_foreign_key',
    object_name       =&gt; NULL,
    attribute_list    =&gt; NULL);
END;
/
</pre><div class="infoboxnotealso" id="GUID-3D15DAFB-98C6-468A-8CCD-BE5CC678369B__GUID-6F1C543A-8AE5-4CA2-80A6-185278D408BF">
                              <p class="notep1">See Also:</p>
                              <p><span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-A6074063-2D66-4FB9-864D-D5228624732A">Managing a DML Handler</a>"</span></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS791"></a><div class="props_rev_3"><a id="GUID-7AFE6108-3A97-416D-A335-1EBD5C0AD79E" name="GUID-7AFE6108-3A97-416D-A335-1EBD5C0AD79E"></a><h5 id="STRMS-GUID-7AFE6108-3A97-416D-A335-1EBD5C0AD79E" class="sect5"><span class="enumeration_section">17.15.1.2 </span>Undefined Constraints at the Destination Database and Value Dependencies
                     </h5>
                     <div>
                        <div class="section">
                           <p>This scenarios involves an environment in which foreign key constraints are used for shared tables at the source database, but no constraints are used for these tables at the destination database. In the replication environment, the destination database is used as a data warehouse where data is written to the database far more often than it is queried. To optimize write operations, no constraints are defined at the destination database.</p>
                           <p>In such an environment, an apply processes running on the destination database must be informed about the constraints to apply transactions consistently. Value dependencies can inform the apply process about these constraints.</p>
                           <p>For example, assume that the <code class="codeph">orders</code> and <code class="codeph">order_items</code> tables in the <code class="codeph">oe</code> schema are shared between the source database and the destination database in this environment. On the source database, the <code class="codeph">order_id</code> column is a primary key in the <code class="codeph">orders</code> table, and the <code class="codeph">order_id</code> column in the <code class="codeph">order_items</code> table is a foreign key that matches the primary key column in the <code class="codeph">orders</code> table. At the destination database, these constraints have been removed. Run the following procedures to create a value dependency at the destination database that informs apply processes about the relationship between the columns in these tables:
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_VALUE_DEPENDENCY(
    dependency_name   =&gt; 'order_id_foreign_key',
    object_name       =&gt; 'oe.orders',
    attribute_list    =&gt; 'order_id');
END;
/
</pre><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_VALUE_DEPENDENCY(
    dependency_name   =&gt; 'order_id_foreign_key',
    object_name       =&gt; 'oe.order_items',
    attribute_list    =&gt; 'order_id');
END;
/
</pre><p>Also, in this environment, the following actions should be performed so that apply processes can apply transactions consistently:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Value dependencies should be set for each column that has a unique key or bitmap index at the source database.</p>
                              </li>
                              <li>
                                 <p>The <code class="codeph">DBMS_APPLY_ADM.SET_KEY_COLUMNS</code> procedure should set substitute key columns for the columns that are primary key columns at the source database.
                                 </p>
                              </li>
                           </ul>
                           <p>To unset the value dependency that was set previously, run the following procedure:</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.SET_VALUE_DEPENDENCY(
    dependency_name   =&gt; 'order_id_foreign_key',
    object_name       =&gt; NULL,
    attribute_list    =&gt; NULL);
END;
/
</pre><div class="infoboxnotealso" id="GUID-7AFE6108-3A97-416D-A335-1EBD5C0AD79E__GUID-B9263F89-F3B5-4C0D-9801-FA2290A5B01C">
                              <p class="notep1">See Also:</p>
                              <p><span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-F893917F-8877-4A42-BF8F-43C832F2AE8A">Managing the Substitute Key Columns for a Table</a>"</span></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div><a id="STRMS792"></a><div class="props_rev_3"><a id="GUID-A38BEAC6-468B-44AC-B40B-171C0FF5D1C1" name="GUID-A38BEAC6-468B-44AC-B40B-171C0FF5D1C1"></a><h4 id="STRMS-GUID-A38BEAC6-468B-44AC-B40B-171C0FF5D1C1" class="sect4"><span class="enumeration_section">17.15.2 </span>Creating and Dropping Object Dependencies
                  </h4>
                  <div>
                     <p>Use the <code class="codeph">CREATE_OBJECT_DEPENDENCY</code> and <code class="codeph">DROP_OBJECT_DEPENDENCY</code> procedures in the <code class="codeph">DBMS_APPLY_ADM</code> package to create or drop an object dependency.
                     </p>
                     <p>The following topics provide detailed instructions for creating and dropping object dependencies:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-E7E09975-8C59-439E-A3EC-3C29762AE523">Creating an Object Dependency</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-information-consumption.html#GUID-7CDEE3F1-6ADD-4FA4-8DDF-8F0FCF9EA49E">Dropping an Object Dependency</a></p>
                        </li>
                     </ul>
                  </div><a id="STRMS793"></a><div class="props_rev_3"><a id="GUID-E7E09975-8C59-439E-A3EC-3C29762AE523" name="GUID-E7E09975-8C59-439E-A3EC-3C29762AE523"></a><h5 id="STRMS-GUID-E7E09975-8C59-439E-A3EC-3C29762AE523" class="sect5"><span class="enumeration_section">17.15.2.1 </span>Creating an Object Dependency
                     </h5>
                     <div>
                        <div class="section">
                           <p>An object dependency can be used when row LCRs for a particular table always should be applied before the row LCRs for another table, and the data dictionary of the destination database does not contain a constraint to enforce this relationship. When you define an object dependency, the table whose row LCRs should be applied first is the parent table and the table whose row LCRs should be applied second is the child table.</p>
                           <p>For example, consider an Oracle Streams replication environment with the following characteristics:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>The following tables in the <code class="codeph">ord</code> schema are shared between a source and destination database:
                                 </p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>The <code class="codeph">customers</code> table contains information about customers, including each customer's shipping address.
                                       </p>
                                    </li>
                                    <li>
                                       <p>The <code class="codeph">orders</code> table contains information about each order.
                                       </p>
                                    </li>
                                    <li>
                                       <p>The <code class="codeph">order_items</code> table contains information about the items ordered in each order.
                                       </p>
                                    </li>
                                    <li>
                                       <p>The <code class="codeph">ship_orders</code> table contains information about orders that are ready to ship, but it does not contain detailed information about the customer or information about individual items to ship with each order.
                                       </p>
                                    </li>
                                 </ul>
                              </li>
                              <li>
                                 <p>The <code class="codeph">ship_orders</code> table has no relationships, defined by constraints, with the other tables.
                                 </p>
                              </li>
                              <li>
                                 <p>Information about orders is entered into the source database and propagated to the destination database, where it is applied.</p>
                              </li>
                              <li>
                                 <p>The destination database site is a warehouse where orders are shipped to customers. At this site, a procedure DML handler uses the information in the <code class="codeph">ship_orders</code>, <code class="codeph">customers</code>, <code class="codeph">orders</code>, and <code class="codeph">order_items</code> tables to generate a report that includes the customer's shipping address and the items to ship.
                                 </p>
                              </li>
                           </ul>
                           <p>The information in the report generated by the procedure DML handler must be consistent with the time when the ship order record was created. An object dependency at the destination database can accomplish this goal. In this case, the <code class="codeph">ship_orders</code> table is the parent table of the following child tables: <code class="codeph">customers</code>, <code class="codeph">orders</code>, and <code class="codeph">order_items</code>. Because <code class="codeph">ship_orders</code> is the parent of these tables, any changes to these tables made after a record in the <code class="codeph">ship_orders</code> table was entered will not be applied until the procedure DML handler has generated the report for the ship order.
                           </p>
                           <p>To create these object dependencies, run the following procedures at the destination database:</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.CREATE_OBJECT_DEPENDENCY(
    object_name         =&gt;  'ord.customers',
    parent_object_name  =&gt;  'ord.ship_orders');
END;
/
</pre><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.CREATE_OBJECT_DEPENDENCY(
    object_name         =&gt;  'ord.orders',
    parent_object_name  =&gt;  'ord.ship_orders');
END;
/
</pre><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.CREATE_OBJECT_DEPENDENCY(
    object_name         =&gt;  'ord.order_items',
    parent_object_name  =&gt;  'ord.ship_orders');
END;
/
</pre><div class="infoboxnotealso" id="GUID-E7E09975-8C59-439E-A3EC-3C29762AE523__GUID-DA1827A3-652E-4302-B89C-CD78267F164D">
                              <p class="notep1">See Also:</p>
                              <p><span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-A6074063-2D66-4FB9-864D-D5228624732A">Managing a DML Handler</a>"</span></p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STRMS794"></a><div class="props_rev_3"><a id="GUID-7CDEE3F1-6ADD-4FA4-8DDF-8F0FCF9EA49E" name="GUID-7CDEE3F1-6ADD-4FA4-8DDF-8F0FCF9EA49E"></a><h5 id="STRMS-GUID-7CDEE3F1-6ADD-4FA4-8DDF-8F0FCF9EA49E" class="sect5"><span class="enumeration_section">17.15.2.2 </span>Dropping an Object Dependency
                     </h5>
                     <div>
                        <div class="section">
                           <p>To drop the object dependencies created in <span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-E7E09975-8C59-439E-A3EC-3C29762AE523">Creating an Object Dependency</a>"</span>, run the following procedure:
                           </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.DROP_OBJECT_DEPENDENCY(
    object_name         =&gt;  'ord.customers',
    parent_object_name  =&gt;  'ord.ship_orders');
END;
/
</pre><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.DROP_OBJECT_DEPENDENCY(
    object_name         =&gt;  'ord.orders',
    parent_object_name  =&gt;  'ord.ship_orders');
END;
/
</pre><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.DROP_OBJECT_DEPENDENCY(
    object_name         =&gt;  'ord.order_items',
    parent_object_name  =&gt;  'ord.ship_orders');
END;
/
</pre></div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="STRMS797"></a><div class="props_rev_3"><a id="GUID-ADDA7BD3-3D52-41B5-944B-2E4E324ECE4F" name="GUID-ADDA7BD3-3D52-41B5-944B-2E4E324ECE4F"></a><h3 id="STRMS-GUID-ADDA7BD3-3D52-41B5-944B-2E4E324ECE4F" class="sect3"><span class="enumeration_section">17.16 </span>Dropping an Apply Process
               </h3>
               <div>
                  <div class="section">
                     <p>You run the <code class="codeph">DROP_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to drop an existing <a href="strms_glossary.html#GUID-8FCB69CE-7655-4991-B988-0373A0A20085"><span class="xrefglossterm">apply process</span></a>. For example, the following procedure drops an apply process named <code class="codeph">strm02_apply</code>:
                     </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_APPLY_ADM.DROP_APPLY(
 &nbsp;&nbsp;&nbsp;apply_name            =&gt; 'strm02_apply',
    drop_unused_rule_sets =&gt; TRUE);
END;
/
</pre><p>Because the <code class="codeph">drop_unused_rule_sets</code> parameter is set to <code class="codeph">TRUE</code>, this procedure also drops any <a href="strms_glossary.html#GUID-36BC41F8-E073-4AFE-ADF1-5036DD323379"><span class="xrefglossterm">rule set</span></a>s used by the <code class="codeph">strm02_apply</code> apply process, unless a rule set is used by another <a href="strms_glossary.html#GUID-1ADE5718-8C94-4762-85E9-6B032F124365"><span class="xrefglossterm">Oracle Streams client</span></a>. If the <code class="codeph">drop_unused_rule_sets</code> parameter is set to <code class="codeph">TRUE</code>, then both the positive and <a href="strms_glossary.html#GUID-F44D0886-397B-4E00-A666-A19F96F3C242"><span class="xrefglossterm">negative rule set</span></a> for the apply process might be dropped. If this procedure drops a rule set, then it also drops any <a href="strms_glossary.html#GUID-6779E306-1287-45C6-8182-CD04A7325F91"><span class="xrefglossterm">rule</span></a>s in the rule set that are not in another rule set.
                     </p>
                     <p>An error is raised if you try to drop an apply process and there are errors in the error queue for the specified apply process. Therefore, if there are errors in the error queue for an apply process, delete the errors before dropping the apply process.</p>
                     <div class="infoboxnotealso" id="GUID-ADDA7BD3-3D52-41B5-944B-2E4E324ECE4F__GUID-13246040-E9BE-4A49-B33F-E97CF39C62A6">
                        <p class="notep1">See Also:</p>
                        <p></p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="q">"<a href="managing-oracle-streams-information-consumption.html#GUID-3C45493C-6DD6-478F-98D7-71A857D17FDD">Managing Apply Errors</a>"</span></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>