<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">
      <meta name="description" content="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">
      <title>Using SODA for C</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="SODA for C Developers Guide">
      <meta property="og:description" content="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="SODA for C Developers Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-database-soda-c-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2019-02-25T09:40:03-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2018, 2019">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E84721-04">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      
      <link rel="prev" href="soda-c-overview.html" title="Previous" type="text/html">
      <link rel="next" href="character-set-considerations-soda-c.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Oracle® Database SODA for C Developer's Guide">
    <meta name="dcterms.isVersionOf" content="ADSDC">
    <meta name="dcterms.release" content="Release 18">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="soda-c-overview.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="character-set-considerations-soda-c.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">SODA for C Developers Guide</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Using SODA for C</li>
            </ol>
            <a id="GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" name="GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90"></a>
            
            <h2 id="ADSDC-GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" class="sect2"><span class="enumeration_chapter">3 </span>Using SODA for C
            </h2>
         </header>
         <div class="ind"><script type="text/javascript">window.name='using-soda-c'</script><script type="text/javascript">
    function footdisplay(footnum,footnote) {
    var msg = window.open('about:blank', 'NewWindow' + footnum,
        'directories=no,height=100,location=no,menubar=no,resizable=yes,' +
        'scrollbars=yes,status=no,toolbar=no,width=598');
    msg.document.open('text/html');
    msg.document.write('<!DOCTYPE html ');
    msg.document.write('PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" ');
    msg.document.write('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'); 
    msg.document.write('<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" dir="ltr"><head><title>');
   
    msg.document.write('Footnote&nbsp; ' + footnum);
    msg.document.write('<\/title><meta http-equiv="Content-Type" ');
    msg.document.write('content="text/html; charset=utf-8" />');
    msg.document.write('<meta http-equiv="Content-Script-Type" ');
    msg.document.write('content="text/javascript" />');
    msg.document.write('<style type="text/css"> <![CDATA[ ');
    msg.document.write('h1 {text-align: center; font-size: 14pt;}');
    msg.document.write('fieldset {border: none;}');
    msg.document.write('form {text-align: center;}');
    msg.document.write(' ]]\u003e <\/style>');
    msg.document.write('<\/head><body><div id="footnote"><h1>Footnote&nbsp; ' + footnum + '<\/h1><p>');
    msg.document.write(footnote);
    msg.document.write('<\/p><form action="" method="post"><fieldset>');
    msg.document.write('<input type="button" value="OK" ');
    msg.document.write('onclick="window.close();" />');
    msg.document.write('<\/fieldset><\/form><\/div><\/body><\/html>');
    msg.document.close();
    setTimeout(function() {
        var height = msg.document.getElementById('footnote').offsetHeight;
        msg.resizeTo(598, height + 100);
    }
    , 100);
    msg.focus();
}
            </script><noscript>
               <p>The script content on this page is for navigation purposes only and does not alter the content in any way.</p>
            </noscript>
            <div>
               <p>How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document. </p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-33CCA224-68D0-41EA-AFB1-2740084CFC65">Getting Started with SODA for C</a><br>How to access SODA for C is described, as well as how to use it to create a     database collection, insert a document into a collection, and retrieve a document from a     collection.
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-8B40F7AB-1397-4520-9854-B68B6B6D2D5D">Creating a Document Collection with SODA for C</a><br>Use OCI function <code class="codeph">OCISodaCollCreate()</code>                                               to create a collection, if you do not care about the                                               details of its configuration. This creates a                                               collection that has the default metadata. To create a                                               collection that is configured in a nondefault way, use                                               function                                                   <code class="codeph">OCISodaCollCreateWithMetadata()</code>                                               instead, passing it custom metadata, expressed in                                               JSON. 
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-BEE217C1-8B25-4697-8216-F8B86F425386">Opening an Existing Document Collection with SODA for C</a><br>Use OCI function <code class="codeph">OCISodaCollOpen()</code> to open an existing document collection.
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-5875138F-348B-4574-9FCD-D96AA570535E">Checking Whether a Given Collection Exists with SODA for C</a><br>To check for the existence of a collection with a given name, use OCI function <code class="codeph">OCISodaCollOpen()</code>. The function returns <code class="codeph">OCI_SUCCESS</code> if the collection was successfully opened, which means that it exists. If no such collection exists then the collection-handle pointer is <code class="codeph">NULL</code>. 
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-7F1DFCEF-3A2C-41A3-810B-420299A4E66B">Discovering Existing Collections with SODA for C</a><br>To discover existing collections, use OCI functions       <code class="codeph">OCISodaCollList()</code> and <code class="codeph">OCISodaCollGetNext()</code>.
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-F92DF544-ED19-466F-BC05-192246ECEE3E">Dropping a Document Collection with SODA for C</a><br>To drop a document collection, use OCI function             <code class="codeph">OCISodaCollDrop()</code>. 
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-793B416B-2E8C-4425-9B35-381855E673AA">Creating Documents with SODA for C</a><br>Various ways to create a SODA document are described, along with the     components of a document.
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6">Inserting Documents into Collections with SODA for C</a><br>Various ways to insert a document into a SODA collection are             described.
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-F3435DEA-D0EC-4922-83FF-F51B57CCF542">SODA for C Read and Write Operations</a><br>For all read operations, and for write operations other than insertions,     you: (1) allocate an operation-options handle, (2) set some of its attributes to specify a     particular operation, and (3) pass the handle to a generic function that performs the     operation.
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E">Finding Documents in Collections with SODA for C</a><br>To find documents in a collection use function       <code class="codeph">OCISodaFind()</code>, passing it an operation-options handle that specifies the     particular find operation. To find the unique document that has a given key you can     alternatively use OCI convenience function <code class="codeph">OCISodaFindOneWithKey()</code>, which does     not require an operation-options handle.
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6">Replacing Documents in a Collection with SODA for C</a><br>You can use function <code class="codeph">OCISodaReplOneAndGet()</code> to replace a     document in a collection, passing it an operation-options handle that specifies the key of the     document to replace as well as the new, replacement document. It returns that replacement     document, but with all of its metadata filled in, as the result document. 
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE">Removing Documents from a Collection with SODA for C</a><br>To remove a document from a collection you can use function <code class="codeph">OCISodaRemove()</code>, passing it an operation-options handle. If you only want to remove one document, specified by its key, then you can alternatively use convenience function <code class="codeph">OCISodaRemoveOneWithKey()</code>. It does not require an operation-options handle — you pass it the key directly.
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-5F6ED443-F775-4529-BEE9-93D84062D90F">Indexing the Documents in a Collection with SODA for C</a><br>Indexing can improve the performance of QBEs. To index the documents in a SODA collection, use function <code class="codeph">OCISodaIndexCreate()</code>, passing it a textual JSON <span class="italic">index specification</span>. This can specify support for B-tree, spatial, full-text, and ad hoc indexing, and it can specify support for a JSON data guide.
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-80CC6F4E-FB19-4336-B407-1CF46B1CD3CD">Getting a Data Guide for a Collection with SODA for C</a><br>You use function <code class="codeph">OCISodaDataGuideGet()</code> to get a data guide for a collection. A data guide is a JSON document that summarizes the structural and type information of the JSON documents in the collection. It records metadata about the fields used in those documents.
                  </li>
                  <li class="ulchildlink"><a href="using-soda-c.html#GUID-53A1F8DB-72A9-46E4-B90D-0A8E338E133F">Handling Transactions with SODA for C</a><br>You can handle individual read and write operations, or groups of them, as a database transaction. 
                  </li>
               </ul>
            </div>
            
            <div class="sect2"><a id="GUID-33CCA224-68D0-41EA-AFB1-2740084CFC65" name="GUID-33CCA224-68D0-41EA-AFB1-2740084CFC65"></a><h3 id="ADSDC-GUID-33CCA224-68D0-41EA-AFB1-2740084CFC65" class="sect3"><span class="enumeration_section">3.1 </span>Getting Started with SODA for C
               </h3>
               <div>
                  <p>How to access SODA for C is described, as well as how to use it to create a
    database collection, insert a document into a collection, and retrieve a document from a
    collection.</p>
                  <div class="section">
                     <div class="infoboxnote" id="GUID-33CCA224-68D0-41EA-AFB1-2740084CFC65__GUID-9CF8A571-0960-4C64-BF72-8612B7525C46">
                        <p class="notep1">Note:</p>
                        <p>Don’t worry if not
                everything in this topic is clear to you on first reading. The necessary concepts
                are developed in detail in other topics. This topic should give you an idea of what
                is involved overall in using SODA.</p>
                     </div>
                     <p>To get started with SODA for
        C, follow these steps:
        </p>
                     <ol>
                        <li>
                           <p>Ensure that all of the prerequisites have been met for using
            SODA for C. See <a href="soda-c-prerequisites.html#GUID-944DC773-6A9B-4F9E-8404-EC0B9CF8975D" title="SODA for C is an integral part of Oracle Call Interface (OCI) starting with Oracle Database Release 18c (18.3).">SODA for C Prerequisites</a>.
                           </p>
                        </li>
                        <li>
                           <p>Grant database role <code class="codeph">SODA_APP</code> to the
            database schema (user account) where you intend to store SODA collections. (Replace
            placeholder <span class="italic"><code class="codeph">user</code></span> here by a real account
          name.)
                           </p><pre class="pre codeblock"><code>GRANT SODA_APP TO <span class="italic">user</span>;
</code></pre></li>
                        <li>
                           <p>Create a program file containing the C code in <a href="using-soda-c.html#GUID-33CCA224-68D0-41EA-AFB1-2740084CFC65__GETTINGSTARTEDRUN-THROUGH-16AA81AF">Example 3-1</a>, but set variables <code class="codeph"><span class="codeinlineitalic">usr</span></code>,
                <code class="codeph"><span class="codeinlineitalic">passwd</span></code>, and <code class="codeph"><span class="codeinlineitalic">connstr</span></code> to values
            appropriate string values for your database account and instance.
                           </p>
                        </li>
                        <li>
                           <p>Compile the file and build an executable program from it as
            you would for any OCI program.</p>
                        </li>
                        <li>
                           <p>Run the program.</p>
                           <p>You can run it just by
            entering the program name on the command line. For example, if the name is
              <code class="codeph">soda-get-started</code> then enter that at the command-line
            prompt:
                           </p><pre class="pre codeblock"><code>&gt; soda-get-started</code></pre><p>If
            you want the program to drop the collection when done with it then pass the argument
              <code class="codeph">drop</code> to it on the command
          line:
                           </p><pre class="pre codeblock"><code>&gt; soda-get-started drop</code></pre></li>
                     </ol>
                     <div class="infoboxnote" id="GUID-33CCA224-68D0-41EA-AFB1-2740084CFC65__GUID-99311192-16DD-4DF0-B76B-2245BB2A5A44">
                        <p class="notep1">Caution:</p>
                        <p>Do
                    <span class="italic">not</span> use SQL to drop the database <span class="italic">table</span> that underlies a
                collection. Dropping a <span class="italic">collection</span> involves more than just dropping its
                database table. In addition to the documents that are stored in its table, a
                collection has <span class="italic">metadata</span>, which is also persisted in Oracle Database. Dropping
                the table underlying a collection does <span class="italic">not</span> also drop the collection metadata.
            
                        </p>
                     </div>
                     <div class="infoboxnote" id="GUID-33CCA224-68D0-41EA-AFB1-2740084CFC65__GUID-9E711D2E-FCCF-4719-82AA-640C1CE9A65F">
                        <p class="notep1">Note:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>All C code you have that uses SODA for C features
                <span class="italic">must</span> first initialize the environment in OCI <span class="italic">object mode</span>, passing
                <code class="codeph">OCI_OBJECT</code> as the mode parameter to function
                <code class="codeph">OCIEnvNlsCreate()</code> here.
                              </p>
                           </li>
                           <li>
                              <p>All SODA handles (document, collection, and any others) need to be
              explicitly freed using function <code class="codeph">OCIHandleFree()</code> when your program no
              longer needs them. (In particular, a handle for a document with large content can be
              associated with a lot of memory.)
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-33CCA224-68D0-41EA-AFB1-2740084CFC65__GUID-E01FBF95-835C-48B0-BECF-D78D1AD52985">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../lnoci/build-and-configure-oci-applications.html#LNOCI-GUID-7DC38FFE-0AA2-4736-8D0C-CE5792F68493" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about building an OCI
            application
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-programming-basics.html#LNOCI-GUID-4CFB8AF7-EF05-4E0F-847F-2D0710E552C5" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for basic information about OCI programming
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-33CCA224-68D0-41EA-AFB1-2740084CFC65__GETTINGSTARTEDRUN-THROUGH-16AA81AF">
                     <p class="titleinexample">Example 3-1 Getting Started Run-Through</p>
                     <p>This example code does the
        following:</p>
                     <ol>
                        <li>
                           <p>Creates an Oracle Call Interface (OCI) environment in object
            mode, allocates the error handle, and gets a session using function
              <code class="codeph">OCISessionGet()</code>.
                           </p>
                        </li>
                        <li>
                           <p>Creates and opens a SODA document collection, using the
            default collection configuration (metadata).</p>
                        </li>
                        <li>
                           <p>Creates a SODA document with some JSON content. </p>
                        </li>
                        <li>
                           <p>Inserts the document into the collection. </p>
                        </li>
                        <li>
                           <p>Gets the inserted document back. Its other components,
            besides the content, are generated automatically.</p>
                        </li>
                        <li>
                           <p>Prints the unique document key, which is one of the
            components generated automatically.</p>
                        </li>
                        <li>
                           <p>Finds the document in the collection, providing its
          key.</p>
                        </li>
                        <li>
                           <p>Prints some of the document components: key, version,
            last-modified time stamp, creation time stamp, media type, and content.</p>
                        </li>
                        <li>
                           <p>Optionally drops the collection, cleaning up the database
            table that is used to store the collection and its
          metadata.</p>
                        </li>
                        <li>
                           <p>Frees all allocated handles.</p>
                        </li>
                     </ol>
                     <p>Whether or not the collection is dropped is decided at runtime. To drop
        the collection you provide the command-line argument <code class="codeph">drop</code> to the executable
        program.
                     </p><pre class="pre codeblock"><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;oci.h&gt;

static sword status;

int <span class="bold">main</span>(int argc, char *argv[])
{
  sword        rc = OCI_SUCCESS;
  OCIEnv      *envhp = NULL;
  OCIError    *errhp = NULL;
  OCISvcCtx   *<span class="bold">svchp</span> = NULL;
  OCIAuthInfo *<span class="bold">authhp</span> = NULL;
  OCISodaColl *<span class="bold">collhp</span> = NULL;
  OCISodaDoc  *<span class="bold">dochp</span> = NULL;
  boolean      isDropped = FALSE;
  ub4          docFlags = OCI_DEFAULT;
  OraText     *<span class="bold">collectionName</span> = (oratext *)"MyJSONCollection";
  OCISodaDoc  *<span class="bold">foundDochp</span> = NULL;
  OCISodaDoc  *<span class="bold">origDochp</span> = NULL;

  // Document content: JSON data
  char         <span class="bold">documentContent</span>[30] = "{\"name\":\"Alexander\"}";
 
  // Set these variables to strings with the appropriate user name and password.
  // (Be sure to replace the placeholders <span class="italic">user</span> and <span class="italic">password</span> used here.)
  OraText      <span class="bold">usr</span>[30] = <span class="italic">user</span>;
  OraText      <span class="bold">passwd</span>[30] = <span class="italic">password</span>;

  // Set variable connstr to a string value composed of the host name, port number, and service name
  // of your database instance.
  // (Be sure to replace placeholders <span class="italic">host</span>, <span class="italic">port</span>, and <span class="italic">service</span> used here.)
  OraText      <span class="italic">connstr</span>[50] = "<span class="italic">host</span><span class="bold">:</span><span class="italic">port</span><span class="bold">/</span><span class="italic">service</span>";

  OraText     *key = NULL;
  ub4          keyLen = 0;
  OraText     *content = NULL;
  ub4          contentLen = 0;
  OraText     *version = NULL;
  ub4          versionLen = 0;
  OraText     *lastModified = NULL;
  ub4          lastModifiedLen = 0;
  OraText     *mediaType = NULL;
  ub4          mediaTypeLen = 0;
  OraText     *createdOn = NULL;
  ub4          createdOnLen = 0;

  // <span class="bold">Set up environment.</span> <span class="italic">OCI_OBJECT is required for all SODA C code.</span>
  rc = <span class="bold">OCIEnvNlsCreate</span>(&amp;envhp,
                       <span class="bold">OCI_OBJECT</span>,
                       NULL,
                       NULL,
                       NULL,
                       NULL,
                       0,
                       NULL,
                       0,
                       0);

  if (rc != OCI_SUCCESS)
  {
    printf ("OCIEnvNlsCreate failed\n");
    goto finally;
  }

  // <span class="bold">Allocate error handle</span>
  rc = <span class="bold">OCIHandleAlloc</span>((dvoid *) envhp,
                      (dvoid **) &amp;<span class="bold">errhp</span>,
                      <span class="bold">OCI_HTYPE_ERROR</span>,
                      (size_t) 0,
                      (dvoid **) 0);

  if (rc != OCI_SUCCESS)
  {
    printf ("OCIHandleAlloc: OCI_HTYPE_ERROR creation failed\n");
    goto finally;
  }

  // <span class="bold">Allocate authentication-information handle</span>
  rc = <span class="bold">OCIHandleAlloc</span> ((dvoid *)envhp,
                       (dvoid **)&amp;<span class="bold">authhp</span>,
                       (ub4)<span class="bold">OCI_HTYPE_AUTHINFO</span>,
                       (size_t)0,
                       (dvoid **)0);

  if (rc != OCI_SUCCESS)
  {
    printf ("OCIHandleAlloc: OCI_HTYPE_AUTHINFO creation failed\n");
    goto finally;
  }
  
  // <span class="bold">Set variable usr to the user name</span>
  rc = <span class="bold">OCIAttrSet</span> ((dvoid *)authhp,
                   (ub4)OCI_HTYPE_AUTHINFO,
                   (dvoid *)<span class="bold">usr</span>,
                   (ub4)strlen((char *)usr),
                   (ub4)<span class="bold">OCI_ATTR_USERNAME</span>,
                   (OCIError *)errhp);
  if (rc != OCI_SUCCESS)
  {
    printf ("OCIAttrSet: OCI_ATTR_USERNAME failed\n");
    goto finally;
  }

  // <span class="bold">Set variable passwd to the password</span>
  rc = <span class="bold">OCIAttrSet</span> ((dvoid *)authhp,
                   (ub4)OCI_HTYPE_AUTHINFO,
                   (dvoid *)<span class="bold">passwd</span>,
                   (ub4)strlen((char *)passwd),
                   (ub4)<span class="bold">OCI_ATTR_PASSWORD</span>,
                   (OCIError *)errhp);
  if (rc != OCI_SUCCESS)
  {
    printf ("OCIAttrSet: OCI_ATTR_PASSWORD failed\n");
    goto finally;
  }

  // <span class="bold">Get service handle</span>
  // This provides service and error handles we can use for service calls
  rc = <span class="bold">OCISessionGet</span> ((OCIEnv *)envhp,
                      (OCIError *)errhp,
                      (OCISvcCtx **)&amp;<span class="bold">svchp</span>,
                      (OCIAuthInfo *)<span class="bold">authhp</span>,
                      (OraText *)<span class="bold">connstr</span>,
                      (ub4)strlen((char *)connstr),
                      (OraText *)NULL,
                      (ub4)0,
                      (OraText **)0,
                      (ub4 *)0,
                      (boolean *)0,
                      (ub4)OCI_DEFAULT);

  if (rc != OCI_SUCCESS)
  {
    printf("OCISessionGet failed\n");
    goto finally;
  }

  // <span class="bold">Create collection</span> named by the value of variable collectionName, with default metadata
  rc = <span class="bold">OCISodaCollCreate</span>(svchp,
                         <span class="bold">collectionName</span>,
                         (ub4) strlen(collectionName),
                         &amp;<span class="bold">collhp</span>,
                         errhp,
                         OCI_DEFAULT);

  if (rc != OCI_SUCCESS)
  {
    printf("OCISodaCollCreate failed\n");
    goto finally;
  }

  // Create a document with content provided by variable documentContent
  rc = <span class="bold">OCISodaDocCreate</span>(envhp,
                        <span class="bold">documentContent</span>,
                        (ub4) strlen(documentContent),
                        docFlags,
                        &amp;<span class="bold">dochp</span>,
                        errhp,
                        OCI_DEFAULT);

  if (rc != OCI_SUCCESS)
  {
    printf("OCISodaDocCreate failed\n");
    goto finally;
  }

  // Because OCISodaInsertAndGet returns the result document as dochp, we first
  // <span class="bold">save the pointer to the original input document handle</span>, which was returned
  // by OCISodaDocCreate, as origDochp. This lets us free the original
  // document handle later.
  origDochp = dochp;

  // <span class="bold">Insert the document</span> into the collection
  rc = <span class="bold">OCISodaInsertAndGet</span>(svchp,
                           <span class="bold">collhp</span>,
                           &amp;<span class="bold">dochp</span>,
                           errhp,
                           OCI_SODA_ATOMIC_COMMIT);

  if (rc != OCI_SUCCESS)
  {
    printf("OCISodaInsertAndGet failed\n");
    goto finally;
  }

  // Get the auto-generated key of the inserted document
  rc = <span class="bold">OCIAttrGet</span>((dvoid *) dochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">key</span>,
                  &amp;keyLen,
                  <span class="bold">OCI_ATTR_SODA_KEY</span>,
                  errhp);

  if (rc != OCI_SUCCESS)
  {
    printf("OCIAttrGet for OCI_ATTR_SODA_KEY failed\n");
    goto finally;
  }

  // <span class="bold">Find the document</span> using its <span class="bold">key</span>
  printf("Find the document by its auto-generated key %.*s\n", keyLen, key);
  rc = <span class="bold">OCISodaFindOneWithKey</span>(svchp,
                             collhp,
                             <span class="bold">key</span>,
                             keyLen,
                             OCI_DEFAULT,
                             &amp;foundDochp,
                             errhp,
                             OCI_DEFAULT);

  if (rc != OCI_SUCCESS)
  {
    printf("OCISodaFindOneWithKey failed\n");
    goto finally;
  }

  // <span class="bold">Get and print components</span> of found document
  rc = <span class="bold">OCIAttrGet</span>((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">key</span>,
                  &amp;keyLen,
                  <span class="bold">OCI_ATTR_SODA_KEY</span>,
                  errhp);

  if (rc != OCI_SUCCESS)
  {
    printf("OCIAttrGet for OCI_ATTR_SODA_KEY failed\n");
    goto finally;
  }
  printf("<span class="bold">Key:</span> %.*s\n", keyLen, key);

  rc = <span class="bold">OCIAttrGet</span>((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">version</span>,
                  &amp;versionLen,
                  <span class="bold">OCI_ATTR_SODA_VERSION</span>,
                  errhp);

  if (rc != OCI_SUCCESS)
  {
    printf("OCIAttrGet for OCI_ATTR_SODA_VERSION failed\n");
    goto finally;
  }
  printf("<span class="bold">Version:</span> %.*s\n", versionLen, version);

  rc = <span class="bold">OCIAttrGet</span>((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">lastModified</span>,
                  &amp;lastModifiedLen,
                  <span class="bold">OCI_ATTR_SODA_LASTMOD_TIMESTAMP</span>,
                  errhp);

  if (rc != OCI_SUCCESS)
  {
    printf("OCIAttrGet for OCI_ATTR_SODA_LASTMOD_TIMESTAMP failed\n");
    goto finally;
  }
  printf("<span class="bold">Last-modified:</span> %.*s\n", lastModifiedLen, lastModified);

  rc = <span class="bold">OCIAttrGet</span>((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">createdOn</span>,
                  &amp;createdOnLen,
                  <span class="bold">OCI_ATTR_SODA_CREATE_TIMESTAMP</span>,
                  errhp);

  if (rc != OCI_SUCCESS)
  {
    printf("OCIAttrGet for OCI_ATTR_SODA_CREATE_TIMESTAMP failed\n");
    goto finally;
  }
  printf("<span class="bold">Created:</span> %.*s\n", createdOnLen, createdOn);

  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">mediaType</span>,
                  &amp;mediaTypeLen,
                  <span class="bold">OCI_ATTR_SODA_MEDIA_TYPE</span>,
                  errhp);

  if (rc != OCI_SUCCESS)
  {
    printf("OCIAttrGet for OCI_ATTR_SODA_MEDIA_TYPE failed\n");
    goto finally;
  }
  printf("<span class="bold">Media Type:</span> %.*s\n", mediaTypeLen, mediaType);

  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">content</span>,
                  &amp;contentLen,
                  <span class="bold">OCI_ATTR_SODA_CONTENT</span>,
                  errhp);

  if (rc != OCI_SUCCESS)
  {
    printf("OCIAttrGet for OCI_ATTR_SODA_CONTENT failed\n");
    goto finally;
  }
  printf("<span class="bold">Content:</span> %.*s \n", contentLen, content);

  // <span class="bold">Drop the collection</span> if argument "drop" was provided
  if ((argc &gt; 1) &amp;&amp; (strcmp(argv[1], <span class="bold">"drop"</span>) == 0))
  {
    rc = <span class="bold">OCISodaCollDrop</span>(svchp,
                         <span class="bold">collhp</span>,
                         &amp;isDropped,
                         errhp,
                         OCI_DEFAULT);
    if (rc != OCI_SUCCESS)
    {
      printf("OCISodaCollDrop failed\n");
      goto finally;
    }
    else 
    {
      printf("Collection dropped\n");
    }
  }

 finally:

  // <span class="bold">Release the session and free all handles</span>
  if (collhp) 
    (void ) OCIHandleFree((dvoid *) <span class="bold">collhp</span>, OCI_HTYPE_SODA_COLLECTION);
  
  if (dochp) 
    (void ) OCIHandleFree((dvoid *) <span class="bold">dochp</span>, OCI_HTYPE_SODA_DOCUMENT);

  if (origDochp)
    (void ) OCIHandleFree((dvoid *) <span class="bold">origDochp</span>, OCI_HTYPE_SODA_DOCUMENT);

  if (foundDochp) 
    (void ) OCIHandleFree((dvoid *) <span class="bold">foundDochp</span>, OCI_HTYPE_SODA_DOCUMENT);

  (void ) OCISessionRelease(svchp, <span class="bold">errhp</span>, (oratext *)0, 0, OCI_DEFAULT);

  if (authhp)
    (void ) OCIHandleFree ((dvoid *)<span class="bold">authhp</span>, (ub4)OCI_HTYPE_AUTHINFO);
  
  if (errhp) 
    (void ) OCIHandleFree((dvoid *) <span class="bold">errhp</span>, OCI_HTYPE_ERROR);
  
  if (svchp) 
    (void ) OCIHandleFree((dvoid *) <span class="bold">svchp</span>, OCI_HTYPE_SVCCTX);

  if (envhp) 
    (void ) OCIHandleFree((dvoid *) <span class="bold">envhp</span>, OCI_HTYPE_ENV);
  return rc;
}
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="using-soda-c.html#GUID-F92DF544-ED19-466F-BC05-192246ECEE3E" title="To drop a document collection, use OCI function OCISodaCollDrop().">Dropping a Document Collection with SODA for C</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-8B40F7AB-1397-4520-9854-B68B6B6D2D5D" name="GUID-8B40F7AB-1397-4520-9854-B68B6B6D2D5D"></a><h3 id="ADSDC-GUID-8B40F7AB-1397-4520-9854-B68B6B6D2D5D" class="sect3"><span class="enumeration_section">3.2 </span>Creating a Document
                                              Collection with SODA for C
               </h3>
               <div>
                  <p>Use OCI function <code class="codeph">OCISodaCollCreate()</code>
                                              to create a collection, if you do not care about the
                                              details of its configuration. This creates a
                                              collection that has the default metadata. To create a
                                              collection that is configured in a nondefault way, use
                                              function
                                                  <code class="codeph">OCISodaCollCreateWithMetadata()</code>
                                              instead, passing it custom metadata, expressed in
                                              JSON. 
                  </p>
                  <div class="section">
                     <p>For each of
                                                  these functions, if a collection with the same
                                                  name already exists then it is simply opened and
                                                  its handle is returned. For function
                                                  <code class="codeph">OCISodaCollCreateWithMetadata()</code>,
                                                  if the metadata passed to it does not match that
                                                  of the existing collection then the collection is
                                                  not opened and an error is raised. (To match, all
                                                  metadata fields must have the same
                                                  values.)
                     </p>
                     <p><a href="using-soda-c.html#GUID-8B40F7AB-1397-4520-9854-B68B6B6D2D5D__CREATINGACOLLECTIONTHATHASTHEDEFAUL-14B659B0">Example 3-2</a> uses function
                                                  <code class="codeph">OCISodaCollCreate()</code> to create a
                                                  collection that has the default configuration
                                                  (default metadata). It returns the collection as
                                                  an <code class="codeph">OCISodaColl</code> handle.
                     </p>
                     <p>A collection that has the default
                                                  collection metadata has the following
                                                  characteristics:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>It can store only
                                                  JSON documents.</p>
                        </li>
                        <li>
                           <p>Each of its
                                                  documents has these components: key, content,
                                                  creation time stamp, last-modified time
                                                  stamp.</p>
                        </li>
                        <li>
                           <p>Keys are
                                                  automatically generated for documents that you add
                                                  to the collection.</p>
                        </li>
                     </ul>
                     <p>The default collection
                                                  configuration is recommended in most cases, but
                                                  collections are highly configurable. When you
                                                  create a collection you can specify things such as
                                                  the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Whether the
                                                  collection can store only JSON documents.</p>
                        </li>
                        <li>
                           <p>The presence or
                                                  absence of columns for document creation time
                                                  stamp, last-modified time stamp, and
                                                  version.</p>
                        </li>
                        <li>
                           <p>Methods of
                                                  document key generation, and whether keys are
                                                  client-assigned or generated
                                                  automatically.</p>
                        </li>
                        <li>
                           <p>Methods of version
                                                  generation.</p>
                        </li>
                        <li>
                           <p>Storage details,
                                                  such as the name of the table that stores the
                                                  collection and the names and data types of its
                                                  columns.</p>
                        </li>
                     </ul>
                     <p>This configurability also lets
                                                  you map a new collection to an existing database
                                                  table.</p>
                     <div class="infoboxnote" id="GUID-8B40F7AB-1397-4520-9854-B68B6B6D2D5D__UNLESSOTHERWISESTATEDTHEREMAINDEROF-14B636E1">
                        <p class="notep1">Note:</p>
                        <p>Unless otherwise stated, the
                                                  remainder of this documentation assumes that a
                                                  collection has the default
                                                  configuration.</p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-8B40F7AB-1397-4520-9854-B68B6B6D2D5D__ORACLEDATABASEINTRODUCTIONTOSIMPLEO-14B64219">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=ADSDI-GUID-9200BDAC-4BA3-4AD2-BF4B-81196278C064" target="_blank"><span><cite>Oracle Database Introduction to Simple Oracle Document Access (SODA)</cite></span></a>
                                                  for information about the default naming of a
                                                  collection table
                              </p>
                           </li>
                           <li>
                              <p><a href="../adsdi/soda-collection-metadata-components-reference.html#ADSDI-GUID-49EFF3D3-9FAB-4DA6-BDE2-2650383566A3" target="_blank"><span><cite>Oracle Database Introduction to Simple Oracle Document Access (SODA)</cite></span></a> for reference
                                                  information about collection metadata
                                                  components
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-09F34D70-9815-4DE2-8AC0-60FDA1F9AB4A" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI
                                                  function
                                                  <code class="codeph">OCISodaCollCreate()</code></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-E1F2326C-FCCD-434C-8CBA-C0C27992AA25" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaCollCreateWithMetadata()</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-8B40F7AB-1397-4520-9854-B68B6B6D2D5D__CREATINGACOLLECTIONTHATHASTHEDEFAUL-14B659B0">
                     <p class="titleinexample">Example 3-2 Creating a Collection That Has the Default
                                                  Metadata</p>
                     <p>This example
                                                  creates collection <code class="codeph">MyCollection</code>
                                                  with the default metadata. Note that function
                                                  <code class="codeph">OCISodaCollCreate()</code> does not,
                                                  itself, perform a database commit
                                                  operation.
                     </p><pre class="pre codeblock"><code>OCISodaColl *<span class="bold">collhp</span> = NULL;
OraText     *collectionName = (OraText *)"<span class="bold">MyCollection</span>";
rc = <span class="bold">OCISodaCollCreate</span>(svchp,
                       (const OraText *)collectionName,
                       (ub4)strlen(collectionName),
                       &amp;<span class="bold">collhp</span>,
                       errhp,
                       OCI_DEFAULT);</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="soda-collection-configuration-using-custom-metadata.html#GUID-E5544945-0347-409D-9DD2-7807DB732007" title="You can use OCI function OCIAttrGet() with attribute OCI_ATTR_SODA_DESCRIPTOR, to get all of the metadata of a collection at once, as a JSON document. You can also use OCIAttrGet() to get individual collection metadata attributes.">Getting the Metadata of an Existing Collection</a></li>
                        <li><a href="soda-collection-configuration-using-custom-metadata.html#GUID-1650308E-56E0-448B-B727-B2E16F8621E2" title="To create a document collection that has custom metadata, you pass its metadata, as JSON data, to OCI function OCISodaCollCreateWithMetadata().">Creating a Collection That Has Custom Metadata</a></li>
                        <li><a href="using-soda-c.html#GUID-5875138F-348B-4574-9FCD-D96AA570535E" title="To check for the existence of a collection with a given name, use OCI function OCISodaCollOpen(). The function returns OCI_SUCCESS if the collection was successfully opened, which means that it exists. If no such collection exists then the collection-handle pointer is NULL.">Checking Whether a Given Collection Exists with SODA for C</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-BEE217C1-8B25-4697-8216-F8B86F425386" name="GUID-BEE217C1-8B25-4697-8216-F8B86F425386"></a><h3 id="ADSDC-GUID-BEE217C1-8B25-4697-8216-F8B86F425386" class="sect3"><span class="enumeration_section">3.3 </span>Opening an Existing Document Collection with SODA for C
               </h3>
               <div>
                  <p>Use OCI function <code class="codeph">OCISodaCollOpen()</code> to open an existing document collection.
                  </p>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-BEE217C1-8B25-4697-8216-F8B86F425386__ORACLECALLINTERFACEPROGRAMMERSGUIDE-183B40CB">
                        <p class="notep1">See Also:</p>
                        <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-F421A54C-F1BF-4747-9F1A-4F3A4CD1269E" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaCollOpen()</code> 
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-BEE217C1-8B25-4697-8216-F8B86F425386__OPENINGANEXISTINGDOCUMENTCOLLECTION-14B6D1CA">
                     <p class="titleinexample">Example 3-3 Opening an Existing Document Collection</p>
                     <p>This example uses OCI function <code class="codeph">OCISodaCollOpen()</code> to open the collection named <code class="codeph">MyCollection</code>. It returns an <code class="codeph">OCISodaColl</code> handle that represents this collection as the value of the fourth parameter (<code class="codeph">collhp</code> in this example). The function return value is <code class="codeph">OCI_SUCCESS</code> for success or <code class="codeph">OCI_ERROR</code> for failure. If the value returned is <code class="codeph">OCI_ERROR</code> then there is no existing collection named <code class="codeph">MyCollection</code>.
                     </p><pre class="pre codeblock"><code><span class="bold">OCISodaColl</span> *collhp = <span class="bold">NULL</span>;
OraText     *collectionName = "<span class="bold">MyCollection</span>";
rc = <span class="bold">OCISodaCollOpen</span>(svchp, 
                     collectionName,
                     (ub4) strlen(collectionName),
                     &amp;<span class="bold">collhp</span>,
                     errhp,
                     OCI_DEFAULT);
<span class="bold">if (!collhp)</span> printf("<span class="bold">Collection</span> %s <span class="bold">does not exist</span>\n", collectionName);</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-5875138F-348B-4574-9FCD-D96AA570535E" name="GUID-5875138F-348B-4574-9FCD-D96AA570535E"></a><h3 id="ADSDC-GUID-5875138F-348B-4574-9FCD-D96AA570535E" class="sect3"><span class="enumeration_section">3.4 </span>Checking Whether a Given Collection Exists with SODA for C
               </h3>
               <div>
                  <p>To check for the existence of a collection with a given name, use OCI function <code class="codeph">OCISodaCollOpen()</code>. The function returns <code class="codeph">OCI_SUCCESS</code> if the collection was successfully opened, which means that it exists. If no such collection exists then the collection-handle pointer is <code class="codeph">NULL</code>. 
                  </p>
                  <div class="section">
                     <p><a href="using-soda-c.html#GUID-BEE217C1-8B25-4697-8216-F8B86F425386__OPENINGANEXISTINGDOCUMENTCOLLECTION-14B6D1CA">Example 3-3</a> illustrates this. If <code class="codeph">MyCollection</code>&nbsp;names an existing collection then that collection is opened, and collection-handle <code class="codeph">collhp</code> points to it. If <code class="codeph">MyCollection</code>&nbsp;does not name an existing collection then&nbsp;after invoking function <code class="codeph">OCISodaCollOpen()</code> the value of collection-handle <code class="codeph">collhp</code> is still <code class="codeph">NULL</code>.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="using-soda-c.html#GUID-8B40F7AB-1397-4520-9854-B68B6B6D2D5D" title="Use OCI function OCISodaCollCreate() to create a collection, if you do not care about the details of its configuration. This creates a collection that has the default metadata. To create a collection that is configured in a nondefault way, use function OCISodaCollCreateWithMetadata() instead, passing it custom metadata, expressed in JSON.">Creating a Document Collection with SODA for C</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-7F1DFCEF-3A2C-41A3-810B-420299A4E66B" name="GUID-7F1DFCEF-3A2C-41A3-810B-420299A4E66B"></a><h3 id="ADSDC-GUID-7F1DFCEF-3A2C-41A3-810B-420299A4E66B" class="sect3"><span class="enumeration_section">3.5 </span>Discovering Existing Collections with SODA
    for C
               </h3>
               <div>
                  <p>To discover existing collections, use OCI functions
      <code class="codeph">OCISodaCollList()</code> and <code class="codeph">OCISodaCollGetNext()</code>.
                  </p>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-7F1DFCEF-3A2C-41A3-810B-420299A4E66B__FORINFORMATIONABOUTCFUNCTIONLIST_CO-14B77175">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-EB16DC20-A544-4E19-A7BA-66791A74D657" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaCollList()</code>
                                 
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-682E158B-50F7-4E84-9A2D-EC48237E3613" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaGetNext()</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-7F1DFCEF-3A2C-41A3-810B-420299A4E66B__PRINTINGTHENAMESOFALLEXISTINGCOLLEC-14B77AEB">
                     <p class="titleinexample">Example 3-4 Printing the Names of All Existing
        Collections</p>
                     <p>This example uses OCI function <code class="codeph">OCISodaCollList()</code> to obtain a
        collection cursor (<code class="codeph">collectionCursor</code>). It then iterates over the cursor,
        printing out each collection
        name.
                     </p><pre class="pre codeblock"><code>OCISodaCollCursor *<span class="bold">collectionCursor</span>;
OCISodaColl       *collhp;
OraText           *startName = NULL;
ub4                startNameLen = 0;
OraText           *collectionName = NULL;
ub4                collectionNameLen = 0;

rc = <span class="bold">OCISodaCollList</span>(svchp,
                     startName,
                     (ub4) strlen(startName),
                     startNameLen,
                     &amp;<span class="bold">collectionCursor</span>,
                     errhp,
                     OCI_DEFAULT);

if (rc != OCI_SUCCESS) goto finally;

do
{
  rc = <span class="bold">OCISodaCollGetNext</span>(svchp,
                          <span class="bold">collectionCursor</span>,
                          &amp;collhp,
                          errhp,
                          OCI_DEFAULT);
  if (rc == OCI_NO_DATA || rc == OCI_INVALID_HANDLE || rc == OCI_ERROR) goto finally;

  rc = <span class="bold">OCIAttrGet</span>((dvoid *) collhp,
                  OCI_HTYPE_SODA_COLLECTION,
                  (dvoid *) &amp;collectionName,
                  &amp;collectionNameLen,
                  OCI_ATTR_SODA_COLL_NAME,
                  errhp);

  if (rc != OCI_SUCCESS) goto finally;
  printf("%s\n", <span class="bold">collectionName</span>);
  if (collhp) OCIHandleFree((dvoid *) collhp, (ub4) OCI_HTYPE_SODA_COLLECTION));
}
while(1);

finally:
if (collectionCursor) OCIHandleFree((dvoid *) collectionCursor, (ub4)OCI_HTYPE_SODA_CURSOR);
</code></pre><p>In this example, <code class="codeph">startName</code> is <code class="codeph">NULL</code>, and
          <code class="codeph">startNameLen</code> is <code class="codeph">0</code>. As a result, the cursor iterates over
          <span class="italic">all collections in the database</span>.
                     </p>
                     <p>Alternatively, you could
        iterate over only a subset of the existing collections. For that, you could set
          <code class="codeph">startName</code> to an existing collection name, such as
          <code class="codeph">"myCollectionB"</code>, and set <code class="codeph">startNameLen</code> to its string
        length. The cursor would then iterate over only that collection and the collections whose
        names come after that collection name alphabetically. The collections would be iterated over
        in alphabetic order of their names.
                     </p>
                     <p>For example, if the existing
        collections are <code class="codeph">"myCollectionA"</code>, <code class="codeph">"myCollectionB"</code>, and
          <code class="codeph">"myCollectionC"</code>, and if <code class="codeph">startName</code> is
          <code class="codeph">"myCollectionB"</code>, then the cursor iterates over
          <code class="codeph">"myCollectionB"</code> and <code class="codeph">"myCollectionC"</code>, in that
      order.
                     </p>
                  </div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-F92DF544-ED19-466F-BC05-192246ECEE3E" name="GUID-F92DF544-ED19-466F-BC05-192246ECEE3E"></a><h3 id="ADSDC-GUID-F92DF544-ED19-466F-BC05-192246ECEE3E" class="sect3"><span class="enumeration_section">3.6 </span>Dropping a Document Collection with SODA
        for C
               </h3>
               <div>
                  <p>To drop a document collection, use OCI function
            <code class="codeph">OCISodaCollDrop()</code>. 
                  </p>
                  <div class="section">
                     <p>Unlike Oracle SQL statement <code class="codeph">DROP TABLE</code>, function
                    <code class="codeph">OCISodaCollDrop()</code> does not implicitly perform a commit
                operation before and after it drops the collection. To complete the collection
                removal you must explicitly commit all uncommitted writes to the collection
                    <span class="italic">before</span> invoking
                <code class="codeph">OCISodaCollDrop()</code>.
                     </p>
                     <p>Dropping a collection using a collection handle does <span class="italic">not</span> free
                the handle. You must use OCI function <code class="codeph">OCIHandleFree()</code> to free a
                handle.
                     </p>
                     <div class="infoboxnote" id="GUID-F92DF544-ED19-466F-BC05-192246ECEE3E__GUID-486F51AA-DFC5-4A46-AB4A-6C3875FF8F4B">
                        <p class="notep1">Caution:</p>
                        <p>Do
                    <span class="italic">not</span> use SQL to drop the database <span class="italic">table</span> that underlies a
                collection. Dropping a <span class="italic">collection</span> involves more than just dropping its
                database table. In addition to the documents that are stored in its table, a
                collection has <span class="italic">metadata</span>, which is also persisted in Oracle Database. Dropping
                the table underlying a collection does <span class="italic">not</span> also drop the collection metadata.
            
                        </p>
                     </div>
                     <div class="infoboxnote" id="GUID-F92DF544-ED19-466F-BC05-192246ECEE3E__GUID-63C1034E-CB28-4E37-854F-3C4014DEA668">
                        <p class="notep1">Note:</p>
                        <p>Day-to-day use of a typical application that makes use of SODA does not require that you drop and re-create collections. But if you need to do that for any reason then this guideline applies.</p>
                        <p>Do <span class="italic">not </span>drop a collection and then re-create it with <span class="italic">different metadata </span>if there is any application running that uses the collection in any way. Shut down any such applications before re-creating the collection, so that all live SODA handles are released.
                        </p>
                        <p>There is no problem just dropping a collection. Any read or write operation on a dropped collection raises an error. And there is no problem dropping a collection and then re-creating it with the same metadata. But if you re-create a collection with different metadata, and if there are any live applications using SODA handles, then there is a risk that a stale collection is accessed, and <span class="italic">no error is raised</span> in this case. 
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-F92DF544-ED19-466F-BC05-192246ECEE3E__FORINFORMATIONABOUTCFUNCTIONDROP_CO-14B7DAA0">
                        <p class="notep1">See Also:</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=LNOCI-GUID-2A0C7230-7CE9-4E3C-941D-9C362B680AD1" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI
                    function <code class="codeph">OCISodaCollDrop()</code>
                           
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-F92DF544-ED19-466F-BC05-192246ECEE3E__DROPPINGADOCUMENTCOLLECTION-14B7EEE9">
                     <p class="titleinexample">Example 3-5 Dropping a Document
                Collection</p>
                     <p>This example uses OCI function <code class="codeph">OCISodaCollDrop()</code> to
                drop a collection. (Variable <code class="codeph">collhp</code> is assumed to point to an
                existing collection — an <code class="codeph">OCISodaColl</code> instance).
                     </p>
                     <p>If the collection cannot be dropped because of uncommitted write operations then an
                error is returned. If the collection is dropped successfully, the value of out
                parameter <code class="codeph">dropStatus</code> is <code class="codeph">TRUE</code>; otherwise it is
                    <code class="codeph">FALSE</code>.
                     </p>
                     <p>If the collection-handle argument
                    (<code class="codeph">collhp</code> in this example) no longer references an existing
                collection then <span class="italic">no error</span> is returned, but <code class="codeph">dropStatus</code> is
                    <code class="codeph">FALSE</code> after the invocation of
                    <code class="codeph">OCISodaCollDrop()</code>.
                     </p><pre class="pre codeblock"><code>boolean dropStatus = FALSE;
rc =&nbsp;<span class="bold">OCISodaCollDrop</span>(svchp, collhp, &amp;dropStatus, errhp, OCI_DEFAULT);
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="using-soda-c.html#GUID-53A1F8DB-72A9-46E4-B90D-0A8E338E133F" title="You can handle individual read and write operations, or groups of them, as a database transaction.">Handling Transactions with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6" title="Various ways to insert a document into a SODA collection are described.">Inserting Documents into Collections with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6" title="You can use function OCISodaReplOneAndGet() to replace a document in a collection, passing it an operation-options handle that specifies the key of the document to replace as well as the new, replacement document. It returns that replacement document, but with all of its metadata filled in, as the result document.">Replacing Documents in a Collection with SODA for C</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-793B416B-2E8C-4425-9B35-381855E673AA" name="GUID-793B416B-2E8C-4425-9B35-381855E673AA"></a><h3 id="ADSDC-GUID-793B416B-2E8C-4425-9B35-381855E673AA" class="sect3"><span class="enumeration_section">3.7 </span>Creating Documents with SODA for C
               </h3>
               <div>
                  <p>Various ways to create a SODA document are described, along with the
    components of a document.</p>
                  <div class="section">
                     <p>SODA for C represents a document using a
            <code class="codeph"><span class="bold">OCISodaDoc</span></code> handle. This is a <span class="italic">carrier</span> of document content
        and other document components, such as the document key. Document components are handle
        attributes.
                     </p>
                     <p>Here is an example of the <span class="italic">content</span> of a JSON
        document:
                     </p><pre class="pre codeblock"><code>{ "name" :    "Alexander",
  "address" : "1234 Main Street",
  "city" :    "Anytown",
  "state" :   "CA",
  "zip" :     "12345"
}</code></pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>A document has these <strong class="term">components</strong>:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Key</p>
                        </li>
                        <li>
                           <p>Content</p>
                        </li>
                        <li>
                           <p>Creation time stamp</p>
                        </li>
                        <li>
                           <p>Last-modified time stamp</p>
                        </li>
                        <li>
                           <p>Version</p>
                        </li>
                        <li>
                           <p>Media type (<code class="codeph">"application/json"</code> for JSON
            documents)
                           </p>
                        </li>
                     </ul>
                     <p>You can <span class="italic">create a document</span> in these ways:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>By invoking a OCI function that is specifically designed to
            create a document: <code class="codeph"><span class="bold">OCISodaDocCreate()</span></code>,
                <code class="codeph"><span class="bold">OCISodaDocCreateWithKey()</span></code>, or
                <code class="codeph"><span class="bold">OCISodaDocCreateWithKeyAndMType()</span></code>. 
                           </p>
                           <p><a href="using-soda-c.html#GUID-793B416B-2E8C-4425-9B35-381855E673AA__CREATINGADOCUMENTWITHJSONCONTENT-14B8B729">Example 3-6</a> and <a href="using-soda-c.html#GUID-793B416B-2E8C-4425-9B35-381855E673AA__CREATINGADOCUMENTWITHDOCUMENTKEYAND-14B89D25">Example 3-7</a> illustrate this. They both create a document handle. In
            each case the media type for the created document defaults to
              <code class="codeph">"application/json"</code>, and the other document components default to
              <code class="codeph">NULL</code>.
                           </p>
                        </li>
                        <li>
                           <p>By invoking function <code class="codeph">OCIHandleAlloc()</code> with
            handle type <code class="codeph"><span class="bold">OCI_HTYPE_SODA_DOCUMENT</span></code>, to create an empty document
            (handle).
                           </p>
                           <p><a href="using-soda-c.html#GUID-793B416B-2E8C-4425-9B35-381855E673AA__CREATINGANEMPTYDOCUMENTANDTHENDEFIN-17CE1424">Example 3-8</a> illustrates this.
                           </p>
                        </li>
                     </ul>
                     <p>You can use function <code class="codeph">OCIAttrSet()</code> to define (set)
        document components (document-handle attributes), whether or not they already have
        values.
                     </p>
                     <p>If you use the second approach (<code class="codeph">OCIHandleAlloc()</code>) to create a document
        then you must invoke function <code class="codeph">OCIAttrSet()</code> to set the <span class="italic">content</span>
        component. If you intend the document to be written to a collection with client-assigned
        keys then you must also invoke it to set the <span class="italic">key</span>. If you intend the document to have
        non-JSON content then you must also invoke it to set the <span class="italic">media
        type</span>.
                     </p>
                     <p>However you create a document, you can reuse the handle for multiple document
        operations. For example, you can change the content or other components, passing the same
        handle to different write operations.</p>
                     <p>In a collection, each document must
        have a key. You must provide the key when you create the document <span class="italic">only</span> if you expect
        to insert the document into a collection that does <span class="italic">not</span> automatically generate keys
        for inserted documents. By default, collections are configured to automatically generate
        document keys. Use function <code class="codeph">OCISodaDocCreate()</code> if the key is to be
        automatically generated; otherwise, supply the key (as parameter <code class="codeph">key</code>) to
          <code class="codeph">OCISodaDocCreateWithKey()</code>, or
          <code class="codeph">OCISodaDocCreateWithKeyAndMType()</code>. 
                     </p>
                     <p>Use function
          <code class="codeph">OCISodaDocCreateWithKeyAndMType()</code> if you want to provide the document
        media type (otherwise, it defaults to <code class="codeph">"application/json"</code>). This can be
        useful for creating <span class="italic">non</span>-JSON documents (using a media type other than
          <code class="codeph">"application/json"</code>).
                     </p>
                     <p>Whichever document-creation
        function you use, invoking it sets the document components that you provide (the content,
        possibly the key, and possibly the media type) to the values you provide for them. And it
        sets the values of the creation time stamp, last-modified time stamp, and version to
          <code class="codeph">null</code>.
                     </p>
                     <p>You <span class="italic">get</span> document components using OCI
        function <code class="codeph">OCIAttrGet()</code>, which is the same way you get the value of any
        handle attribute. You pass the type of the component you want to get to
          <code class="codeph">OCIAttrGet()</code> as the fifth argument. 
                     </p>
                     <div class="tblformal" id="GUID-793B416B-2E8C-4425-9B35-381855E673AA__GETTERMETHODSFORDOCUMENTSWHATISNEED-14B9185B">
                        <p class="titleintable">Table 3-1 Document Handle Attributes
          (Document Components)</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Document Handle Attributes&#xA;          (Document Components)" summary="The table columns are Attribute and Description" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" id="d1269e2038">Attribute</th>
                                 <th align="left" valign="bottom" id="d1269e2040">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d1269e2044" headers="d1269e2038 ">
                                    <p><code class="codeph">OCI_ATTR_SODA_KEY</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d1269e2044 d1269e2040 ">
                                    <p>The unique <span class="italic">key</span> for the document.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d1269e2055" headers="d1269e2038 ">
                                    <p><code class="codeph">OCI_ATTR_SODA_CREATE_TIMESTAMP</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d1269e2055 d1269e2040 ">
                                    <p>The <span class="italic">creation time stamp</span> for the
                  document.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d1269e2066" headers="d1269e2038 ">
                                    <p><code class="codeph">OCI_ATTR_SODA_LASTMOD_TIMESTAMP</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d1269e2066 d1269e2040 ">
                                    <p>The <span class="italic">last-modified time stamp</span> for the
                  document.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d1269e2077" headers="d1269e2038 ">
                                    <p><code class="codeph">OCI_ATTR_SODA_MEDIA_TYPE</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d1269e2077 d1269e2040 ">
                                    <p>The <span class="italic">media type</span> for the document.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d1269e2088" headers="d1269e2038 ">
                                    <p><code class="codeph">OCI_ATTR_SODA_VERSION</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d1269e2088 d1269e2040 ">
                                    <p>The document <span class="italic">version</span>.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" id="d1269e2099" headers="d1269e2038 ">
                                    <p><code class="codeph">OCI_ATTR_SODA_CONTENT</code></p>
                                 </td>
                                 <td align="left" valign="top" headers="d1269e2099 d1269e2040 ">
                                    <p>The document <span class="italic">content</span>. 
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <p>Immediately after you create a document, <code class="codeph">OCIAttrGet()</code>
        returns these values for components:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Values explicitly provided to the document-creation
            function</p>
                        </li>
                        <li>
                           <p><code class="codeph">"application/json"</code>, for
              <code class="codeph">OCI_ATTR_SODA_MEDIA_TYPE</code>, if the media type was not provided to the
            creation function
                           </p>
                        </li>
                        <li>
                           <p><code class="codeph">NULL</code> for other components
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-793B416B-2E8C-4425-9B35-381855E673AA__ORACLEDATABASEINTRODUCTIONTOSIMPLEO-14B8E096">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=ADSDI-GUID-FD2AA288-D82C-4CE8-995C-88DD02F5BA1C" target="_blank"><span><cite>Oracle Database Introduction to Simple Oracle Document Access (SODA)</cite></span></a> for an overview of SODA
            documents
                              </p>
                           </li>
                           <li>
                              <p><a href="../adsdi/soda-guidelines-and-restrictions.html#ADSDI-GUID-5B96ECEE-4766-48C6-847B-76B09DB8F800" target="_blank"><span><cite>Oracle Database Introduction to Simple Oracle Document Access (SODA)</cite></span></a> for restrictions that apply for SODA
              documents
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-12B1D620-C014-4E63-9041-CBCAAAFA0211" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaDocCreate()</code>
                                 
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-B038CD10-9FBF-45E4-8317-69D8790BDAFC" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaDocCreateWithKey()</code>
                                 
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-1701559F-C5C9-42D1-877B-D73D36C470A7" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaDocCreateWithKeyAndMType()</code>
                                 
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/handle-and-descriptor-functions.html#LNOCI-GUID-C5BF55F7-A110-4CB5-9663-5056590F12B5" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCIHandleAlloc()</code>
                                 
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/handle-and-descriptor-functions.html#LNOCI-GUID-3741D7BD-7652-4D7A-8813-AC2AEA8D3B03" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCIAttrSet()</code>
                                 
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-793B416B-2E8C-4425-9B35-381855E673AA__CREATINGADOCUMENTWITHJSONCONTENT-14B8B729">
                     <p class="titleinexample">Example 3-6 Creating a Document with JSON
        Content</p>
                     <p>This example uses <code class="codeph">OCISodaDocCreate()</code> to create a document handle and fill the document with content. It then frees the document handle.<a id="fn_1" name="fn_1" href="#fn_1" onclick="footdisplay(1, "The handle is freed here immediately, just as a reminder to free it when you are done with it (the same as any other handle). In practice you would make use of the handle in some way before freeing it.")"><sup>Foot&nbsp;1</sup></a></p><pre class="pre codeblock"><code>OCISodaDoc *dochp =  NULL;
OraText    *<span class="bold">documentContent</span> = "{\"name\":\"Alexander\"}";
ub4         docFlags = OCI_DEFAULT;

rc = <span class="bold">OCISodaDocCreate</span>(envhp,
                      <span class="bold">documentContent</span>,
                      (ub4) strlen(documentContent),
                      docFlags,
                      &amp;dochp,
                      errhp,
                      OCI_DEFAULT)
// Make further use of handle dochp...
if (dochp) <span class="bold">OCIHandleFree</span>((dvoid *) dochp, (ub4) OCI_HTYPE_SODA_DOCUMENT);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-793B416B-2E8C-4425-9B35-381855E673AA__CREATINGADOCUMENTWITHDOCUMENTKEYAND-14B89D25">
                     <p class="titleinexample">Example 3-7 Creating a Document with Document Key and
        JSON Content</p>
                     <p>This example is similar to <a href="using-soda-c.html#GUID-793B416B-2E8C-4425-9B35-381855E673AA__CREATINGADOCUMENTWITHJSONCONTENT-14B8B729">Example 3-6</a>, but it uses <code class="codeph">OCISodaDocCreateWithKey()</code>,
        providing the document key (<code class="codeph">myKey</code>) as well as the document content. It then
        gets and prints the non-null document components that were set by
          <code class="codeph">OCISodaDocCreateWithKey()</code>: the key, the content and the media type. It
        then frees the document
        handle.
                     </p><pre class="pre codeblock"><code>OCISodaDoc *dochp =  NULL;
OraText    *<span class="bold">documentContent</span> = "{\"name\":\"Alexander\"}";
OraText    *<span class="bold">key</span> = "myKey";
ub4         docFlags = OCI_DEFAULT;
sword       rc = OCI_SUCCESS;
OraText    *<span class="bold">finalKey</span>;
ub4         finalKeyLen = 0;
OraText    *<span class="bold">finalContent</span>;
ub4         finalContentLen = 0;
OraText    *<span class="bold">media</span>;
ub4         mediaLen = 0;

rc = <span class="bold">OCISodaDocCreateWithKey</span>(envhp,
                             <span class="bold">documentContent</span>,
                             (ub4) strlen(documentContent),
                             <span class="bold">key</span>,
                             (ub4) strlen(key),
                             docFlags,
                             &amp;dochp,
                             errhp,
                             OCI_DEFAULT)
  
if (rc != OCI_SUCCESS) goto finally;

// Get and print the key, content and media type, which were set by OCISodaDocCreateWithKey().
OCIAttrGet((dvoid *) dochp,
           OCI_HTYPE_SODA_DOCUMENT,
           (dvoid *) &amp;<span class="bold">finalKey</span>,
           &amp;finalKeyLen,
           OCI_ATTR_SODA_KEY,
           errhp);
printf ("<span class="bold">Key:</span> %.*s\n", finalKeyLen, finalKey);
  
OCIAttrGet((dvoid *) dochp,
           OCI_HTYPE_SODA_DOCUMENT,
           (dvoid *) &amp;<span class="bold">finalContent</span>,
           &amp;finalContentLen,
           OCI_ATTR_SODA_CONTENT,
           errhp);
printf ("<span class="bold">Content:</span> %.*s\n", finalContentLen, finalContent);

OCIAttrGet((dvoid *)dochp,
           OCI_HTYPE_SODA_DOCUMENT,
           (dvoid *) &amp;<span class="bold">media</span>,
           &amp;mediaLen,
           OCI_ATTR_SODA_MEDIA_TYPE,
           errhp);
printf ("<span class="bold">Media type:</span> %.*s\n", mediaLen, media);

finally:
if (dochp) <span class="bold">OCIHandleFree</span>((dvoid *) dochp, (ub4) OCI_HTYPE_SODA_DOCUMENT);
</code></pre><p>This is the printed
      output:</p><pre class="pre codeblock"><code>Key: myKey
Content: {"name" : "Alexander"}
Media type: application/json 
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-793B416B-2E8C-4425-9B35-381855E673AA__CREATINGANEMPTYDOCUMENTANDTHENDEFIN-17CE1424">
                     <p class="titleinexample">Example 3-8 Creating an Empty Document and Then
        Defining
      Components</p><pre class="pre codeblock"><code>sword       rc = OCI_SUCCESS;
OCISodaDoc *dochp = NULL;
OraText    *<span class="bold">documentContent</span>= "{\"name\":\"Alexander\"}";

rc = <span class="bold">OCIHandleAlloc</span>((void *) envhp,
                    (void **) &amp;dochp,
                    <span class="bold">OCI_HTYPE_SODA_DOCUMENT</span>,
                    (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

rc = <span class="bold">OCIAttrSet</span>(dochp,
                OCI_HTYPE_SODA_DOCUMENT,
                documentContent,
                (ub4) strlen(<span class="bold">documentContent</span>),
                OCI_ATTR_SODA_CONTENT,
                errhp);
finally: ...
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="using-soda-c.html#GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6" title="Various ways to insert a document into a SODA collection are described.">Inserting Documents into Collections with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E" title="To find documents in a collection use function OCISodaFind(), passing it an operation-options handle that specifies the particular find operation. To find the unique document that has a given key you can alternatively use OCI convenience function OCISodaFindOneWithKey(), which does not require an operation-options handle.">Finding Documents in Collections with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6" title="You can use function OCISodaReplOneAndGet() to replace a document in a collection, passing it an operation-options handle that specifies the key of the document to replace as well as the new, replacement document. It returns that replacement document, but with all of its metadata filled in, as the result document.">Replacing Documents in a Collection with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE" title="To remove a document from a collection you can use function OCISodaRemove(), passing it an operation-options handle. If you only want to remove one document, specified by its key, then you can alternatively use convenience function OCISodaRemoveOneWithKey(). It does not require an operation-options handle — you pass it the key directly.">Removing Documents from a Collection with SODA for C</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6" name="GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6"></a><h3 id="ADSDC-GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6" class="sect3"><span class="enumeration_section">3.8 </span>Inserting Documents into Collections
            with SODA for C
               </h3>
               <div>
                  <p>Various ways to insert a document into a SODA collection are
            described.</p>
                  <div class="section">
                     <p>If you have created a document handle, you can use
                        function <code class="codeph">OCISodaInsert()</code> or
                              <code class="codeph">OCISodaInsertAndGet()</code> to insert the document into a
                        collection. These functions create document keys automatically, unless the
                        collection is configured with client-assigned keys and the input document
                        provides the key. These functions take a document handle as one of their
                        arguments.
                     </p>
                     <p>For convenience, you can alternatively use
                        function <code class="codeph">OCISodaInsertWithCtnt()</code> or
                              <code class="codeph">OCISodaInsertAndGetWithCtnt()</code> to insert a document
                        without having created a document handle. You provide only the content and
                        (optionally) the key for the document. (The key is needed only when
                        inserting into a collection that has client-assigned keys.)
                     </p>
                     <p>If the target collection is configured for documents that have
                        creation and last-modified time-stamp components then all of the
                        document-insertion functions automatically set these components. If the
                        collection is configured to generate document versions automatically then
                        the insertion functions also set the version component. (The default
                        collection configuration provides both time-stamp components and the version
                        component.)</p>
                     <p>In addition to inserting the document, functions
                              <code class="codeph">OCISodaInsertAndGet()</code> and
                              <code class="codeph">OCISodaInsertAndGetWithCtnt()</code> return a result
                        document. The result document contains the generated document components,
                        such as the key, version, created-on timestamp, and last-modified timestamp.
                        It does <span class="italic">not</span> contain the <span class="italic">content</span> of the inserted
                        document.
                     </p>
                     <div class="infoboxnote" id="GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6__IFTHECOLLECTIONISCONFIGUREDWITHCLIE-14C4EE58">
                        <p class="notep1">Note:</p>
                        <p>If the collection is configured with client-assigned
                              document keys (which is not the default case), and the input document
                              provides a key that identifies an existing document in the collection,
                              then these methods return an error.</p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6__WHATXREFISNEEDEDNEEDXREFFORINFORMAT-14C4FA3B">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-D0833EAB-53AA-47C3-8302-C4C58410E347" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI
                                          function <code class="codeph">OCISodaInsert()</code>
                                 
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-45B6544B-2DA1-4A60-975D-5F4B307C640C" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI
                                          function <code class="codeph">OCISodaInsertAndGet()</code></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-C76C86E6-E726-4445-A42B-B7C7C26E4218" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI
                                          function <code class="codeph">OCISodaInsertWithCtnt()</code>
                                 
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-95248C10-60E6-46EE-8C7B-E975187137C2" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI
                                          function
                                          <code class="codeph">OCISodaInsertAndGetWithCtnt()</code></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaBulkInsert()</code> 
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaBulkInsertAndGet()</code></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaBulkInsertWithCtnt()</code> 
                              </p>
                           </li>
                           <li>
                              <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaBulkInsertAndGetWithCtnt()</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6__INSERTINGADOCUMENTINTOACOLLECTION-14C44EDD">
                     <p class="titleinexample">Example 3-9 Inserting a Document into a
                        Collection</p>
                     <p>This example
                        creates a document and inserts it into a collection using function
                              <code class="codeph">OCISodaInsert()</code>. The use of mode parameter
                              <code class="codeph">OCI_SODA_ATOMIC_COMMIT</code> ensures that the insertion and
                        any other outstanding operations are
                  committed.
                     </p><pre class="pre codeblock"><code>OCISodaDoc *dochp = NULL;
OraText    *documentContent = "{\"name\":\"Alexander\"}";

rc = OCISodaDocCreate(envhp,
                      documentContent,
                      (ub4) strlen(documentContent),
                      OCI_DEFAULT,
                      &amp;<span class="bold">dochp</span>,
                      errhp,
                      OCI_DEFAULT);

if (rc != OCI_SUCCESS) goto finally:

rc = <span class="bold">OCISodaInsert</span>(svchp,
                   collhp,
                   <span class="bold">dochp</span>,
                   errhp,
                   OCI_SODA_ATOMIC_COMMIT);

finally: ...
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6__INSERTINGADOCUMENTINTOACOLLECTIONAN-14C427D0">
                     <p class="titleinexample">Example 3-10 Inserting a Document into
                        a Collection and Getting the Result Document</p>
                     <p>This example creates a document and inserts it into a
                        collection using function <code class="codeph">OCISodaInsertAndGet()</code>, which also
                        returns the result document, after insertion. The example then gets (and
                        prints) each of the generated components from that result document (which
                        contains them): the creation time stamp, the last-modified time stamp, the
                        media type, and the version. To obtain each of these components it uses
                        function <code class="codeph">OCIAttrGet()</code>, passing the type of the component:
                              <code class="codeph">OCI_ATTR_SODA_CREATE_TIMESTAMP</code>,
                              <code class="codeph">OCI_ATTR_SODA_LASTMOD_TIMESTAMP</code>,
                              <code class="codeph">OCI_ATTR_SODA_MEDIA_TYPE</code>, and
                              <code class="codeph">OCI_ATTR_SODA_VERSION</code>.
                     </p><pre class="pre codeblock"><code>sword rc = OCI_SUCCESS;

OraText    *key = "myKey1";
OraText    *documentContent = "{\"name\":\"Alexander\"}";
ub4         docFlags = OCI_DEFAULT;
OCISodaDoc *<span class="bold">dochp</span> = NULL;
OCISodaDoc *<span class="bold">origDochp</span> = NULL;
OraText    *resultKey;
ub4         resultKeyLen = 0;
OraText    *resultCreatedOn;
ub4         resultCreatedOnLen = 0;
OraText    *resultLastModified;
ub4         resultLastModifiedLen = 0;
OraText    *resultVersion;
ub4         resultVersionLen = 0;
OraText    *resultMedia;
ub4         resultMediaLen = 0;

// Create a document with key "myKey1"
rc = OCISodaDocCreateWithKey(envhp,
                             documentContent,
                             (ub4) strlen(documentContent),
                             key,
                             (ub4) strlen(key),
                             docFlags,
                             &amp;<span class="bold">dochp</span>,
                             errhp,
                             OCI_DEFAULT);

if (rc != OCI_SUCCESS) goto finally;

// Insert the document into a collection.

// collhp is a collection-handle pointer.  We assume the collection it
// points to was configured to use client-assigned keys.

// Because OCISodaInsertAndGet returns the result document as dochp, we first
// save the pointer to the original input document handle, which is returned by
// OCISodaDocCreateWithKey, as origDochp.  This lets us free the original
// document handle later.
 
origDochp = dochp;

rc = <span class="bold">OCISodaInsertAndGet</span>(svchp,
                         collhp,
                         &amp;<span class="bold">dochp</span>,
                         errhp,
                         OCI_SODA_ATOMIC_COMMIT);

if (rc != OCI_SUCCESS) goto finally;

// Print some components of the result document.  (For brevity we omit checking
// for a return value of OCI_SUCCESS in all OCIAttrGet() calls here.)

OCIAttrGet((dvoid *)dochp,
           OCI_HTYPE_SODA_DOCUMENT,
           (dvoid *)&amp;resultCreatedOn,
           &amp;resultCreatedOnLen,
           OCI_ATTR_SODA_<span class="bold">CREATE_TIMESTAMP</span>,
           errhp);
printf ("<span class="bold">Created-on time stamp:</span> %.*s\n", resultCreatedOnLen, resultCreatedOn);

OCIAttrGet((dvoid *)dochp,
           OCI_HTYPE_SODA_DOCUMENT,
           (dvoid *)&amp;resultLastModified,
           &amp;resultLastModifiedLen,
           OCI_ATTR_SODA_<span class="bold">LASTMOD_TIMESTAMP</span>,
           errhp);
printf ("<span class="bold">Last-modified time stamp:</span> %.*s\n", resultLastModifiedLen, resultLastModified);

OCIAttrGet((dvoid *)dochp,
           OCI_HTYPE_SODA_DOCUMENT,
           (dvoid *)&amp;resultVersion,
           &amp;resultVersionLen,
           OCI_ATTR_SODA_<span class="bold">VERSION</span>,
           errhp);
printf ("<span class="bold">Version:</span> %.*s\n", resultVersionLen, resultVersion);

OCIAttrGet((dvoid *)dochp,
           OCI_HTYPE_SODA_DOCUMENT,
           (dvoid *)&amp;resultMedia,
           &amp;resultMediaLen,
           OCI_ATTR_SODA_<span class="bold">MEDIA_TYPE</span>,
           errhp);
printf ("<span class="bold">Media type:</span> %.*s\n", resultMediaLen, resultMedia);

finally:
    
// Free the document handles
if (origDochp) <span class="bold">OCIHandleFree</span>((dvoid *) <span class="bold">origDochp</span>, (ub4) OCI_HTYPE_SODA_DOCUMENT);

if (dochp) <span class="bold">OCIHandleFree</span>((dvoid *) <span class="bold">dochp</span>, (ub4) OCI_HTYPE_SODA_DOCUMENT);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6__INSERTINGADOCUMENTINTOACOLLECTIONWI-1DFC4B5A">
                     <p class="titleinexample">Example 3-11 Inserting a Document into
                        a Collection Without Providing a
                        Handle</p>
                     <p>This example uses function
                              <code class="codeph">OCISodaInsertWithCtnt()</code> to insert a document into a
                        collection without providing a document handle. Only the document key and
                        content are provided as arguments.
                     </p>
                     <p>Here we assume that we
                        are inserting the document into a collection that is configured with
                        client-assigned keys. If you instead insert a document into a collection
                        configured for auto-generated keys then pass <code class="codeph">NULL</code> as the
                        key argument and <code class="codeph">0</code> as the key-length argument (which
                        immediately follows the key
                  argument).
                     </p><pre class="pre codeblock"><code>OraText *documentContent = "{\"name\":\"Hannibal\"}";
OraText *key = "myKey2";

rc = <span class="bold">OCISodaInsertWithCtnt</span>(svchp,
                           collhp,
                           key,
                           (ub4) strlen(key),
                           (void *)documentContent,
                           (ub4) strlen(documentContent),
                           errhp,
                           OCI_SODA_ATOMIC_COMMIT);
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="using-soda-c.html#GUID-53A1F8DB-72A9-46E4-B90D-0A8E338E133F" title="You can handle individual read and write operations, or groups of them, as a database transaction.">Handling Transactions with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-F92DF544-ED19-466F-BC05-192246ECEE3E" title="To drop a document collection, use OCI function OCISodaCollDrop().">Dropping a Document Collection with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6" title="You can use function OCISodaReplOneAndGet() to replace a document in a collection, passing it an operation-options handle that specifies the key of the document to replace as well as the new, replacement document. It returns that replacement document, but with all of its metadata filled in, as the result document.">Replacing Documents in a Collection with SODA for C</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-F3435DEA-D0EC-4922-83FF-F51B57CCF542" name="GUID-F3435DEA-D0EC-4922-83FF-F51B57CCF542"></a><h3 id="ADSDC-GUID-F3435DEA-D0EC-4922-83FF-F51B57CCF542" class="sect3"><span class="enumeration_section">3.9 </span>SODA for C Read and Write
    Operations
               </h3>
               <div>
                  <p>For all read operations, and for write operations other than insertions,
    you: (1) allocate an operation-options handle, (2) set some of its attributes to specify a
    particular operation, and (3) pass the handle to a generic function that performs the
    operation.</p>
                  <p>These are the read-operation functions:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">OCISodaFindOne()</code> — Find and return at most
          one document.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">OCISodaFind()</code> — Find multiple documents and
          return a cursor to them.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">OCISodaDocCount()</code> — Find multiple documents
          and return the number of documents found.
                        </p>
                        
                     </li>
                  </ul>
                  <p>These are the write-operation functions:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">OCISodaReplOne()</code> — Replace one
        document.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">OCISodaReplOneAndGet()</code> — Replace one document
          and return the result document.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">OCISodaRemove()</code> — Remove multiple
          documents.
                        </p>
                     </li>
                  </ul>
                  <p>You use function <code class="codeph">OCIHandleAlloc()</code> to allocate an empty
      operation-options handle:
                  </p><pre class="pre codeblock"><code><span class="bold">OCISodaOperationOptions</span> *opthp;
// Create an empty operation options handle
rc = <span class="bold">OCIHandleAlloc</span>((void *) envhp,
                    (void **)&amp;<span class="bold">opthp</span>,
                    <span class="bold">OCI_HTYPE_SODA_OPER_OPTIONS</span>,
                    (size_t) 0,
                    (dvoid **) 0);</code></pre><p>You use function <code class="codeph">OCIAttrSet()</code> to set a single attribute of an
      operation-options handle. For example, this sets attribute <code class="codeph">filter</code> with value
        <code class="codeph">{"name:"Ruth"}</code>:
                  </p><pre class="pre codeblock"><code>OraText * <span class="bold">filter</span> = "{\"name\" : \"Ruth\"}";
// Set the filter on the operation options handle
rc = <span class="bold">OCIAttrSet</span>(opthp, 
                OCI_HTYPE_SODA_OPER_OPTIONS, 
                <span class="bold">filter</span>,
                strlen(<span class="bold">filter</span>),
                <span class="bold">OCI_ATTR_SODA_FILTER</span>,
                errhp);</code></pre><p>There is no attribute that represents multiple document keys. For an operation
      that involves multiple keys you use function <code class="codeph">OCISodaOperKeysSet()</code> to set
      them.
                  </p>
                  <div class="infoboxnote" id="GUID-F3435DEA-D0EC-4922-83FF-F51B57CCF542__GUID-BF2BCFFE-E759-4CE2-9AF9-207AD19C2B4A">
                     <p class="notep1">Note:</p>
                     <p>If you use function <code class="codeph">OCIAttrSet()</code> to set attribute <code class="codeph">OCI_ATTR_SODA_KEY</code> on an operation-options handle, and you also use function <code class="codeph">OCISodaOperKeysSet()</code> to set multiple keys on the same handle, then only the latest of the two settings takes effect. The effect of the first function invoked is overridden by the effect of the second.
                     </p>
                  </div>
               </div>
               <div>
                  <div class="infoboxnotealso" id="GUID-F3435DEA-D0EC-4922-83FF-F51B57CCF542__GUID-636CA782-27F2-4929-9D97-176548C8E0C6">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about the SODA attributes that can be set on an operation-options handle
                        </li>
                        <li><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-54CEBCDA-C8A8-423C-B015-EF9895E80348" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaOperKeySet()</code></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E" name="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E"></a><h3 id="ADSDC-GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E" class="sect3"><span class="enumeration_section">3.10 </span>Finding Documents in Collections with SODA
    for C
               </h3>
               <div>
                  <p>To find documents in a collection use function
      <code class="codeph">OCISodaFind()</code>, passing it an operation-options handle that specifies the
    particular find operation. To find the unique document that has a given key you can
    alternatively use OCI convenience function <code class="codeph">OCISodaFindOneWithKey()</code>, which does
    not require an operation-options handle.
                  </p>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E__WHATXREFISNEEDEDNEEDXREFFORINFORMAT-14C56589">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaFind()</code></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-447802C9-772D-43D3-AF95-5B32B18F72C2" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaFindOneWithKey()</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E__FINDINGALLDOCUMENTSINACOLLECTION-D033BD02">
                     <p class="titleinexample">Example 3-12 Finding All Documents in a
        Collection</p>
                     <p>This example first obtains a cursor for a query result
        list that contains each document in a collection. It then uses the cursor in a while
        statement to get and print the components of each document, as a
      string.</p><pre class="pre codeblock"><code>OraText                 *key = NULL;
ub4                      keyLen = 0;
OraText                 *content = NULL;
ub4                      contentLen = 0;
OraText                 *version = NULL;
ub4                      versionLen = 0;
OraText                 *lastModified = NULL;
ub4                      lastModifiedLen = 0;
OraText                 *mediaType = NULL;
ub4                      mediaTypeLen = 0;
OraText                 *createdOn = NULL;
ub4                      createdOnLen = 0;
ub4                      findFlags = OCI_DEFAULT;

OCISodaDocCursor        *cursorhp = NULL;
OCISodaDoc              *foundDochp = NULL;
OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// Find all documents in the collection.
//
// <span class="italic">Because the operation-options handle (opthp) is empty</span>, no conditions
// are set on the find operation, so <span class="italic">all documents</span> are returned.
//
// collhp is an OCISodaColl pointer, representing an open collection.
//
// cursorhp is a OCISodaDocCursor pointer to a returned cursor over the
// resulting document set.
rc = <span class="bold">OCISodaFind</span>(svchp,
                 collhp,
                 opthp,
                 findFlags,
                 &amp;<span class="bold">cursorhp</span>,
                 errhp,
                 OCI_DEFAULT);
if (rc != OCI_SUCCESS) goto finally;

// Fetch each document from the cursor, and print all of its components.
while (<span class="bold">OCISodaDocGetNext</span>(svchp,
                         <span class="bold">cursorhp</span>,
                         &amp;<span class="bold">foundDochp</span>,
                         errhp,
                         OCI_DEFAULT)
        == OCI_SUCCESS)
{
  // Get and print components of found document.
  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">key</span>,
                  &amp;keyLen,
                  OCI_ATTR_SODA_<span class="bold">KEY</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Key:</span> %.*s\n", keyLen, key);

  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">version</span>,
                  &amp;versionLen,
                  OCI_ATTR_SODA_<span class="bold">VERSION</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Version:</span> %.*s\n", versionLen, version);

  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;lastModified,
                  &amp;lastModifiedLen,
                  OCI_ATTR_SODA_<span class="bold">LASTMOD_TIMESTAMP</span>,
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Last-modified:</span> %.*s\n", lastModifiedLen, lastModified);

  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;createdOn,
                  &amp;createdOnLen,
                  OCI_ATTR_SODA_<span class="bold">CREATE_TIMESTAMP</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Created:</span> %.*s\n", createdOnLen, createdOn);

  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">mediaType</span>,
                  &amp;mediaTypeLen,
                  OCI_ATTR_SODA_<span class="bold">MEDIA_TYPE</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Media Type:</span> %.*s\n", mediaTypeLen, mediaType);

  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">content</span>,
                  &amp;contentLen,
                  OCI_ATTR_SODA_<span class="bold">CONTENT</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Content:</span> %.*s \n", contentLen, content);

  // <span class="italic">Important:</span> free document handle <span class="italic">before fetching next document</span>.
  // This releases memory associated with the current document.
  if (foundDochp)
    (void) OCIHandleFree((dvoid *) foundDochp, OCI_HTYPE_SODA_DOCUMENT);
}

finally:

// Free all handles.
if (cursorhp)
  (void) OCIHandleFree((dvoid *) cursorhp, OCI_HTYPE_SODA_DOC_CURSOR);
if (opthp)
  (void) OCIHandleFree((dvoid *) opthp, OCI_HTYPE_SODA_OPER_OPTIONS);
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (foundDochp)
  (void) OCIHandleFree((dvoid *) foundDochp, OCI_HTYPE_SODA_DOCUMENT);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E__FINDINGTHEUNIQUEDOCUMENTTHATHASAGIV-14C56797">
                     <p class="titleinexample">Example 3-13 Finding the Unique Document That Has a
        Given Document Key</p>
                     <p>This example sets up an operations options handle
        with the given UUID key (<code class="codeph">E914016C41174F6CBF7C877C7F9EB4C2</code>), which it passes
        to function <code class="codeph">OCISodaFindOne()</code> to find the document with that key. 
                     </p>
                     <p>After finding the document, the example uses function
          <code class="codeph">OCIAttrGet()</code> to retrieve the document key and content, and then it prints
        them. Finally, it frees the document handles that were allocated for the collection,
        document, and operations options.
                     </p>
                     <p>As an alternative to setting the key
        attribute on an operation-options handle and using <code class="codeph">OCISodaFindOne()</code>, you
        can use convenience function <code class="codeph">OCISodaFindOneWithKey</code>. It accepts a key
        argument directly, in place of an operation-options handle.
                     </p><pre class="pre codeblock"><code>OraText                 *key = NULL;
ub4                      keyLen = 0;
OraText                 *content = NULL;
ub4                      contentLen = 0;
ub4                      findFlags = OCI_DEFAULT;

OraText                 *<span class="bold">inKey</span> = "E914016C41174F6CBF7C877C7F9EB4C2";

OCISodaDoc              *foundDochp = NULL;
OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;<span class="bold">opthp</span>,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// Set the key of the document we want to find, on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">inKey</span>,
                strlen(inKey),
                OCI_ATTR_SODA_<span class="bold">KEY</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// Find the document with the key, by way of the operation-options handle.
//
// collhp is an OCISodaColl pointer, representing an open collection.
rc = <span class="bold">OCISodaFindOne</span>(svchp,
                    collhp, 
                    <span class="bold">opthp</span>,
                    findFlags, 
                    &amp;<span class="bold">foundDochp</span>,
                    errhp,
                    OCI_DEFAULT);
if (rc != OCI_SUCCESS) goto finally;

// Get and print components of found document.
rc = OCIAttrGet((dvoid *) foundDochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">key</span>,
                &amp;keyLen,
                OCI_ATTR_SODA_<span class="bold">KEY</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Key:</span> %.*s\n", keyLen, key);

rc = OCIAttrGet((dvoid *) foundDochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">content</span>,
                &amp;contentLen,
                OCI_ATTR_SODA_<span class="bold">CONTENT</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Content:</span> %.*s \n", contentLen, content);

finally:

// Free all handles.
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (foundDochp)
  (void) OCIHandleFree((dvoid *) foundDochp, OCI_HTYPE_SODA_DOCUMENT);
if (opthp)     
  (void) OCIHandleFree((dvoid *) opthp, OCI_HTYPE_SODA_OPER_OPTIONS);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E__GUID-15485302-A596-47DF-AC5B-E858DC3C99B4">
                     <p class="titleinexample">Example 3-14 Finding Multiple Documents with Specified
        Document Keys</p>
                     <p>This example finds three documents using their keys.
        The keys and their string lengths, as arrays, and the number of keys (3) are passed to
        function <code class="codeph">OCISodaOperKeysSet()</code>, which sets up the operation-options handle
        appropriately. (You cannot set multiple keys and their lengths using standard function
            <code class="codeph"><span class="bold">OCIAttrSet()</span></code>.) The example then invokes function
          <code class="codeph">OCISodaFind()</code>, passing it the handle.
                     </p>
                     <p>This example
        uses function <code class="codeph">OCISodaFind</code> to find three documents using their keys. The
        keys and their string lengths, as arrays, and the number of keys (3) are passed to function
          <code class="codeph">OCISodaOperKeysSet()</code>, which sets up the operation-options handle with
        this information. (You cannot set multiple keys and their lengths using standard function
            <code class="codeph"><span class="bold">OCIAttrSet()</span></code>.)
                     </p>
                     <div class="infoboxnote" id="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E__GUID-35502A40-A69B-4701-88DC-D2EAA646B16C">
                        <p class="notep1">Note:</p>
                        <p>If you use function <code class="codeph">OCIAttrSet()</code> to set attribute <code class="codeph">OCI_ATTR_SODA_KEY</code> on an operation-options handle, and you also use function <code class="codeph">OCISodaOperKeysSet()</code> to set multiple keys on the same handle, then only the latest of the two settings takes effect. The effect of the first function invoked is overridden by the effect of the second.
                        </p>
                     </div><pre class="pre codeblock"><code>OraText                 *key = NULL;
ub4                      keyLen = 0;
OraText                 *content = NULL;
ub4                      contentLen = 0;
ub4                      findFlags = OCI_DEFAULT;

OraText                 *<span class="bold">keys</span>[3] = {"6B67A10BC6EB4FB7BFA1ECE7E697C507",
                                    "9195598AA9FB4F1CBFA376F35BF78588",
                                    "7FD55EED38BE4F70BF327F8132394E8B"};
ub4                      keyLengths[3];
int                      i = 0;

OCISodaDocCursor        *cursorhp = NULL;
OCISodaDoc              *foundDochp = NULL;
OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// Fill array of key lengths.
for(i=0; i&lt;3; i++)
  <span class="bold">keyLengths</span>[i] = strlen(keys[i]);

// Set keys and their lengths on the operation-options handle.
//
// You <span class="italic">cannot</span> set keys and their lengths using standard function OCIAttrSet().
// Use function OCISodaOperKeysSet().
rc = <span class="bold">OCISodaOperKeysSet</span>(opthp,
                        <span class="bold">keys</span>,
                        <span class="bold">keyLengths</span>,
                        <span class="bold">3</span>,
                        errhp,
                        OCI_DEFAULT);

if (rc != OCI_SUCCESS) goto finally;

// Find documents in collection that match the keys set in operation-options handle.
//
// collhp is an OCISodaColl pointer, representing an open collection.
//
// cursorhp is a OCISodaDocCursor pointer to a returned cursor over the
// resulting document set.
rc = <span class="bold">OCISodaFind</span>(svchp,
                 collhp,
                 opthp,
                 findFlags,
                 &amp;<span class="bold">cursorhp</span>,
                 errhp,
                 OCI_DEFAULT);
if (rc != OCI_SUCCESS) goto finally;

// Fetch each document from the cursor, and its key and content.
while (<span class="bold">OCISodaDocGetNext</span>(svchp,
                         <span class="bold">cursorhp</span>,
                         &amp;<span class="bold">foundDochp</span>,
                         errhp,
                         OCI_DEFAULT)
       == OCI_SUCCESS)
{
  // Get and print components of found document.
  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">key</span>,
                  &amp;keyLen,
                  OCI_ATTR_SODA_<span class="bold">KEY</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Key:</span> %.*s\n", keyLen, key);

  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">content</span>,
                  &amp;contentLen,
                  OCI_ATTR_SODA_<span class="bold">CONTENT</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Content:</span> %.*s \n\n", contentLen, content);

  // <span class="italic">Important:</span> Free the document handle before fetching the next document.
  // This releases memory associated with the current document.
  if (foundDochp)
    (void) OCIHandleFree((dvoid *) foundDochp, OCI_HTYPE_SODA_DOCUMENT);
}

finally: 

// Free all handles
if (cursorhp)
  (void) OCIHandleFree((dvoid *) cursorhp, OCI_HTYPE_SODA_DOC_CURSOR );
if (opthp)
  (void) OCIHandleFree((dvoid *) cursorhp, OCI_HTYPE_SODA_OPER_OPTIONS );
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (foundDochp)
  (void) OCIHandleFree((dvoid *) foundDochp, OCI_HTYPE_SODA_DOCUMENT);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E__GUID-A6F8D524-4C45-4C0E-A3B0-20841A309FE0">
                     <p class="titleinexample">Example 3-15 Finding Documents with a Filter
        Specification</p>
                     <p>Function <code class="codeph">OCISodaFind()</code> provides a
        powerful way to filter JSON documents in a collection. To use it you pass an
        operation-options handle that specifies attribute <code class="codeph">OCI_ATTR_SODA_FILTER</code> as a
        JSON query-by-example (QBE, also called a filter specification).
                     </p>
                     <p>The
        syntax of filter specifications is an expressive pattern-matching language for JSON
        documents. This example uses only a very simple QBE, just to indicate how you make use of
        one in SODA for C.</p>
                     <p>This example sets operation-options handle attribute
          <code class="codeph">OCI_ATTR_SODA_FILTER</code> to a filter that specifies JSON documents whose
          <code class="codeph">name</code> field has value <code class="codeph">"Alexander"</code>. It then uses the
        operation-options handle to find the documents that match that filter. Finally, it prints
        the key and content of each found
      document.
                     </p><pre class="pre codeblock"><code>OraText                 *key = NULL;
ub4                      keyLen = 0;
OraText                 *content = NULL;
ub4                      contentLen = 0;
ub4                      findFlags = OCI_DEFAULT;

OraText                 *<span class="bold">filter</span> = "{ \"name\" : \"Alexander\"}";

OCISodaDocCursor        *cursorhp = NULL;
OCISodaDoc              *foundDochp = NULL;
OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Set the filter</span> (query-by-example, or QBE) on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">filter</span>,
                strlen(filter),
                OCI_ATTR_SODA_<span class="bold">FILTER</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// Find all documents in collection that match filter set in operation-options handle.
//
// collhp is an OCISodaColl pointer, representing an open collection.
//
// cursorhp is a OCISodaDocCursor pointer to a returned cursor over the
// resulting document set.
rc = <span class="bold">OCISodaFind</span>(svchp,
                       collhp,
                       opthp,
                       findFlags,
                       &amp;<span class="bold">cursorhp</span>,
                       errhp,
                       OCI_DEFAULT);
if (rc != OCI_SUCCESS) goto finally;

// Fetch each document from the cursor, and print its key and content.
while (<span class="bold">OCISodaDocGetNext</span>(svchp,
                         <span class="bold">cursorhp</span>,
                         &amp;<span class="bold">foundDochp</span>,
                         errhp,
                         OCI_DEFAULT)
       == OCI_SUCCESS)
{
  // Get and print key and content of found document.
  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">key</span>,
                  &amp;keyLen,
                  OCI_ATTR_SODA_<span class="bold">KEY</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Key:</span> %.*s\n", keyLen, key);

  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">content</span>,
                  &amp;contentLen,
                  OCI_ATTR_SODA_<span class="bold">CONTENT</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Content:</span> %.*s \n\n", contentLen, content);

  // <span class="italic">Important:</span> Free the document handle before fetching next document.
  // This releases memory associated with the current document.
  if (foundDochp)
    (void) OCIHandleFree((dvoid *) foundDochp, OCI_HTYPE_SODA_DOCUMENT);
}

finally:

// Free all handles
if (cursorhp)
  (void) OCIHandleFree((dvoid *) cursorhp, OCI_HTYPE_SODA_DOC_CURSOR );
if (opthp)
  (void) OCIHandleFree((dvoid *) cursorhp, OCI_HTYPE_SODA_OPER_OPTIONS );
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (foundDochp)
  (void) OCIHandleFree((dvoid *) foundDochp, OCI_HTYPE_SODA_DOCUMENT);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E__GUID-25B34304-CC3F-4244-BDF7-2D9AA13DF9A7">
                     <p class="titleinexample">Example 3-16 Finding Documents with a Filter Specification
        and Pagination</p>
                     <p>This example uses function
          <code class="codeph">OCISodaFind()</code> in a pagination query. It passes an operation-options
        handle that specifies attribute <code class="codeph">OCI_ATTR_SODA_FILTER</code> as a QBE, as well as
        attributes <code class="codeph">OCI_ATTR_SODA_SKIP</code> (the number of documents to skip) and
          <code class="codeph">OCI_ATTR_SODA_LIMIT</code> (the maximum number of documents to return). Except
        for specifying pagination (skip and limit) this example is the same as <a href="using-soda-c.html#GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E__GUID-A6F8D524-4C45-4C0E-A3B0-20841A309FE0">Example 3-15</a>.
                     </p><pre class="pre codeblock"><code>OraText                 *key = NULL;
ub4                      keyLen = 0;
OraText                 *content = NULL;
ub4                      contentLen = 0;
ub4                      findFlags = OCI_DEFAULT;

OraText                 *<span class="bold">filter</span> = "{ \"name\" : \"Alexander\"}";
ub4                      <span class="bold">skip</span> = 1000;
ub4                      <span class="bold">limit</span> = 100;

OCISodaDocCursor        *cursorhp = NULL;
OCISodaDoc              *foundDochp = NULL;
OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Set the filter</span> (query-by-example, or QBE) on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">filter</span>,
                strlen(filter),
                OCI_ATTR_SODA_<span class="bold">FILTER</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Set the number of documents to skip</span> on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                &amp;<span class="bold">skip</span>,
                0,
                OCI_ATTR_SODA_<span class="bold">SKIP</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Set the limit of the number of documents to return</span> on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                &amp;<span class="bold">limit</span>,
                0,
                OCI_ATTR_SODA_<span class="bold">LIMIT</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// Find all documents in collection that match filter set in operation-options handle.
// Honor  <span class="italic">skip</span> and <span class="italic">limit</span> values set in the handle.
//
// collhp is an OCISodaColl pointer, representing an open collection.
//
// cursorhp is a OCISodaDocCursor pointer to a returned cursor over the
// resulting document set.
rc = <span class="bold">OCISodaFind</span>(svchp,
                 collhp,
                 opthp,
                 findFlags,
                 &amp;<span class="bold">cursorhp</span>,
                 errhp,
                 OCI_DEFAULT);
if (rc != OCI_SUCCESS) goto finally;

// Fetch each document from the cursor, and print its key and content.
while (<span class="bold">OCISodaDocGetNext</span>(svchp,
                         cursorhp,
                         &amp;<span class="bold">foundDochp</span>,
                         errhp,
                         OCI_DEFAULT)
       == OCI_SUCCESS)
{
  // Get and print components of found document.
  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">key</span>,
                  &amp;keyLen,
                  OCI_ATTR_SODA_<span class="bold">KEY</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Key:</span> %.*s\n", keyLen, key);

  rc = OCIAttrGet((dvoid *) foundDochp,
                  OCI_HTYPE_SODA_DOCUMENT,
                  (dvoid *) &amp;<span class="bold">content</span>,
                  &amp;contentLen,
                  OCI_ATTR_SODA_<span class="bold">CONTENT</span>,
                  errhp);
  if (rc != OCI_SUCCESS) goto finally;
  printf("<span class="bold">Content:</span> %.*s \n\n", contentLen, content);

  // <span class="italic">Important:</span> Free the document handle before fetching the next document.
  // This releases memory associated with the current document.
  if (foundDochp)
    (void) OCIHandleFree((dvoid *) foundDochp, OCI_HTYPE_SODA_DOCUMENT);
}

finally:

// Free all handles
if (cursorhp)
  (void) OCIHandleFree((dvoid *) cursorhp, OCI_HTYPE_SODA_DOC_CURSOR );
if (opthp)
  (void) OCIHandleFree((dvoid *) cursorhp, OCI_HTYPE_SODA_OPER_OPTIONS );
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (foundDochp)
  (void) OCIHandleFree((dvoid *) foundDochp, OCI_HTYPE_SODA_DOCUMENT);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E__GUID-3AAB04CD-A3C6-47E3-A92F-3017342ABAE5">
                     <p class="titleinexample">Example 3-17 Finding a Particular Version of a
        Document</p>
                     <p>This example uses
        function <code class="codeph">OCISodaFindOne()</code> with an operation-options handle that specifies
        the version, as well as the key, of the document to find.
                     </p>
                     <p>When specifying
        the document version you typically specify the key as well. But you can specify the version
        along with a filter, provided the filter specifies at most one document in the
        collection.</p><pre class="pre codeblock"><code>OraText                 *key = NULL;
ub4                      keyLen = 0;
OraText                 *content = NULL;
ub4                      contentLen = 0;
OraText                 *version = NULL;
ub4                      versionLen = 0;
ub4                      findFlags = OCI_DEFAULT;

OraText                 *<span class="bold">inKey</span> = "E914016C41174F6CBF7C877C7F9EB4C2";
OraText                 *<span class="bold">inVersion</span> =
  "7CCEF2F54035DE9A9D64653645DBEF7E61B92142F2E41B3F6144262A5F7BC054";

OCISodaDocCursor        *cursorhp = NULL;
OCISodaDoc              *foundDochp = NULL;
OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Set the key</span> on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">inKey</span>,
                strlen(inKey),
                OCI_ATTR_SODA_<span class="bold">KEY</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Set the version</span> on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">inVersion</span>,
                strlen(inVersion),
                OCI_ATTR_SODA_<span class="bold">VERSION</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Find document that matches key and version</span> set on operation-options handle.
rc = <span class="bold">OCISodaFindOne</span>(svchp,
                          collhp,
                          opthp,
                          findFlags,
                          &amp;<span class="bold">foundDochp</span>,
                          errhp,
                          OCI_DEFAULT);
if (rc != OCI_SUCCESS) goto finally;

// Get the found document and print its key, version, and content.
rc = OCIAttrGet((dvoid *) foundDochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">key</span>,
                &amp;keyLen,
                OCI_ATTR_SODA_<span class="bold">KEY</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Key:</span> %.*s\n", keyLen, key);

rc = OCIAttrGet((dvoid *) foundDochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">version</span>,
                &amp;versionLen,
                OCI_ATTR_SODA_<span class="bold">VERSION</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Version:</span> %.*s\n", versionLen, version);

rc = OCIAttrGet((dvoid *) foundDochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">content</span>,
                &amp;contentLen,
                OCI_ATTR_SODA_<span class="bold">CONTENT</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Content:</span> %.*s \n", contentLen, content);

finally:

// Free all handles
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (foundDochp)
  (void) OCIHandleFree((dvoid *) foundDochp, OCI_HTYPE_SODA_DOCUMENT);
if (opthp)
  (void) OCIHandleFree((dvoid *) opthp, OCI_HTYPE_SODA_OPER_OPTIONS);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-0CD8625C-61DF-4B82-A93E-A3BB6B379A5E__GUID-11A5EBD9-1D62-4CCC-A812-B1DCE521E27B">
                     <p class="titleinexample">Example 3-18 Counting the Number of Documents
        Found</p>
                     <p>This example uses function <code class="codeph">OCISodaDocCount()</code>
        to get a count of all of the documents in a collection that satisfy a given filter
        specification.
                     </p><pre class="pre codeblock"><code>OraText                 *<span class="bold">filter</span> = "{ \"name\" : \"Alexander\"}";
ub8                      count = 0;
OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Set the filter</span> (query-by-example, or QBE) on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">filter</span>,
                strlen(filter),
                OCI_ATTR_SODA_<span class="bold">FILTER</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// Number of documents that match filter set on  operation-options handle is returned as count.
rc = <span class="bold">OCISodaDocCount</span>(svchp,
                     collhp,
                     opthp ,
                     &amp;<span class="bold">count</span>,
                     errhp,
                     OCI_DEFAULT);
if (rc != OCI_SUCCESS) goto finally;
printf ("<span class="bold">Number of matching documents:</span> %d\n", count);

finally:

// Free all handles.
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION );
if (opthp)
  (void) OCIHandleFree((dvoid *) opthp, OCI_HTYPE_SODA_OPER_OPTIONS );
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="using-soda-c.html#GUID-F3435DEA-D0EC-4922-83FF-F51B57CCF542" title="For all read operations, and for write operations other than insertions, you: (1) allocate an operation-options handle, (2) set some of its attributes to specify a particular operation, and (3) pass the handle to a generic function that performs the operation.">SODA for C Read and Write Operations</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6" name="GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6"></a><h3 id="ADSDC-GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6" class="sect3"><span class="enumeration_section">3.11 </span>Replacing Documents in a Collection with
    SODA for C
               </h3>
               <div>
                  <p>You can use function <code class="codeph">OCISodaReplOneAndGet()</code> to replace a
    document in a collection, passing it an operation-options handle that specifies the key of the
    document to replace as well as the new, replacement document. It returns that replacement
    document, but with all of its metadata filled in, as the result document. 
                  </p>
                  <div class="section">
                     <p>Function <code class="codeph">OCISodaReplOne()</code> is the same as
          <code class="codeph">OCISodaReplOneAndGet()</code>, except that it does not return the result
        document with completed metadata.
                     </p>
                     <p>These are the most generic
        document-replacement functions. There are also other, convenience functions for more
        specific use cases.</p>
                     <p>You can use these convenience functions if only the
        document <span class="italic">content</span> is to be replaced. Instead of passing them a replacement document,
        you pass just the new (JSON) content as a textual argument.
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">OCISodaReplOneAndGetWith<span class="bold">Ctnt</span>()</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">OCISodaReplOneWith<span class="bold">Ctnt</span>()</code></p>
                        </li>
                     </ul>
                     <p>You can use these convenience functions if only the document <span class="italic">key</span> is
        to be specified. Instead of passing them an operation-options handle, you pass just the
        replacement document and the key of the document to replace. This means that you cannot
        specify a filter, document version, and so on.
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">OCISodaReplOneAndGetWith<span class="bold">Key</span>()</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">OCISodaReplOneWith<span class="bold">Key</span>()</code></p>
                        </li>
                     </ul>
                     <p>The functions with <code class="codeph">AndGet</code> in their
        name return the new (result) document as the value of the same parameter that was used for
        the input document, so you can get its components.
                     </p>
                     <p>Whichever replacement
        function you use, it returns a Boolean value as output parameter
        <code class="codeph">isReplaced</code>, indicating whether the replacement operation was
        successful.
                     </p>
                     <div class="infoboxnotealso" id="GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6__WHATXREFISNEEDEDNEEDXREFORACLEDATAB-14C5C87A">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaReplOne()</code></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaReplOneAndGet()</code></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaReplOneWithCtnt()</code></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaReplOneAndGetWithCtnt()</code></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-76BE9730-EC37-4DBC-A4CE-2B09A96E5C40" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaReplOneWithKey()</code></p>
                           </li>
                           <li>
                              <p><a href="../lnoci/oci-SODA-functions-listed.html#LNOCI-GUID-21A05CA9-47E6-44F9-901E-25F29C5B31F9" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function
                <code class="codeph">OCISodaReplOneAndGetWithKey()</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6__REPLACINGADOCUMENTINACOLLECTIONGIVE-14C5A9D0">
                     <p class="titleinexample">Example 3-19 Replacing a Document in a Collection,
        Given Its Key, and Getting the Result
        Document</p>
                     <p>This example creates a new document as a replacement for the document with UUID
        key <code class="codeph">"3C03C00FA3904FC2BF5182C424A2C6C1"</code>. It uses OCI function
          <code class="codeph">OCISodaReplOneAndGet()</code> to replace the document having that key, and it
        gets the result document. 
                     </p>
                     <p>It uses function <code class="codeph">OCIAttrGet()</code>
        to retrieve various components from the result document, which it prints. The use of mode
        parameter <code class="codeph">OCI_SODA_ATOMIC_COMMIT</code> ensures that the replacement and any other
        outstanding operations are
      committed.
                     </p><pre class="pre codeblock"><code>OCISodaDoc              *dochp = NULL;
OCISodaDoc              *tempDochp = NULL;

// Document content: JSON data
char                     <span class="bold">documentContent</span>[30] = "{\"name\":\"LiLing\"}";
ub4                      docFlags = OCI_DEFAULT;

OraText                 *key = NULL;
ub4                      keyLen = 0;
OraText                 *content = NULL;
ub4                      contentLen = 0;
OraText                 *version = NULL;
ub4                      versionLen = 0;
OraText                 *lastModified = NULL;
ub4                      lastModifiedLen = 0;
OraText                 *mediaType = NULL;
ub4                      mediaTypeLen = 0;
OraText                 *createdOn = NULL;
ub4                      createdOnLen = 0;
boolean                  isReplaced = FALSE;

OCISodaOperationOptions *opthp;
OraText                 *<span class="bold">inKey</span> = "3C03C00FA3904FC2BF5182C424A2C6C1";

// Create a temporary replacement document, which has documentContent as its content.
rc = <span class="bold">OCISodaDocCreate</span>(envhp,
                      documentContent,
                      (ub4) strlen(documentContent),
                      docFlags,
                      &amp;<span class="bold">dochp</span>,
                      errhp,
                      OCI_DEFAULT);
if (rc != OCI_SUCCESS)
{
  printf("OCISodaDocCreate failed\n");
  goto finally;
}

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// Set the document-key attribute on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">inKey</span>,
                strlen(inKey),
                <span class="bold">OCI_ATTR_SODA_KEY</span>,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// OCISodaReplOneAndGet returns the result document as dochp, so
// <span class="italic">before calling it we save a pointer, tempDochp</span>, to the handle that
// was returned by OCISodaDocCreate.  Later we free tempDochp.
<span class="bold">tempDochp</span> = dochp;

// Replace the document that has the key set in the operation-options
// handle with the new, replacement document pointed to by dochp, and
// get back the result document.
//
// The <span class="italic">result document</span> has the <span class="italic">content</span> of the replacement
// document, but it <span class="italic">also has all of the other document components</span>,
// automatically populated by SODA when the replacement document was inserted.
rc = <span class="bold">OCISodaReplOneAndGet</span>(svchp,
                          collhp,
                          opthp,
                          &amp;<span class="bold">dochp</span>,
                          &amp;<span class="bold">isReplaced</span>,
                          errhp,
                          <span class="bold">OCI_SODA_ATOMIC_COMMIT</span>);
if (rc != OCI_SUCCESS) goto finally;

if (isReplaced) printf ("<span class="bold">Document was replaced.</span>\n");

// Get and print the components of the document after replacement.
rc = OCIAttrGet((dvoid *) dochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">key</span>,
                &amp;keyLen,
                OCI_ATTR_SODA_KEY,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Key:</span> %.*s\n", keyLen, key);

rc = OCIAttrGet((dvoid *) dochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">version</span>,
                &amp;versionLen,
                OCI_ATTR_SODA_VERSION,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Version:</span> %.*s\n", versionLen, version);

rc = OCIAttrGet((dvoid *) dochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">lastModified</span>,
                &amp;lastModifiedLen,
                OCI_ATTR_SODA_LASTMOD_TIMESTAMP,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Last-modified:</span> %.*s\n", lastModifiedLen, lastModified);

rc = OCIAttrGet((dvoid *) dochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">createdOn</span>,
                &amp;createdOnLen,
                OCI_ATTR_SODA_CREATE_TIMESTAMP,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Created:</span> %.*s\n", createdOnLen, createdOn);

rc = OCIAttrGet((dvoid *) dochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">mediaType</span>,
                &amp;mediaTypeLen,
                OCI_ATTR_SODA_MEDIA_TYPE,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Media Type:</span> %.*s\n", mediaTypeLen, mediaType);

finally:

// Release the session and free all handles, including the handle of the temporary document.
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (dochp)
  (void) OCIHandleFree((dvoid *) dochp, OCI_HTYPE_SODA_DOCUMENT);
if (opthp)
  (void) OCIHandleFree((dvoid *) opthp, OCI_HTYPE_SODA_OPER_OPTIONS);
if (tempDochp)
  (void) OCIHandleFree((dvoid *) <span class="bold">tempDochp</span>, OCI_HTYPE_SODA_DOCUMENT);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6__GUID-1D50D5BD-AFDB-4CD1-85D1-B5E8218193AE">
                     <p class="titleinexample">Example 3-20 Replacing a Particular Version of a
        Document</p>
                     <p>To implement optimistic locking when replacing a document,
        you can specify both key and version, as in this
      example.</p><pre class="pre codeblock"><code>OCISodaDoc              *dochp = NULL;
OCISodaDoc              *tempDochp = NULL;

// Document content: JSON data
char                     <span class="bold">documentContent</span>[30] = "{\"name\":\"Esmeralda\"}";
ub4                      docFlags = OCI_DEFAULT;

OraText                 *key = NULL;
ub4                      keyLen = 0;
OraText                 *content = NULL;
ub4                      contentLen = 0;
OraText                 *version = NULL;
ub4                      versionLen = 0;
boolean                  isReplaced = FALSE;

OCISodaOperationOptions *opthp;

OraText                 *<span class="bold">inKey</span> = "3C03C00FA3904FC2BF5182C424A2C6C1";
OraText                 *<span class="bold">inVersion</span> =
  "BD0A8E86428FFD68A00FAE7833B41404637EE0A31791B36EC4C78A5782272448";

// Create a temporary replacement document, which has documentContent as its content.
rc = OCISodaDocCreate(envhp,
                      documentContent,
                      (ub4) strlen(documentContent),
                      docFlags,
                      &amp;dochp,
                      errhp,
                      OCI_DEFAULT);
if (rc != OCI_SUCCESS)
{
  printf("OCISodaDocCreate failed\n");
  goto finally;
}

// Allocate an empty operation options handle
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Set the key</span> of the document we want to replace on the operation options handle
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">inKey</span>, 
                strlen(inKey),
                OCI_ATTR_SODA_KEY,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Set the version</span> of the document we want to replace on the operation options handle
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">inVersion</span>,
                strlen(inVersion),
                OCI_ATTR_SODA_VERSION,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// OCISodaReplOneAndGet returns the result document as dochp, so
// <span class="italic">before calling it we save a pointer, tempDochp</span>, to the handle that
// was returned by OCISodaDocCreate.  Later we free tempDochp.
<span class="bold">tempDochp</span> = dochp;

// Replace the document that has the key and version set in the
// operation-options handle with the new, replacement document pointed
// to by dochp, and get back the result document.
//
// The <span class="italic">result document</span> has the <span class="italic">content</span> of the replacement
// document, but it also has all of the other document components,
// automatically populated by SODA when the replacement document was inserted.
rc = <span class="bold">OCISodaReplOneAndGet</span>(svchp,
                          collhp,
                          opthp,
                          &amp;dochp,
                          &amp;isReplaced,
                          errhp,
                          <span class="bold">OCI_SODA_ATOMIC_COMMIT</span>);
if (rc != OCI_SUCCESS) goto finally;

if (isReplaced) printf ("<span class="bold">Document was replaced.</span>\n");

// Get and print the components of found document after replacement.
rc = OCIAttrGet((dvoid *) dochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">key</span>,
                &amp;keyLen,
                OCI_ATTR_SODA_KEY,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Key:</span> %.*s\n", keyLen, key);

rc = OCIAttrGet((dvoid *) dochp,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">version</span>,
                &amp;versionLen,
                OCI_ATTR_SODA_VERSION,
                errhp);
if (rc != OCI_SUCCESS) goto finally;
printf("<span class="bold">Version:</span> %.*s\n", versionLen, version);

finally:

// Release the session and free all handles, including handle of the temporary document.
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (dochp)
  (void) OCIHandleFree((dvoid *) dochp, OCI_HTYPE_SODA_DOCUMENT);
if (opthp)
  (void) OCIHandleFree((dvoid *) opthp, OCI_HTYPE_SODA_OPER_OPTIONS);
if (tempDochp)
  (void) OCIHandleFree((dvoid *) <span class="bold">tempDochp</span>, OCI_HTYPE_SODA_DOCUMENT);
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="using-soda-c.html#GUID-F3435DEA-D0EC-4922-83FF-F51B57CCF542" title="For all read operations, and for write operations other than insertions, you: (1) allocate an operation-options handle, (2) set some of its attributes to specify a particular operation, and (3) pass the handle to a generic function that performs the operation.">SODA for C Read and Write Operations</a></li>
                        <li><a href="using-soda-c.html#GUID-53A1F8DB-72A9-46E4-B90D-0A8E338E133F" title="You can handle individual read and write operations, or groups of them, as a database transaction.">Handling Transactions with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-F92DF544-ED19-466F-BC05-192246ECEE3E" title="To drop a document collection, use OCI function OCISodaCollDrop().">Dropping a Document Collection with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6" title="Various ways to insert a document into a SODA collection are described.">Inserting Documents into Collections with SODA for C</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE" name="GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE"></a><h3 id="ADSDC-GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE" class="sect3"><span class="enumeration_section">3.12 </span>Removing Documents from a Collection with SODA for C
               </h3>
               <div>
                  <p>To remove a document from a collection you can use function <code class="codeph">OCISodaRemove()</code>, passing it an operation-options handle. If you only want to remove one document, specified by its key, then you can alternatively use convenience function <code class="codeph">OCISodaRemoveOneWithKey()</code>. It does not require an operation-options handle — you pass it the key directly.
                  </p>
                  <div class="section">
                     <p>Whichever document-removal function you use, the function returns the number of documents removed as an out parameter.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE__WHATXREFISNEEDEDNEEDXREFFORINFORMAT-14C635E1">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../lnoci/index.html" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaRemove()</code></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=LNOCI-GUID-18F97A89-BF78-4406-9212-574E95ACF1B6" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaRemoveOneWithKey()</code></p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE__REMOVINGADOCUMENTFROMACOLLECTIONUSI-14C626BA">
                     <p class="titleinexample">Example 3-21 Removing a Document from a Collection Using a Document Key</p>
                     <p>This example removes the document with UUID key <code class="codeph">"E914016C41174F6CBF7C877C7F9EB4C2"</code>. The use of mode parameter <code class="codeph">OCI_SODA_ATOMIC_COMMIT</code> ensures that the removal and any other outstanding operations are committed.
                     </p><pre class="pre codeblock"><code>OraText                 *inKey = "E914016C41174F6CBF7C877C7F9EB4C2";
ub8                      removeCount = 0;

OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// Set the document-key attribute on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">inKey</span>,
                strlen(inKey),
                OCI_ATTR_SODA_KEY,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// Remove the document that has the key set in the operation-options handle.
rc = =OCISodaRemove(svchp,
                    collhp,
                    opthp,
                    &amp;<span class="bold">removeCount</span>,
                    errhp,
                    <span class="bold">OCI_SODA_ATOMIC_COMMIT</span>);
if (rc != OCI_SUCCESS) goto finally;

if (removeCount &gt; 0)
  printf("<span class="bold">Successfully removed document.</span>\n");
else
  printf("<span class="bold">Document with specified key was not found.</span>\n");

finally:

// Free all handles.
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (opthp)
  (void) OCIHandleFree((dvoid *) opthp, OCI_HTYPE_SODA_OPER_OPTIONS);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE__GUID-39C7BBC4-B5B6-4612-9DC4-FF872B2AD1DE">
                     <p class="titleinexample">Example 3-22 Removing a Particular Version of a Document</p>
                     <p>This example uses function <code class="codeph">OCISodaRemove()</code> with an operation-options handle that specifies the version, as well as the key, of the document to remove. This is useful for implementing optimistic locking, for write operations.
                     </p>
                     <p>When specifying the document version you typically specify the key as well. But you can specify the version along with a filter, provided the filter specifies at most one document in the collection.</p><pre class="pre codeblock"><code>ub8                      removeCount = 0;

OraText                 *<span class="bold">inKey</span> = "0C6132FC780D4F16BF9561FC9E2B4F98";
OraText                 *<span class="bold">inVersion</span> =
  "7CCEF2F54035DE9A9D64653645DBEF7E61B92142F2E41B3F6144262A5F7BC054";

OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle,
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// Set the document-key attribute on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">inKey</span>,
                strlen(inKey),
                OCI_ATTR_SODA_KEY, 
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// Set the document-version attribute on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">inVersion</span>,
                strlen(inVersion),
                OCI_ATTR_SODA_VERSION,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// Remove document that has the key and version set in the operation-options handle.
rc = <span class="bold">OCISodaRemove</span>(svchp,
                   collhp,
                   opthp,
                   &amp;<span class="bold">removeCount</span>,
                   errhp,
                   <span class="bold">OCI_SODA_ATOMIC_COMMIT</span>);
if (rc != OCI_SUCCESS) goto finally;

if (removeCount &gt; 0)
  printf("<span class="bold">Successfully removed document.</span>\n");
else
  printf("<span class="bold">Document with specified key was not found.</span>\n");

finally:

// Free all handles.
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (opthp)
  (void) OCIHandleFree((dvoid *) opthp, OCI_HTYPE_SODA_OPER_OPTIONS);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE__GUID-164570C7-61A6-49E4-80AC-6B9F8E570986">
                     <p class="titleinexample">Example 3-23 Removing Documents from a Collection Using Document Keys</p>
                     <p>This example uses function <code class="codeph">OCISodaOperKeysSet()</code> to set operation-options handle attributes for key and key length for two documents. It then invokes function <code class="codeph">OCISodaRemove()</code> to remove the documents that have those keys. Function <code class="codeph">OCISodaOperKeysSet()</code> accepts an array of keys, an array of the corresponding key lengths, and the number of keys as arguments. (You cannot set multiple keys and their lengths using standard function <code class="codeph"><span class="bold">OCIAttrSet()</span></code>.)
                     </p>
                     <div class="infoboxnote" id="GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE__GUID-2F6930FF-DC39-4668-829D-960590E06385">
                        <p class="notep1">Note:</p>
                        <p>If you use function <code class="codeph">OCIAttrSet()</code> to set attribute <code class="codeph">OCI_ATTR_SODA_KEY</code> on an operation-options handle, and you also use function <code class="codeph">OCISodaOperKeysSet()</code> to set multiple keys on the same handle, then only the latest of the two settings takes effect. The effect of the first function invoked is overridden by the effect of the second.
                        </p>
                     </div><pre class="pre codeblock"><code>OraText                 *<span class="bold">keys[2]</span> = {"ACF8C4BDA3E44F4CBF802C9708D00C10",
                                    "787B22133B254F0CBF2DB9975E277913"};

ub4                      <span class="bold">keyLengths[2]</span>;
ub8                      removeCount = 0;
int                      i = 0;

OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// Fill array of key lengths.
for(i=0; i&lt;2; i++)
  <span class="bold">keyLengths</span>[i] = strlen(keys[i]);

// Set keys and key lengths on operation-options handle.
rc = <span class="bold">OCISodaOperKeysSet</span>(opthp,
                        <span class="bold">keys</span>,
                        <span class="bold">keyLengths</span>,
                        <span class="bold">2</span>,
                        errhp,
                        OCI_DEFAULT);
if (rc != OCI_SUCCESS) goto finally;

// Remove documents matching the keys in the operation options handle.
rc = <span class="bold">OCISodaRemove</span>(svchp,
                   collhp,
                   opthp,
                   &amp;<span class="bold">removeCount</span>,
                   errhp,
                   OCI_SODA_ATOMIC_COMMIT);
if (rc != OCI_SUCCESS) goto finally;

if (removeCount &gt; 0)
  printf("<span class="bold">Successfully removed %d documents.</span>\n", removeCount);
else
  printf("<span class="bold">Document with specified keys were not found.</span>\n");

finally:

// Free all handles.
if (opthp)
  (void) OCIHandleFree((dvoid *) opthp, OCI_HTYPE_SODA_OPER_OPTIONS);
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-F3C144A6-7F15-4ABC-AE0E-5C962C5A7AFE__GUID-FB5F7ADF-6C49-4D05-B8DB-AF216EB78545">
                     <p class="titleinexample">Example 3-24 Removing JSON Documents from a Collection Using a Filter</p>
                     <p>This example uses a filter to remove the JSON documents whose <code class="codeph">greeting</code> field has value <code class="codeph">"hello"</code>. It then prints the number of documents removed.
                     </p><pre class="pre codeblock"><code>ub8                      removeCount = 0;
OraText                 *<span class="bold">filter</span> = "{\"greeting\" : \"hello\"}";
OCISodaOperationOptions *opthp;

// Allocate an empty operation-options handle.
rc = OCIHandleAlloc((void *) envhp, (void **)&amp;opthp,
                    OCI_HTYPE_SODA_OPER_OPTIONS, (size_t) 0,
                    (dvoid **) 0);
if (rc != OCI_SUCCESS) goto finally;

// <span class="italic">Set the filter</span> (query-by-example, or QBE) on the operation-options handle.
rc = OCIAttrSet(opthp,
                OCI_HTYPE_SODA_OPER_OPTIONS,
                <span class="bold">filter</span>,
                strlen(filter),
                OCI_ATTR_SODA_FILTER,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// Remove documents matching the filter (QBE) set in operation-options handle.
rc = <span class="bold">OCISodaRemove</span>(svchp,
                   collhp,
                   opthp,
                   &amp;<span class="bold">removeCount</span>,
                   errhp,
                   <span class="bold">OCI_SODA_ATOMIC_COMMIT</span>);
if (rc != OCI_SUCCESS) goto finally;

if (removeCount &gt; 0)
  printf("<span class="bold">Successfully removed %d documents.\n</span>", removeCount);
else
  printf("<span class="bold">No documents matching the filter were found.</span>\n");

finally:

//Free all handles.
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (opthp)
  (void) OCIHandleFree((dvoid *) opthp, OCI_HTYPE_SODA_OPER_OPTIONS);
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="using-soda-c.html#GUID-F3435DEA-D0EC-4922-83FF-F51B57CCF542" title="For all read operations, and for write operations other than insertions, you: (1) allocate an operation-options handle, (2) set some of its attributes to specify a particular operation, and (3) pass the handle to a generic function that performs the operation.">SODA for C Read and Write Operations</a></li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-5F6ED443-F775-4529-BEE9-93D84062D90F" name="GUID-5F6ED443-F775-4529-BEE9-93D84062D90F"></a><h3 id="ADSDC-GUID-5F6ED443-F775-4529-BEE9-93D84062D90F" class="sect3"><span class="enumeration_section">3.13 </span>Indexing the Documents in a Collection with SODA for C
               </h3>
               <div>
                  <p>Indexing can improve the performance of QBEs. To index the documents in a SODA collection, use function <code class="codeph">OCISodaIndexCreate()</code>, passing it a textual JSON <span class="italic">index specification</span>. This can specify support for B-tree, spatial, full-text, and ad hoc indexing, and it can specify support for a JSON data guide.
                  </p>
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>A B-tree index is used to index particular scalar JSON fields.</p>
                        </li>
                        <li>
                           <p>An Oracle Spatial and Graph index is used to index GeoJSON (spatial) data.</p>
                        </li>
                        <li>
                           <p>A JSON search index can improve the performance of:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>QBEs that you might not anticipate or use regularly — it is a general purpose index.</p>
                              </li>
                              <li>
                                 <p>QBEs that use operator <code class="codeph">$contains</code> — full-text search.
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>A JSON search index can also provide persistent recording and automatic updating of JSON data-guide information. </p>
                        </li>
                     </ul>
                     <p> If a JSON search index is defined, and if a B-tree index or a spatial index applies to a given QBE, the B-tree or spatial index is generally used for that QBE, in preference to the (more general) search index.</p>
                     <p>The invocation of function <code class="codeph">OCISodaIndexCreate()</code> is the same for each kind of index you create. The only difference is the index specification that is passed to the function as an argument.
                     </p>
                     <p>You drop an index on a SODA collection using function <code class="codeph">OCISodaIndexDrop()</code>, passing it the index name.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-5F6ED443-F775-4529-BEE9-93D84062D90F__ORACLEDATABASEINTRODUCTIONTOSIMPLEO-C86B1FF5">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=LNOCI-GUID-7CE795A6-4C96-4956-9567-BA23AAF0C97F" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaIndexCreate()</code></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=LNOCI-GUID-61F13F0C-D7AD-468D-AAC7-17851106E571" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCISodaIndexDrop()</code></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=ADSDI-GUID-4848E6A0-58A7-44FD-8D6D-A033D0CCF9CB" target="_blank"><span><cite>Oracle Database Introduction to Simple Oracle Document Access (SODA)</cite></span></a> for an overview of using SODA indexing
                              </p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=ADSDI-GUID-00C06941-6FFD-4CEB-81B6-9A7FBD577A2C" target="_blank"><span><cite>Oracle Database Introduction to Simple Oracle Document Access (SODA)</cite></span></a> for information about SODA index specifications
                              </p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=ADJSN-GUID-D7A604E1-F617-4C92-A9D9-00B6AB78EFD8" target="_blank"><span><cite>Oracle Database JSON Developer’s Guide</cite></span></a> for information about JSON search indexes
                              </p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=ADJSN-GUID-E77948CB-DCA0-4733-8832-4B5F00C01A2E" target="_blank"><span><cite>Oracle Database JSON Developer’s Guide</cite></span></a> for information about persistent data-guide information as part of a JSON search index
                              </p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=ADJSN-GUID-2AD827B4-871E-4652-87F3-AC33FE7839AE" target="_blank"><span><cite>Oracle Database JSON Developer’s Guide</cite></span></a> for information about spatial indexing of GeoJSON data.
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-5F6ED443-F775-4529-BEE9-93D84062D90F__INDEXINGAJSONFIELDWITHSODAFORC-D1B8E18C">
                     <p class="titleinexample">Example 3-25 Creating a B-Tree Index for a JSON Field with SODA for C</p>
                     <p>This example creates a B-tree non-unique index for numeric field <code class="codeph">address.zip</code> of the JSON documents in a collection that has handle <code class="codeph">collhp</code>. A B-tree index specification can be recognized by the presence of field <code class="codeph">fields</code>.
                     </p><pre class="pre codeblock"><code>// Index specification for B-tree index on field address.zip.
OraText *<span class="bold">indexSpec</span> = "{\"name\" : \"ZIPCODE_IDX\", \
                       \"<span class="bold">fields</span>\" : [{\"path\" : \"<span class="bold">address.zip</span>\", \
                                      \"datatype\" : \"<span class="bold">number</span>\", \
                                      \"order\" : \"asc\"}]}";

// Create the index.
rc = <span class="bold">OCISodaIndexCreate</span>(svchp, collhp, <span class="bold">indexSpec</span>, strlen(indexSpec), errhp, OCI_DEFAULT);
</code></pre></div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-5F6ED443-F775-4529-BEE9-93D84062D90F__CREATINGAJSONSEARCHINDEXWITHSODAFOR-D5618E93">
                     <p class="titleinexample">Example 3-26 Creating a JSON Search Index with SODA for C</p>
                     <p>This example indexes the documents in a collection that has handle <code class="codeph">collhp</code> for ad hoc queries and full-text search (QBEs that use operator <code class="codeph">$contains</code>), and it automatically accumulates and updates data-guide information about your JSON documents (aggregate structural and type information). The index specification has only field <code class="codeph">name</code> (no field <code class="codeph">fields</code>).
                     </p><pre class="pre codeblock"><code>// Index specification for JSON search index.
OraText *<span class="bold">indexSpec</span> = "{\"name\" : \"SEARCH_AND_DATA_GUIDE_IDX\"}";

// Create the index.
rc = <span class="bold">OCISodaIndexCreate</span>(svchp, collhp, <span class="bold">indexSpec</span>, strlen(indexSpec), errhp, OCI_DEFAULT);
</code></pre><p>The simple index specification it uses is equivalent to this one, which makes explicit the default values:</p><pre class="pre codeblock"><code>{"name" : "SEARCH_AND_DATA_GUIDE_IDX",
 "dataguide" : "on",
 "search_on" : "text_value"}</code></pre><p>If you instead wanted <span class="italic">only ad hoc</span> indexing then you would explicitly specify a value of <code class="codeph">"off"</code> for field <code class="codeph">dataguide</code>. If you instead wanted <span class="italic">only data-guide</span> support then you would explicitly specify a value of <code class="codeph">"none"</code> for field <code class="codeph">search_on</code>.
                     </p>
                     <div class="infoboxnote" id="GUID-5F6ED443-F775-4529-BEE9-93D84062D90F__GUID-3425903F-645D-4E76-9CDF-241950DDD701">
                        <p class="notep1">Note:</p>
                        <p>To create a data
                guide-enabled JSON search index, or to data guide-enable an existing JSON search
                index, you need database privilege <code class="codeph">CTXAPP</code> and Oracle Database
                Release 12c (12.2.0.1) or later.
                        </p>
                     </div>
                  </div>
                  <!-- class="example" -->
                  <div class="example" id="GUID-5F6ED443-F775-4529-BEE9-93D84062D90F__DROPPINGANINDEXWITHSODAFORC-D1C1AF04">
                     <p class="titleinexample">Example 3-27 Dropping an Index with SODA for C</p>
                     <p>To drop an index on a SODA collection, just pass the index name to function <code class="codeph">OCISodaIndexDrop()</code>. This example drops index <code class="codeph">ZIPCODE_IDX</code>.
                     </p><pre class="pre codeblock"><code>boolean isDropped = FALSE;

// Drop the index named ZIPCODE_IDX.
rc = <span class="bold">OCISodaIndexDrop</span>(svchp,
                      "<span class="bold">ZIPCODE_IDX</span>",
                      strlen("ZIPCODE_IDX"),
                      &amp;isDropped,
                      errhp,
                      OCI_DEFAULT);

printf ("isDropped %d\n", isDropped);
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-80CC6F4E-FB19-4336-B407-1CF46B1CD3CD" name="GUID-80CC6F4E-FB19-4336-B407-1CF46B1CD3CD"></a><h3 id="ADSDC-GUID-80CC6F4E-FB19-4336-B407-1CF46B1CD3CD" class="sect3"><span class="enumeration_section">3.14 </span>Getting a Data Guide for a Collection with SODA for C
               </h3>
               <div>
                  <p>You use function <code class="codeph">OCISodaDataGuideGet()</code> to get a data guide for a collection. A data guide is a JSON document that summarizes the structural and type information of the JSON documents in the collection. It records metadata about the fields used in those documents.
                  </p>
                  <div class="section">
                     <p>Before you can obtain a data guide for your collection you must create a data guide-enabled JSON search index on it.<a href="using-soda-c.html#GUID-5F6ED443-F775-4529-BEE9-93D84062D90F__CREATINGAJSONSEARCHINDEXWITHSODAFOR-D5618E93">Example 3-26</a> shows how to do that.
                     </p>
                     <div class="infoboxnotealso" id="GUID-80CC6F4E-FB19-4336-B407-1CF46B1CD3CD__GUID-786D4686-9660-421A-A7B2-81952AD46F89">
                        <p class="notep1">See Also:</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=LNOCI-GUID-DF3D928D-0DDF-4D04-A0B4-1608D53A1F57" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">CISodaDataGuideGet()</code></p>
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-80CC6F4E-FB19-4336-B407-1CF46B1CD3CD__GUID-FEBB152E-AA68-4284-B15B-6AF261B0570C">
                     <p class="titleinexample">Example 3-28 Getting a Data Guide with SODA for Java</p>
                     <p>This example gets a data guide for a collection with collection handle <code class="codeph">collhp</code>, using function <code class="codeph">OCISodaDataGuideGet()</code>. It then prints the content of the data-guide document.
                     </p><pre class="pre codeblock"><code>OCISodaDoc  *dochp = NULL;
OraText     *content = NULL;
ub4          contentLen = 0;

// Get the data guide based on the JSON search index defined on the collection.
// dochp is the handle for the data-guide document.
rc = <span class="bold">OCISodaDataGuideGet</span>(svchp,
                         collhp,
                         OCI_DEFAULT,
                         &amp;<span class="bold">dochp</span>,
                         errhp,
                         OCI_DEFAULT);
if (rc != OCI_SUCCESS) goto finally;

rc = OCIAttrGet((dvoid *) <span class="bold">dochp</span>,
                OCI_HTYPE_SODA_DOCUMENT,
                (dvoid *) &amp;<span class="bold">content</span>,
                &amp;contentLen,
                OCI_ATTR_SODA_CONTENT,
                errhp);
if (rc != OCI_SUCCESS) goto finally;

// Print the content of the data-guide document.
printf("<span class="bold">Data guide:</span> %.*s \n", contentLen, <span class="bold">content</span>);

finally:

//Free all handles.
if (collhp)
  (void) OCIHandleFree((dvoid *) collhp, OCI_HTYPE_SODA_COLLECTION);
if (dochp)
  (void) OCIHandleFree((dvoid *) dochp, OCI_HTYPE_SODA_OPER_OPTIONS);
</code></pre></div>
                  <!-- class="example" -->
               </div>
               <div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="sect2"><a id="GUID-53A1F8DB-72A9-46E4-B90D-0A8E338E133F" name="GUID-53A1F8DB-72A9-46E4-B90D-0A8E338E133F"></a><h3 id="ADSDC-GUID-53A1F8DB-72A9-46E4-B90D-0A8E338E133F" class="sect3"><span class="enumeration_section">3.15 </span>Handling Transactions with SODA for C
               </h3>
               <div>
                  <p>You can handle individual read and write operations, or groups of them, as a database transaction. </p>
                  <div class="section">
                     <p>You do this in <span class="italic">either</span> of these ways:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Use execution mode parameter <code class="codeph"><span class="bold">OCI_SODA_ATOMIC_COMMIT</span></code> when you invoke a SODA operation. If an operation is executed in this mode and it completes successfully then the current transaction is committed after completion. 
                           </p>
                           <p>As is usual for a commit, this commits <span class="italic">all</span> outstanding changes, not just changes made by the SODA operation. However, if the operation <span class="italic">fails</span> then <span class="italic">only changes made by the SODA operation are rolled back</span>; any uncommitted changes made prior to invocation of the SODA operation are not rolled back.
                           </p>
                        </li>
                        <li>
                           <p>Use function <code class="codeph">OCITransCommit()</code> or <code class="codeph">OCITransRollback()</code>, to commit or roll back, respectively, the current transaction. These are standard Oracle Call Interface (OCI) functions; they are not SODA-specific.
                           </p>
                        </li>
                     </ul>
                     <p>SODA operations of creating and dropping a collection do <span class="italic">not</span> automatically commit before or after they perform their action. (This differs from the behavior of SQL DDL statements, which commit both before and after performing their action.) 
                     </p>
                     <p>One consequence of this is that, <span class="italic">before a SODA collection can be dropped</span>, any outstanding write operations to it must be committed or rolled back. This is because function &nbsp;<code class="codeph">OCISodaCollDrop()</code>&nbsp;does not itself commit before it performs its action.&nbsp;In this, its behavior&nbsp;differs from that of a SQL&nbsp;<code class="codeph">DROP TABLE</code> statement.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section"></div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="using-soda-c.html#GUID-F92DF544-ED19-466F-BC05-192246ECEE3E" title="To drop a document collection, use OCI function OCISodaCollDrop().">Dropping a Document Collection with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-3111C13E-2809-44EC-B618-80D4CF1E0CA6" title="Various ways to insert a document into a SODA collection are described.">Inserting Documents into Collections with SODA for C</a></li>
                        <li><a href="using-soda-c.html#GUID-25680AEE-1D25-4FF5-803D-7A500A9F2DF6" title="You can use function OCISodaReplOneAndGet() to replace a document in a collection, passing it an operation-options handle that specifies the key of the document to replace as well as the new, replacement document. It returns that replacement document, but with all of its metadata filled in, as the result document.">Replacing Documents in a Collection with SODA for C</a></li>
                     </ul>
                  </div>
                  <div class="infoboxnotealso" id="GUID-53A1F8DB-72A9-46E4-B90D-0A8E338E133F__NOTE-1421-14C3AE44">
                     <p class="notep1">See Also:</p>
                     <ul style="list-style-type: disc;">
                        <li></li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=LNOCI-GUID-D0833EAB-53AA-47C3-8302-C4C58410E347" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about execution mode parameter <code class="codeph">OCI_SODA_ATOMIC_COMMIT</code></p>
                        </li>
                        <li>
                           <p><a href="../lnoci/managing-scalable-platforms.html#LNOCI-GUID-3E96017A-64D3-4A29-B617-C9879610B5F2" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about Oracle Call Interface (OCI) support for transactions
                           </p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/adsdc&amp;id=LNOCI-GUID-DDAE3122-8769-4A30-8D78-EB2A3CCF77D4" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCITransCommit()</code></p>
                        </li>
                        <li>
                           <p><a href="../lnoci/transaction-functions.html#LNOCI-GUID-06EF9A0A-01A3-40CE-A0B7-DF0504A93366" target="_blank"><span><cite>Oracle Call Interface Programmer's Guide</cite></span></a> for information about OCI function <code class="codeph">OCITransRollback()</code></p>
                        </li>
                     </ul>
                  </div>
                  <div class="familylinks">
                     <div class="parentlink">
                        <p><strong>Parent topic:</strong> <a href="using-soda-c.html#GUID-EE1AAE5A-5BBA-40BE-A199-37F9D687AE90" title="How to access SODA for C is described, as well as how to use it to perform create, read (retrieve), update, and delete (CRUD) operations on collections. CRUD operations are also called “read and write operations” in this document.">Using SODA for C</a></p>
                     </div>
                  </div>
               </div>
               
            </div>
            <hr><br><p style="text-decoration:underline">Footnote Legend</p>Footnote&nbsp;1: The handle is freed here immediately, just as a reminder to free it when you are done with it (the same as any other handle). In practice you would make use of the handle in some way before freeing it.<br></div>
      </article>
   </body>
</html>