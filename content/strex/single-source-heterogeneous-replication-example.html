<!DOCTYPE html
  SYSTEM "about:legacy-compat">

<!-- saved from url=(0023)https://docs.oracle.com -->

<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Single-Source Heterogeneous Replication&nbsp;Example</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Extended Examples ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Extended Examples">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.1.1">
      <link rel="alternate" href="streams-extended-examples.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-01-24T22:39:34-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2008, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E83782-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      <meta name="dcterms.release" content="Release 18">
      <link rel="prev" href="simple-single-source-replication-example.html" title="Previous" type="text/html">
      <link rel="next" href="n-way-replication-example.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Streams Extended Examples">
    <meta name="dcterms.isVersionOf" content="STREX">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="simple-single-source-replication-example.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="n-way-replication-example.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Extended Examples </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Single-Source Heterogeneous Replication&nbsp;Example</li>
            </ol>
            <a id="GUID-DE33395B-8597-455F-BC92-7040422686C7" name="GUID-DE33395B-8597-455F-BC92-7040422686C7"></a><a id="STREX003"></a>
            
            <h2 id="STREX-GUID-DE33395B-8597-455F-BC92-7040422686C7" class="sect2"><span class="enumeration_chapter">2 </span> Single-Source Heterogeneous Replication&nbsp;Example
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d2443e48" class="indexterm-anchor"></a><a id="d2443e54" class="indexterm-anchor"></a>This chapter illustrates an example of a single-source heterogeneous replication environment that can be constructed using Oracle Streams, as well as the tasks required to add new objects and databases to such an environment.
               </p>
               <p>This chapter contains these topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="single-source-heterogeneous-replication-example.html#GUID-17FB11BA-4EF3-4238-82A0-CA712739B0BF">Overview of the Single-Source Heterogeneous Replication Example</a></p>
                  </li>
                  <li>
                     <p><a href="single-source-heterogeneous-replication-example.html#GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9">Prerequisites</a></p>
                  </li>
                  <li>
                     <p><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482">Create Queues and Database Links</a></p>
                  </li>
                  <li>
                     <p><a href="single-source-heterogeneous-replication-example.html#GUID-40AD270B-4EC1-41CF-AF2E-67383BFD657B">Example Scripts for Sharing Data from One Database</a></p>
                  </li>
                  <li>
                     <p><a href="single-source-heterogeneous-replication-example.html#GUID-55D3343C-9184-46EB-BD04-9AE07771AE47">Make DML and DDL Changes to Tables in the hr Schema</a></p>
                  </li>
                  <li>
                     <p><a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282">Add Objects to an Existing Oracle Streams Replication Environment</a></p>
                  </li>
                  <li>
                     <p><a href="single-source-heterogeneous-replication-example.html#GUID-1CE0338C-A42A-4CF6-82B4-3062E2308092">Make a DML Change to the hr.employees Table</a></p>
                  </li>
                  <li>
                     <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7">Add a Database to an Existing Oracle Streams Replication Environment</a></p>
                  </li>
                  <li>
                     <p><a href="single-source-heterogeneous-replication-example.html#GUID-46179B80-26A4-4655-A1B4-AE9A9D540923">Make a DML Change to the hr.departments Table</a></p>
                  </li>
               </ul>
            </div><a id="STREX551"></a><a id="STREX550"></a><div class="props_rev_3"><a id="GUID-17FB11BA-4EF3-4238-82A0-CA712739B0BF" name="GUID-17FB11BA-4EF3-4238-82A0-CA712739B0BF"></a><h3 id="STREX-GUID-17FB11BA-4EF3-4238-82A0-CA712739B0BF" class="sect3"><span class="enumeration_section">2.1 </span>Overview of the Single-Source Heterogeneous Replication Example
               </h3>
               <div>
                  <p>This example illustrates using Oracle Streams to replicate data between four databases. The environment is heterogeneous because three of the databases are Oracle databases and one is a Sybase database. DML and DDL changes made to tables in the <code class="codeph">hr</code> schema at the <code class="codeph">dbs1.example.com</code> Oracle database are captured and propagated to the other two Oracle databases. Only DML changes are captured and propagated to the <code class="codeph">dbs4.example.com</code> database, because an apply process cannot apply DDL changes to a non-Oracle database. Changes to the <code class="codeph">hr</code> schema occur only at <code class="codeph">dbs1.example.com</code>. The <code class="codeph">hr</code> schema is read-only at the other databases in the environment. 
                  </p>
                  <p><a href="single-source-heterogeneous-replication-example.html#GUID-17FB11BA-4EF3-4238-82A0-CA712739B0BF__i1006138">Figure 2-1</a> provides an overview of the environment.
                  </p>
                  <div class="figure" id="GUID-17FB11BA-4EF3-4238-82A0-CA712739B0BF__i1006138">
                     <p class="titleinfigure">Figure 2-1 Sample Environment that Shares Data from a Single Source Database</p><img width="569" src="img/strex002.gif" alt="Description of Figure 2-1 follows" title="Description of Figure 2-1 follows" longdesc="img_text/strex002.html"><br><a href="img_text/strex002.html">Description of "Figure 2-1 Sample Environment that Shares Data from a Single Source Database"</a></div>
                  <!-- class="figure" -->
                  <p>As illustrated in <a href="single-source-heterogeneous-replication-example.html#GUID-17FB11BA-4EF3-4238-82A0-CA712739B0BF__i1006138">Figure 2-1</a>, <code class="codeph">dbs1.example.com</code> contains the following tables in the <code class="codeph">hr</code> schema:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">countries</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">departments</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">employees</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">job_history</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">jobs</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">locations</code></p>
                     </li>
                     <li>
                        <p><code class="codeph">regions</code></p>
                     </li>
                  </ul>
                  <p>This example uses directed networks, which means that captured changes at a source database are propagated to another database through one or more intermediate databases. Here, the <code class="codeph">dbs1.example.com</code> database propagates changes to the <code class="codeph">dbs3.example.com</code> database through the intermediate database <code class="codeph">dbs2.example.com</code>. This configuration is an example of queue forwarding in a directed network. Also, the <code class="codeph">dbs1.example.com</code> database propagates changes to the <code class="codeph">dbs2.example.com</code> database, which applies the changes directly to the <code class="codeph">dbs4.example.com</code> database through an Oracle Database Gateway. 
                  </p>
                  <p>Some of the databases in the environment do not have certain tables. If the database is not an intermediate database for a table and the database does not contain the table, then changes to the table do not need to be propagated to that database. For example, the <code class="codeph">departments</code>, <code class="codeph">employees</code>, <code class="codeph">job_history</code>, and <code class="codeph">jobs</code> tables do not exist at <code class="codeph">dbs3.example.com</code>. Therefore, <code class="codeph">dbs2.example.com</code> does not propagate changes to these tables to <code class="codeph">dbs3.example.com</code>. 
                  </p>
                  <p>In this example, Oracle Streams is used to perform the following series of actions:</p>
                  <ol>
                     <li>
                        <p>The capture process captures DML and DDL changes for all of the tables in the <code class="codeph">hr</code> schema and enqueues them at the <code class="codeph">dbs1.example.com</code> database. In this example, changes to only four of the seven tables are propagated to destination databases, but in the example that illustrates <span class="q">"<a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282">Add Objects to an Existing Oracle Streams Replication Environment</a>"</span>, the remaining tables in the <code class="codeph">hr</code> schema are added to a destination database.
                        </p>
                     </li>
                     <li>
                        <p>The <code class="codeph">dbs1.example.com</code> database propagates these changes in the form of messages to a queue at <code class="codeph">dbs2.example.com</code>. 
                        </p>
                     </li>
                     <li>
                        <p>At <code class="codeph">dbs2.example.com</code>, DML changes to the <code class="codeph">jobs</code> table are transformed into DML changes for the <code class="codeph">assignments</code> table (which is a direct mapping of <code class="codeph">jobs</code>) and then applied. Changes to other tables in the <code class="codeph">hr</code> schema are not applied at&nbsp;<code class="codeph">dbs2.example.com</code>.
                        </p>
                     </li>
                     <li>
                        <p>Because the queue at <code class="codeph">dbs3.example.com</code> receives changes from the queue at <code class="codeph">dbs2.example.com</code> that originated in <code class="codeph">countries</code>, <code class="codeph">locations</code>, and <code class="codeph">regions</code> tables at <code class="codeph">dbs1.example.com</code>, these changes are propagated from <code class="codeph">dbs2.example.com</code> to <code class="codeph">dbs3.example.com</code>. This configuration is an example of directed networks.
                        </p>
                     </li>
                     <li>
                        <p>The apply process at <code class="codeph">dbs3.example.com</code> applies changes to the <code class="codeph">countries</code>, <code class="codeph">locations</code>, and <code class="codeph">regions</code> tables.
                        </p>
                     </li>
                     <li>
                        <p>Because <code class="codeph">dbs4.example.com</code>, a Sybase database, receives changes from the queue at <code class="codeph">dbs2.example.com</code> to the <code class="codeph">jobs</code> table that originated at <code class="codeph">dbs1.example.com</code>, these changes are applied remotely from <code class="codeph">dbs2.example.com</code> using the <code class="codeph">dbs4.example.com</code> database link through an Oracle Database Gateway. This configuration is an example of heterogeneous support.
                        </p>
                     </li>
                  </ol>
               </div>
            </div><a id="STREX552"></a><div class="props_rev_3"><a id="GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9" name="GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9"></a><h3 id="STREX-GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9" class="sect3"><span class="enumeration_section">2.2 </span>Prerequisites
               </h3>
               <div>
                  <p>The following prerequisites must be completed before you begin the example in this chapter.</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a id="d2443e440" class="indexterm-anchor"></a><a id="d2443e444" class="indexterm-anchor"></a><a id="d2443e446" class="indexterm-anchor"></a>Set the following initialization parameters to the values indicated for all databases in the environment:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">GLOBAL_NAMES</code>: This parameter must be set to <code class="codeph">TRUE</code> at each database that is participating in your Oracle Streams environment. 
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">COMPATIBLE</code>: This parameter must be set to <code class="codeph">10.2.0</code> or higher. 
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">STREAMS_POOL_SIZE</code>: Optionally set this parameter to an appropriate value for each database in the environment. This parameter specifies the size of the Oracle Streams pool. The Oracle Streams pool stores messages in a buffered queue and is used for internal communications during parallel capture and apply. When the <code class="codeph">MEMORY_TARGET</code>, <code class="codeph">MEMORY_MAX_TARGET</code>, or <code class="codeph">SGA_TARGET</code> initialization parameter is set to a nonzero value, the Oracle Streams pool size is managed automatically.
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9__GUID-F1120A2F-9046-4AAC-B3FD-A7A1ACF23D1F">
                           <p class="notep1">See Also:</p>
                           <p><a href="../strep/preparing-for-oracle-streams-replication.html#STREP201"><span class="italic">Oracle Streams Replication Administrator's Guide </span></a>for information about other initialization parameters that are important in an Oracle Streams environment
                           </p>
                        </div>
                     </li>
                     <li>
                        <p><a id="d2443e489" class="indexterm-anchor"></a><a id="d2443e493" class="indexterm-anchor"></a>Any database producing changes that will be captured must be running in <code class="codeph">ARCHIVELOG</code> mode. In this example, changes are produced at <code class="codeph">dbs1.example.com</code>, and so <code class="codeph">dbs1.example.com</code> must be running in <code class="codeph">ARCHIVELOG</code> mode.
                        </p>
                        <div class="infoboxnotealso" id="GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9__GUID-9BB2F296-3A16-44E4-9227-4813946F0627">
                           <p class="notep1">See Also:</p>
                           <p><a href="../admin/managing-archived-redo-log-files.html#ADMIN008"><span class="italic">Oracle Database Administrator's Guide </span></a>for information about running a database in <code class="codeph">ARCHIVELOG</code> mode
                           </p>
                        </div>
                     </li>
                     <li>
                        <p>Configure an Oracle Database Gateway on <code class="codeph">dbs2.example.com</code> to communicate with the Sybase database <code class="codeph">dbs4.example.com</code>.
                        </p>
                        <div class="infoboxnotealso" id="GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9__GUID-9F56D6FA-1010-4D60-8B76-AB62A72DB397">
                           <p class="notep1">See Also:</p>
                           <p><a href="../heter/toc.htm"><span class="italic">Oracle Database Heterogeneous Connectivity User's Guide</span></a></p>
                        </div>
                     </li>
                     <li>
                        <p>At the Sybase database <code class="codeph">dbs4.example.com</code>, set up the <code class="codeph">hr</code> user.
                        </p>
                        <div class="infoboxnotealso" id="GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9__GUID-933A893B-CACA-4C5C-A257-ABC135B7C254">
                           <p class="notep1">See Also:</p>
                           <p>Your Sybase documentation for information about creating users and tables in your Sybase database</p>
                        </div>
                     </li>
                     <li>
                        <p>Instantiate the <code class="codeph">hr.jobs</code> table from the <code class="codeph">dbs1.example.com</code> Oracle database at the <code class="codeph">dbs4.example.com</code> Sybase database.
                        </p>
                        <div class="infoboxnotealso" id="GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9__GUID-4F3800B9-83C8-45D6-B7F8-8B7A7459DE9F">
                           <p class="notep1">See Also:</p>
                           <p><a href="../strep/oracle-streams-heterogeneous-information-sharing.html#STREP106"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
                        </div>
                     </li>
                     <li>
                        <p>Configure your network and Oracle Net so that the following databases can communicate with each other:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">dbs1.example.com</code> and <code class="codeph">dbs2.example.com</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">dbs2.example.com</code> and <code class="codeph">dbs3.example.com</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">dbs2.example.com</code> and <code class="codeph">dbs4.example.com</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">dbs3.example.com</code> and <code class="codeph">dbs1.example.com</code> (for optional Data Pump network instantiation)
                              </p>
                              <div class="infoboxnotealso" id="GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9__GUID-C25DA690-4251-4461-9E38-A0B150A271FA">
                                 <p class="notep1">See Also:</p>
                                 <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strex&amp;id=NETAG"><span class="italic">Oracle Database Net Services Administrator's Guide</span></a></p>
                              </div>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Create an Oracle Streams administrator at each Oracle database in the replication environment. In this example, the databases are <code class="codeph">dbs1.example.com</code>, <code class="codeph">dbs2.example.com</code>, and <code class="codeph">dbs3.example.com</code>. This example assumes that the user name of the Oracle Streams administrator is <code class="codeph">strmadmin</code>.
                        </p>
                        <div class="infoboxnotealso" id="GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9__GUID-6A21B566-24B7-4593-93DA-B691107D9DB9">
                           <p class="notep1">See Also:</p>
                           <p><a href="../strep/preparing-for-oracle-streams-replication.html#STREP200"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a> for instructions about creating an Oracle Streams administrator
                           </p>
                        </div>
                     </li>
                  </ul>
               </div>
            </div><a id="STREX1194"></a><a id="STREX1195"></a><a id="STREX1196"></a><a id="STREX1197"></a><a id="STREX1198"></a><a id="STREX1199"></a><a id="STREX1200"></a><a id="STREX1201"></a><a id="STREX1202"></a><a id="STREX1203"></a><a id="STREX553"></a><div class="props_rev_3"><a id="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482" name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482"></a><h3 id="STREX-GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482" class="sect3"><span class="enumeration_section">2.3 </span>Create Queues and Database Links
               </h3>
               <div>
                  <div class="section">
                     <p>Complete the following steps to create queues and database links for an Oracle Streams replication environment that includes three Oracle databases and one Sybase database:</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__GUID-3820DA7B-DDE3-45AF-88F8-182A89B6F80C">"Show Output and Spool Results"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFBIJAF">"Create the ANYDATA Queue at dbs1.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFEIBFJ">"Create the Database Link at dbs1.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFBHJFI">"Create the ANYDATA Queue at dbs2.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFDDFBI">"Create the Database Links at dbs2.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFBBDHE">"Create the hr.assignments Table at dbs2.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFFFGFH">"Create the ANYDATA Queue at dbs3.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFDDFBI">"Create the Database Links at dbs2.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFGBHDJ">"Drop All of the Tables in the hr Schema at dbs3.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFGGEEF">"Check the Spool Results"</a></span></li>
                  </ol>
                  <div class="section">
                     <p></p>
                     <div class="infoboxnote" id="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__GUID-DC5F4900-4A84-4B1D-8EC4-7DAB3ED23235">
                        <p class="notep1">Note:</p>
                        <p>If you are viewing this document online, then you can copy the text from the "BEGINNING OF SCRIPT" line after this note to the next "END OF SCRIPT" line into a text editor and then edit the text to create a script for your environment. Run the script with SQL*Plus on a computer that can connect to all of the databases in the environment.</p>
                     </div><pre class="oac_no_warn" dir="ltr">/************************* BEGINNING OF SCRIPT ******************************</pre><dl>
                        <dt><strong></strong></dt>
                        <dt class="dlterm"><a name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__GUID-3820DA7B-DDE3-45AF-88F8-182A89B6F80C">
                              <!-- --></a><span class="bold">Show Output and Spool Results</span></dt>
                        <dd>
                           <p>Run <code class="codeph">SET</code> <code class="codeph">ECHO</code> <code class="codeph">ON</code> and specify the spool file for the script. Check the spool file for errors after you run this script.
                           </p><pre class="oac_no_warn" dir="ltr">*/

SET ECHO ON
SPOOL streams_setup_single.out

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFBIJAF">
                              <!-- --></a><span>Create the ANYDATA Queue at dbs1.example.com</span></dt>
                        <dd>
                           <p>Connect as the Oracle Streams administrator at the database where you want to capture changes. In this example, that database is <code class="codeph">dbs1.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

CONNECT strmadmin@dbs1.example.com

/*
</pre><p>Run the <code class="codeph">SET_UP_QUEUE</code> procedure to create a queue named <code class="codeph">streams_queue</code> at <code class="codeph">dbs1.example.com</code>. This queue will function as the <code class="codeph">ANYDATA</code> queue by holding the captured changes that will be propagated to other databases.
                           </p>
                           <p>Running the <code class="codeph">SET_UP_QUEUE</code> procedure performs the following actions:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Creates a queue table named <code class="codeph">streams_queue_table</code>. This queue table is owned by the Oracle Streams administrator (<code class="codeph">strmadmin</code>) and uses the default storage of this user.
                                 </p>
                              </li>
                              <li>
                                 <p>Creates a queue named <code class="codeph">streams_queue</code> owned by the Oracle Streams administrator (<code class="codeph">strmadmin</code>).
                                 </p>
                              </li>
                              <li>
                                 <p>Starts the queue.</p>
                              </li>
                           </ul>
                           <p></p><pre class="oac_no_warn" dir="ltr">*/

EXEC DBMS_STREAMS_ADM.SET_UP_QUEUE();

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFEIBFJ">
                              <!-- --></a><span>Create the Database Link at dbs1.example.com</span></dt>
                        <dd>
                           <p>Create the database link from the database where changes are captured to the database where changes are propagated. In this example, the database where changes are captured is <code class="codeph">dbs1.example.com</code>, and these changes are propagated to&nbsp;<code class="codeph">dbs2.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

ACCEPT password PROMPT 'Enter password for user: ' HIDE

CREATE DATABASE LINK dbs2.example.com CONNECT TO strmadmin 
   IDENTIFIED BY &amp;password USING 'dbs2.example.com';

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFBHJFI">
                              <!-- --></a><span>Create the ANYDATA Queue at dbs2.example.com</span></dt>
                        <dd>
                           <p>Connect as the Oracle Streams administrator at <code class="codeph">dbs2.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

CONNECT strmadmin@dbs2.example.com

/*
</pre><p>Run the <code class="codeph">SET_UP_QUEUE</code> procedure to create a queue named <code class="codeph">streams_queue</code> at <code class="codeph">dbs2.example.com</code>. This queue will function as the <code class="codeph">ANYDATA</code> queue by holding the changes that will be applied at this database and the changes that will be propagated to other databases.
                           </p>
                           <p>Running the <code class="codeph">SET_UP_QUEUE</code> procedure performs the following actions:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Creates a queue table named <code class="codeph">streams_queue_table</code>. This queue table is owned by the Oracle Streams administrator (<code class="codeph">strmadmin</code>) and uses the default storage of this user.
                                 </p>
                              </li>
                              <li>
                                 <p>Creates a queue named <code class="codeph">streams_queue</code> owned by the Oracle Streams administrator (<code class="codeph">strmadmin</code>).
                                 </p>
                              </li>
                              <li>
                                 <p>Starts the queue.</p>
                              </li>
                           </ul>
                           <p></p><pre class="oac_no_warn" dir="ltr">*/

EXEC  DBMS_STREAMS_ADM.SET_UP_QUEUE();

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFDDFBI">
                              <!-- --></a><span>Create the Database Links at dbs2.example.com</span></dt>
                        <dd>
                           <p>Create the database links to the databases where changes are propagated. In this example, database <code class="codeph">dbs2.example.com</code> propagates changes to <code class="codeph">dbs3.example.com</code>, which is another Oracle database, and to <code class="codeph">dbs4.example.com</code>, which is a Sybase database. Notice that the database link to the Sybase database connects to the owner of the tables, not to the Oracle Streams administrator. This database link can connect to any user at <code class="codeph">dbs4.example.com</code> that has privileges to change the <code class="codeph">hr.jobs</code> table at that database.
                           </p>
                           <div class="infoboxnote" id="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__GUID-D790BA1A-8F12-4D3F-B7E4-B7E857596DE5">
                              <p class="notep1">Note:</p>
                              <p>On some non-Oracle databases, including Sybase, you must ensure that the characters in the user name and password are in the correct case. Therefore, double quotation marks are specified for the user name and password at the Sybase database.</p>
                           </div><pre class="oac_no_warn" dir="ltr">*/

CREATE DATABASE LINK dbs3.example.com CONNECT TO strmadmin 
   IDENTIFIED BY &amp;password USING 'dbs3.example.com';

CREATE DATABASE LINK dbs4.example.com CONNECT TO "hr" 
   IDENTIFIED BY "&amp;password" USING 'dbs4.example.com';

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFBBDHE">
                              <!-- --></a><span>Create the hr.assignments Table at dbs2.example.com</span></dt>
                        <dd>
                           <p>This example illustrates a custom rule-based transformation in which changes to the <code class="codeph">hr.jobs</code> table at <code class="codeph">dbs1.example.com</code> are transformed into changes to the <code class="codeph">hr.assignments</code> table at <code class="codeph">dbs2.example.com</code>. You must create the <code class="codeph">hr.assignments</code> table on <code class="codeph">dbs2.example.com</code> for the transformation portion of this example to work properly.
                           </p>
                           <div class="infoboxnote" id="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__GUID-A0751D1C-8FFA-449A-90EC-9A93B3EF91C3">
                              <p class="notep1">Note:</p>
                              <p>Instead of using a custom rule-based transformation to change the name of the table, you can use a <code class="codeph">RENAME_TABLE</code> declarative rule-based transformation. See <a href="../strms/rule-based-transformations.html#STRMS151"><span class="italic">Oracle Streams Concepts and Administration</span></a>.
                              </p>
                           </div>
                           <p>Connect as hr at <code class="codeph">dbs2.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

CONNECT hr@dbs2.example.com

/*
</pre><p>Create the <code class="codeph">hr.assignments</code> table in the <code class="codeph">dbs2.example.com</code> database. 
                           </p><pre class="oac_no_warn" dir="ltr">*/

CREATE TABLE hr.assignments AS SELECT * FROM hr.jobs;

ALTER TABLE hr.assignments ADD PRIMARY KEY (job_id);

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFFFGFH">
                              <!-- --></a><span>Create the ANYDATA Queue at dbs3.example.com</span></dt>
                        <dd>
                           <p>Connect as the Oracle Streams administrator at <code class="codeph">dbs3.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

CONNECT strmadmin@dbs3.example.com

/*
</pre><p>Run the <code class="codeph">SET_UP_QUEUE</code> procedure to create a queue named <code class="codeph">streams_queue</code> at <code class="codeph">dbs3.example.com</code>. This queue will function as the <code class="codeph">ANYDATA</code> queue by holding the changes that will be applied at this database.
                           </p>
                           <p>Running the <code class="codeph">SET_UP_QUEUE</code> procedure performs the following actions:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Creates a queue table named <code class="codeph">streams_queue_table</code>. This queue table is owned by the Oracle Streams administrator (<code class="codeph">strmadmin</code>) and uses the default storage of this user.
                                 </p>
                              </li>
                              <li>
                                 <p>Creates a queue named <code class="codeph">streams_queue</code> owned by the Oracle Streams administrator (<code class="codeph">strmadmin</code>).
                                 </p>
                              </li>
                              <li>
                                 <p>Starts the queue.</p>
                              </li>
                           </ul>
                           <p></p><pre class="oac_no_warn" dir="ltr">*/

EXEC  DBMS_STREAMS_ADM.SET_UP_QUEUE();

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__GUID-3D3DC8AA-24BB-4132-BD75-5D5676083F11">
                              <!-- --></a><span>Create a Database Link at dbs3.example.com to dbs1.example.com</span></dt>
                        <dd>
                           <p>Create a database link from <code class="codeph">dbs3.example.com</code> to <code class="codeph">dbs1.example.com</code>. Later in this example, this database link is used for the instantiation of some of the database objects that were dropped in Step <a href="single-source-heterogeneous-replication-example.html#GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFGBHDJ">"Drop All of the Tables in the hr Schema at dbs3.example.com"</a>. This example uses the <code class="codeph">DBMS_DATAPUMP</code> package to perform a network import of these database objects directly from the <code class="codeph">dbs1.example.com</code> database. Because this example performs a network import, no dump file is required.
                           </p>
                           <p>Alternatively, you can perform an export at the source database <code class="codeph">dbs1.example.com</code>, transfer the export dump file to the destination database <code class="codeph">dbs3.example.com</code>, and then import the export dump file at the destination database. In this case, the database link created in this step is not required.
                           </p><pre class="oac_no_warn" dir="ltr">*/

CREATE DATABASE LINK dbs1.example.com CONNECT TO strmadmin 
   IDENTIFIED BY &amp;password USING 'dbs1.example.com';

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFGBHDJ">
                              <!-- --></a><span>Drop All of the Tables in the hr Schema at dbs3.example.com</span></dt>
                        <dd>
                           <p>This example illustrates instantiating tables in the <code class="codeph">hr</code> schema by importing them from <code class="codeph">dbs1.example.com</code> into <code class="codeph">dbs3.example.com</code> with Data Pump. You must delete these tables at <code class="codeph">dbs3.example.com</code> for the instantiation portion of this example to work properly.
                           </p>
                           <p>Connect as <code class="codeph">hr</code> at <code class="codeph">dbs3.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

CONNECT hr@dbs3.example.com

/*
</pre><p>Drop all tables in the <code class="codeph">hr</code> schema in the <code class="codeph">dbs3.example.com</code> database. 
                           </p>
                           <div class="infoboxnote" id="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__GUID-220CAD6E-0140-4CEB-AE38-B32E83707EAA">
                              <p class="notep1">Note:</p>
                              <p>If you complete this step and drop all of the tables in the <code class="codeph">hr</code> schema, then you should complete the remaining sections of this example to reinstantiate the <code class="codeph">hr</code> schema at <code class="codeph">dbs3.example.com</code>. If the <code class="codeph">hr</code> schema does not exist in an Oracle database, then some examples in the Oracle documentation set can fail.
                              </p>
                           </div><pre class="oac_no_warn" dir="ltr">*/

DROP TABLE hr.countries CASCADE CONSTRAINTS;
DROP TABLE hr.departments CASCADE CONSTRAINTS;
DROP TABLE hr.employees CASCADE CONSTRAINTS;
DROP TABLE hr.job_history CASCADE CONSTRAINTS;
DROP TABLE hr.jobs CASCADE CONSTRAINTS;
DROP TABLE hr.locations CASCADE CONSTRAINTS;
DROP TABLE hr.regions CASCADE CONSTRAINTS;

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-7E700F48-93E4-4FC5-8F55-7DD01A265482__CJFGGEEF">
                              <!-- --></a><span>Check the Spool Results</span></dt>
                        <dd>
                           <p>Check the <code class="codeph">streams_setup_single.out</code> spool file to ensure that all actions finished successfully after this script is completed.
                           </p><pre class="oac_no_warn" dir="ltr">*/

SET ECHO OFF
SPOOL OFF

/*************************** END OF SCRIPT ******************************/</pre></dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STREX554"></a><div class="props_rev_3"><a id="GUID-40AD270B-4EC1-41CF-AF2E-67383BFD657B" name="GUID-40AD270B-4EC1-41CF-AF2E-67383BFD657B"></a><h3 id="STREX-GUID-40AD270B-4EC1-41CF-AF2E-67383BFD657B" class="sect3"><span class="enumeration_section">2.4 </span>Example Scripts for Sharing Data from One Database
               </h3>
               <div>
                  <p>This example illustrates two ways to accomplish the replication of the tables in the <code class="codeph">hr</code> schema using Oracle Streams.
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><span class="q">"<a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E">Simple Configuration for Sharing Data from a Single Database</a>"</span> demonstrates a simple way to configure the environment. This example uses the <code class="codeph">DBMS_STREAMS_ADM</code> package to create a capture process, propagations, and apply processes, as well as the rule sets associated with them. Using the <code class="codeph">DBMS_STREAMS_ADM</code> package is the simplest way to configure an Oracle Streams environment.
                        </p>
                     </li>
                     <li>
                        <p><span class="q">"<a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28">Flexible Configuration for Sharing Data from a Single Database</a>"</span> demonstrates a more flexible way to configure this environment. This example uses the <code class="codeph">DBMS_CAPTURE_ADM</code> package to create a capture process, the <code class="codeph">DBMS_PROPAGATION_ADM</code> package to create propagations, and the <code class="codeph">DBMS_APPLY_ADM</code> package to create apply processes. Also, this example uses the <code class="codeph">DBMS_RULES_ADM</code> package to create and populate the rule sets associated with these capture processes, propagations, and apply processes. Using these packages, instead of the <code class="codeph">DBMS_STREAMS_ADM</code> package, provides more configuration options and flexibility.
                        </p>
                        <div class="infoboxnote" id="GUID-40AD270B-4EC1-41CF-AF2E-67383BFD657B__GUID-FDC02D77-12FB-418B-8D52-59C0E5B1D6BB">
                           <p class="notep1">Note:</p>
                           <p>These examples illustrate two different ways to configure the same Oracle Streams environment. Therefore, you should run only one of the examples for a particular distributed database system. Otherwise, errors stating that objects already exist will result.</p>
                        </div>
                     </li>
                  </ul>
               </div><a id="STREX1204"></a><a id="STREX1205"></a><a id="STREX1206"></a><a id="STREX1207"></a><a id="STREX1208"></a><a id="STREX1209"></a><a id="STREX1210"></a><a id="STREX1211"></a><a id="STREX1212"></a><a id="STREX1213"></a><a id="STREX1214"></a><a id="STREX1215"></a><a id="STREX1216"></a><a id="STREX1217"></a><a id="STREX1218"></a><a id="STREX1219"></a><a id="STREX1220"></a><a id="STREX1221"></a><a id="STREX1222"></a><a id="STREX555"></a><div class="props_rev_3"><a id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E" name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E"></a><h4 id="STREX-GUID-31B023BA-4C18-4899-9B21-F260C7F2842E" class="sect4"><span class="enumeration_section">2.4.1 </span>Simple Configuration for Sharing Data from a Single Database
                  </h4>
                  <div>
                     <div class="section">
                        <p>Complete the following steps to specify the capture, propagation, and apply definitions using primarily the <code class="codeph">DBMS_STEAMS_ADM</code> package.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__GUID-44C1B5AD-507F-4C45-9A06-D2C7FACEF175">"Show Output and Spool Results"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFFJJHD">"Configure Propagation at dbs1.example.com"</a></span></li>
                        <li id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFBEBJF"><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFDDFCE">"Configure the Capture Process at dbs1.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFDCEDE">"Set the Instantiation SCN for the Existing Tables at Other Databases"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFDCDIB">"Instantiate the dbs1.example.com Tables at dbs3.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFFBEDG">"Configure the Apply Process at dbs3.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFHFFDG">"Specify hr as the Apply User for the Apply Process at dbs3.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFEDFGH">"Grant the hr User Execute Privilege on the Apply Process Rule Set"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFJCICF">"Start the Apply Process at dbs3.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFEGFHA">"Configure Propagation at dbs2.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFBIBBH">"Create the Custom Rule-Based Transformation for Row LCRs at dbs2.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFDJGAG">"Configure the Apply Process for Local Apply at dbs2.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFGBFHD">"Specify hr as the Apply User for the Apply Process at dbs2.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFJJCIC">"Grant the hr User Execute Privilege on the Apply Process Rule Set"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFGGJDH">"Start the Apply Process at dbs2.example.com for Local Apply"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFEACAG">"Configure the Apply Process at dbs2.example.com for Apply at dbs4.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFGCFEE">"Start the Apply Process at dbs2.example.com for Apply at dbs4.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFCHABB">"Start the Capture Process at dbs1.example.com"</a></span></li>
                        <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFHJAGI">"Check the Spool Results"</a></span></li>
                     </ol>
                     <div class="section">
                        <p></p>
                        <div class="infoboxnote" id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__GUID-F44F01D5-47F1-492A-BF4D-8F7B719B5CBD">
                           <p class="notep1">Note:</p>
                           <p>If you are viewing this document online, then you can copy the text from the "BEGINNING OF SCRIPT" line after this note to the next "END OF SCRIPT" line into a text editor and then edit the text to create a script for your environment. Run the script with SQL*Plus on a computer that can connect to all of the databases in the environment.</p>
                        </div><pre class="oac_no_warn" dir="ltr">/************************* BEGINNING OF SCRIPT ******************************</pre><dl id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__i1112704">
                           <dt><strong></strong></dt>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__GUID-44C1B5AD-507F-4C45-9A06-D2C7FACEF175">
                                 <!-- --></a>Show Output and Spool Results
                           </dt>
                           <dd>
                              <p>Run <code class="codeph">SET</code> <code class="codeph">ECHO</code> <code class="codeph">ON</code> and specify the spool file for the script. Check the spool file for errors after you run this script.
                              </p><pre class="oac_no_warn" dir="ltr">*/

SET ECHO ON
SPOOL streams_share_schema1.out

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFFJJHD">
                                 <!-- --></a>Configure Propagation at dbs1.example.com
                           </dt>
                           <dd>
                              <p>Connect to <code class="codeph">dbs1.example.com</code> as the <code class="codeph">strmadmin</code> user.
                              </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs1.example.com

/*
</pre><p>Configure and schedule propagation of DML and DDL changes in the <code class="codeph">hr</code> schema from the queue at <code class="codeph">dbs1.example.com</code> to the queue at <code class="codeph">dbs2.example.com</code>. 
                              </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_STREAMS_ADM.ADD_SCHEMA_PROPAGATION_RULES(
&nbsp;&nbsp;&nbsp; schema_name             =&gt; 'hr', 
&nbsp;&nbsp; &nbsp;streams_name            =&gt; 'dbs1_to_dbs2', 
&nbsp;&nbsp; &nbsp;source_queue_name       =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; destination_queue_name  =&gt; 'strmadmin.streams_queue@dbs2.example.com',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;        &nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp;         =&gt; TRUE,
    source_database         =&gt; 'dbs1.example.com',
    inclusion_rule          =&gt; TRUE,
    queue_to_queue          =&gt; TRUE);
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFDDFCE">
                                 <!-- --></a>Configure the Capture Process at dbs1.example.com
                           </dt>
                           <dd>
                              <p>Configure the capture process to capture changes to the entire <code class="codeph">hr</code> schema at <code class="codeph">dbs1.example.com</code>. This step specifies that changes to the tables in the specified schema are captured by the capture process and enqueued into the specified queue.
                              </p>
                              <p>This step also prepares the <code class="codeph">hr</code> schema for instantiation and enables supplemental logging for any primary key, unique key, bitmap index, and foreign key columns in the tables in this schema. Supplemental logging places additional information in the redo log for changes made to tables. The apply process needs this extra information to perform certain operations, such as unique row identification and conflict resolution. Because <code class="codeph">dbs1.example.com</code> is the only database where changes are captured in this environment, it is the only database where you must specify supplemental logging for the tables in the <code class="codeph">hr</code> schema.
                              </p>
                              <div class="infoboxnotealso" id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__GUID-B2E2235C-6518-4379-BB4B-8B9A03C1953C">
                                 <p class="notep1">See Also:</p>
                                 <p><a href="../strep/preparing-for-oracle-streams-replication.html#STREP107"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
                              </div><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_STREAMS_ADM.ADD_SCHEMA_RULES(
    schema_name    =&gt; 'hr',   
    streams_type   =&gt; 'capture',
    streams_name   =&gt; 'capture',
    queue_name     =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;=&gt; TRUE, 
    include_ddl &nbsp;&nbsp; =&gt; TRUE,
    inclusion_rule =&gt; TRUE);
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFDCEDE">
                                 <!-- --></a>Set the Instantiation SCN for the Existing Tables at Other Databases
                           </dt>
                           <dd>
                              <p>In this example, the <code class="codeph">hr.jobs</code> table already exists at <code class="codeph">dbs2.example.com</code> and <code class="codeph">dbs4.example.com</code>. At <code class="codeph">dbs2.example.com</code>, this table is named <code class="codeph">assignments</code>, but it has the same shape and data as the <code class="codeph">jobs</code> table at <code class="codeph">dbs1.example.com</code>. Also, in this example, <code class="codeph">dbs4.example.com</code> is a Sybase database. All of the other tables in the Oracle Streams environment are instantiated at the other destination databases using Data Pump import.
                              </p>
                              <p>Because the <code class="codeph">hr.jobs</code> table already exists at <code class="codeph">dbs2.example.com</code> and <code class="codeph">dbs4.example.com</code>, this example uses the <code class="codeph">GET_SYSTEM_CHANGE_NUMBER</code> function in the <code class="codeph">DBMS_FLASHBACK</code> package at <code class="codeph">dbs1.example.com</code> to obtain the current SCN for the database. This SCN is used at <code class="codeph">dbs2.example.com</code> to run the <code class="codeph">SET_TABLE_INSTANTIATION_SCN</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. Running this procedure twice sets the instantiation SCN for the <code class="codeph">hr.jobs</code> table at <code class="codeph">dbs2.example.com</code> and <code class="codeph">dbs4.example.com</code>.
                              </p>
                              <p>The <code class="codeph">SET_TABLE_INSTANTIATION_SCN</code> procedure controls which LCRs for a table are ignored by an apply process and which LCRs for a table are applied by an apply process. If the commit SCN of an LCR for a table from a source database is less than or equal to the instantiation SCN for that table at a destination database, then the apply process at the destination database discards the LCR. Otherwise, the apply process applies the LCR.
                              </p>
                              <p>In this example, both of the apply processes at <code class="codeph">dbs2.example.com</code> will apply transactions to the <code class="codeph">hr.jobs</code> table with SCNs that were committed after SCN obtained in this step.
                              </p>
                              <div class="infoboxnote" id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__GUID-8A5F04AB-B21C-4427-BC35-F8455B81E2ED">
                                 <p class="notep1">Note:</p>
                                 <p>This example assumes that the contents of the <code class="codeph">hr.jobs</code> table at <code class="codeph">dbs1.example.com</code>, <code class="codeph">dbs2.example.com</code> (as <code class="codeph">hr.assignments</code>), and <code class="codeph">dbs4.example.com</code> are consistent when you complete this step. You might want to lock the table at each database while you complete this step to ensure consistency.
                                 </p>
                              </div><pre class="oac_no_warn" dir="ltr">*/

DECLARE
  iscn  NUMBER;         -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@DBS2.EXAMPLE.COM(
    source_object_name    =&gt; 'hr.jobs',
    source_database_name  =&gt; 'dbs1.example.com',
    instantiation_scn     =&gt; iscn);
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@DBS2.EXAMPLE.COM(
    source_object_name    =&gt; 'hr.jobs',
    source_database_name  =&gt; 'dbs1.example.com',
    instantiation_scn     =&gt; iscn,
    apply_database_link   =&gt; 'dbs4.example.com');
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFDCDIB">
                                 <!-- --></a>Instantiate the dbs1.example.com Tables at dbs3.example.com
                           </dt>
                           <dd>
                              <p>This example performs a network Data Pump import of the following tables:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">hr.countries</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">hr.locations</code></p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">hr.regions</code></p>
                                 </li>
                              </ul>
                              <p>A network import means that Data Pump imports these tables from <code class="codeph">dbs1.example.com</code> without using an export dump file.
                              </p>
                              <div class="infoboxnotealso" id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__GUID-0E4CBB60-85DD-4384-96E1-AC5BC2CCCB60">
                                 <p class="notep1">See Also:</p>
                                 <p><a href="../sutil/index.html"><span class="italic">Oracle Database Utilities </span></a>for information about performing an import
                                 </p>
                              </div>
                              <p>Connect to <code class="codeph">dbs3.example.com</code> as the <code class="codeph">strmadmin</code> user.
                              </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs3.example.com

/*
</pre><p>This example will do a table import using the <code class="codeph">DBMS_DATAPUMP</code> package. For simplicity, exceptions from any of the API calls will not be trapped. However, Oracle recommends that you define exception handlers and call <code class="codeph">GET_STATUS</code> to retrieve more detailed error information if a failure occurs. If you want to monitor the import, then query the <code class="codeph">DBA_DATAPUMP_JOBS</code> data dictionary view at the import database.
                              </p><pre class="oac_no_warn" dir="ltr">*/

SET SERVEROUTPUT ON
DECLARE
  h1        NUMBER;         -- Data Pump job handle
  sscn      NUMBER;         -- Variable to hold current source SCN
  job_state VARCHAR2(30);   -- To keep track of job state
  js        ku$_JobStatus;  -- The job status from GET_STATUS
  sts       ku$_Status;     -- The status object returned by GET_STATUS
  job_not_exist    exception;
  pragma exception_init(job_not_exist, -31626);
BEGIN
-- Create a (user-named) Data Pump job to do a table-level import.
  h1 := DBMS_DATAPUMP.OPEN(
          operation   =&gt; 'IMPORT',
          job_mode    =&gt; 'TABLE',
          remote_link =&gt; 'DBS1.EXAMPLE.COM',
          job_name    =&gt; 'dp_sing1');
-- A metadata filter is used to specify the schema that owns the tables 
-- that will be imported.
  DBMS_DATAPUMP.METADATA_FILTER(
    handle    =&gt; h1,
    name      =&gt; 'SCHEMA_EXPR',
    value     =&gt; '=''HR''');
-- A metadata filter is used to specify the tables that will be imported.
  DBMS_DATAPUMP.METADATA_FILTER(
    handle    =&gt; h1,
    name      =&gt; 'NAME_EXPR',
    value     =&gt; 'IN(''COUNTRIES'', ''REGIONS'', ''LOCATIONS'')');
-- Get the current SCN of the source database, and set the FLASHBACK_SCN 
-- parameter to this value to ensure consistency between all of the 
-- objects included in the import.
  sscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER@dbs1.example.com(); 
  DBMS_DATAPUMP.SET_PARAMETER(
    handle =&gt; h1,
    name   =&gt; 'FLASHBACK_SCN',
    value  =&gt; sscn); 
-- Start the job. 
  DBMS_DATAPUMP.START_JOB(h1);
-- The import job should be running. In the following loop, the job
-- is monitored until it completes.
  job_state := 'UNDEFINED';
  BEGIN
    WHILE (job_state != 'COMPLETED') AND (job_state != 'STOPPED') LOOP
      sts:=DBMS_DATAPUMP.GET_STATUS(
             handle  =&gt; h1,
             mask    =&gt; DBMS_DATAPUMP.KU$_STATUS_JOB_ERROR +
                        DBMS_DATAPUMP.KU$_STATUS_JOB_STATUS +
                        DBMS_DATAPUMP.KU$_STATUS_WIP,
             timeout =&gt; -1);
      js := sts.job_status;
      DBMS_LOCK.SLEEP(10);
      job_state := js.state;
    END LOOP;
  -- Gets an exception when job no longer exists
    EXCEPTION WHEN job_not_exist THEN
      DBMS_OUTPUT.PUT_LINE('Data Pump job has completed');
      DBMS_OUTPUT.PUT_LINE('Instantiation SCN: ' ||sscn);
  END;
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFFBEDG">
                                 <!-- --></a>Configure the Apply Process at dbs3.example.com
                           </dt>
                           <dd>
                              <p>Connect to <code class="codeph">dbs3.example.com</code> as the <code class="codeph">strmadmin</code> user.
                              </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs3.example.com

/*
</pre><p>Configure <code class="codeph">dbs3.example.com</code> to apply changes to the <code class="codeph">countries</code> table, <code class="codeph">locations</code> table, and <code class="codeph">regions</code> table. 
                              </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.countries',
&nbsp;&nbsp;&nbsp;&nbsp;streams_type    =&gt; 'apply', 
    streams_name    =&gt; 'apply',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name      =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp; =&gt; TRUE,
    source_database =&gt; 'dbs1.example.com',
    inclusion_rule  =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.locations',
&nbsp;&nbsp;&nbsp;&nbsp;streams_type    =&gt; 'apply', 
    streams_name    =&gt; 'apply',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name      =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp; =&gt; TRUE,
    source_database =&gt; 'dbs1.example.com',
    inclusion_rule  =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.regions',
&nbsp;&nbsp;&nbsp;&nbsp;streams_type    =&gt; 'apply', 
    streams_name    =&gt; 'apply',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name      =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp; =&gt; TRUE,
    source_database =&gt; 'dbs1.example.com',
    inclusion_rule  =&gt; TRUE);
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFHFFDG">
                                 <!-- --></a>Specify hr as the Apply User for the Apply Process at dbs3.example.com
                           </dt>
                           <dd>
                              <p>In this example, the <code class="codeph">hr</code> user owns all of the database objects for which changes are applied by the apply process at this database. Therefore, <code class="codeph">hr</code> already has the necessary privileges to change these database objects, and it is convenient to make <code class="codeph">hr</code> the apply user. 
                              </p>
                              <p>When the apply process was created in the previous step, the Oracle Streams administrator <code class="codeph">strmadmin</code> was specified as the apply user by default, because <code class="codeph">strmadmin</code> ran the procedure that created the apply process. Instead of specifying hr as the apply user, you could retain <code class="codeph">strmadmin</code> as the apply user, but then you must grant <code class="codeph">strmadmin</code> privileges on all of the database objects for which changes are applied and privileges to execute all user procedures used by the apply process. In an environment where an apply process applies changes to database objects in multiple schemas, it might be more convenient to use the Oracle Streams administrator as the apply user.
                              </p>
                              <div class="infoboxnotealso" id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__GUID-12C224D6-3B41-4C81-874A-062124AAD7AD">
                                 <p class="notep1">See Also:</p>
                                 <p><a href="../strep/preparing-for-oracle-streams-replication.html#STREP200"><span class="italic">Oracle Streams Replication Administrator's Guide </span></a>for more information about configuring an Oracle Streams administrator
                                 </p>
                              </div><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name =&gt; 'apply',
    apply_user =&gt; 'hr');
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFEDFGH">
                                 <!-- --></a>Grant the hr User Execute Privilege on the Apply Process Rule Set
                           </dt>
                           <dd>
                              <p>Because the <code class="codeph">hr</code> user was specified as the apply user in the previous step, the <code class="codeph">hr</code> user requires <code class="codeph">EXECUTE</code> privilege on the positive rule set used by the apply process
                              </p><pre class="oac_no_warn" dir="ltr">*/

DECLARE
   rs_name  VARCHAR2(64);   -- Variable to hold rule set name
BEGIN
  SELECT RULE_SET_OWNER||'.'||RULE_SET_NAME 
    INTO rs_name 
    FROM DBA_APPLY 
    WHERE APPLY_NAME='APPLY';
  DBMS_RULE_ADM.GRANT_OBJECT_PRIVILEGE(
    privilege   =&gt; SYS.DBMS_RULE_ADM.EXECUTE_ON_RULE_SET,
    object_name =&gt; rs_name,
    grantee     =&gt; 'hr');
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFJCICF">
                                 <!-- --></a>Start the Apply Process at dbs3.example.com
                           </dt>
                           <dd>
                              <p>Set the <code class="codeph">disable_on_error</code> parameter to <code class="codeph">n</code> so that the apply process will not be disabled if it encounters an error, and start the apply process at <code class="codeph">dbs3.example.com</code>.
                              </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name  =&gt; 'apply', 
    parameter   =&gt; 'disable_on_error', 
    value       =&gt; 'N');
END;
/
 
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; 'apply');
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFEGFHA">
                                 <!-- --></a>Configure Propagation at dbs2.example.com
                           </dt>
                           <dd>
                              <p>Connect to <code class="codeph">dbs2.example.com</code> as the <code class="codeph">strmadmin</code> user.
                              </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs2.example.com

/*
</pre><p>Configure and schedule propagation from the queue at <code class="codeph">dbs2.example.com</code> to the queue at <code class="codeph">dbs3.example.com</code>. You must specify this propagation for each table that will apply changes at <code class="codeph">dbs3.example.com</code>. This configuration is an example of directed networks because the changes at <code class="codeph">dbs2.example.com</code> originated at <code class="codeph">dbs1.example.com</code>.
                              </p><pre class="oac_no_warn" dir="ltr">*/
 
BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name               =&gt; 'hr.countries',
&nbsp;&nbsp;&nbsp;&nbsp;streams_name             =&gt; 'dbs2_to_dbs3',
&nbsp;&nbsp;&nbsp;&nbsp;source_queue_name        =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp;&nbsp;destination_queue_name   =&gt; 'strmadmin.streams_queue@dbs3.example.com', 
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;           =&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;           =&gt; TRUE,
    source_database          =&gt; 'dbs1.example.com',
    inclusion_rule           =&gt; TRUE,
    queue_to_queue           =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name              =&gt; 'hr.locations',
&nbsp;&nbsp;&nbsp;&nbsp;streams_name            =&gt; 'dbs2_to_dbs3',
&nbsp;&nbsp;&nbsp;&nbsp;source_queue_name       =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp;&nbsp;destination_queue_name  =&gt; 'strmadmin.streams_queue@dbs3.example.com', 
&nbsp;&nbsp;&nbsp; include_dml &nbsp;           =&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;          =&gt; TRUE,
    source_database         =&gt; 'dbs1.example.com',
    inclusion_rule          =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name              =&gt; 'hr.regions',
&nbsp;&nbsp;&nbsp;&nbsp;streams_name            =&gt; 'dbs2_to_dbs3',
&nbsp;&nbsp;&nbsp;&nbsp;source_queue_name       =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp;&nbsp;destination_queue_name  =&gt; 'strmadmin.streams_queue@dbs3.example.com', 
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;        =&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp;         =&gt; TRUE,
    source_database         =&gt; 'dbs1.example.com',
    inclusion_rule          =&gt; TRUE);
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFBIBBH">
                                 <!-- --></a>Create the Custom Rule-Based Transformation for Row LCRs at dbs2.example.com
                           </dt>
                           <dd>
                              <p>Connect to <code class="codeph">dbs2.example.com</code> as the <code class="codeph">hr</code> user.
                              </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT hr@dbs2.example.com

/*
</pre><p>Create the custom rule-based transformation function that transforms row changes resulting from DML statements to the <code class="codeph">jobs</code> table from <code class="codeph">dbs1.example.com</code> into row changes to the <code class="codeph">assignments</code> table on <code class="codeph">dbs2.example.com</code>.
                              </p>
                              <p>The following function transforms every row LCR for the <code class="codeph">jobs</code> table into a row LCR for the <code class="codeph">assignments</code> table.
                              </p>
                              <div class="infoboxnote" id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__GUID-F1491262-5444-457B-B6CC-B1DF3CC6E79A">
                                 <p class="notep1">Note:</p>
                                 <p>If DDL changes were also applied to the <code class="codeph">assignments</code> table, then another transformation would be required for the DDL LCRs. This transformation would need to change the object name and the DDL&nbsp;text.
                                 </p>
                              </div><pre class="oac_no_warn" dir="ltr">*/

CREATE OR REPLACE FUNCTION hr.to_assignments_trans_dml(
  p_in_data in ANYDATA) 
  RETURN ANYDATA IS out_data SYS.LCR$_ROW_RECORD;
  tc   pls_integer;
BEGIN
  -- Typecast AnyData to LCR$_ROW_RECORD
     tc := p_in_data.GetObject(out_data);
     IF out_data.GET_OBJECT_NAME() = 'JOBS'
     THEN
  -- Transform the in_data into the out_data
     out_data.SET_OBJECT_NAME('ASSIGNMENTS');
     END IF;
  -- Convert to AnyData
     RETURN ANYDATA.ConvertObject(out_data);
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFDJGAG">
                                 <!-- --></a>Configure the Apply Process for Local Apply at dbs2.example.com
                           </dt>
                           <dd>
                              <p>Connect to <code class="codeph">dbs2.example.com</code> as the <code class="codeph">strmadmin</code> user.
                              </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs2.example.com

/*
</pre><p><a id="d2443e1828" class="indexterm-anchor"></a><a id="d2443e1834" class="indexterm-anchor"></a>Configure <code class="codeph">dbs2.example.com</code> to apply changes to the <code class="codeph">assignments</code> table. Remember that the <code class="codeph">assignments</code> table receives changes from the <code class="codeph">jobs</code> table at <code class="codeph">dbs1.example.com</code>.
                              </p><pre class="oac_no_warn" dir="ltr">*/

DECLARE
  to_assignments_rulename_dml   VARCHAR2(30);
  dummy_rule                    VARCHAR2(30);
BEGIN
--  DML changes to the jobs table from dbs1.example.com are applied 
--  to the assignments table. The to_assignments_rulename_dml variable 
--  is an out parameter in this call.
&nbsp;&nbsp;DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.jobs', -- jobs, not assignments, specified
&nbsp;&nbsp;&nbsp;&nbsp;streams_type    =&gt; 'apply', 
    streams_name    =&gt; 'apply_dbs2',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name      =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp; =&gt; FALSE,
    source_database =&gt; 'dbs1.example.com',
    dml_rule_name   =&gt; to_assignments_rulename_dml,
    ddl_rule_name   =&gt; dummy_rule,
    inclusion_rule  =&gt; TRUE); 
--  Modify the rule for the hr.jobs table to use the transformation function.
  DBMS_STREAMS_ADM.SET_RULE_TRANSFORM_FUNCTION(
    rule_name          =&gt; to_assignments_rulename_dml,
    transform_function =&gt; 'hr.to_assignments_trans_dml');
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFGBFHD">
                                 <!-- --></a>Specify hr as the Apply User for the Apply Process at dbs2.example.com
                           </dt>
                           <dd>
                              <p>In this example, the <code class="codeph">hr</code> user owns all of the database objects for which changes are applied by the apply process at this database. Therefore, <code class="codeph">hr</code> already has the necessary privileges to change these database objects, and it is convenient to make <code class="codeph">hr</code> the apply user. 
                              </p>
                              <p>When the apply process was created in the previous step, the Oracle Streams administrator <code class="codeph">strmadmin</code> was specified as the apply user by default, because <code class="codeph">strmadmin</code> ran the procedure that created the apply process. Instead of specifying hr as the apply user, you could retain <code class="codeph">strmadmin</code> as the apply user, but then you must grant <code class="codeph">strmadmin</code> privileges on all of the database objects for which changes are applied and privileges to execute all user procedures used by the apply process. In an environment where an apply process applies changes to database objects in multiple schemas, it might be more convenient to use the Oracle Streams administrator as the apply user.
                              </p>
                              <div class="infoboxnotealso" id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__GUID-8C799DF0-04E1-4637-8ABA-3C11DEC415CD">
                                 <p class="notep1">See Also:</p>
                                 <p><a href="../strep/preparing-for-oracle-streams-replication.html#STREP200"><span class="italic">Oracle Streams Replication Administrator's Guide </span></a>for more information about configuring an Oracle Streams administrator
                                 </p>
                              </div><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name =&gt; 'apply_dbs2',
    apply_user =&gt; 'hr');
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFJJCIC">
                                 <!-- --></a>Grant the hr User Execute Privilege on the Apply Process Rule Set
                           </dt>
                           <dd>
                              <p>Because the <code class="codeph">hr</code> user was specified as the apply user in the previous step, the <code class="codeph">hr</code> user requires <code class="codeph">EXECUTE</code> privilege on the positive rule set used by the apply process
                              </p><pre class="oac_no_warn" dir="ltr">*/

DECLARE
   rs_name  VARCHAR2(64);   -- Variable to hold rule set name
BEGIN
  SELECT RULE_SET_OWNER||'.'||RULE_SET_NAME 
    INTO rs_name 
    FROM DBA_APPLY 
    WHERE APPLY_NAME='APPLY_DBS2';
  DBMS_RULE_ADM.GRANT_OBJECT_PRIVILEGE(
    privilege   =&gt; SYS.DBMS_RULE_ADM.EXECUTE_ON_RULE_SET,
    object_name =&gt; rs_name,
    grantee     =&gt; 'hr');
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFGGJDH">
                                 <!-- --></a>Start the Apply Process at dbs2.example.com for Local Apply
                           </dt>
                           <dd>
                              <p>Set the <code class="codeph">disable_on_error</code> parameter to <code class="codeph">n</code> so that the apply process will not be disabled if it encounters an error, and start the apply process for local apply at <code class="codeph">dbs2.example.com</code>.
                              </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name  =&gt; 'apply_dbs2', 
    parameter   =&gt; 'disable_on_error', 
    value       =&gt; 'N');
END;
/
 
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; 'apply_dbs2');
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFEACAG">
                                 <!-- --></a>Configure the Apply Process at dbs2.example.com for Apply at dbs4.example.com
                           </dt>
                           <dd>
                              <p>Configure the apply process for <code class="codeph">dbs4.example.com</code>, which is a Sybase database. The <code class="codeph">dbs2.example.com</code> database is acting as a gateway to <code class="codeph">dbs4.example.com</code>. Therefore, the apply process for <code class="codeph">dbs4.example.com</code> must be configured at <code class="codeph">dbs2.example.com</code>. The apply process cannot apply DDL changes to non-Oracle databases. Therefore, the <code class="codeph">include_ddl</code> parameter is set to <code class="codeph">FALSE</code> when the <code class="codeph">ADD_TABLE_RULES</code> procedure is run.
                              </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.CREATE_APPLY(
    queue_name          =&gt; 'strmadmin.streams_queue',
    apply_name          =&gt; 'apply_dbs4',
    apply_database_link =&gt; 'dbs4.example.com',
    apply_captured      =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.jobs',
&nbsp;&nbsp;&nbsp;&nbsp;streams_type    =&gt; 'apply', 
    streams_name    =&gt; 'apply_dbs4',
&nbsp; &nbsp;&nbsp;queue_name      =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp; =&gt; FALSE,
    source_database =&gt; 'dbs1.example.com',
    inclusion_rule  =&gt; TRUE);
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFGCFEE">
                                 <!-- --></a>Start the Apply Process at dbs2.example.com for Apply at dbs4.example.com
                           </dt>
                           <dd>
                              <p>Set the <code class="codeph">disable_on_error</code> parameter to <code class="codeph">n</code> so that the apply process will not be disabled if it encounters an error, and start the remote apply for Sybase using database link <code class="codeph">dbs4.example.com</code>.
                              </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name  =&gt; 'apply_dbs4', 
    parameter   =&gt; 'disable_on_error', 
    value       =&gt; 'N');
END;
/
 
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; 'apply_dbs4');
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFCHABB">
                                 <!-- --></a>Start the Capture Process at dbs1.example.com
                           </dt>
                           <dd>
                              <p>Connect to <code class="codeph">dbs1.example.com</code> as the <code class="codeph">strmadmin</code> user.
                              </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs1.example.com

/*
</pre><p>Start the capture process at <code class="codeph">dbs1.example.com</code>.
                              </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_CAPTURE_ADM.START_CAPTURE(
    capture_name  =&gt; 'capture');
END;
/

/*</pre></dd>
                           <dt class="dlterm"><a name="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFHJAGI">
                                 <!-- --></a>Check the Spool Results
                           </dt>
                           <dd>
                              <p>Check the <code class="codeph">streams_share_schema1.out</code> spool file to ensure that all actions finished successfully after this script is completed.
                              </p><pre class="oac_no_warn" dir="ltr">*/

SET ECHO OFF
SPOOL OFF

/*
</pre><p>You can now make DML and DDL changes to specific tables at <code class="codeph">dbs1.example.com</code> and see these changes replicated to the other databases in the environment based on the rules you configured for the Oracle Streams processes and propagations in this environment.
                              </p>
                              <div class="infoboxnotealso" id="GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__GUID-919C414D-BF9B-4CC5-B23C-1C774FE39FD4">
                                 <p class="notep1">See Also:</p>
                                 <p><span class="q">"<a href="single-source-heterogeneous-replication-example.html#GUID-55D3343C-9184-46EB-BD04-9AE07771AE47">Make DML and DDL Changes to Tables in the hr Schema</a>"</span> for examples of changes that are replicated in this environment
                                 </p>
                              </div><pre class="oac_no_warn" dir="ltr">/*************************** END OF SCRIPT ******************************/</pre></dd>
                        </dl>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STREX1223"></a><a id="STREX1224"></a><a id="STREX1225"></a><a id="STREX1226"></a><a id="STREX1227"></a><a id="STREX1228"></a><a id="STREX1229"></a><a id="STREX1230"></a><a id="STREX1231"></a><a id="STREX1232"></a><a id="STREX1233"></a><a id="STREX1234"></a><a id="STREX1235"></a><a id="STREX1236"></a><a id="STREX1237"></a><a id="STREX1238"></a><a id="STREX1239"></a><a id="STREX1240"></a><a id="STREX102"></a><div class="props_rev_3"><a id="GUID-09860484-7341-47FA-8FEA-92AA5202EE28" name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28"></a><h4 id="STREX-GUID-09860484-7341-47FA-8FEA-92AA5202EE28" class="sect4"><span class="enumeration_section">2.4.2 </span>Flexible Configuration for Sharing Data from a Single Database
                  </h4>
                  <div>
                     <p>Complete the following steps to use a more flexible approach for specifying the capture, propagation, and apply definitions. This approach does not use the <code class="codeph">DBMS_STREAMS_ADM</code> package. Instead, it uses the following packages:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p> The <code class="codeph">DBMS_CAPTURE_ADM</code> package to configure capture processes
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">DBMS_PROPAGATION_ADM</code> package to configure propagations
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">DBMS_APPLY_ADM</code> package to configure apply processes
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">DBMS_RULES_ADM</code> package to specify capture process, propagation, and apply process rules and rule sets
                           </p>
                           <div class="infoboxnote" id="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__GUID-66E5C711-BC4D-4757-80A7-FD320B83AE34">
                              <p class="notep1">Note:</p>
                              <p>Neither the <code class="codeph">ALL_STREAMS_TABLE_RULES</code> nor the <code class="codeph">DBA_STREAMS_TABLE_RULES</code> data dictionary view is populated by the rules created in this example. To view the rules created in this example, you can query the <code class="codeph">ALL_STREAMS_RULES</code> or <code class="codeph">DBA_STREAMS_RULES</code> data dictionary view.
                              </p>
                           </div>
                        </li>
                     </ul>
                     <p>This example includes the following steps:</p>
                     <ol>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFIFIAC">"Show Output and Spool Results"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFIACJC">"Configure Propagation at dbs1.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFEGIIB">"Configure the Capture Process at dbs1.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFCAEGH">"Prepare the hr Schema at dbs1.example.com for Instantiation"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFJHEIH">"Set the Instantiation SCN for the Existing Tables at Other Databases"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFCEFDI">"Instantiate the dbs1.example.com Tables at dbs3.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFGBFIC">"Configure the Apply Process at dbs3.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFJCJFE">"Grant the hr User Execute Privilege on the Apply Process Rule Set"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFFJHBB">"Start the Apply Process at dbs3.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFDBEJH">"Configure Propagation at dbs2.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFJBFAA">"Create the Custom Rule-Based Transformation for Row LCRs at dbs2.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFEIBGI">"Configure the Apply Process for Local Apply at dbs2.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFFJEGD">"Grant the hr User Execute Privilege on the Apply Process Rule Set"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFIEBCE">"Start the Apply Process at dbs2.example.com for Local Apply"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFFDHAA">"Configure the Apply Process at dbs2.example.com for Apply at dbs4.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFDCIII">"Start the Apply Process at dbs2.example.com for Apply at dbs4.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFDHBJD">"Start the Capture Process at dbs1.example.com"</a></p>
                        </li>
                        <li>
                           <p><a href="single-source-heterogeneous-replication-example.html#GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFCEDAJ">"Check the Spool Results"</a></p>
                        </li>
                     </ol>
                     <p></p>
                     <div class="infoboxnote" id="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__GUID-B3021F63-D321-4CCE-875E-D6F19A95D660">
                        <p class="notep1">Note:</p>
                        <p>If you are viewing this document online, then you can copy the text from the "BEGINNING OF SCRIPT" line after this note to the next "END OF SCRIPT" line into a text editor and then edit the text to create a script for your environment. Run the script with SQL*Plus on a computer that can connect to all of the databases in the environment.</p>
                     </div><pre class="oac_no_warn" dir="ltr">/************************* BEGINNING OF SCRIPT ******************************</pre><dl>
                        <dt><strong></strong></dt>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFIFIAC">
                              <!-- --></a>Show Output and Spool Results
                        </dt>
                        <dd>
                           <p>Run <code class="codeph">SET</code> <code class="codeph">ECHO</code> <code class="codeph">ON</code> and specify the spool file for the script. Check the spool file for errors after you run this script.
                           </p><pre class="oac_no_warn" dir="ltr">*/

SET ECHO ON
SPOOL streams_share_schema2.out

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFIACJC">
                              <!-- --></a>Configure Propagation at dbs1.example.com
                        </dt>
                        <dd>
                           <p>Connect to <code class="codeph">dbs1.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs1.example.com

/*
</pre><p>Configure and schedule propagation from the queue at <code class="codeph">dbs1.example.com</code> to the queue at <code class="codeph">dbs2.example.com</code>. This configuration specifies that the propagation propagates all changes to the <code class="codeph">hr</code> schema. You have the option of omitting the rule set specification, but then everything in the queue will be propagated, which might not be desired if, in the future, multiple capture processes will use the <code class="codeph">streams_queue</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  -- Create the rule set
  DBMS_RULE_ADM.CREATE_RULE_SET(
    rule_set_name       =&gt; 'strmadmin.propagation_dbs1_rules',
  &nbsp;&nbsp;evaluation_context  =&gt; 'SYS.STREAMS$_EVALUATION_CONTEXT');
  -- Create rules for all modifications to the hr schema
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name  =&gt; 'strmadmin.all_hr_dml',
    condition  =&gt; ' :dml.get_object_owner() = ''HR'' AND ' || 
                  ' :dml.is_null_tag() = ''Y'' AND ' ||
                  ' :dml.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name  =&gt; 'strmadmin.all_hr_ddl',
    condition  =&gt; ' (:ddl.get_object_owner() = ''HR'' OR ' ||
                  ' :ddl.get_base_table_owner() = 	''HR'') AND ' || 
                  ' :ddl.is_null_tag() = ''Y'' AND ' ||
                  ' :ddl.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  -- Add rules to rule set
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_hr_dml', 
    rule_set_name  =&gt; 'strmadmin.propagation_dbs1_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_hr_ddl', 
    rule_set_name  =&gt; 'strmadmin.propagation_dbs1_rules');
  -- Create a propagation that uses the rule set as its positive rule set
  DBMS_PROPAGATION_ADM.CREATE_PROPAGATION(
    propagation_name    =&gt; 'dbs1_to_dbs2',
    source_queue        =&gt; 'strmadmin.streams_queue',
    destination_queue   =&gt; 'strmadmin.streams_queue',
    destination_dblink  =&gt; 'dbs2.example.com',
    rule_set_name       =&gt; 'strmadmin.propagation_dbs1_rules');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFEGIIB">
                              <!-- --></a>Configure the Capture Process at dbs1.example.com
                        </dt>
                        <dd>
                           <p>Create a capture process and rules to capture the entire <code class="codeph">hr</code> schema at <code class="codeph">dbs1.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  -- Create the rule set
  DBMS_RULE_ADM.CREATE_RULE_SET(
    rule_set_name       =&gt; 'strmadmin.demo_rules',
&nbsp; &nbsp; evaluation_context  =&gt; 'SYS.STREAMS$_EVALUATION_CONTEXT');
  --   Create rules that specify the entire hr schema
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name  =&gt; 'strmadmin.schema_hr_dml',
    condition  =&gt; ' :dml.get_object_owner() = ''HR''  AND ' || 
                  ' :dml.is_null_tag() = ''Y'' AND ' ||
                  ' :dml.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name  =&gt; 'strmadmin.schema_hr_ddl',
    condition  =&gt; ' (:ddl.get_object_owner() = ''HR'' OR ' ||
                  ' :ddl.get_base_table_owner() = 	''HR'') AND ' || 
                  ' :ddl.is_null_tag() = ''Y'' AND ' ||
                  ' :ddl.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  --  Add the rules to the rule set
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.schema_hr_dml', 
    rule_set_name  =&gt; 'strmadmin.demo_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.schema_hr_ddl', 
    rule_set_name  =&gt; 'strmadmin.demo_rules');
  --  Create a capture process that uses the rule set as its positive rule set
  DBMS_CAPTURE_ADM.CREATE_CAPTURE(
    queue_name    =&gt; 'strmadmin.streams_queue',
    capture_name  =&gt; 'capture',
    rule_set_name =&gt; 'strmadmin.demo_rules');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFCAEGH">
                              <!-- --></a>Prepare the hr Schema at dbs1.example.com for Instantiation
                        </dt>
                        <dd>
                           <p>While still connected as the Oracle Streams administrator at <code class="codeph">dbs1.example.com</code>, prepare the <code class="codeph">hr</code> schema at <code class="codeph">dbs1.example.com</code> for instantiation at <code class="codeph">dbs3.example.com</code>. This step marks the lowest SCN of the tables in the schema for instantiation. SCNs subsequent to the lowest SCN can be used for instantiation.
                           </p>
                           <p>This step also enables supplemental logging for any primary key, unique key, bitmap index, and foreign key columns in the tables in the <code class="codeph">hr</code> schema. Supplemental logging places additional information in the redo log for changes made to tables. The apply process needs this extra information to perform certain operations, such as unique row identification and conflict resolution. Because <code class="codeph">dbs1.example.com</code> is the only database where changes are captured in this environment, it is the only database where you must specify supplemental logging for the tables in the <code class="codeph">hr</code> schema.
                           </p>
                           <div class="infoboxnote" id="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__GUID-3AB20ECB-C418-4EFA-97C9-2269900A91C0">
                              <p class="notep1">Note:</p>
                              <p>This step is not required in the <span class="q">"<a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E">Simple Configuration for Sharing Data from a Single Database</a>"</span>. In that example, when the <code class="codeph">ADD_SCHEMA_RULES</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package is run in Step <a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFDDFCE">"Configure the Capture Process at dbs1.example.com"</a><a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFDDFCE">"Configure the Capture Process at dbs1.example.com"</a>, the <code class="codeph">PREPARE_SCHEMA_INSTANTIATION</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package is run automatically for the <code class="codeph">hr</code> schema.
                              </p>
                           </div>
                           <div class="infoboxnotealso" id="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__GUID-4B4721DB-45FC-4B46-8829-6D6E7001EA37">
                              <p class="notep1">See Also:</p>
                              <p><a href="../strep/preparing-for-oracle-streams-replication.html#STREP107"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
                           </div><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_CAPTURE_ADM.PREPARE_SCHEMA_INSTANTIATION(
    schema_name          =&gt; 'hr',
    supplemental_logging =&gt; 'keys');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFJHEIH">
                              <!-- --></a>Set the Instantiation SCN for the Existing Tables at Other Databases
                        </dt>
                        <dd>
                           <p>In this example, the <code class="codeph">hr.jobs</code> table already exists at <code class="codeph">dbs2.example.com</code> and <code class="codeph">dbs4.example.com</code>. At <code class="codeph">dbs2.example.com</code>, this table is named <code class="codeph">assignments</code>, but it has the same shape and data as the <code class="codeph">jobs</code> table at <code class="codeph">dbs1.example.com</code>. Also, in this example, <code class="codeph">dbs4.example.com</code> is a Sybase database. All of the other tables in the Oracle Streams environment are instantiated at the other destination databases using Data Pump import.
                           </p>
                           <p>Because the <code class="codeph">hr.jobs</code> table already exists at <code class="codeph">dbs2.example.com</code> and <code class="codeph">dbs4.example.com</code>, this example uses the <code class="codeph">GET_SYSTEM_CHANGE_NUMBER</code> function in the <code class="codeph">DBMS_FLASHBACK</code> package at <code class="codeph">dbs1.example.com</code> to obtain the current SCN for the database. This SCN is used at <code class="codeph">dbs2.example.com</code> to run the <code class="codeph">SET_TABLE_INSTANTIATION_SCN</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package. Running this procedure twice sets the instantiation SCN for the <code class="codeph">hr.jobs</code> table at <code class="codeph">dbs2.example.com</code> and <code class="codeph">dbs4.example.com</code>.
                           </p>
                           <p>The <code class="codeph">SET_TABLE_INSTANTIATION_SCN</code> procedure controls which LCRs for a table are ignored by an apply process and which LCRs for a table are applied by an apply process. If the commit SCN of an LCR for a table from a source database is less than or equal to the instantiation SCN for that table at a destination database, then the apply process at the destination database discards the LCR. Otherwise, the apply process applies the LCR.
                           </p>
                           <p>In this example, both of the apply processes at <code class="codeph">dbs2.example.com</code> will apply transactions to the <code class="codeph">hr.jobs</code> table with SCNs that were committed after SCN obtained in this step.
                           </p>
                           <div class="infoboxnote" id="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__GUID-0820EAE4-D1A4-4ACB-9CCE-4EC90B32C115">
                              <p class="notep1">Note:</p>
                              <p>This example assumes that the contents of the <code class="codeph">hr.jobs</code> table at <code class="codeph">dbs1.example.com</code>, <code class="codeph">dbs2.example.com</code> (as <code class="codeph">hr.assignments</code>), and <code class="codeph">dbs4.example.com</code> are consistent when you complete this step. You might want to lock the table at each database while you complete this step to ensure consistency.
                              </p>
                           </div><pre class="oac_no_warn" dir="ltr">*/

DECLARE
  iscn  NUMBER;         -- Variable to hold instantiation SCN value
BEGIN
  iscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER();
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@DBS2.EXAMPLE.COM(
    source_object_name    =&gt; 'hr.jobs',
    source_database_name  =&gt; 'dbs1.example.com',
    instantiation_scn     =&gt; iscn);
  DBMS_APPLY_ADM.SET_TABLE_INSTANTIATION_SCN@DBS2.EXAMPLE.COM(
    source_object_name    =&gt; 'hr.jobs',
    source_database_name  =&gt; 'dbs1.example.com',
    instantiation_scn     =&gt; iscn,
    apply_database_link   =&gt; 	'dbs4.example.com');
END;
/
</pre><p>/*</p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFCEFDI">
                              <!-- --></a>Instantiate the dbs1.example.com Tables at dbs3.example.com
                        </dt>
                        <dd>
                           <p>This example performs a network Data Pump import of the following tables:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">hr.countries</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">hr.locations</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">hr.regions</code></p>
                              </li>
                           </ul>
                           <p>A network import means that Data Pump imports these tables from <code class="codeph">dbs1.example.com</code> without using an export dump file.
                           </p>
                           <div class="infoboxnotealso" id="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__GUID-D7F06B3F-FD67-4551-93BC-1C5B11B20531">
                              <p class="notep1">See Also:</p>
                              <p><a href="../sutil/index.html"><span class="italic">Oracle Database Utilities </span></a>for information about performing an import
                              </p>
                           </div>
                           <p>Connect to <code class="codeph">dbs3.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs3.example.com

/*
</pre><p>This example will do a table import using the <code class="codeph">DBMS_DATAPUMP</code> package. For simplicity, exceptions from any of the API calls will not be trapped. However, Oracle recommends that you define exception handlers and call <code class="codeph">GET_STATUS</code> to retrieve more detailed error information if a failure occurs. If you want to monitor the import, then query the <code class="codeph">DBA_DATAPUMP_JOBS</code> data dictionary view at the import database.
                           </p><pre class="oac_no_warn" dir="ltr">*/

SET SERVEROUTPUT ON
DECLARE
  h1        NUMBER;         -- Data Pump job handle
  sscn      NUMBER;         -- Variable to hold current source SCN
  job_state VARCHAR2(30);   -- To keep track of job state
  js        ku$_JobStatus;  -- The job status from GET_STATUS
  sts       ku$_Status;     -- The status object returned by GET_STATUS
  job_not_exist    exception;
  pragma exception_init(job_not_exist, -31626);
BEGIN
-- Create a (user-named) Data Pump job to do a table-level import.
  h1 := DBMS_DATAPUMP.OPEN(
          operation   =&gt; 'IMPORT',
          job_mode    =&gt; 'TABLE',
          remote_link =&gt; 'DBS1.EXAMPLE.COM',
          job_name    =&gt; 'dp_sing2');
-- A metadata filter is used to specify the schema that owns the tables 
-- that will be imported.
  DBMS_DATAPUMP.METADATA_FILTER(
    handle    =&gt; h1,
    name      =&gt; 'SCHEMA_EXPR',
    value     =&gt; '=''HR''');
-- A metadata filter is used to specify the tables that will be imported.
  DBMS_DATAPUMP.METADATA_FILTER(
    handle    =&gt; h1,
    name      =&gt; 'NAME_EXPR',
    value     =&gt; 'IN(''COUNTRIES'', ''REGIONS'', ''LOCATIONS'')');
-- Get the current SCN of the source database, and set the FLASHBACK_SCN 
-- parameter to this value to ensure consistency between all of the 
-- objects included in the import.
  sscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER@dbs1.example.com();
  DBMS_DATAPUMP.SET_PARAMETER(
    handle =&gt; h1,
    name   =&gt; 'FLASHBACK_SCN',
    value  =&gt; sscn); 
-- Start the job. 
  DBMS_DATAPUMP.START_JOB(h1);
-- The import job should be running. In the following loop, the job
-- is monitored until it completes.
  job_state := 'UNDEFINED';
  BEGIN
    WHILE (job_state != 'COMPLETED') AND (job_state != 'STOPPED') LOOP
      sts:=DBMS_DATAPUMP.GET_STATUS(
             handle  =&gt; h1,
             mask    =&gt; DBMS_DATAPUMP.KU$_STATUS_JOB_ERROR +
                        DBMS_DATAPUMP.KU$_STATUS_JOB_STATUS +
                        DBMS_DATAPUMP.KU$_STATUS_WIP,
             timeout =&gt; -1);
      js := sts.job_status;
      DBMS_LOCK.SLEEP(10);
      job_state := js.state;
    END LOOP;
  -- Gets an exception when job no longer exists
    EXCEPTION WHEN job_not_exist THEN
      DBMS_OUTPUT.PUT_LINE('Data Pump job has completed');
      DBMS_OUTPUT.PUT_LINE('Instantiation SCN: ' ||sscn);
  END;
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFGBFIC">
                              <!-- --></a>Configure the Apply Process at dbs3.example.com
                        </dt>
                        <dd>
                           <p>Connect to <code class="codeph">dbs3.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs3.example.com

/*
</pre><p>Configure <code class="codeph">dbs3.example.com</code> to apply DML and DDL changes to the <code class="codeph">countries</code> table, <code class="codeph">locations</code> table, and <code class="codeph">regions</code> table. 
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  -- Create the rule set
  DBMS_RULE_ADM.CREATE_RULE_SET(
    rule_set_name       =&gt; 'strmadmin.apply_rules',
&nbsp; &nbsp; evaluation_context  =&gt; 'SYS.STREAMS$_EVALUATION_CONTEXT');
  -- Rules for hr.countries
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name    =&gt; 'strmadmin.all_countries_dml',
    condition    =&gt; ' :dml.get_object_owner() = ''HR'' AND ' || 
                    ' :dml.get_object_name() = ''COUNTRIES''  AND ' || 
                    ' :dml.is_null_tag() = ''Y'' AND ' ||
                    ' :dml.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name    =&gt; 'strmadmin.all_countries_ddl',
    condition    =&gt; ' (:ddl.get_object_owner() = ''HR'' OR ' ||
                    ' :ddl.get_base_table_owner() = 	''HR'') AND ' || 
                    ' :ddl.get_object_name() = ''COUNTRIES'' AND ' || 
                    ' :ddl.is_null_tag() = ''Y'' AND ' ||
                    ' :ddl.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  -- Rules for hr.locations
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name    =&gt; 'strmadmin.all_locations_dml',
    condition    =&gt; ' :dml.get_object_owner() = ''HR'' AND ' ||
                    ' :dml.get_object_name() = ''LOCATIONS'' AND ' || 
                    ' :dml.is_null_tag() = ''Y'' AND ' ||
                    ' :dml.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name    =&gt; 'strmadmin.all_locations_ddl',
    condition    =&gt; ' (:ddl.get_object_owner() = ''HR'' OR ' ||
                    ' :ddl.get_base_table_owner() = 	''HR'') AND ' ||
                    ' :ddl.get_object_name() = ''LOCATIONS'' AND ' || 
                    ' :ddl.is_null_tag() = ''Y'' AND ' ||
                    ' :ddl.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  -- Rules for hr.regions
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name    =&gt; 'strmadmin.all_regions_dml',
    condition    =&gt; ' :dml.get_object_owner() = ''HR'' AND ' ||
                    ' :dml.get_object_name() = ''REGIONS'' AND ' || 
                    ' :dml.is_null_tag() = ''Y'' AND ' ||
                    ' :dml.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name    =&gt; 'strmadmin.all_regions_ddl',
    condition    =&gt; ' (:ddl.get_object_owner() = ''HR'' OR ' ||
                    ' :ddl.get_base_table_owner() = 	''HR'') AND ' ||
                    ' :ddl.get_object_name() = ''REGIONS'' AND ' || 
                    ' :ddl.is_null_tag() = ''Y'' AND ' ||
                    ' :ddl.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  -- Add rules to rule set
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_countries_dml', 
    rule_set_name  =&gt; 'strmadmin.apply_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_countries_ddl', 
    rule_set_name  =&gt; 'strmadmin.apply_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_locations_dml', 
    rule_set_name  =&gt; 'strmadmin.apply_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_locations_ddl', 
    rule_set_name  =&gt; 'strmadmin.apply_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_regions_dml', 
    rule_set_name  =&gt; 'strmadmin.apply_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_regions_ddl', 
    rule_set_name  =&gt; 'strmadmin.apply_rules');
  -- Create an apply process that uses the rule set as its positive rule set
  DBMS_APPLY_ADM.CREATE_APPLY(
    queue_name      =&gt; 'strmadmin.streams_queue',
    apply_name      =&gt; 'apply',
    rule_set_name   =&gt; 'strmadmin.apply_rules',
    apply_user      =&gt; 'hr',
    apply_captured  =&gt; TRUE,
    source_database =&gt; 'dbs1.example.com');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFJCJFE">
                              <!-- --></a>Grant the hr User Execute Privilege on the Apply Process Rule Set
                        </dt>
                        <dd>
                           <p>Because the <code class="codeph">hr</code> user was specified as the apply user in the previous step, the <code class="codeph">hr</code> user requires <code class="codeph">EXECUTE</code> privilege on the positive rule set used by the apply process
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_RULE_ADM.GRANT_OBJECT_PRIVILEGE(
    privilege   =&gt; SYS.DBMS_RULE_ADM.EXECUTE_ON_RULE_SET,
    object_name =&gt; 'strmadmin.apply_rules',
    grantee     =&gt; 'hr');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFFJHBB">
                              <!-- --></a>Start the Apply Process at dbs3.example.com
                        </dt>
                        <dd>
                           <p>Set the <code class="codeph">disable_on_error</code> parameter to <code class="codeph">n</code> so that the apply process will not be disabled if it encounters an error, and start the apply process at <code class="codeph">dbs3.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name  =&gt; 'apply', 
    parameter   =&gt; 'disable_on_error', 
    value       =&gt; 'N');
END;
/
 
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; 'apply');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFDBEJH">
                              <!-- --></a>Configure Propagation at dbs2.example.com
                        </dt>
                        <dd>
                           <p>Connect to <code class="codeph">dbs2.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs2.example.com

/*
</pre><p>Configure and schedule propagation from the queue at <code class="codeph">dbs2.example.com</code> to the queue at <code class="codeph">dbs3.example.com</code>. This configuration is an example of directed networks because the changes at <code class="codeph">dbs2.example.com</code> originated at <code class="codeph">dbs1.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  -- Create the rule set
  DBMS_RULE_ADM.CREATE_RULE_SET(
    rule_set_name       =&gt; 'strmadmin.propagation_dbs3_rules',
  &nbsp;&nbsp;evaluation_context  =&gt; 'SYS.STREAMS$_EVALUATION_CONTEXT');
  -- Create rules for all modifications to the countries table
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name  =&gt; 'strmadmin.all_countries_dml',
    condition  =&gt; ' :dml.get_object_owner() = ''HR'' AND ' || 
                  ' :dml.get_object_name() = ''COUNTRIES'' AND ' || 
                  ' :dml.is_null_tag() = ''Y'' AND ' ||
                  ' :dml.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name  =&gt; 'strmadmin.all_countries_ddl',
    condition  =&gt; ' (:ddl.get_object_owner() = ''HR'' OR ' ||
                  ' :ddl.get_base_table_owner() = 	''HR'') AND ' || 
                  ' :ddl.get_object_name() = ''COUNTRIES'' AND ' || 
                  ' :ddl.is_null_tag() = ''Y'' AND ' ||
                  ' :ddl.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  -- Create rules for all modifications to the locations table
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name   =&gt; 'strmadmin.all_locations_dml',
    condition  =&gt; ' :dml.get_object_owner() = ''HR'' AND ' ||
                  ' :dml.get_object_name() = ''LOCATIONS'' AND ' || 
                  ' :dml.is_null_tag() = ''Y'' AND ' ||
                  ' :dml.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name   =&gt; 'strmadmin.all_locations_ddl',
    condition  =&gt; ' (:ddl.get_object_owner() = ''HR'' OR ' ||
                  ' :ddl.get_base_table_owner() = 	''HR'') AND ' ||
                  ' :ddl.get_object_name() = ''LOCATIONS'' AND ' || 
                  ' :ddl.is_null_tag() = ''Y'' AND ' ||
                  ' :ddl.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  -- Create rules for all modifications to the regions table
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name   =&gt; 'strmadmin.all_regions_dml',
    condition  =&gt; ' :dml.get_object_owner() = ''HR'' AND ' ||
                  ' :dml.get_object_name() = ''REGIONS'' AND ' || 
                  ' :dml.is_null_tag() = ''Y'' AND ' ||
                  ' :dml.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name   =&gt; 'strmadmin.all_regions_ddl',
    condition  =&gt; ' (:ddl.get_object_owner() = ''HR'' OR ' ||
                  ' :ddl.get_base_table_owner() = 	''HR'') AND ' ||
                  ' :ddl.get_object_name() = ''REGIONS'' AND ' || 
                  ' :ddl.is_null_tag() = ''Y'' AND ' ||
                  ' :ddl.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  -- Add rules to rule set
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_countries_dml', 
    rule_set_name  =&gt; 'strmadmin.propagation_dbs3_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_countries_ddl', 
    rule_set_name  =&gt; 'strmadmin.propagation_dbs3_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_locations_dml',  
    rule_set_name  =&gt; 'strmadmin.propagation_dbs3_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_locations_ddl',  
    rule_set_name  =&gt; 'strmadmin.propagation_dbs3_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_regions_dml',  
    rule_set_name  =&gt; 'strmadmin.propagation_dbs3_rules');
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_regions_ddl',  
    rule_set_name  =&gt; 'strmadmin.propagation_dbs3_rules');
  -- Create a propagation that uses the rule set as its positive rule set
  DBMS_PROPAGATION_ADM.CREATE_PROPAGATION(
    propagation_name    =&gt; 'dbs2_to_dbs3',
    source_queue        =&gt; 'strmadmin.streams_queue',
    destination_queue   =&gt; 'strmadmin.streams_queue',
    destination_dblink  =&gt; 'dbs3.example.com',
    rule_set_name       =&gt; 'strmadmin.propagation_dbs3_rules');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFJBFAA">
                              <!-- --></a>Create the Custom Rule-Based Transformation for Row LCRs at dbs2.example.com
                        </dt>
                        <dd>
                           <p>Connect to <code class="codeph">dbs2.example.com</code> as the <code class="codeph">hr</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT hr@dbs2.example.com

/*
</pre><p>Create the custom rule-based transformation function that transforms row changes resulting from DML statements to the <code class="codeph">jobs</code> table from <code class="codeph">dbs1.example.com</code> into row changes to the <code class="codeph">assignments</code> table on <code class="codeph">dbs2.example.com</code>.
                           </p>
                           <p>The following function transforms every row LCR for the <code class="codeph">jobs</code> table into a row LCR for the <code class="codeph">assignments</code> table.
                           </p>
                           <div class="infoboxnote" id="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__GUID-AF9B8627-E9D9-4ED4-8807-E5450AF76F29">
                              <p class="notep1">Note:</p>
                              <p>If DDL changes were also applied to the <code class="codeph">assignments</code> table, then another transformation would be required for the DDL LCRs. This transformation would need to change the object name and the DDL&nbsp;text.
                              </p>
                           </div><pre class="oac_no_warn" dir="ltr">*/

CREATE OR REPLACE FUNCTION hr.to_assignments_trans_dml(
  p_in_data in ANYDATA) 
  RETURN ANYDATA IS out_data SYS.LCR$_ROW_RECORD;
  tc   pls_integer;
BEGIN
  -- Typecast AnyData to LCR$_ROW_RECORD
     tc := p_in_data.GetObject(out_data);
     IF out_data.GET_OBJECT_NAME() = 'JOBS'
     THEN
  -- Transform the in_data into the out_data
     out_data.SET_OBJECT_NAME('ASSIGNMENTS');
     END IF;
  -- Convert to AnyData
     RETURN ANYDATA.ConvertObject(out_data);
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFEIBGI">
                              <!-- --></a>Configure the Apply Process for Local Apply at dbs2.example.com
                        </dt>
                        <dd>
                           <p>Connect to <code class="codeph">dbs2.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs2.example.com

/*
</pre><p>Configure <code class="codeph">dbs2.example.com</code> to apply changes to the local <code class="codeph">assignments</code> table. Remember that the <code class="codeph">assignments</code> table receives changes from the <code class="codeph">jobs</code> table at <code class="codeph">dbs1.example.com</code>. This step specifies a custom rule-based transformation without using the <code class="codeph">SET_RULE_TRANSFORM_FUNCTION</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package. Instead, a name-value pair is added manually to the action context of the rule. The name-value pair specifies <code class="codeph">STREAMS$_TRANSFORM_FUNCTION</code> for the name and <code class="codeph">hr.to_assignments_trans_dml</code> for the value. 
                           </p><pre class="oac_no_warn" dir="ltr">*/

DECLARE
  action_ctx_dml       SYS.RE$NV_LIST;
  action_ctx_ddl       SYS.RE$NV_LIST;
  ac_name              VARCHAR2(30) := 'STREAMS$_TRANSFORM_FUNCTION';
BEGIN
  -- Specify the name-value pair in the action context
  action_ctx_dml := SYS.RE$NV_LIST(SYS.RE$NV_ARRAY());
  action_ctx_dml.ADD_PAIR(
    ac_name, 
    ANYDATA.CONVERTVARCHAR2('hr.to_assignments_trans_dml'));
  --  Create the rule set strmadmin.apply_rules
  DBMS_RULE_ADM.CREATE_RULE_SET(
    rule_set_name       =&gt; 'strmadmin.apply_rules',
    evaluation_context  =&gt; 'SYS.STREAMS$_EVALUATION_CONTEXT');
  --  Create a rule that transforms all DML changes to the jobs table into 
  --  DML changes for assignments table
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name       =&gt; 'strmadmin.all_jobs_dml',
    condition       =&gt; ' :dml.get_object_owner() = ''HR'' AND ' ||
                       ' :dml.get_object_name() = ''JOBS'' AND ' || 
                       ' :dml.is_null_tag() = ''Y'' AND ' ||
                       ' :dml.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ',
&nbsp;&nbsp;  action_context  =&gt; action_ctx_dml);
  --  Add the rule to the rule set
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_jobs_dml', 
    rule_set_name  =&gt; 'strmadmin.apply_rules');
  -- Create an apply process that uses the rule set as its positive rule set
  DBMS_APPLY_ADM.CREATE_APPLY(
    queue_name      =&gt; 'strmadmin.streams_queue',
    apply_name      =&gt; 'apply_dbs2',
    rule_set_name   =&gt; 'strmadmin.apply_rules',
    apply_user      =&gt; 'hr',
    apply_captured  =&gt; TRUE,
    source_database =&gt; 'dbs1.example.com');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFFJEGD">
                              <!-- --></a>Grant the hr User Execute Privilege on the Apply Process Rule Set
                        </dt>
                        <dd>
                           <p>Because the <code class="codeph">hr</code> user was specified as the apply user in the previous step, the <code class="codeph">hr</code> user requires <code class="codeph">EXECUTE</code> privilege on the positive rule set used by the apply process
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_RULE_ADM.GRANT_OBJECT_PRIVILEGE(
    privilege   =&gt; SYS.DBMS_RULE_ADM.EXECUTE_ON_RULE_SET,
    object_name =&gt; 'strmadmin.apply_rules',
    grantee     =&gt; 'hr');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFIEBCE">
                              <!-- --></a>Start the Apply Process at dbs2.example.com for Local Apply
                        </dt>
                        <dd>
                           <p>Set the <code class="codeph">disable_on_error</code> parameter to <code class="codeph">n</code> so that the apply process will not be disabled if it encounters an error, and start the apply process for local apply at <code class="codeph">dbs2.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name  =&gt; 'apply_dbs2', 
    parameter   =&gt; 'disable_on_error', 
    value       =&gt; 'N');
END;
/
 
BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; 'apply_dbs2');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFFDHAA">
                              <!-- --></a>Configure the Apply Process at dbs2.example.com for Apply at dbs4.example.com
                        </dt>
                        <dd>
                           <p>Configure <code class="codeph">dbs2.example.com</code> to apply DML changes to the <code class="codeph">jobs</code> table at <code class="codeph">dbs4.example.com</code>, which is a Sybase database. Remember that these changes originated at <code class="codeph">dbs1.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  -- Create the rule set
  DBMS_RULE_ADM.CREATE_RULE_SET(
    rule_set_name      =&gt; 'strmadmin.apply_dbs4_rules',
  &nbsp;&nbsp;evaluation_context =&gt; 'SYS.STREAMS$_EVALUATION_CONTEXT');
  -- Create rule strmadmin.all_jobs_remote for all modifications 
  -- to the jobs table
  DBMS_RULE_ADM.CREATE_RULE(
    rule_name    =&gt; 'strmadmin.all_jobs_remote',
    condition    =&gt; ' :dml.get_object_owner() = ''HR'' AND ' ||
                    ' :dml.get_object_name() = ''JOBS'' AND ' || 
                    ' :dml.is_null_tag() = ''Y'' AND ' ||
                    ' :dml.get_source_database_name() = ''DBS1.EXAMPLE.COM'' ');
  -- Add the rule to the rule set
  DBMS_RULE_ADM.ADD_RULE(
    rule_name      =&gt; 'strmadmin.all_jobs_remote', 
    rule_set_name  =&gt; 'strmadmin.apply_dbs4_rules');
  -- Create an apply process that uses the rule set as its positive rule set
  DBMS_APPLY_ADM.CREATE_APPLY(
    queue_name          =&gt; 'strmadmin.streams_queue',
    apply_name          =&gt; 'apply_dbs4',
    rule_set_name       =&gt; 'strmadmin.apply_dbs4_rules',
    apply_database_link =&gt; 'dbs4.example.com',
    apply_captured      =&gt; TRUE,
    source_database     =&gt; 'dbs1.example.com');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFDCIII">
                              <!-- --></a>Start the Apply Process at dbs2.example.com for Apply at dbs4.example.com
                        </dt>
                        <dd>
                           <p>Set the <code class="codeph">disable_on_error</code> parameter to <code class="codeph">n</code> so that the apply process will not be disabled if it encounters an error, and start the remote apply for Sybase using database link <code class="codeph">dbs4.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name  =&gt; 'apply_dbs4', 
    parameter   =&gt; 'disable_on_error', 
    value       =&gt; 'N');
END;
/

BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; 'apply_dbs4');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFDHBJD">
                              <!-- --></a>Start the Capture Process at dbs1.example.com
                        </dt>
                        <dd>
                           <p>Connect to <code class="codeph">dbs1.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs1.example.com

/*
</pre><p>Start the capture process at <code class="codeph">dbs1.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_CAPTURE_ADM.START_CAPTURE(
    capture_name  =&gt; 'capture');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__CJFCEDAJ">
                              <!-- --></a>Check the Spool Results
                        </dt>
                        <dd>
                           <p>Check the <code class="codeph">streams_share_schema2.out</code> spool file to ensure that all actions finished successfully after this script is completed.
                           </p><pre class="oac_no_warn" dir="ltr">*/

SET ECHO OFF
SPOOL OFF

/*
</pre><p>You can now make DML and DDL changes to specific tables at <code class="codeph">dbs1.example.com</code> and see these changes replicated to the other databases in the environment based on the rules you configured for the Oracle Streams processes and propagations in this environment.
                           </p>
                           <div class="infoboxnotealso" id="GUID-09860484-7341-47FA-8FEA-92AA5202EE28__GUID-BC6CC350-1D32-4089-AD4C-C3CFAF8BFE75">
                              <p class="notep1">See Also:</p>
                              <p><span class="q">"<a href="single-source-heterogeneous-replication-example.html#GUID-55D3343C-9184-46EB-BD04-9AE07771AE47">Make DML and DDL Changes to Tables in the hr Schema</a>"</span> for examples of changes that are replicated in this environment
                              </p>
                           </div><pre class="oac_no_warn" dir="ltr">/*************************** END OF SCRIPT ******************************/</pre></dd>
                     </dl>
                  </div>
               </div>
            </div><a id="STREX1241"></a><a id="STREX1242"></a><a id="STREX1243"></a><a id="STREX556"></a><div class="props_rev_3"><a id="GUID-55D3343C-9184-46EB-BD04-9AE07771AE47" name="GUID-55D3343C-9184-46EB-BD04-9AE07771AE47"></a><h3 id="STREX-GUID-55D3343C-9184-46EB-BD04-9AE07771AE47" class="sect3"><span class="enumeration_section">2.5 </span>Make DML and DDL Changes to Tables in the hr Schema
               </h3>
               <div>
                  <div class="section">
                     <p>After completing either of the examples described in <span class="q">"<a href="single-source-heterogeneous-replication-example.html#GUID-40AD270B-4EC1-41CF-AF2E-67383BFD657B">Example Scripts for Sharing Data from One Database</a>"</span>, you can make DML and DDL changes to the tables in the <code class="codeph">hr</code> schema at the <code class="codeph">dbs1.example.com</code> database. These changes will be replicated to the other databases in the environment based on the rules you configured for Oracle Streams processes and propagations. You can check the other databases to see that the changes have been replicated. 
                     </p>
                     <p>For example, complete the following steps to make DML changes to the <code class="codeph">hr.jobs</code> and <code class="codeph">hr.locations</code> tables at <code class="codeph">dbs1.example.com</code>. You can also make a DDL change to the <code class="codeph">hr.locations</code> table at <code class="codeph">dbs1.example.com</code>.
                     </p>
                     <p>After you make these changes, you can query the <code class="codeph">hr.assignments</code> table at <code class="codeph">dbs2.example.com</code> to see that the DML change you made to this table at <code class="codeph">dbs1.example.com</code> has been replicated. Remember that a custom rule-based transformation configured for the apply process at <code class="codeph">dbs2.example.com</code> transforms DML changes to the <code class="codeph">hr.jobs</code> table into DML changes to the <code class="codeph">hr.assignments</code> table. You can also query the <code class="codeph">hr.locations</code> table at <code class="codeph">dbs3.example.com</code> to see that the DML and DDL changes you made to this table at <code class="codeph">dbs1.example.com</code> have been replicated.
                     </p>
                     <dl>
                        <dt><strong></strong></dt>
                        <dt class="dlterm"><a name="GUID-55D3343C-9184-46EB-BD04-9AE07771AE47__GUID-AC2F6E79-E77A-47B9-A4A0-C0E0D8B9E536">
                              <!-- --></a>Make DML and DDL Changes to Tables in the hr Schema
                        </dt>
                        <dd>
                           <p>Make the following changes:</p><pre class="oac_no_warn" dir="ltr">CONNECT hr@dbs1.example.com
Enter password: <span class="italic">password</span>

UPDATE hr.jobs SET max_salary=10000 WHERE job_id='MK_REP';
COMMIT;

INSERT INTO hr.locations VALUES(
  3300, '521 Ralston Avenue', '94002', 'Belmont', 'CA', 'US');
COMMIT;

ALTER TABLE hr.locations RENAME COLUMN state_province TO state_or_province;</pre></dd>
                        <dt class="dlterm"><a name="GUID-55D3343C-9184-46EB-BD04-9AE07771AE47__GUID-F13062DD-F035-41AA-B704-DD0061A668C0">
                              <!-- --></a>Query the hr.assignments Table at dbs2.example.com
                        </dt>
                        <dd>
                           <p>After some time passes to allow for capture, propagation, and apply of the changes performed the previous step, run the following query to confirm that the <code class="codeph">UPDATE</code> change made to the <code class="codeph">hr.jobs</code> table at <code class="codeph">dbs1.example.com</code> has been applied to the <code class="codeph">hr.assignments</code> table at <code class="codeph">dbs2.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">CONNECT hr@dbs2.example.com
Enter password: <span class="italic">password</span>

SELECT max_salary FROM hr.assignments WHERE job_id='MK_REP';
</pre><p>You should see <code class="codeph">10000</code> for the value of the <code class="codeph">max_salary</code>.
                           </p>
                        </dd>
                        <dt class="dlterm"><a name="GUID-55D3343C-9184-46EB-BD04-9AE07771AE47__GUID-565D92AA-35DE-4DD1-AD6D-FB9823C4768C">
                              <!-- --></a>Query and Describe the hr.locations Table at dbs3.example.com
                        </dt>
                        <dd>
                           <p>Run the following query to confirm that the <code class="codeph">INSERT</code> change made to the <code class="codeph">hr.locations</code> table at <code class="codeph">dbs1.example.com</code> has been applied at <code class="codeph">dbs3.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">CONNECT hr@dbs3.example.com
Enter password: <span class="italic">password</span>

SELECT * FROM hr.locations WHERE location_id=3300;
</pre><p>You should see the row inserted into the <code class="codeph">hr.locations</code> table at <code class="codeph">dbs1.example.com</code> in the previous step.
                           </p>
                           <p>Next, describe the <code class="codeph">hr.locations</code> table at to confirm that the <code class="codeph">ALTER</code> <code class="codeph">TABLE</code> change was propagated and applied correctly.
                           </p><pre class="oac_no_warn" dir="ltr">DESC hr.locations
</pre><p>The fifth column in the table should be <code class="codeph">state_or_province</code>.
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STREX557"></a><a id="STREX1244"></a><a id="STREX1245"></a><a id="STREX1246"></a><a id="STREX1247"></a><a id="STREX1248"></a><a id="STREX1249"></a><a id="STREX1250"></a><a id="STREX1251"></a><a id="STREX103"></a><div class="props_rev_3"><a id="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282" name="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282"></a><h3 id="STREX-GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282" class="sect3"><span class="enumeration_section">2.6 </span>Add Objects to an Existing Oracle Streams Replication Environment
               </h3>
               <div>
                  <div class="section">
                     <p>This example extends the Oracle Streams environment configured in the previous sections by adding replicated objects to an existing database. To complete this example, you must have completed the tasks in one of the previous examples in this chapter.</p>
                     <p>This example will add the following tables to the <code class="codeph">hr</code> schema in the <code class="codeph">dbs3.example.com</code> database:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><code class="codeph">departments</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">employees</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">job_history</code></p>
                        </li>
                        <li>
                           <p><code class="codeph">jobs</code></p>
                        </li>
                     </ul>
                     <p>When you complete this example, Oracle Streams processes changes to these tables with the following series of actions:</p>
                     <ol>
                        <li>
                           <p>The capture process captures changes at <code class="codeph">dbs1.example.com</code> and enqueues them at <code class="codeph">dbs1.example.com</code>.
                           </p>
                        </li>
                        <li>
                           <p>A propagation propagates changes from the queue at <code class="codeph">dbs1.example.com</code> to the queue at <code class="codeph">dbs2.example.com</code>.
                           </p>
                        </li>
                        <li>
                           <p>A propagation propagates changes from the queue at <code class="codeph">dbs2.example.com</code> to the queue at <code class="codeph">dbs3.example.com</code>.
                           </p>
                        </li>
                        <li>
                           <p>The apply process at <code class="codeph">dbs3.example.com</code> applies the changes at <code class="codeph">dbs3.example.com</code>.
                           </p>
                        </li>
                     </ol>
                     <p>When you complete this example, the <code class="codeph">hr</code> schema at the <code class="codeph">dbs3.example.com</code> database will have all of its original tables, because the <code class="codeph">countries</code>, <code class="codeph">locations</code>, and <code class="codeph">regions</code> tables were instantiated at <code class="codeph">dbs3.example.com</code> in the previous section. 
                     </p>
                     <p><a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFCFGFG">Figure 2-2</a> provides an overview of the environment with the added tables.
                     </p>
                     <div class="figure" id="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFCFGFG">
                        <p class="titleinfigure">Figure 2-2 Adding Objects to dbs3.example.com in the Environment</p><img src="img/strex003.gif" width="575" alt="Description of Figure 2-2 follows" title="Description of Figure 2-2 follows" longdesc="img_text/strex003.html"><br><a href="img_text/strex003.html">Description of "Figure 2-2 Adding Objects to dbs3.example.com in the Environment"</a></div>
                     <!-- class="figure" -->
                     <p>Complete the following steps to replicate these tables to the <code class="codeph">dbs3.example.com</code> database.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFHDIFJ">"Show Output and Spool Results"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFIBEFA">"Stop the Apply Process at dbs3.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFEJFIG">"Configure the Apply Process for the Added Tables at dbs3.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFBJJIF">"Specify the Table Propagation Rules for the Added Tables at dbs2.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFEEEHE">"Prepare the Four Added Tables for Instantiation at dbs1.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFIJIEH">"Instantiate the dbs1.example.com Tables at dbs3.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFFJCHI">"Start the Apply Process at dbs3.example.com"</a></span></li>
                     <li><span><a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFGEGEJ">"Check the Spool Results"</a></span></li>
                  </ol>
                  <div class="section">
                     <p></p>
                     <div class="infoboxnote" id="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__GUID-D6141635-F20D-40F6-9CF2-31475C1031E7">
                        <p class="notep1">Note:</p>
                        <p>If you are viewing this document online, then you can copy the text from the "BEGINNING OF SCRIPT" line after this note to the next "END OF SCRIPT" line into a text editor and then edit the text to create a script for your environment. Run the script with SQL*Plus on a computer that can connect to all of the databases in the environment.</p>
                     </div><pre class="oac_no_warn" dir="ltr">/************************* BEGINNING OF SCRIPT ******************************</pre><dl>
                        <dt><strong></strong></dt>
                        <dt class="dlterm"><a name="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFHDIFJ">
                              <!-- --></a>Show Output and Spool Results
                        </dt>
                        <dd>
                           <p>Run <code class="codeph">SET</code> <code class="codeph">ECHO</code> <code class="codeph">ON</code> and specify the spool file for the script. Check the spool file for errors after you run this script.
                           </p><pre class="oac_no_warn" dir="ltr">*/

SET ECHO ON
SPOOL streams_addobjs.out

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFIBEFA">
                              <!-- --></a>	Stop the Apply Process at dbs3.example.com
                        </dt>
                        <dd>
                           <p>Until you finish adding objects to <code class="codeph">dbs3.example.com</code>, you must ensure that the apply process that will apply changes for the added objects does not try to apply changes for these objects. You can do this by stopping the capture process at the source database. Or, you can do this by stopping propagation of changes from <code class="codeph">dbs2.example.com</code> to <code class="codeph">dbs3.example.com</code>. Yet another alternative is to stop the apply process at <code class="codeph">dbs3.example.com</code>. This example stops the apply process at <code class="codeph">dbs3.example.com</code>.
                           </p>
                           <p>Connect to <code class="codeph">dbs3.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs3.example.com

/*</pre><p></p>
                           <p>Stop the apply process at <code class="codeph">dbs3.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.STOP_APPLY(
    apply_name  =&gt; 'apply');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFEJFIG">
                              <!-- --></a>Configure the Apply Process for the Added Tables at dbs3.example.com
                        </dt>
                        <dd>
                           <p>Configure the apply process at <code class="codeph">dbs3.example.com</code> to apply changes to the tables you are adding.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.departments',
&nbsp;&nbsp;&nbsp;&nbsp;streams_type    =&gt; 'apply', 
    streams_name    =&gt; 'apply',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name      =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp; =&gt; TRUE,
    source_database =&gt; 'dbs1.example.com',
    inclusion_rule  =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.employees',
&nbsp;&nbsp;&nbsp;&nbsp;streams_type    =&gt; 'apply', 
    streams_name    =&gt; 'apply',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name      =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp; =&gt; TRUE,
    source_database =&gt; 'dbs1.example.com',
    inclusion_rule  =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.job_history',
&nbsp;&nbsp;&nbsp;&nbsp;streams_type    =&gt; 'apply', 
    streams_name    =&gt; 'apply',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name      =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp; =&gt; TRUE,
    source_database =&gt; 'dbs1.example.com',
    inclusion_rule  =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_RULES(
    table_name      =&gt; 'hr.jobs',
&nbsp;&nbsp;&nbsp;&nbsp;streams_type    =&gt; 'apply', 
    streams_name    =&gt; 'apply',
&nbsp;&nbsp;&nbsp;&nbsp;queue_name      =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp; =&gt; TRUE,
    source_database =&gt; 'dbs1.example.com',
    inclusion_rule  =&gt; TRUE);
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFBJJIF">
                              <!-- --></a>Specify the Table Propagation Rules for the Added Tables at dbs2.example.com
                        </dt>
                        <dd>
                           <p>Connect to <code class="codeph">dbs2.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs2.example.com

/*</pre><p></p>
                           <p>Add the tables to the rules for propagation from the queue at <code class="codeph">dbs2.example.com</code> to the queue at <code class="codeph">dbs3.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name               =&gt; 'hr.departments',
&nbsp;&nbsp;&nbsp;&nbsp;streams_name             =&gt; 'dbs2_to_dbs3',
&nbsp;&nbsp;&nbsp;&nbsp;source_queue_name        =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp;&nbsp;destination_queue_name   =&gt; 'strmadmin.streams_queue@dbs3.example.com', 
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;         =&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp;          =&gt; TRUE,
    source_database          =&gt; 'dbs1.example.com',
    inclusion_rule           =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name              =&gt; 'hr.employees',
&nbsp;&nbsp;&nbsp;&nbsp;streams_name            =&gt; 'dbs2_to_dbs3',
&nbsp;&nbsp;&nbsp;&nbsp;source_queue_name       =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp;&nbsp;destination_queue_name  =&gt; 'strmadmin.streams_queue@dbs3.example.com', 
&nbsp;&nbsp;&nbsp; include_dml &nbsp;         &nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp;         =&gt; TRUE,
    source_database         =&gt; 'dbs1.example.com',
    inclusion_rule          =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name              =&gt; 'hr.job_history',
&nbsp;&nbsp;&nbsp;&nbsp;streams_name            =&gt; 'dbs2_to_dbs3',
&nbsp;&nbsp;&nbsp;&nbsp;source_queue_name       =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp;&nbsp;destination_queue_name  =&gt; 'strmadmin.streams_queue@dbs3.example.com', 
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;        &nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;        &nbsp; =&gt; TRUE,
    source_database         =&gt; 'dbs1.example.com',
    inclusion_rule          =&gt; TRUE);
END;
/

BEGIN
  DBMS_STREAMS_ADM.ADD_TABLE_PROPAGATION_RULES(
    table_name              =&gt; 'hr.jobs',
&nbsp;&nbsp;&nbsp;&nbsp;streams_name            =&gt; 'dbs2_to_dbs3',
&nbsp;&nbsp;&nbsp;&nbsp;source_queue_name       =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp;&nbsp;destination_queue_name  =&gt; 'strmadmin.streams_queue@dbs3.example.com', 
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;        &nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;        &nbsp;&nbsp; =&gt; TRUE,
    source_database         =&gt; 'dbs1.example.com',
    inclusion_rule          =&gt; TRUE);
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFEEEHE">
                              <!-- --></a>Prepare the Four Added Tables for Instantiation at dbs1.example.com
                        </dt>
                        <dd>
                           <p>Connect to <code class="codeph">dbs1.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs1.example.com

/*
</pre><p>Prepare the tables for instantiation. These tables will be instantiated at <code class="codeph">dbs3.example.com</code>. This step marks the lowest SCN of the tables for instantiation. SCNs subsequent to the lowest SCN can be used for instantiation. Also, this preparation is necessary so that the Oracle Streams data dictionary for the relevant propagations and the apply process at <code class="codeph">dbs3.example.com</code> contain information about these tables.
                           </p>
                           <div class="infoboxnote" id="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__GUID-77DB7E4C-C75D-457F-902F-FDE680D9956F">
                              <p class="notep1">Note:</p>
                              <p>When the <code class="codeph">PREPARE_TABLE_INSTANTIATION</code> procedure is run in this step, the <code class="codeph">supplemental_logging</code> parameter is not specified. Therefore, the default value (<code class="codeph">keys</code>) is used for this parameter. Supplemental logging already was enabled for any primary key, unique key, bitmap index, and foreign key columns in these tables in Step <a href="single-source-heterogeneous-replication-example.html#GUID-31B023BA-4C18-4899-9B21-F260C7F2842E__CJFBEBJF">3</a>.
                              </p>
                           </div>
                           <div class="infoboxnotealso" id="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__GUID-8E8A0717-8EA6-4D06-A07F-3AA93E67E160">
                              <p class="notep1">See Also:</p>
                              <p><a href="../strep/instantiation-and-oracle-streams-replication.html#STREP115"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
                           </div><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_CAPTURE_ADM.PREPARE_TABLE_INSTANTIATION(
    table_name  =&gt; 'hr.departments');
END;
/
 
BEGIN
  DBMS_CAPTURE_ADM.PREPARE_TABLE_INSTANTIATION(
    table_name  =&gt; 'hr.employees');
END;
/

BEGIN
  DBMS_CAPTURE_ADM.PREPARE_TABLE_INSTANTIATION(
    table_name  =&gt; 'hr.job_history');
END;
/

BEGIN
  DBMS_CAPTURE_ADM.PREPARE_TABLE_INSTANTIATION(
    table_name  =&gt; 'hr.jobs');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFIJIEH">
                              <!-- --></a>Instantiate the dbs1.example.com Tables at dbs3.example.com
                        </dt>
                        <dd>
                           <p>This example performs a network Data Pump import of the following tables:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">hr.departments</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">hr.employees</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">hr.job_history</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">hr.jobs</code></p>
                              </li>
                           </ul>
                           <p>A network import means that Data Pump imports these tables from <code class="codeph">dbs1.example.com</code> without using an export dump file.
                           </p>
                           <div class="infoboxnotealso" id="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__GUID-3BCF1000-C25B-4EC1-83EF-CFE38A30CA99">
                              <p class="notep1">See Also:</p>
                              <p><a href="../sutil/index.html"><span class="italic">Oracle Database Utilities </span></a>for information about performing an import
                              </p>
                           </div>
                           <p>Connect to <code class="codeph">dbs3.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs3.example.com

/*
</pre><p>This example will do a table import using the <code class="codeph">DBMS_DATAPUMP</code> package. For simplicity, exceptions from any of the API calls will not be trapped. However, Oracle recommends that you define exception handlers and call <code class="codeph">GET_STATUS</code> to retrieve more detailed error information if a failure occurs. If you want to monitor the import, then query the <code class="codeph">DBA_DATAPUMP_JOBS</code> data dictionary view at the import database.
                           </p><pre class="oac_no_warn" dir="ltr">*/

SET SERVEROUTPUT ON
DECLARE
  h1        NUMBER;         -- Data Pump job handle
  sscn      NUMBER;         -- Variable to hold current source SCN
  job_state VARCHAR2(30);   -- To keep track of job state
  js        ku$_JobStatus;  -- The job status from GET_STATUS
  sts       ku$_Status;     -- The status object returned by GET_STATUS
  job_not_exist    exception;
  pragma exception_init(job_not_exist, -31626);
BEGIN
-- Create a (user-named) Data Pump job to do a table-level import.
  h1 := DBMS_DATAPUMP.OPEN(
          operation   =&gt; 'IMPORT',
          job_mode    =&gt; 'TABLE',
          remote_link =&gt; 'DBS1.EXAMPLE.COM',
          job_name    =&gt; 'dp_sing3');
-- A metadata filter is used to specify the schema that owns the tables 
-- that will be imported.
  DBMS_DATAPUMP.METADATA_FILTER(
    handle    =&gt; h1,
    name      =&gt; 'SCHEMA_EXPR',
    value     =&gt; '=''HR''');
-- A metadata filter is used to specify the tables that will be imported.
  DBMS_DATAPUMP.METADATA_FILTER(
    handle    =&gt; h1,
    name      =&gt; 'NAME_EXPR',
    value     =&gt; 'IN(''DEPARTMENTS'', ''EMPLOYEES'', 
                     ''JOB_HISTORY'', ''JOBS'')');
-- Get the current SCN of the source database, and set the FLASHBACK_SCN 
-- parameter to this value to ensure consistency between all of the 
-- objects included in the import.
  sscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER@dbs1.example.com();
  DBMS_DATAPUMP.SET_PARAMETER(
    handle =&gt; h1,
    name   =&gt; 'FLASHBACK_SCN',
    value  =&gt; sscn); 
-- Start the job. 
  DBMS_DATAPUMP.START_JOB(h1);
-- The import job should be running. In the following loop, the job
-- is monitored until it completes.
  job_state := 'UNDEFINED';
  BEGIN
    WHILE (job_state != 'COMPLETED') AND (job_state != 'STOPPED') LOOP
      sts:=DBMS_DATAPUMP.GET_STATUS(
             handle  =&gt; h1,
             mask    =&gt; DBMS_DATAPUMP.KU$_STATUS_JOB_ERROR +
                        DBMS_DATAPUMP.KU$_STATUS_JOB_STATUS +
                        DBMS_DATAPUMP.KU$_STATUS_WIP,
             timeout =&gt; -1);
      js := sts.job_status;
      DBMS_LOCK.SLEEP(10);
      job_state := js.state;
    END LOOP;
  -- Gets an exception when job no longer exists
    EXCEPTION WHEN job_not_exist THEN
      DBMS_OUTPUT.PUT_LINE('Data Pump job has completed');
      DBMS_OUTPUT.PUT_LINE('Instantiation SCN: ' ||sscn);
  END;
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFFJCHI">
                              <!-- --></a>	Start the Apply Process at dbs3.example.com
                        </dt>
                        <dd>
                           <p>Start the apply process at <code class="codeph">dbs3.example.com</code>. This apply process was stopped in Step <a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFIBEFA">"Stop the Apply Process at dbs3.example.com"</a>.
                           </p>
                           <p>Connect to <code class="codeph">dbs3.example.com</code> as the <code class="codeph">strmadmin</code> user.
                           </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs3.example.com

/*</pre><p></p>
                           <p>Start the apply process at <code class="codeph">dbs3.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; 'apply');
END;
/

/*</pre></dd>
                        <dt class="dlterm"><a name="GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282__CJFGEGEJ">
                              <!-- --></a>Check the Spool Results
                        </dt>
                        <dd>
                           <p>Check the <code class="codeph">streams_addobjs.out</code> spool file to ensure that all actions finished successfully after this script is completed.
                           </p><pre class="oac_no_warn" dir="ltr">*/

SET ECHO OFF
SPOOL OFF

/*************************** END OF SCRIPT ******************************/</pre></dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STREX1252"></a><a id="STREX1253"></a><a id="STREX558"></a><div class="props_rev_3"><a id="GUID-1CE0338C-A42A-4CF6-82B4-3062E2308092" name="GUID-1CE0338C-A42A-4CF6-82B4-3062E2308092"></a><h3 id="STREX-GUID-1CE0338C-A42A-4CF6-82B4-3062E2308092" class="sect3"><span class="enumeration_section">2.7 </span>Make a DML Change to the hr.employees Table
               </h3>
               <div>
                  <div class="section">
                     <p>After completing the examples described in the <span class="q">"<a href="single-source-heterogeneous-replication-example.html#GUID-FA2A0665-CB67-4A17-809A-95C2DC51F282">Add Objects to an Existing Oracle Streams Replication Environment</a>"</span> section, you can make DML and DDL changes to the tables in the <code class="codeph">hr</code> schema at the <code class="codeph">dbs1.example.com</code> database. These changes will be replicated to <code class="codeph">dbs3.example.com</code>. You can check these tables at <code class="codeph">dbs3.example.com</code> to see that the changes have been replicated. 
                     </p>
                     <p>For example, complete the following steps to make a DML change to the <code class="codeph">hr.employees</code> table at <code class="codeph">dbs1.example.com</code>. Next, query the <code class="codeph">hr.employees</code> table at <code class="codeph">dbs3.example.com</code> to see that the change has been replicated.
                     </p>
                     <dl>
                        <dt><strong></strong></dt>
                        <dt class="dlterm"><a name="GUID-1CE0338C-A42A-4CF6-82B4-3062E2308092__GUID-077AD59A-A556-4E2D-BCF7-2D6440D3D1C8">
                              <!-- --></a>Make a DML Change to the hr.employees Table
                        </dt>
                        <dd>
                           <p>Make the following change:</p><pre class="oac_no_warn" dir="ltr">CONNECT hr@dbs1.example.com
Enter password: <span class="italic">password</span>

UPDATE hr.employees SET job_id='ST_MAN' WHERE employee_id=143;
COMMIT;</pre></dd>
                        <dt class="dlterm"><a name="GUID-1CE0338C-A42A-4CF6-82B4-3062E2308092__GUID-2DD39579-63B3-4970-BA9E-C9B8A2C27EAB">
                              <!-- --></a>Query the hr.employees Table at dbs3.example.com
                        </dt>
                        <dd>
                           <p>After some time passes to allow for capture, propagation, and apply of the change performed in the previous step, run the following query to confirm that the <code class="codeph">UPDATE</code> change made to the <code class="codeph">hr.employees</code> table at <code class="codeph">dbs1.example.com</code> has been applied to the <code class="codeph">hr.employees</code> table at <code class="codeph">dbs3.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">CONNECT hr@dbs3.example.com
Enter password: <span class="italic">password</span>

SELECT job_id FROM hr.employees WHERE employee_id=143;
</pre><p>You should see <code class="codeph">ST_MAN</code> for the value of the <code class="codeph">job_id</code>.
                           </p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STREX559"></a><a id="STREX1254"></a><a id="STREX1255"></a><a id="STREX1256"></a><a id="STREX1257"></a><a id="STREX1258"></a><a id="STREX1259"></a><a id="STREX1260"></a><a id="STREX1261"></a><a id="STREX1262"></a><a id="STREX1263"></a><a id="STREX1264"></a><a id="STREX1265"></a><a id="STREX1266"></a><a id="STREX1267"></a><a id="STREX104"></a><div class="props_rev_3"><a id="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7" name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7"></a><h3 id="STREX-GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7" class="sect3"><span class="enumeration_section">2.8 </span>Add a Database to an Existing Oracle Streams Replication Environment
               </h3>
               <div>
                  <p>This example extends the Oracle Streams environment configured in the previous sections by adding an additional database to the existing configuration. In this example, an existing Oracle database named <code class="codeph">dbs5.example.com</code> is added to receive changes to the entire <code class="codeph">hr</code> schema from the queue at <code class="codeph">dbs2.example.com</code>. 
                  </p>
                  <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__i1008946">Figure 2-3</a> provides an overview of the environment with the added database.
                  </p>
                  <div class="figure" id="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__i1008946">
                     <p class="titleinfigure">Figure 2-3 Adding the dbs5.example.com Oracle Database to the Environment</p><img src="img/strex001.gif" width="587" alt="Description of Figure 2-3 follows" title="Description of Figure 2-3 follows" longdesc="img_text/strex001.html"><br><a href="img_text/strex001.html">Description of "Figure 2-3 Adding the dbs5.example.com Oracle Database to the Environment"</a></div>
                  <!-- class="figure" -->
                  <p>To complete this example, you must meet the following prerequisites:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The <code class="codeph">dbs5.example.com</code> database must exist.
                        </p>
                     </li>
                     <li>
                        <p>The <code class="codeph">dbs2.example.com</code> and <code class="codeph">dbs5.example.com</code> databases must be able to communicate with each other through Oracle Net.
                        </p>
                     </li>
                     <li>
                        <p>The <code class="codeph">dbs5.example.com</code> and <code class="codeph">dbs1.example.com</code> databases must be able to communicate with each other through Oracle Net (for optional Data Pump network instantiation).
                        </p>
                     </li>
                     <li>
                        <p>You must have completed the tasks in the previous examples in this chapter.</p>
                     </li>
                     <li>
                        <p>The <span class="q">"<a href="single-source-heterogeneous-replication-example.html#GUID-197A1C30-95C8-4160-BFCC-F53A90A69BE9">Prerequisites</a>"</span> must be met if you want the entire Oracle Streams environment to work properly.
                        </p>
                     </li>
                     <li>
                        <p>This examples creates a new user to function as the Oracle Streams administrator (<code class="codeph">strmadmin</code>) at the <code class="codeph">dbs5.example.com</code> database and prompts you for the tablespace you want to use for this user's data. Before you start this example, either create a new tablespace or identify an existing tablespace for the Oracle Streams administrator to use at the <code class="codeph">dbs5.example.com</code> database. The Oracle Streams administrator should not use the <code class="codeph">SYSTEM</code> tablespace.
                        </p>
                     </li>
                  </ul>
                  <p>Complete the following steps to add <code class="codeph">dbs5.example.com</code> to the Oracle Streams environment.
                  </p>
                  <ol>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFJIBGD">"Show Output and Spool Results"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFHIJEG">"Drop All of the Tables in the hr Schema at dbs5.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFJGFBE">"Set Up Users at dbs5.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFHAHAA">"Create the ANYDATA Queue at dbs5.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFCDJGC">"Create a Database Link at dbs5.example.com to dbs1.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFDDBGA">"Configure the Apply Process at dbs5.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFCHEAC">"Specify hr as the Apply User for the Apply Process at dbs5.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFBHJHJ">"Grant the hr User Execute Privilege on the Apply Process Rule Set"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFIDAEC">"Create the Database Link Between dbs2.example.com and dbs5.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFDGGCG">"Configure Propagation Between dbs2.example.com and dbs5.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFBEDGC">"Prepare the hr Schema for Instantiation at dbs1.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFFACCJ">"Instantiate the dbs1.example.com Tables at dbs5.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFJDGDB">"Start the Apply Process at dbs5.example.com"</a></p>
                     </li>
                     <li>
                        <p><a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFGGDEI">"Check the Spool Results"</a></p>
                     </li>
                  </ol>
                  <p></p>
                  <div class="infoboxnote" id="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__GUID-C705A978-DF7F-4D40-B118-306844F4A42A">
                     <p class="notep1">Note:</p>
                     <p>If you are viewing this document online, then you can copy the text from the "BEGINNING OF SCRIPT" line after this note to the next "END OF SCRIPT" line into a text editor and then edit the text to create a script for your environment. Run the script with SQL*Plus on a computer that can connect to all of the databases in the environment.</p>
                  </div><pre class="oac_no_warn" dir="ltr">/************************* BEGINNING OF SCRIPT ******************************</pre><dl>
                     <dt><strong></strong></dt>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFJIBGD">
                           <!-- --></a>Show Output and Spool Results
                     </dt>
                     <dd>
                        <p>Run <code class="codeph">SET</code> <code class="codeph">ECHO</code> <code class="codeph">ON</code> and specify the spool file for the script. Check the spool file for errors after you run this script.
                        </p><pre class="oac_no_warn" dir="ltr">*/

SET ECHO ON
SPOOL streams_adddb.out

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFHIJEG">
                           <!-- --></a>Drop All of the Tables in the hr Schema at dbs5.example.com
                     </dt>
                     <dd>
                        <p>This example illustrates instantiating the tables in the <code class="codeph">hr</code> schema by importing them from <code class="codeph">dbs1.example.com</code> into <code class="codeph">dbs5.example.com</code> using Data Pump. You must delete these tables at <code class="codeph">dbs5.example.com</code> for the instantiation portion of this example to work properly.
                        </p>
                        <p>Connect as <code class="codeph">hr</code> at <code class="codeph">dbs5.example.com</code>.
                        </p><pre class="oac_no_warn" dir="ltr">*/

CONNECT hr@dbs5.example.com

/*
</pre><p>Drop all tables in the <code class="codeph">hr</code> schema in the <code class="codeph">dbs5.example.com</code> database. 
                        </p>
                        <div class="infoboxnote" id="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__GUID-0DFEBB48-C175-4288-B364-DE0B12D62E60">
                           <p class="notep1">Note:</p>
                           <p>If you complete this step and drop all of the tables in the <code class="codeph">hr</code> schema, then you should complete the remaining sections of this example to reinstantiate the <code class="codeph">hr</code> schema at <code class="codeph">dbs5.example.com</code>. If the <code class="codeph">hr</code> schema does not exist in an Oracle database, then some examples in the Oracle documentation set can fail.
                           </p>
                        </div><pre class="oac_no_warn" dir="ltr">*/

DROP TABLE hr.countries CASCADE CONSTRAINTS;
DROP TABLE hr.departments CASCADE CONSTRAINTS;
DROP TABLE hr.employees CASCADE CONSTRAINTS;
DROP TABLE hr.job_history CASCADE CONSTRAINTS;
DROP TABLE hr.jobs CASCADE CONSTRAINTS;
DROP TABLE hr.locations CASCADE CONSTRAINTS;
DROP TABLE hr.regions CASCADE CONSTRAINTS;

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFJGFBE">
                           <!-- --></a>Set Up Users at dbs5.example.com
                     </dt>
                     <dd>
                        <p>Connect to <code class="codeph">dbs5.example.com</code> as <code class="codeph">SYSTEM</code> user.
                        </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT system@dbs5.example.com

/*
</pre><p>Create the Oracle Streams administrator named <code class="codeph">strmadmin</code> and grant this user the necessary privileges. These privileges enable the user to manage queues, execute subprograms in packages related to Oracle Streams, create rule sets, create rules, and monitor the Oracle Streams environment by querying data dictionary views and queue tables. You can choose a different name for this user.
                        </p>
                        <div class="infoboxnote" id="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__GUID-43B04369-5182-4E6B-A6AC-DD9E4EC2AB2E">
                           <p class="notep1">Note:</p>
                           <p>The <code class="codeph">ACCEPT</code> command must appear on a single line in the script.
                           </p>
                        </div>
                        <div class="infoboxnotealso" id="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__GUID-26487295-BE1B-4C4E-AC02-E41D1C1812E6">
                           <p class="notep1">See Also:</p>
                           <p><a href="../strep/preparing-for-oracle-streams-replication.html#STREP200"><span class="italic">Oracle Streams Replication Administrator's Guide </span></a>for more information about configuring an Oracle Streams administrator
                           </p>
                        </div><pre class="oac_no_warn" dir="ltr">*/

ACCEPT password PROMPT 'Enter password for user: ' HIDE

GRANT DBA TO strmadmin IDENTIFIED BY &amp;password;

ACCEPT streams_tbs PROMPT 'Enter Oracle Streams administrator tablespace on dbs5.example.com: ' HIDE

ALTER USER strmadmin DEFAULT TABLESPACE &amp;streams_tbs
                     QUOTA UNLIMITED ON &amp;streams_tbs;

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFHAHAA">
                           <!-- --></a>Create the ANYDATA Queue at dbs5.example.com
                     </dt>
                     <dd>
                        <p>Connect as the Oracle Streams administrator at the database you are adding. In this example, that database is <code class="codeph">dbs5.example.com</code>.
                        </p><pre class="oac_no_warn" dir="ltr">*/

CONNECT strmadmin@dbs5.example.com

/*
</pre><p>Run the <code class="codeph">SET_UP_QUEUE</code> procedure to create a queue named <code class="codeph">streams_queue</code> at <code class="codeph">dbs5.example.com</code>. This queue will function as the <code class="codeph">ANYDATA</code> queue by holding the changes that will be applied at this database.
                        </p>
                        <p>Running the <code class="codeph">SET_UP_QUEUE</code> procedure performs the following actions:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Creates a queue table named <code class="codeph">streams_queue_table</code>. This queue table is owned by the Oracle Streams administrator (<code class="codeph">strmadmin</code>) and uses the default storage of this user.
                              </p>
                           </li>
                           <li>
                              <p>Creates a queue named <code class="codeph">streams_queue</code> owned by the Oracle Streams administrator (<code class="codeph">strmadmin</code>).
                              </p>
                           </li>
                           <li>
                              <p>Starts the queue.</p>
                           </li>
                        </ul>
                        <p></p><pre class="oac_no_warn" dir="ltr">*/

EXEC  DBMS_STREAMS_ADM.SET_UP_QUEUE();

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFCDJGC">
                           <!-- --></a><span>Create a Database Link at dbs5.example.com to dbs1.example.com</span></dt>
                     <dd>
                        <p>Create a database link from <code class="codeph">dbs5.example.com</code> to <code class="codeph">dbs1.example.com</code>. Later in this example, this database link is used for the instantiation of the database objects that were dropped in Step <a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFHIJEG">"Drop All of the Tables in the hr Schema at dbs5.example.com"</a>. This example uses the <code class="codeph">DBMS_DATAPUMP</code> package to perform a network import of these database objects directly from the <code class="codeph">dbs1.example.com</code> database. Because this example performs a network import, no dump file is required.
                        </p>
                        <p>Alternatively, you can perform an export at the source database <code class="codeph">dbs1.example.com</code>, transfer the export dump file to the destination database <code class="codeph">dbs5.example.com</code>, and then import the export dump file at the destination database. In this case, the database link created in this step is not required.
                        </p><pre class="oac_no_warn" dir="ltr">*/

CREATE DATABASE LINK dbs1.example.com CONNECT TO strmadmin 
   IDENTIFIED BY &amp;password USING 'dbs1.example.com';

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFDDBGA">
                           <!-- --></a>Configure the Apply Process at dbs5.example.com
                     </dt>
                     <dd>
                        <p>While still connected as the Oracle Streams administrator at <code class="codeph">dbs5.example.com</code>, configure the apply process to apply changes to the <code class="codeph">hr</code> schema.
                        </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_STREAMS_ADM.ADD_SCHEMA_RULES(
    schema_name     =&gt; 'hr',   
    streams_type    =&gt; 'apply',
    streams_name    =&gt; 'apply',
    queue_name      =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; include_dml &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;&nbsp; =&gt; TRUE,
    source_database =&gt; 'dbs1.example.com',
    inclusion_rule  =&gt; TRUE);
END;
/

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFCHEAC">
                           <!-- --></a>Specify hr as the Apply User for the Apply Process at dbs5.example.com
                     </dt>
                     <dd>
                        <p>In this example, the <code class="codeph">hr</code> user owns all of the database objects for which changes are applied by the apply process at this database. Therefore, <code class="codeph">hr</code> already has the necessary privileges to change these database objects, and it is convenient to make <code class="codeph">hr</code> the apply user. 
                        </p>
                        <p>When the apply process was created in the previous step, the Oracle Streams administrator <code class="codeph">strmadmin</code> was specified as the apply user by default, because <code class="codeph">strmadmin</code> ran the procedure that created the apply process. Instead of specifying hr as the apply user, you could retain <code class="codeph">strmadmin</code> as the apply user, but then you must grant <code class="codeph">strmadmin</code> privileges on all of the database objects for which changes are applied and privileges to execute all user procedures used by the apply process. In an environment where an apply process applies changes to database objects in multiple schemas, it might be more convenient to use the Oracle Streams administrator as the apply user.
                        </p>
                        <div class="infoboxnotealso" id="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__GUID-787A94CA-FF0A-41C5-8466-8E82387889E8">
                           <p class="notep1">See Also:</p>
                           <p><a href="../strep/preparing-for-oracle-streams-replication.html#STREP200"><span class="italic">Oracle Streams Replication Administrator's Guide </span></a>for more information about configuring an Oracle Streams administrator
                           </p>
                        </div><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.ALTER_APPLY(
    apply_name =&gt; 'apply',
    apply_user =&gt; 'hr');
END;
/

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFBHJHJ">
                           <!-- --></a>Grant the hr User Execute Privilege on the Apply Process Rule Set
                     </dt>
                     <dd>
                        <p>Because the <code class="codeph">hr</code> user was specified as the apply user in the previous step, the <code class="codeph">hr</code> user requires <code class="codeph">EXECUTE</code> privilege on the positive rule set used by the apply process
                        </p><pre class="oac_no_warn" dir="ltr">*/

DECLARE
   rs_name  VARCHAR2(64);   -- Variable to hold rule set name
BEGIN
  SELECT RULE_SET_OWNER||'.'||RULE_SET_NAME 
    INTO rs_name 
    FROM DBA_APPLY 
    WHERE APPLY_NAME='APPLY';
  DBMS_RULE_ADM.GRANT_OBJECT_PRIVILEGE(
    privilege   =&gt; SYS.DBMS_RULE_ADM.EXECUTE_ON_RULE_SET,
    object_name =&gt; rs_name,
    grantee     =&gt; 'hr');
END;
/

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFIDAEC">
                           <!-- --></a>Create the Database Link Between dbs2.example.com and dbs5.example.com
                     </dt>
                     <dd>
                        <p>Connect to <code class="codeph">dbs2.example.com</code> as the <code class="codeph">strmadmin</code> user.
                        </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs2.example.com

/*
</pre><p>Create the database links to the databases where changes are propagated. In this example, database <code class="codeph">dbs2.example.com</code> propagates changes to <code class="codeph">dbs5.example.com</code>.
                        </p><pre class="oac_no_warn" dir="ltr">*/

CREATE DATABASE LINK dbs5.example.com CONNECT TO strmadmin 
   IDENTIFIED BY &amp;password USING 'dbs5.example.com';

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFDGGCG">
                           <!-- --></a>Configure Propagation Between dbs2.example.com and dbs5.example.com
                     </dt>
                     <dd>
                        <p>While still connected as the Oracle Streams administrator at <code class="codeph">dbs2.example.com</code>, configure and schedule propagation from the queue at <code class="codeph">dbs2.example.com</code> to the queue at <code class="codeph">dbs5.example.com</code>. Remember, changes to the <code class="codeph">hr</code> schema originated at <code class="codeph">dbs1.example.com</code>.
                        </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_STREAMS_ADM.ADD_SCHEMA_PROPAGATION_RULES(
&nbsp;&nbsp;&nbsp; schema_name             =&gt; 'hr', 
&nbsp;&nbsp; &nbsp;streams_name            =&gt; 'dbs2_to_dbs5', 
&nbsp;&nbsp; &nbsp;source_queue_name       =&gt; 'strmadmin.streams_queue',
&nbsp;&nbsp;&nbsp; destination_queue_name  =&gt; 'strmadmin.streams_queue@dbs5.example.com',
&nbsp;&nbsp;&nbsp; include_dml         &nbsp;&nbsp;&nbsp;&nbsp;=&gt; TRUE,
&nbsp;&nbsp;  include_ddl &nbsp;&nbsp;        &nbsp; =&gt; TRUE,
    source_database         =&gt; 'dbs1.example.com',
    inclusion_rule          =&gt; TRUE,
    queue_to_queue          =&gt; TRUE);
END;
/

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFBEDGC">
                           <!-- --></a>Prepare the hr Schema for Instantiation at dbs1.example.com
                     </dt>
                     <dd>
                        <p>Connect to <code class="codeph">dbs1.example.com</code> as the <code class="codeph">strmadmin</code> user.
                        </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs1.example.com

/*
</pre><p>Prepare the <code class="codeph">hr</code> schema for instantiation. These tables in this schema will be instantiated at <code class="codeph">dbs5.example.com</code>. This preparation is necessary so that the Oracle Streams data dictionary for the relevant propagations and the apply process at <code class="codeph">dbs5.example.com</code> contain information about the <code class="codeph">hr</code> schema and the objects in the schema.
                        </p>
                        <div class="infoboxnotealso" id="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__GUID-C567AA82-057F-40FD-939E-AA433C936E73">
                           <p class="notep1">See Also:</p>
                           <p><a href="../strep/instantiation-and-oracle-streams-replication.html#STREP115"><span class="italic">Oracle Streams Replication Administrator's Guide</span></a></p>
                        </div><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_CAPTURE_ADM.PREPARE_SCHEMA_INSTANTIATION(
    schema_name          =&gt; 'hr',
    supplemental_logging =&gt; 'keys');
END;
/

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFFACCJ">
                           <!-- --></a>Instantiate the dbs1.example.com Tables at dbs5.example.com
                     </dt>
                     <dd>
                        <p>This example performs a network Data Pump import of the following tables:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">hr.countries</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">hr.departments</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">hr.employees</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">hr.job_history</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">hr.jobs</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">hr.locations</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">hr.regions</code></p>
                           </li>
                        </ul>
                        <p>A network import means that Data Pump imports these tables from <code class="codeph">dbs1.example.com</code> without using an export dump file.
                        </p>
                        <div class="infoboxnotealso" id="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__GUID-0E18C102-0363-4614-B526-D5ECDD5BD2E3">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strex&amp;id=SUTIL"><span class="italic">Oracle Database Utilities </span></a>for information about performing an import
                           </p>
                        </div>
                        <p>Connect to <code class="codeph">dbs5.example.com</code> as the <code class="codeph">strmadmin</code> user.
                        </p><pre class="oac_no_warn" dir="ltr">*/
 
CONNECT strmadmin@dbs5.example.com

/*
</pre><p>This example will do a table import using the <code class="codeph">DBMS_DATAPUMP</code> package. For simplicity, exceptions from any of the API calls will not be trapped. However, Oracle recommends that you define exception handlers and call <code class="codeph">GET_STATUS</code> to retrieve more detailed error information if a failure occurs. If you want to monitor the import, then query the <code class="codeph">DBA_DATAPUMP_JOBS</code> data dictionary view at the import database.
                        </p><pre class="oac_no_warn" dir="ltr">*/

SET SERVEROUTPUT ON
DECLARE
  h1        NUMBER;         -- Data Pump job handle
  sscn      NUMBER;         -- Variable to hold current source SCN
  job_state VARCHAR2(30);   -- To keep track of job state
  js        ku$_JobStatus;  -- The job status from GET_STATUS
  sts       ku$_Status;     -- The status object returned by GET_STATUS
  job_not_exist    exception;
  pragma exception_init(job_not_exist, -31626);
BEGIN
-- Create a (user-named) Data Pump job to do a table-level import.
  h1 := DBMS_DATAPUMP.OPEN(
          operation   =&gt; 'IMPORT',
          job_mode    =&gt; 'TABLE',
          remote_link =&gt; 'DBS1.EXAMPLE.COM',
          job_name    =&gt; 'dp_sing4');
-- A metadata filter is used to specify the schema that owns the tables 
-- that will be imported.
  DBMS_DATAPUMP.METADATA_FILTER(
    handle    =&gt; h1,
    name      =&gt; 'SCHEMA_EXPR',
    value     =&gt; '=''HR''');
-- Get the current SCN of the source database, and set the FLASHBACK_SCN 
-- parameter to this value to ensure consistency between all of the 
-- objects included in the import.
  sscn := DBMS_FLASHBACK.GET_SYSTEM_CHANGE_NUMBER@dbs1.example.com();
  DBMS_DATAPUMP.SET_PARAMETER(
    handle =&gt; h1,
    name   =&gt; 'FLASHBACK_SCN',
    value  =&gt; sscn); 
-- Start the job. 
  DBMS_DATAPUMP.START_JOB(h1);
-- The import job should be running. In the following loop, the job
-- is monitored until it completes.
  job_state := 'UNDEFINED';
  BEGIN
    WHILE (job_state != 'COMPLETED') AND (job_state != 'STOPPED') LOOP
      sts:=DBMS_DATAPUMP.GET_STATUS(
             handle  =&gt; h1,
             mask    =&gt; DBMS_DATAPUMP.KU$_STATUS_JOB_ERROR +
                        DBMS_DATAPUMP.KU$_STATUS_JOB_STATUS +
                        DBMS_DATAPUMP.KU$_STATUS_WIP,
             timeout =&gt; -1);
      js := sts.job_status;
      DBMS_LOCK.SLEEP(10);
      job_state := js.state;
    END LOOP;
  -- Gets an exception when job no longer exists
    EXCEPTION WHEN job_not_exist THEN
      DBMS_OUTPUT.PUT_LINE('Data Pump job has completed');
      DBMS_OUTPUT.PUT_LINE('Instantiation SCN: ' ||sscn);
  END;
END;
/

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFJDGDB">
                           <!-- --></a>Start the Apply Process at dbs5.example.com
                     </dt>
                     <dd>
                        <p>Connect as the Oracle Streams administrator at <code class="codeph">dbs5.example.com</code>.
                        </p><pre class="oac_no_warn" dir="ltr">*/

CONNECT strmadmin@dbs5.example.com

/*
</pre><p>Set the <code class="codeph">disable_on_error</code> parameter to <code class="codeph">n</code> so that the apply process will not be disabled if it encounters an error, and start apply process at <code class="codeph">dbs5.example.com</code>.
                        </p><pre class="oac_no_warn" dir="ltr">*/

BEGIN
  DBMS_APPLY_ADM.SET_PARAMETER(
    apply_name  =&gt; 'apply', 
    parameter   =&gt; 'disable_on_error', 
    value       =&gt; 'N');
END;
/

BEGIN
  DBMS_APPLY_ADM.START_APPLY(
    apply_name  =&gt; 'apply');
END;
/

/*</pre></dd>
                     <dt class="dlterm"><a name="GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7__CJFGGDEI">
                           <!-- --></a>Check the Spool Results
                     </dt>
                     <dd>
                        <p>Check the <code class="codeph">streams_adddb.out</code> spool file to ensure that all actions finished successfully after this script is completed.
                        </p><pre class="oac_no_warn" dir="ltr">*/

SET ECHO OFF
SPOOL OFF

/*************************** END OF SCRIPT ******************************/</pre></dd>
                  </dl>
               </div>
            </div><a id="STREX1268"></a><a id="STREX1269"></a><a id="STREX560"></a><div class="props_rev_3"><a id="GUID-46179B80-26A4-4655-A1B4-AE9A9D540923" name="GUID-46179B80-26A4-4655-A1B4-AE9A9D540923"></a><h3 id="STREX-GUID-46179B80-26A4-4655-A1B4-AE9A9D540923" class="sect3"><span class="enumeration_section">2.9 </span>Make a DML Change to the hr.departments Table
               </h3>
               <div>
                  <div class="section">
                     <p>After completing the examples described in the <span class="q">"<a href="single-source-heterogeneous-replication-example.html#GUID-1ECC3DFB-6E46-455B-9260-7FCC10EF16E7">Add a Database to an Existing Oracle Streams Replication Environment</a>"</span> section, you can make DML and DDL changes to the tables in the <code class="codeph">hr</code> schema at the <code class="codeph">dbs1.example.com</code> database. These changes will be replicated to <code class="codeph">dbs5.example.com</code>. You can check these tables at <code class="codeph">dbs5.example.com</code> to see that the changes have been replicated. 
                     </p>
                     <p>For example, complete the following steps to make a DML change to the <code class="codeph">hr.departments</code> table at <code class="codeph">dbs1.example.com</code>. Next, query the <code class="codeph">hr.departments</code> table at <code class="codeph">dbs5.example.com</code> to see that the change has been replicated.
                     </p>
                     <dl>
                        <dt><strong></strong></dt>
                        <dt class="dlterm"><a name="GUID-46179B80-26A4-4655-A1B4-AE9A9D540923__GUID-F4A68532-5630-4B85-8D98-4DBC512B52DF">
                              <!-- --></a>Make a DML Change to the hr.departments Table
                        </dt>
                        <dd>
                           <p>Make the following change:</p><pre class="oac_no_warn" dir="ltr">CONNECT hr@dbs1.example.com
Enter password: <span class="italic">password</span>

UPDATE hr.departments SET location_id=2400 WHERE department_id=270;
COMMIT;</pre></dd>
                        <dt class="dlterm"><a name="GUID-46179B80-26A4-4655-A1B4-AE9A9D540923__GUID-769514FC-EC7B-49E6-8E67-0526037C78A1">
                              <!-- --></a>Query the hr.departments Table at dbs5.example.com
                        </dt>
                        <dd>
                           <p>After some time passes to allow for capture, propagation, and apply of the change performed in the previous step, run the following query to confirm that the <code class="codeph">UPDATE</code> change made to the <code class="codeph">hr.departments</code> table at <code class="codeph">dbs1.example.com</code> has been applied to the <code class="codeph">hr.departments</code> table at <code class="codeph">dbs5.example.com</code>.
                           </p><pre class="oac_no_warn" dir="ltr">CONNECT hr@dbs5.example.com
Enter password: <span class="italic">password</span>

SELECT location_id FROM hr.departments WHERE department_id=270;
</pre><p>You should see <code class="codeph">2400</code> for the value of the <code class="codeph">location_id</code>.
                           </p>
                           <p></p>
                        </dd>
                     </dl>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>