<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Programming with Microsoft Transaction Server and an Oracle Database</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide for Microsoft Windows">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-services-microsoft-transaction-server.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-08-05T10:28:43-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E90597-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      
      <link rel="prev" href="managing-recovery-scenarios.html" title="Previous" type="text/html">
      <link rel="next" href="perf-tuning.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OracleÂ® Services for Microsoft Transaction Server">
    <meta name="dcterms.isVersionOf" content="NTMTS">
    <meta name="dcterms.release" content="Release 18">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="managing-recovery-scenarios.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="perf-tuning.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Programming with Microsoft Transaction Server and an Oracle Database</li>
            </ol>
            <a id="GUID-70EE6069-5461-46D9-A207-938A028052D8" name="GUID-70EE6069-5461-46D9-A207-938A028052D8"></a><a id="NTMTS005"></a>
            
            <h2 id="NTMTS-GUID-70EE6069-5461-46D9-A207-938A028052D8" class="sect2"><span class="enumeration_chapter">4 </span> Programming with Microsoft Transaction Server and an Oracle Database
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>These topics describe how to program with <a href="glossary.html#GUID-10C5A220-53B1-4AE6-AD1F-12B8C90EDB91"><span class="xrefglossterm">Microsoft Transaction Server</span></a> and an Oracle Database. 
               </p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="program.html#GUID-C3016C47-E376-4859-AFFD-63CF512D5FA8">COM Component Integration in a Transaction</a></p>
                  </li>
                  <li>
                     <p><a href="program.html#GUID-26813166-65BB-425A-9EBD-BA2F54A0C678">Microsoft Transaction Server Application Development</a></p>
                  </li>
                  <li>
                     <p><a href="program.html#GUID-DB43712F-BD4E-404B-8F3D-67628B127735">OCI Integration with Microsoft Transaction Server</a></p>
                  </li>
                  <li>
                     <p><a href="program.html#GUID-19CAEBCB-68FD-413B-9814-842FDC67FEA3">ODBC Integration with Microsoft Transaction Server Overview</a></p>
                  </li>
               </ul>
               <p>OraMTS also provides integration with Oracle Provider for OLE DB, and Oracle Data Provider for .NET.</p>
               <div class="infoboxnotealso" id="GUID-70EE6069-5461-46D9-A207-938A028052D8__GUID-F02127E4-7E90-41B0-ADD9-D32F5D56A57E">
                  <p class="notep1">See Also:</p>
                  <p></p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="../oledb/features-of-oledb.html#OLEDB167" target="_blank"><span><cite>Oracle Provider for OLE DB Developer's Guide for Microsoft Windows</cite></span></a> for information on using Oracle Provider for OLE DB with MTS 
                        </p>
                     </li>
                     <li>
                        <p><a href="../odpnt/InstallDistributedTransaction.html#ODPNT8172" target="_blank"><span><cite>Oracle Data Provider for .NET Developer's Guide for Microsoft Windows</cite></span></a> for information on using Oracle Data Provider for .NET with MTS
                        </p>
                     </li>
                  </ul>
               </div>
            </div><a id="NTMTS160"></a><a id="NTMTS161"></a><a id="NTMTS162"></a><a id="NTMTS163"></a><a id="NTMTS164"></a><a id="NTMTS165"></a><a id="NTMTS166"></a><a id="NTMTS167"></a><a id="NTMTS168"></a><a id="NTMTS169"></a><a id="NTMTS170"></a><a id="NTMTS159"></a><div class="props_rev_3"><a id="GUID-C3016C47-E376-4859-AFFD-63CF512D5FA8" name="GUID-C3016C47-E376-4859-AFFD-63CF512D5FA8"></a><h3 id="NTMTS-GUID-C3016C47-E376-4859-AFFD-63CF512D5FA8" class="sect3"><span class="enumeration_section">4.1 </span>COM Component Integration in a Transaction
               </h3>
               <div>
                  <p>The focal point of the transaction process is a component of Microsoft Transaction Server called <a href="glossary.html#GUID-37C64380-2031-4103-8965-394C4A30A352"><span class="xrefglossterm">Microsoft Distributed Transaction Coordinator (MS DTC)</span></a>. When a client computer starts a business method on a transactional component, Microsoft Transaction Server begins a transaction coordinated by the MS DTC. The Oracle connection pooling layer enables the database to act as a <a href="glossary.html#GUID-1C8F482C-68E3-4FF2-B488-70A28EFE3E39"><span class="xrefglossterm">resource manager (RM)</span></a> in the MS DTC-coordinated transaction. <a href="program.html#GUID-C3016C47-E376-4859-AFFD-63CF512D5FA8__BEJCBEED">Figure 4-1</a> illustrates this transactional model.
                  </p>
                  <div class="figure" id="GUID-C3016C47-E376-4859-AFFD-63CF512D5FA8__BEJCBEED">
                     <p class="titleinfigure">Figure 4-1 Component Integration in a Transaction</p><img src="img/ntmts011.gif" alt="Description of Figure 4-1 follows" title="Description of Figure 4-1 follows" longdesc="img_text/ntmts011.html"><br><a href="img_text/ntmts011.html">Description of "Figure 4-1 Component Integration in a Transaction"</a></div>
                  <!-- class="figure" -->
                  <div class="section">
                     <p class="subhead2">Client Computer</p>
                     <p>The client computer activates the application components on the <a href="program.html#GUID-C3016C47-E376-4859-AFFD-63CF512D5FA8__BEJGHEGI">MTS Application Server</a> through a Web browser or through the <a href="glossary.html#GUID-4C7B0CCF-32BE-41EE-884A-A23E0E40D23A"><span class="xrefglossterm">component object model (COM)</span></a> /<a href="glossary.html#GUID-76047953-871E-48DD-97C0-FFCC2FAD0674"><span class="xrefglossterm">distributed component object model (DCOM)</span></a>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section" id="GUID-C3016C47-E376-4859-AFFD-63CF512D5FA8__BEJGHEGI">
                     <p class="subhead2">MTS Application Server</p>
                     <p>The MTS application server consists of the services that the Windows operating service provides to host transactional application components that a client computer can activate, either indirectly through a Web browser or directly through the <a href="glossary.html#GUID-4C7B0CCF-32BE-41EE-884A-A23E0E40D23A"><span class="xrefglossterm">component object model (COM)</span></a> /<a href="glossary.html#GUID-76047953-871E-48DD-97C0-FFCC2FAD0674"><span class="xrefglossterm">distributed component object model (DCOM)</span></a>. In response to client requests, the application server invokes the COM components. The invocations are performed within the scope of transactions where required
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Transactional Application Logic COM Components</p>
                     <p>Three primary responsibilities:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Embed the business logic. If a component is transactional, Microsoft Transaction Server starts a transaction for every method invocation on that component.</p>
                        </li>
                        <li>
                           <p>Acquire pooled connections to a Oracle Database through the Oracle resource dispenser and <a href="glossary.html#GUID-5F4766B7-BFBF-44D2-901B-2BB62EDBB694"><span class="xrefglossterm">Oracle Call Interface (OCI)</span></a>, <a href="glossary.html#GUID-DF699FFA-BE96-4E3B-83CD-07203F9EA102"><span class="xrefglossterm">Oracle Open Database Connectivity (ODBC) Driver</span></a>, or <a href="glossary.html#GUID-1D4CC36A-31D7-47CC-94BD-C1E9E69BDADF"><span class="xrefglossterm">Oracle Provider for OLE DB</span></a>.
                           </p>
                        </li>
                        <li>
                           <p>Decide the outcome of the operation by notifying Microsoft Transaction Server of its decision to commit or terminate the changes to all RMs.</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Oracle ODBC Driver, Oracle Provider for OLE DB, and OCI</p>
                     <p>Two primary responsibilities:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Obtain a service context to the Oracle Database through the OCI connection pooling component.</p>
                        </li>
                        <li>
                           <p>Provide connection pooling resources, if necessary (through Oracle Provider for OLE DB or Oracle ODBC Driver). The Oracle ODBC Driver provides pooled ODBC connections. Oracle Provider for OLE DB provides pooled data source objects. </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">OCI Connection Pool</p>
                     <p>Three primary responsibilities:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Enlists the RM (Oracle Database) in the component's Microsoft Transaction Server transaction.</p>
                        </li>
                        <li>
                           <p>Starts an Oracle global transaction corresponding to the Microsoft Transaction Server transaction of which the component is a part.</p>
                        </li>
                        <li>
                           <p>Acts as a resource dispenser to perform client-side connection pooling.</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Oracle Net</p>
                     <p>Provides connectivity in distributed, heterogeneous computing environments. </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Oracle MTS Recovery Service</p>
                     <p>Recovers in-doubt Oracle transactions that originated from the host computer and are related to the Microsoft Transaction Server.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Database Recovery Job</p>
                     <p>Detects in-doubt DTC transactions. This job extracts the recovery service's endpoint address in the in-doubt transaction's XID and then requests the outcome of the Microsoft DTC transaction from the recovery service. Ultimately, the job will commit or terminate the in-doubt transaction when it receives the transaction's outcome. </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Microsoft DTC</p>
                     <p>Microsoft Distributed Transaction Coordinator is part of Microsoft Transaction Server and has two primary responsibilities:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Commits and terminates transactions using the two-phase commit protocol.</p>
                        </li>
                        <li>
                           <p>Monitors transactions that require recovery. Multiple MS DTCs can be involved in a single transaction. When a transactional Microsoft Transaction Server component on computer A invokes another transactional Microsoft Transaction Server component on computer B, a connection is opened between the MS DTC on computer A and the MS DTC on computer B. When the root MS DTC commits or terminates a transaction, it sends the request through all involved MS DTCs. The transaction request is then passed to the OCI connection pooling/Microsoft Transaction Server integration, which sends it to the database.</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Oracle Database</p>
                     <p>Acts as an RM for Microsoft Transaction Server. This is the database on which the client transaction request is performed.</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="NTMTS171"></a><div class="props_rev_3"><a id="GUID-26813166-65BB-425A-9EBD-BA2F54A0C678" name="GUID-26813166-65BB-425A-9EBD-BA2F54A0C678"></a><h3 id="NTMTS-GUID-26813166-65BB-425A-9EBD-BA2F54A0C678" class="sect3"><span class="enumeration_section">4.2 </span>Microsoft Transaction Server Application Development
               </h3>
               <div>
                  <p>OCI connection pooling is used to coordinate a transaction in nearly all application programming interfaces. This topic describes how transactions are registered and how OCI connection pooling coordinates them.</p>
               </div><a id="NTMTS172"></a><div class="props_rev_3"><a id="GUID-DD6A54C5-9330-4A51-BFEC-34502700995D" name="GUID-DD6A54C5-9330-4A51-BFEC-34502700995D"></a><h4 id="NTMTS-GUID-DD6A54C5-9330-4A51-BFEC-34502700995D" class="sect4"><span class="enumeration_section">4.2.1 </span>Microsoft Transaction Server Component Registration
                  </h4>
                  <div>
                     <p>Application components that run in the Microsoft Transaction Server environment are created as dynamic link libraries (DLLs). Application components are registered with Microsoft Transaction Server using the Microsoft Transaction Server Explorer graphical user interface (GUI) tool. </p>
                  </div><a id="NTMTS173"></a><div class="props_rev_3"><a id="GUID-6657E28F-EECB-453C-9001-129114867892" name="GUID-6657E28F-EECB-453C-9001-129114867892"></a><h5 id="NTMTS-GUID-6657E28F-EECB-453C-9001-129114867892" class="sect5"><span class="enumeration_section">4.2.1.1 </span>Types of Registration Components
                     </h5>
                     <div>
                        <p>When you register the application component, you mark it as one of the following types:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="bold">Requires a Transaction</span> The component must run in a transaction. If the transaction does not currently exist, Microsoft Transaction Server automatically creates a new transaction for each method invocation on the component.
                              </p>
                           </li>
                           <li>
                              <p><span class="bold">Supports a Transaction</span> The component can run within the client's transaction. When a new component is created, its context inherits the transaction from the context of the invoking client. If the client does not have a transaction, the new context is also created without one.
                              </p>
                           </li>
                           <li>
                              <p><span class="bold">Requires a New Transaction</span> The component must run within its own transaction. Microsoft Transaction Server automatically creates a new transaction for each method invocation on the component.
                              </p>
                           </li>
                           <li>
                              <p><span class="bold">Does Not Support Transactions</span> The component does not run within a transaction. Each method invocation on the component is performed without a surrounding transaction, regardless of whether the invoking client includes a transaction.
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div><a id="NTMTS174"></a><div class="props_rev_3"><a id="GUID-D6EE54B0-D373-4221-AE31-F05C7AE0E28F" name="GUID-D6EE54B0-D373-4221-AE31-F05C7AE0E28F"></a><h5 id="NTMTS-GUID-D6EE54B0-D373-4221-AE31-F05C7AE0E28F" class="sect5"><span class="enumeration_section">4.2.1.2 </span>Registration of Components
                     </h5>
                     <div>
                        <p>How you register an application component determines if it runs in a Microsoft Transaction Server-coordinated transaction.</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>If the application component <span class="bold">runs</span> in a Microsoft Transaction Server-coordinated transaction, the OCI connection pooling is always used and Microsoft Transaction Server and its MS DTC component coordinate the creation, startup, management, and commitment phases of the transaction. Microsoft Transaction Server ensures that all changes made by the component are committed if the transaction succeeds, or are terminated if the transaction fails. 
                              </p>
                           </li>
                           <li>
                              <p>If the application component <span class="bold">does not run</span> in a Microsoft Transaction Server-coordinated transaction, the component runs in a Microsoft Transaction Server environment, but the databases that it accesses may or may not take part in MS DTC-coordinated transactions. If the transaction is not MS DTC-coordinated, the client application must create, start, manage, and commit the transaction. OCI connection pooling may be used, depending upon the interface accessing the database (such as Oracle Provider for OLE DB, Oracle ODBC Driver, or others).
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div><a id="NTMTS175"></a><div class="props_rev_3"><a id="GUID-F875731C-C70F-4DB7-A0F9-9A04D2EF8B4C" name="GUID-F875731C-C70F-4DB7-A0F9-9A04D2EF8B4C"></a><h4 id="NTMTS-GUID-F875731C-C70F-4DB7-A0F9-9A04D2EF8B4C" class="sect4"><span class="enumeration_section">4.2.2 </span>Microsoft Transaction Server-Coordinated Component Transaction
                  </h4>
                  <div>
                     <p>This topic describes how OCI connection pooling, Microsoft Transaction Server, and MS DTC operate with application components in a Microsoft Transaction Server-coordinated transaction environment.</p>
                     <ol>
                        <li>
                           <p>The client API (one of Oracle ODBC Driver, OCI, ODP.NET or Oracle Provider for OLE DB) calls OCI function <code class="codeph">OraMTSSvcGet()</code> to obtain a service context from the OCI connection pooling component.
                           </p>
                        </li>
                        <li>
                           <p>The OCI connection pooling component enlists the transaction that will be coordinated by the MS DTC component of Microsoft Transaction Server.</p>
                           <p>The OCI service and environment handles are returned to client applications.</p>
                        </li>
                        <li>
                           <p>The client application:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Performs the database operations.</p>
                              </li>
                              <li>
                                 <p>Calls OCI function <code class="codeph">OraMTSSvcRel()</code> to release the OCI pooling connection obtained at the beginning of the transaction.
                                 </p>
                              </li>
                              <li>
                                 <p>Calls <code class="codeph">SetComplete</code> (to commit database operations) or <code class="codeph">SetAbort</code> (to terminate database operations) on the Microsoft Transaction Server context object associated with the component.
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>MS DTC performs the two-phase commit protocol to prepare and commit or to terminate the transaction. This notifies the OCI connection pooling component and ends the transaction.</p>
                        </li>
                        <li>
                           <p>OCI connection pooling is notified and performs the necessary steps to complete phase one, the prepare phase, and phase two, the commit or terminate phase. </p>
                        </li>
                     </ol>
                  </div>
               </div><a id="NTMTS176"></a><div class="props_rev_3"><a id="GUID-4FA9B1C4-53F4-4B82-BC63-7C55740CBE2C" name="GUID-4FA9B1C4-53F4-4B82-BC63-7C55740CBE2C"></a><h4 id="NTMTS-GUID-4FA9B1C4-53F4-4B82-BC63-7C55740CBE2C" class="sect4"><span class="enumeration_section">4.2.3 </span>Microsoft DTC-Coordinated Component Transaction
                  </h4>
                  <div>
                     <p>This topic describes how OCI connection pooling, Microsoft Transaction Server, and MS DTC operate with application components <span class="bold">not running</span> in a Microsoft Transaction Server-coordinated transaction, but using MS DTC.
                     </p>
                     <ol>
                        <li>
                           <p>The client application starts an MS DTC transaction and connects to the Oracle Database. The connection protocol follows one of the following scenarios:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Nonpooled OCI connections are obtained through OCI logon calls such as <code class="codeph">OCIServerAttach()</code> and <code class="codeph">OCISessionBegin()</code>. For these connections, the application calls <code class="codeph">OraMTSEnlCtxGet()</code> to associate the OCI service context with a Microsoft Transaction Server enlistment context.
                                 </p>
                              </li>
                              <li>
                                 <p>A connection pool is obtained by calling <code class="codeph">OraMTSSvcGet(..,..,ORAMTS_CFLG_NOIMPLICIT)</code>.
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>The client handles the context in one of the following scenarios:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>For nonpooled connections, the client application passes in the enlistment context to <code class="codeph">OraMTSJoinTxn()</code>. 
                                 </p>
                              </li>
                              <li>
                                 <p>For pooled connections, the client application passes the OCI service context into <code class="codeph">OraMTSSvcEnlist()</code>.
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>The OCI connection pooling component enlists the connection, either pooled or nonpooled, in the transaction coordinated by the MS DTC component of Microsoft Transaction Server.</p>
                        </li>
                        <li>
                           <p>The client application then:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Performs database operations. </p>
                              </li>
                              <li>
                                 <p>Calls <code class="codeph">OraMTSSvcEnlist()</code> with a <code class="codeph">NULL</code> transaction reference to de-enlist from an MS DTC coordinated transaction.
                                 </p>
                                 <p>For nonpooled connections, <code class="codeph">OraMTSTxnJoin()</code> is invoked with a <code class="codeph">NULL</code> transaction reference to perform the de-enlistment.
                                 </p>
                              </li>
                              <li>
                                 <p>Calls <code class="codeph">OraMTSSvcRel()</code> to release a pooled connection back to the pool.
                                 </p>
                                 <p>For nonpooled connections, the client calls <code class="codeph">OraMTSEnlCtxRel()</code> to release the enlistment context and then logs off the database. 
                                 </p>
                              </li>
                              <li>
                                 <p>Calls the commit or terminate method on the MS DTC transaction object, such as <code class="codeph">pTransaction-&gt;Commit()</code> or <code class="codeph">pTransaction-&gt;Abort()</code>.
                                 </p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p> MS DTC performs the two-phase commit protocol to commit the transaction.</p>
                        </li>
                        <li>
                           <p>OCI connection pooling is notified and performs the necessary steps to complete phase one, the prepare phase, and phase two, the commit or terminate phase.</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div><a id="NTMTS178"></a><a id="NTMTS177"></a><div class="props_rev_3"><a id="GUID-DB43712F-BD4E-404B-8F3D-67628B127735" name="GUID-DB43712F-BD4E-404B-8F3D-67628B127735"></a><h3 id="NTMTS-GUID-DB43712F-BD4E-404B-8F3D-67628B127735" class="sect3"><span class="enumeration_section">4.3 </span>OCI Integration with Microsoft Transaction Server
               </h3>
               <div>
                  <div class="section">
                     <p><a href="program.html#GUID-DB43712F-BD4E-404B-8F3D-67628B127735__BEJGDDFA">Example 4-1</a> illustrates how you can integrate the MTS sever with OCI. The only change in code you must make involves obtaining and releasing the OCI service context handle. Both OCI service context handle and environment handle are acquired when you obtain a pooled OCI connection to the database by calling <code class="codeph">OraMTSSvcGet()</code>. Include the <code class="codeph">oramts.h</code> header and link with the <code class="codeph">oramts.lib</code> library. When you are finished, call OCI function <a id="d4255e793" class="indexterm-anchor"></a><a id="d4255e797" class="indexterm-anchor"></a><code class="codeph">OraMTSSvcRel()</code> to release the service context handle and environment handle. Using <code class="codeph">OraMTSSvcGet()</code> enables you to receive connection pooling and implicit transaction support if you registered the application component to run in a Microsoft Transaction Server transaction. 
                     </p>
                     <p><a id="d4255e809" class="indexterm-anchor"></a><a id="d4255e813" class="indexterm-anchor"></a>Ensure that for each process, you call <code class="codeph">OCIInitialize</code> at least once before executing any other OCI calls. This initializes the OCI process environment. In addition, you must pass it the <code class="codeph">OCI_THREADED</code> flag. If you are using Microsoft Internet Information Server (IIS) and the components are being called as in-process libraries, then <code class="codeph">OCIInitialize</code> is already called for you. The registry key <code class="codeph">ORAMTS_OCI_OBJ_MODE</code> has been added. Set the value to 1 to initialize OCI in Object mode; otherwise OCI will initialize in the threaded mode.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-DB43712F-BD4E-404B-8F3D-67628B127735__BEJGDDFA">
                     <p class="titleinexample">Example 4-1 Integration of MTS and OCI</p><pre class="oac_no_warn" dir="ltr">#include &lt;oci.h&gt; 
#include  &lt;oramts.h&gt; 
#include  &lt;xolehlp.h&gt; 
// other MTS relevant includes ... 
 
// prototype for the error handler. 
BOOL Chekerr(sword swOCIStat, OCIError *OCIErrh); 
 
// MTS component method 
HRESULT OCITestMethod() 
{ 
 IObjectContext *pObjectContext = NULL; 
 OCIEnv    *myenvh = NULL; 
 OCISvcCtx *mysvch = NULL; 
 OCIError  *myerrh = NULL; 
 OCIStnt   *mystmh = NULL; 
 DWORD      dwStat; 
 HRESULT    hRes = S_OK; 
 sword      swOCIStat; 
 BOOL       bCommit = FALSE; 
 char      *lpzStmt = "UPDATE EMP SET SAL = SAL + 1000"; 
 
 // Initialize the OCI environment first -- request OCI_THREADED 
 OCIInitialize(OCI_THREADED, (dvoid*)NULL,NULL,NULL,NULL);  
 // attempt to get a connection to the database through the resource dispenser 
 OraMTSSvcGet( 
"hr","<span class="italic">hr_password</span>","finprod_db",&amp;mysvch, &amp;myenvh, ORAMTS_CFLG_ALLDEFAULT);  
 // validate return status 
 if(dwStat != ORAMTS_ERR_NOERROR) 
 { 
   printf("error: failed to obtain a connection to the database - %ld", 
dwStat); 
   goto cleanup; 
 } 
 // successful logon and enlistment in the MTS transaction. allocate statement 
 // handles and other handles using the OCI environment handle myenvh .... 
 swOCIStat = OCIHandleAlloc(myenvh, (void *)&amp;myerrh,OCI_HTYPE_ERROR, 0 , NULL); 
 if (Checkerr(swOCIStat, myerrh)) goto cleanup; 
 swOCIStat = OCIHandleAlloc(myenvh, (dvoid *)&amp;mystmh,OCI_HTYPE_STMT, 0,NULL); 
 if (Checkerr(swOCIStat, myerrh)) goto cleanup;
 // prepare a DML statement 
 OCIStmtPrepare(mystmh, myerrh, lpzStmt, lstrlen(lpzStmt), OCI_NTV_SYNTAX, 
OCI_DEFAULT) 
 Checkerr(swOCIStat, myerrh);  
 // execute the statement -- ensure that AUTOCOMMIT is not requested. 
 OCIStmtExecute(mysvch, mystmh, myerrh, 1, 0, NULL, NULL, OCI_DEFAULT); 
 if (Checkerr(swOCIStat, myerrh)) goto cleanup;  
 // all's well so far choose to go for a commit 
 bCommit = TRUE;  
cleanup: 
 if (mystmh) OCIHandleFree((void*)mystmh, OCI_HTYPE_STMT); 
 if (myerrh  OCIHandleFree((void*)myerrh, OCI_HTYPE_ERROR); 
 if (mysvch) OraMTSSvcRel(mysvch);  
 if (bCommit)  
     pObjectContext-&gt;SetComplete();  
 else 
     pObjectContext-&gt;Abort();   
 return(bCommit ? S_OK : E_FAIL); 
}</pre></div>
                  <!-- class="example" -->
               </div><a id="NTMTS179"></a><div class="props_rev_3"><a id="GUID-95238DB9-93D7-40D8-8591-FF9185E483F9" name="GUID-95238DB9-93D7-40D8-8591-FF9185E483F9"></a><h4 id="NTMTS-GUID-95238DB9-93D7-40D8-8591-FF9185E483F9" class="sect4"><span class="enumeration_section">4.3.1 </span>Integrating COM Components 
                  </h4>
                  <div>
                     <p>There are several scenarios for integrating COM components. COM applications that are not hosted by the Microsoft Transaction Server environment, also known as standalone applications, cannot use declarative transactions through the Microsoft Transaction Server Explorer Microsoft Management Console, but they can use the last three of the scenario described.</p>
                  </div><a id="NTMTS180"></a><div class="props_rev_2"><a id="GUID-606E43D0-52EF-4BE0-84E2-26A3A12E0B5D" name="GUID-606E43D0-52EF-4BE0-84E2-26A3A12E0B5D"></a><h5 id="NTMTS-GUID-606E43D0-52EF-4BE0-84E2-26A3A12E0B5D" class="sect5"><span class="enumeration_section">4.3.1.1 </span>COM Components Running in an MTS-Coordinated Transaction
                     </h5>
                     <div>
                        <p>COM components that are running in an MTS-coordinated transactions use OCI connection pooling to implicitly enlist the database in a transaction. The following pseudo-code listing illustrates the use of OCI functions:</p><pre class="oac_no_warn" dir="ltr">OCIInitialize(OCI_THREADED, ...)
OraMTSSvcGet(..., &amp;OCISvc, ..., ORAMTS_CFLAG_ALLDEFAULT)
...
OraMTSSvcRel(OCISvc)</pre></div>
                  </div><a id="NTMTS181"></a><div class="props_rev_3"><a id="GUID-CACFDB75-0A9D-4264-B38B-60151E871803" name="GUID-CACFDB75-0A9D-4264-B38B-60151E871803"></a><h5 id="NTMTS-GUID-CACFDB75-0A9D-4264-B38B-60151E871803" class="sect5"><span class="enumeration_section">4.3.1.2 </span>Non-Transactional COM Components Running with OCI Connection Pooling
                     </h5>
                     <div>
                        <p>COM components that are marked as non-transactional and running in an MTS-coordinated transaction use OCI connection pooling <span class="bold">do not enlist</span> the database in a transaction. The following pseudo-code listing illustrates the use of OCI functions:
                        </p><pre class="oac_no_warn" dir="ltr">OCIInitialize(OCI_THREADED, ...)
OraMTSSvcGet(..., &amp;OCISvc, ..., ORAMTS_CFLAG_NOIMPLICIT)
...
OraMTSSvcRel(OCISvc)</pre></div>
                  </div><a id="NTMTS182"></a><div class="props_rev_3"><a id="GUID-B7578654-6F99-4006-AA4F-505AB5F42CE6" name="GUID-B7578654-6F99-4006-AA4F-505AB5F42CE6"></a><h5 id="NTMTS-GUID-B7578654-6F99-4006-AA4F-505AB5F42CE6" class="sect5"><span class="enumeration_section">4.3.1.3 </span>COM Components Using MS DTC and OCI Connection Pooling
                     </h5>
                     <div>
                        <p>COM components that are not running in an MTS-coordinated transaction use MS DTC with OCI connection pooling to explicitly enlist the database in a transaction. The following pseudo-code listing illustrates the use of OCI functions:</p><pre class="oac_no_warn" dir="ltr">OCIInitialize(OCI_THREADED, ...)
DTCGetTransactionManager(...)
BeginTransaction(..., &amp;transaction)
OraMTSSvcGet(..., &amp;OCISvc, ..., ORAMTS_CFLAG_NOIMPLICIT)
OraMTSSvcEnlist(OCISvc, ..., transaction, ...)
...
OraMTSvcEnlist(OCISvc, ..., NULL, ...)
OraMTSSvcRel(OCISvc)</pre></div>
                  </div><a id="NTMTS183"></a><div class="props_rev_3"><a id="GUID-310735E1-953C-4804-9B40-DF383923C893" name="GUID-310735E1-953C-4804-9B40-DF383923C893"></a><h5 id="NTMTS-GUID-310735E1-953C-4804-9B40-DF383923C893" class="sect5"><span class="enumeration_section">4.3.1.4 </span>COM Components Using MS DTC and Nonpooling OCI Connection
                     </h5>
                     <div>
                        <p>COM components that are not running in an MTS-coordinated transaction use MS DTC with a non-pooling OCI connection to explicitly enlist the database in a transaction. The following pseudo-code listing illustrates the use of OCI functions:</p><pre class="oac_no_warn" dir="ltr">OCIInitialize(OCI_THREADED, ...)
OCI to get connected
OraMTSEnlCtxGET
DTCGetTransactionManager(...)
BeginTransaction(..., &amp;transaction)
OraMTSJoinTxn (OCISvc, ..., transaction, ...)
...
OraMTSJoinTxn
...
OraMTSEnlCtxRel()
OCI to logoff</pre></div>
                  </div>
               </div><a id="NTMTS185"></a><a id="NTMTS184"></a><div class="props_rev_3"><a id="GUID-1F71591D-BB07-4FA3-AFCC-DB11D21D0958" name="GUID-1F71591D-BB07-4FA3-AFCC-DB11D21D0958"></a><h4 id="NTMTS-GUID-1F71591D-BB07-4FA3-AFCC-DB11D21D0958" class="sect4"><span class="enumeration_section">4.3.2 </span>Using OCI Functions
                  </h4>
                  <div>
                     <p>This topic details the OCI functions discussed earlier in this topic. <a href="program.html#GUID-1F71591D-BB07-4FA3-AFCC-DB11D21D0958__BEJGEJFD" title="This table lists OCI function in the first column, and provides a brief description of the function in the second column.">Table 4-1</a> summarizes these functions.
                     </p>
                     <div class="tblformal" id="GUID-1F71591D-BB07-4FA3-AFCC-DB11D21D0958__BEJGEJFD">
                        <p class="titleintable">Table 4-1 Summary of OCI Functions for Integrating MTS and Oracle Database</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="Summary of OCI Functions for Integrating MTS and Oracle Database" summary="This table lists OCI function in the first column, and provides a brief description of the function in the second column." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="24%" id="d4255e1112">OCI Function</th>
                                 <th align="left" valign="bottom" width="76%" id="d4255e1115">Summary</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d4255e1120" headers="d4255e1112 ">
                                    <p><a href="program.html#GUID-45167147-7DD4-4390-9CA7-5D1E0A439F39">OraMTSSvcGet() </a></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e1120 d4255e1115 ">
                                    <p>Obtains a pooled connection from the OCI connection pool.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d4255e1129" headers="d4255e1112 ">
                                    <p><a href="program.html#GUID-E8DA2D57-4D05-4AA0-8FCF-362EC708375D">OraMTSSvcRel() </a></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e1129 d4255e1115 ">
                                    <p>Releases a pooled OCI connection, OCI service context, back to the connection pool.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d4255e1138" headers="d4255e1112 ">
                                    <p><a href="program.html#GUID-BD493E2D-B0AA-46DC-8658-7FD80023C542">OraMTSSvcEnlist() </a></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e1138 d4255e1115 ">
                                    <p>Enlists or de-enlists an OCI connection in a transaction coordinated by MS DTC.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d4255e1147" headers="d4255e1112 ">
                                    <p><a href="program.html#GUID-574D1E3F-C50C-44E9-BF13-80F5043B6B08">OraMTSSvcEnlistEx()</a></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e1147 d4255e1115 ">
                                    <p>Enlists an OCI connection or service context in an MS DTC transaction.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d4255e1156" headers="d4255e1112 ">
                                    <p><a href="program.html#GUID-168D8B80-7FCD-445C-AD60-8789B96F1306">OraMTSEnlCtxGet() </a></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e1156 d4255e1115 ">
                                    <p>Creates an enlistment context for a nonpooled OCI connection.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d4255e1165" headers="d4255e1112 ">
                                    <p><a href="program.html#GUID-34590C40-3CE6-4E66-A4FF-844AC20509A6">OraMTSEnlCtxRel()</a></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e1165 d4255e1115 ">
                                    <p>Eliminates a previously set up enlistment context for a nonpooled OCI connection.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d4255e1174" headers="d4255e1112 ">
                                    <p><a href="program.html#GUID-52FF1F1D-E70D-4319-A47A-78AC263E2C29">OraMTSJoinTxn() </a></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e1174 d4255e1115 ">
                                    <p>Enlists a nonpooled OCI connection in an MS DTC transaction.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d4255e1183" headers="d4255e1112 ">
                                    <p><a href="program.html#GUID-22472D28-1D06-4244-99F3-DF6464F691FE">OraMTSTransTest() </a></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e1183 d4255e1115 ">
                                    <p>Tests if you are running inside a Microsoft Transaction Server-started transaction.</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="24%" id="d4255e1192" headers="d4255e1112 ">
                                    <p><a href="program.html#GUID-D87897DB-DD3E-44BA-83E5-656EB3CB075D">OraMTSOCIErrGet() </a></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e1192 d4255e1115 ">
                                    <p>Retrieves the OCI error code and message text.</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                  </div>
               </div><a id="NTMTS187"></a><a id="NTMTS188"></a><a id="NTMTS189"></a><a id="NTMTS190"></a><a id="NTMTS191"></a><a id="NTMTS186"></a><div class="props_rev_3"><a id="GUID-45167147-7DD4-4390-9CA7-5D1E0A439F39" name="GUID-45167147-7DD4-4390-9CA7-5D1E0A439F39"></a><h4 id="NTMTS-GUID-45167147-7DD4-4390-9CA7-5D1E0A439F39" class="sect4"><span class="enumeration_section">4.3.3 </span>OraMTSSvcGet() 
                  </h4>
                  <div>
                     <div class="section">
                        <p>Obtains a pooled connection, also known as an OCI service context, from the OCI connection pool. The pooled connection includes an OCI service context handle and an OCI environment handle. </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Syntax</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">DWORD  OraMTSSvcGet( </pre><pre class="oac_no_warn" dir="ltr">                 text*       lpUname,
                 text*       lpPsswd,
                 text*       lpDbnam,
                 OCISvcCtx** pOCISvc,
                 OCIEnv**    pOCIEnv,
                 ub4         dwConFlgs);</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Parameters</p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-45167147-7DD4-4390-9CA7-5D1E0A439F39__GUID-0F311FE5-9BC0-43B7-BACE-BA96E5762EA0">
                        <p class="titleintable">Table 4-2  OraMTSSvcGet() Parameters</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title=" OraMTSSvcGet() Parameters" summary="OraMTSSvcGet() parameters. Column 1 lists the parameter, column 2 indicates if the parameter has an IN or OUT binding, and column 3 contains a description of the parameter." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="16%" id="d4255e1314">Parameter</th>
                                 <th align="left" valign="bottom" width="10%" id="d4255e1317">IN/OUT</th>
                                 <th align="left" valign="bottom" width="74%" id="d4255e1320">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d4255e1325" headers="d4255e1314 ">
                                    <p><code class="codeph">lpUname</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e1325 d4255e1317 "><pre class="oac_no_warn" dir="ltr">IN</pre></td>
                                 <td align="left" valign="top" width="74%" headers="d4255e1325 d4255e1320 ">
                                    <p>Username for connecting to the Oracle Database</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d4255e1336" headers="d4255e1314 ">
                                    <p><code class="codeph">lpPsswd</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e1336 d4255e1317 "><pre class="oac_no_warn" dir="ltr">IN</pre></td>
                                 <td align="left" valign="top" width="74%" headers="d4255e1336 d4255e1320 ">
                                    <p>Password for the username</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d4255e1347" headers="d4255e1314 ">
                                    <p><code class="codeph">lpDbnam</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e1347 d4255e1317 "><pre class="oac_no_warn" dir="ltr">IN</pre></td>
                                 <td align="left" valign="top" width="74%" headers="d4255e1347 d4255e1320 ">
                                    <p>The <a href="glossary.html#GUID-E2212B15-F7B2-4FFD-AA05-69DD0F664C0E"><span class="xrefglossterm">net service name</span></a> for connecting to the database (created with Oracle Net Manager or Oracle Net Configuration Assistant)
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d4255e1362" headers="d4255e1314 ">
                                    <p><code class="codeph">pOCISvc</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e1362 d4255e1317 "><pre class="oac_no_warn" dir="ltr">OUT</pre></td>
                                 <td align="left" valign="top" width="74%" headers="d4255e1362 d4255e1320 ">
                                    <p>Pointer to the OCI service context handle</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d4255e1373" headers="d4255e1314 ">
                                    <p><code class="codeph">pOCIEnv</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e1373 d4255e1317 "><pre class="oac_no_warn" dir="ltr">OUT</pre></td>
                                 <td align="left" valign="top" width="74%" headers="d4255e1373 d4255e1320 ">
                                    <p>Pointer to the OCI environment handle</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="16%" id="d4255e1384" headers="d4255e1314 ">
                                    <p><code class="codeph">dwConFlgs</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e1384 d4255e1317 "><pre class="oac_no_warn" dir="ltr">IN</pre></td>
                                 <td align="left" valign="top" width="74%" headers="d4255e1384 d4255e1320 ">
                                    <p>Connection flags. Possible values are:</p>
                                    <ul style="list-style-type: disc;">
                                       <li>
                                          <p><code class="codeph">ORAMTS_CFLG_ALLDEFAULT</code></p>
                                          <p>Obtains a pooled connection and enlists the connection in any Microsoft Transaction Server transaction, if one exists. If the component is nontransactional, no enlistment request is dispensed.</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">ORAMTS_CFLG_NOIMPLICIT</code></p>
                                          <p>Obtains a pooled connection, but does not enlist the resource in any Microsoft Transaction Server transaction even if the component is transactional. Use this flag if the component enlists the connection resource later using <code class="codeph">OraMTSSvcEnlist()</code>. Prior to releasing a connection obtained in this fashion, the client must de-enlist the resource if enlisted.
                                          </p>
                                       </li>
                                       <li>
                                          <p>ORAMTS_CFLG_UNIQUESRVR</p>
                                          <p>Requests a single OCI session for each OCI Server. In this release, multiplexing is not supported. Therefore, this option is always used.</p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">ORAMTS_CFLG_SYSDBALOGN</code></p>
                                          <p>Use this flag if connecting as <code class="codeph">SYSDBA</code>.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">ORAMTS_CFLG_SYSOPRLOGN</code></p>
                                          <p>Use this flag if connecting as <code class="codeph">SYSOPER</code>.
                                          </p>
                                       </li>
                                       <li>
                                          <p><code class="codeph">ORAMTS_CFLG_PRELIMAUTH</code></p>
                                          <p>Use this flag if connecting as the user <code class="codeph">INTERNAL</code> to pre-Oracle9<span class="italic">i</span> databases. The <code class="codeph">INTERNAL</code> account is no longer valid as of Oracle9<span class="italic">i</span>. Instead, log on with a <code class="codeph">SYSDBA</code> or <code class="codeph">SYSOPER</code> account using the <code class="codeph">ORAMTS_CFLG_SYSOPRLOGN</code> or <code class="codeph">ORAMTS_CFLG_SYSDBALOGN</code> flag.
                                          </p>
                                       </li>
                                    </ul>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p class="subhead3">Returns</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Returns <code class="codeph">ORAMTSERR_NOERROR</code> upon successful acquisition of an OCI pooling connection (OCI service context).
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Usage Notes</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a id="d4255e1480" class="indexterm-anchor"></a><a id="d4255e1484" class="indexterm-anchor"></a><code class="codeph">OraMTSSvcGet()</code> returns a pooled OCI connection to the caller, enabling a database transaction using OCI to begin. Use <code class="codeph">OraMTSSvcGet()</code> to implicitly enlist the OCI connection in a transaction coordinated by Microsoft Transaction Server. In this type of transaction, Microsoft Transaction Server controls the creation, startup, management, and commitment phases of the transaction through its MS DTC component.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OraMTSSvcGet()</code> also provides connection pooling without enlisting the Oracle Database in a Microsoft Transaction Server transaction. This is done by setting <code class="codeph">OraMTSSvcGet()</code> as follows:
                              </p><pre class="oac_no_warn" dir="ltr">OraMTSSvcGet(...,ORAMTS_CFLG_NOIMPLICIT)
</pre></li>
                           <li>
                              <p>In all cases where <code class="codeph">OraMTSSvcGet</code><code class="codeph">()</code> is used, you must always use <code class="codeph">OraMTSSvcRel</code><code class="codeph">()</code> to release the connection when finished.
                              </p>
                           </li>
                           <li>
                              <p>Use the flags <a id="d4255e1520" class="indexterm-anchor"></a><a id="d4255e1524" class="indexterm-anchor"></a><code class="codeph">ORAMTS_CFLG_SYSDBALOGN</code> and <code class="codeph">ORAMTS_CFLG_SYSOPRLOGN</code> when connecting as <code class="codeph">SYSDBA</code> and <code class="codeph">SYSOPER</code>, respectively. 
                              </p>
                           </li>
                           <li>
                              <p>To obtain a nonenlisted connection using the <code class="codeph">hr</code>/<span class="italic"><code class="codeph">hr_password</code></span> account, call <code class="codeph">OraMTSSvcGet()</code> as follows:
                              </p><pre class="oac_no_warn" dir="ltr">OraMTSSvcGet("hr", "<span class="italic">hr_password</span>", "oracle", &amp;OCISvc, &amp;OCIEnv, ORAMTS_CFLG_ALLDEFAULT | ORAMTS_CFLG_NOIMPLICIT);
</pre></li>
                           <li>
                              <p><code class="codeph">OraMTSSvcGet()</code> does not support placing the username (<code class="codeph">lpUname</code>), password (<code class="codeph">lpPsswd</code>), and net service name syntax (<code class="codeph">lpDbname</code>) together in the username argument (for example, <code class="codeph">hr/</code><span class="italic"><code class="codeph">hr_password</code></span><code class="codeph">@prod_fin</code>). Instead, the caller must fill in <code class="codeph">lpUname</code>, <code class="codeph">lpPsswd</code>, and <code class="codeph">lpDbname</code> separately (as shown in the previous syntax example). Calling <code class="codeph">OraMTSSvcGet()</code> with the username and password as <code class="codeph">NULL</code> strings uses external authentication (operating system authentication) for the connection.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="NTMTS193"></a><a id="NTMTS194"></a><a id="NTMTS195"></a><a id="NTMTS196"></a><a id="NTMTS197"></a><a id="NTMTS192"></a><div class="props_rev_3"><a id="GUID-E8DA2D57-4D05-4AA0-8FCF-362EC708375D" name="GUID-E8DA2D57-4D05-4AA0-8FCF-362EC708375D"></a><h4 id="NTMTS-GUID-E8DA2D57-4D05-4AA0-8FCF-362EC708375D" class="sect4"><span class="enumeration_section">4.3.4 </span>OraMTSSvcRel() 
                  </h4>
                  <div>
                     <div class="section">
                        <p>Releases a pooled OCI connection, OCI service context, back to the connection pool. Use this function to release connections that were acquired with <code class="codeph">OraMTSSvcGet()</code>. 
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Syntax</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">DWORD OraMTSSvcRel(OCISvcCtx* OCISvc);</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Parameters</p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-E8DA2D57-4D05-4AA0-8FCF-362EC708375D__GUID-E4FA51FF-FCC2-4BD4-9CB3-09A5AF2285C2">
                        <p class="titleintable">Table 4-3 OraMTSSvcRel() Parameters</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="OraMTSSvcRel() Parameters" summary="OraMTSSvcRel() parameters. Column 1 lists the parameter, column 2 indicates if the parameter has an IN or OUT binding, and column 3 contains a description of the parameter." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="14%" id="d4255e1692">Parameter</th>
                                 <th align="left" valign="bottom" width="10%" id="d4255e1695">IN/OUT</th>
                                 <th align="left" valign="bottom" width="76%" id="d4255e1698">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d4255e1703" headers="d4255e1692 ">
                                    <p><code class="codeph">OCISvc</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e1703 d4255e1695 "><pre class="oac_no_warn" dir="ltr">IN</pre></td>
                                 <td align="left" valign="top" width="76%" headers="d4255e1703 d4255e1698 ">
                                    <p>OCI service context for a pooled connection</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p class="subhead3">Returns</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Returns <code class="codeph">ORAMTSERR_NOERROR</code> upon successful release of a pooled OCI connection. 
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Usage Notes</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a id="d4255e1729" class="indexterm-anchor"></a><a id="d4255e1733" class="indexterm-anchor"></a><a id="d4255e1737" class="indexterm-anchor"></a>An OCI pooled connection obtained through a previous call to <code class="codeph">OraMTSSvcGet()</code> is released back to the connection pool. Once released back to the connection pool, the OCI service context, its environment handle, and all child handles are invalid.   
                              </p>
                           </li>
                           <li>
                              <p>A nontransactional client component must explicitly call <code class="codeph">OCITransCommit()</code> or <code class="codeph">OCITransAbort()</code> prior to releasing a connection obtained through <code class="codeph">OraMTSSvcGet(..., ...,ORAMTS_CFLG_ALLDEFAULT)</code> back to the pool. Otherwise, all changes made in that session are rolled back. A transaction component uses the <code class="codeph">SetComplete</code> or <code class="codeph">SetAbort</code> methods on its Microsoft Transaction Server object context.
                              </p>
                           </li>
                           <li>
                              <p>Components that have called <code class="codeph">OraMTSSvcGet(..., ...,ORAMTS_CFLG_NOIMPLICIT)</code> to obtain a connection resource must first de-enlist the resource if enlisted. If the connection was enlisted explicitly, <code class="codeph">pTransaction-&gt;Commit()</code> or <code class="codeph">pTransaction-&gt;Abort()</code> must be called. Otherwise, <code class="codeph">OCITransCommit()</code> or <code class="codeph">OCITransAbort()</code> must be called before releasing the connection back to the pool. 
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="NTMTS199"></a><a id="NTMTS200"></a><a id="NTMTS201"></a><a id="NTMTS202"></a><a id="NTMTS203"></a><a id="NTMTS198"></a><div class="props_rev_3"><a id="GUID-BD493E2D-B0AA-46DC-8658-7FD80023C542" name="GUID-BD493E2D-B0AA-46DC-8658-7FD80023C542"></a><h4 id="NTMTS-GUID-BD493E2D-B0AA-46DC-8658-7FD80023C542" class="sect4"><span class="enumeration_section">4.3.5 </span>OraMTSSvcEnlist() 
                  </h4>
                  <div>
                     <div class="section">
                        <p>Enlists or de-enlists an OCI connection in a transaction coordinated by MS DTC. Use this call to explicitly enlist pooled connections. Nonpooled connections must enlist with <code class="codeph">OraMTSJoinTxn()</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Syntax</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">DWORD OraMTSSvcEnlist(</pre><pre class="oac_no_warn" dir="ltr">                   OCISvcCtx*  OCISvc, 
                   OCIError*   OCIErr, 
                   void*       lpTrans, 
                   unsigned    dwFlags);</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Parameters</p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-BD493E2D-B0AA-46DC-8658-7FD80023C542__GUID-1952EB13-B0EC-4744-B046-B091CECB5255">
                        <p class="titleintable">Table 4-4 OraMTSSvcEnlist() Parameters</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="OraMTSSvcEnlist() Parameters" summary="OraMTSSvcEnlist() parameters. Column 1 lists the parameter, column 2 indicates if the parameter has an IN or OUT binding, and column 3 contains a description of the parameter." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="15%" id="d4255e1899">Parameter</th>
                                 <th align="left" valign="bottom" width="12%" id="d4255e1902">IN/OUT</th>
                                 <th align="left" valign="bottom" width="74%" id="d4255e1905">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="15%" id="d4255e1910" headers="d4255e1899 ">
                                    <p><code class="codeph">OCISvc</code></p>
                                 </td>
                                 <td align="left" valign="top" width="12%" headers="d4255e1910 d4255e1902 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="74%" headers="d4255e1910 d4255e1905 ">
                                    <p>OCI service context for pooled connections obtained by calling <code class="codeph">OraMTSSvcGet()</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="15%" id="d4255e1924" headers="d4255e1899 ">
                                    <p><code class="codeph">OCIErr</code></p>
                                 </td>
                                 <td align="left" valign="top" width="12%" headers="d4255e1924 d4255e1902 ">
                                    <p><code class="codeph">IN/OUT</code></p>
                                 </td>
                                 <td align="left" valign="top" width="74%" headers="d4255e1924 d4255e1905 ">
                                    <p>OCI error handle (ignored)</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="15%" id="d4255e1936" headers="d4255e1899 ">
                                    <p><code class="codeph">lpTrans</code></p>
                                 </td>
                                 <td align="left" valign="top" width="12%" headers="d4255e1936 d4255e1902 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="74%" headers="d4255e1936 d4255e1905 ">
                                    <p>Pointer to the MS DTC-controlled transaction in which to enlist. If <code class="codeph">NULL</code>, the OCI connection is de-enlisted from the MS DTC-controlled transaction.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="15%" id="d4255e1951" headers="d4255e1899 ">
                                    <p><code class="codeph">dwFlags</code></p>
                                 </td>
                                 <td align="left" valign="top" width="12%" headers="d4255e1951 d4255e1902 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="74%" headers="d4255e1951 d4255e1905 ">
                                    <p>Flag used for enlisting in a transaction. Use the <code class="codeph">ORAMTS_ENFLG_DEFAULT</code> value. If enlisting, then start a new Oracle global transaction. If de-enlisting, then detach from any global Oracle transaction and delete the context object if the OCI service context represents a nonpooled connection.
                                    </p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p class="subhead3">Returns</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Returns <code class="codeph">ORAMTSERR_NOERROR</code> on success. 
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Usage Notes</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Use this call to explicitly enlist or de-enlist a pooled connection. For enlisting and de-enlisting nonpooled connections, use <code class="codeph">OraMTSSvcRel()</code>.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">OraMTSSvcEnlist()</code> enlists (or de-enlists) pooled OCI connections obtained previously through <code class="codeph">OraMTSSvcGet()</code> with the <code class="codeph">ORAMTS_CFLG_NOIMPLICIT</code> flag and not yet released with <code class="codeph">OraMTSSvcRel()</code>. The pooled OCI connections must be explicitly enlistable. When the transaction is complete, you must de-enlist <code class="codeph">OraMTSSvcEnlist()</code>, passing <code class="codeph">NULL</code> as the transaction pointer as follows: 
                              </p><pre class="oac_no_warn" dir="ltr">OraMTSSvcEnlist (OCISvc, OCIErr, NULL, ORAMTS_ENFLG_DEFAULT)
</pre><p>You must use <code class="codeph">OraMTSSvcRel()</code> to release the connection when done. 
                              </p>
                           </li>
                           <li>
                              <p>Callers must allocate a connection, enlist the connection, perform work, de-enlist the connection, release the connection, and then attempt to commit or terminate.</p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="NTMTS205"></a><a id="NTMTS206"></a><a id="NTMTS207"></a><a id="NTMTS208"></a><a id="NTMTS209"></a><a id="NTMTS204"></a><div class="props_rev_3"><a id="GUID-574D1E3F-C50C-44E9-BF13-80F5043B6B08" name="GUID-574D1E3F-C50C-44E9-BF13-80F5043B6B08"></a><h4 id="NTMTS-GUID-574D1E3F-C50C-44E9-BF13-80F5043B6B08" class="sect4"><span class="enumeration_section">4.3.6 </span>OraMTSSvcEnlistEx()
                  </h4>
                  <div>
                     <div class="section">
                        <p>Enlists an OCI connection or service context in an MS DTC transaction. Use this call only to explicitly enlist pooled connections. Nonpooled connections must enlist with <code class="codeph">OraMTSJoinTxn()</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Syntax</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">DWORD OraMTSSvcEnlistEx(
                     OCISvcCtx* OCISvc, </pre><pre class="oac_no_warn" dir="ltr">                     OCIError*  OCIErr, 
                     void*      lpTrans, 
                     unsigned   dwFlags,
                     char*      lpDBName);</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Parameters</p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-574D1E3F-C50C-44E9-BF13-80F5043B6B08__GUID-BA4A8FEB-2C1B-4F6E-B018-43D5C05ABD06">
                        <p class="titleintable">Table 4-5  OraMTSSvcEnlistEx() Parameters</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title=" OraMTSSvcEnlistEx() Parameters" summary="OraMTSSvcEnlistEx() parameters. Column 1 lists the parameter, column 2 indicates if the parameter has an IN or OUT binding, and column 3 contains a description of the parameter." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="14%" id="d4255e2108">Parameter</th>
                                 <th align="left" valign="bottom" width="10%" id="d4255e2111">IN/OUT</th>
                                 <th align="left" valign="bottom" width="76%" id="d4255e2114">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d4255e2119" headers="d4255e2108 ">
                                    <p><code class="codeph">OCISvc</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e2119 d4255e2111 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2119 d4255e2114 ">
                                    <p>OCI service context for pooled connections obtained by calling <code class="codeph">OraMTSSvcGet()</code></p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d4255e2133" headers="d4255e2108 ">
                                    <p><code class="codeph">OCIErr</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e2133 d4255e2111 ">
                                    <p><code class="codeph">IN/OUT</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2133 d4255e2114 ">
                                    <p>OCI error handle (ignored)</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d4255e2145" headers="d4255e2108 ">
                                    <p><code class="codeph">lpTrans</code> 
                                    </p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e2145 d4255e2111 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2145 d4255e2114 ">
                                    <p>Pointer to the MS DTC-controlled transaction in which to enlist. If <code class="codeph">NULL</code>, the OCI connection is de-enlisted from the MS DTC-controlled transaction.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d4255e2161" headers="d4255e2108 ">
                                    <p><code class="codeph">dwFlags</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e2161 d4255e2111 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2161 d4255e2114 ">
                                    <p>Flag used for enlisting in a transaction. Use the <code class="codeph">ORAMTS_ENFLG_DEFAULT</code> value. If enlisting, then start a new Oracle global transaction. If de-enlisting, then detach from any global Oracle transaction and delete the context object if the OCI service context represents a nonpooled connection.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d4255e2176" headers="d4255e2108 ">
                                    <p><code class="codeph">lpDBName</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e2176 d4255e2111 ">
                                    <p><code class="codeph">-</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2176 d4255e2114 ">
                                    <p>Net service name for connecting to the database (created with Oracle Net Manager or Oracle Net Configuration Assistant)</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p class="subhead3">Returns</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Returns <code class="codeph">ORAMTSERR_ILLEGAL_OPER</code>. 
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Usage Notes</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Use <code class="codeph">OraMTSSvcEnlistEx()</code> for pooled connections or <code class="codeph">OraMTSJoinTxn()</code> for nonpooled connections. 
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="NTMTS211"></a><a id="NTMTS212"></a><a id="NTMTS213"></a><a id="NTMTS214"></a><a id="NTMTS215"></a><a id="NTMTS210"></a><div class="props_rev_3"><a id="GUID-168D8B80-7FCD-445C-AD60-8789B96F1306" name="GUID-168D8B80-7FCD-445C-AD60-8789B96F1306"></a><h4 id="NTMTS-GUID-168D8B80-7FCD-445C-AD60-8789B96F1306" class="sect4"><span class="enumeration_section">4.3.7 </span>OraMTSEnlCtxGet() 
                  </h4>
                  <div>
                     <div class="section">
                        <p>Creates an enlistment context for a nonpooled OCI connection.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Syntax</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">DWORD OraMTSEnlCtxGet(</pre><pre class="oac_no_warn" dir="ltr">                     text*       lpUname,
                     text*       lpPsswd,
                     text*       lpDbnam,              
                     OCISvcCtx*  pOCISvc,
                     OCIError*   pOCIErr,
                     ub4         dwFlags,
                     void**      pCtxt);</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Parameters</p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-168D8B80-7FCD-445C-AD60-8789B96F1306__GUID-9A0A979C-AB4A-441E-8FA7-01D86EFBC14F">
                        <p class="titleintable">Table 4-6 OraMTSEnlCtxGet() Parameters</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="OraMTSEnlCtxGet() Parameters" summary="OraMTSEnlCtxGet() parameters. Column 1 lists the parameter, column 2 indicates if the parameter has an IN or OUT binding, and column 3 contains a description of the parameter." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="13%" id="d4255e2291">Parameter</th>
                                 <th align="left" valign="bottom" width="11%" id="d4255e2294">IN/OUT</th>
                                 <th align="left" valign="bottom" width="76%" id="d4255e2297">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="13%" id="d4255e2302" headers="d4255e2291 ">
                                    <p><code class="codeph">lpUname</code></p>
                                 </td>
                                 <td align="left" valign="top" width="11%" headers="d4255e2302 d4255e2294 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2302 d4255e2297 ">
                                    <p>Username for connecting to the Oracle Database</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="13%" id="d4255e2314" headers="d4255e2291 ">
                                    <p><code class="codeph">lpPsswd</code></p>
                                 </td>
                                 <td align="left" valign="top" width="11%" headers="d4255e2314 d4255e2294 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2314 d4255e2297 ">
                                    <p>Password for connecting to the Oracle Database</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="13%" id="d4255e2326" headers="d4255e2291 ">
                                    <p><code class="codeph">lpDbnam</code></p>
                                 </td>
                                 <td align="left" valign="top" width="11%" headers="d4255e2326 d4255e2294 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2326 d4255e2297 ">
                                    <p>Net service name for connecting to a database</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="13%" id="d4255e2338" headers="d4255e2291 ">
                                    <p><code class="codeph">pOCISvc</code></p>
                                 </td>
                                 <td align="left" valign="top" width="11%" headers="d4255e2338 d4255e2294 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2338 d4255e2297 ">
                                    <p>OCI service context for a nonpooled connection</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="13%" id="d4255e2350" headers="d4255e2291 ">
                                    <p><code class="codeph">pOCIErr</code></p>
                                 </td>
                                 <td align="left" valign="top" width="11%" headers="d4255e2350 d4255e2294 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2350 d4255e2297 ">
                                    <p>OCI error handle</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="13%" id="d4255e2362" headers="d4255e2291 ">
                                    <p><code class="codeph">dwFlags</code></p>
                                 </td>
                                 <td align="left" valign="top" width="11%" headers="d4255e2362 d4255e2294 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2362 d4255e2297 ">
                                    <p>Enlistment flags. The only value currently permitted is <code class="codeph">0</code>.
                                    </p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="13%" id="d4255e2377" headers="d4255e2291 ">
                                    <p><code class="codeph">pCtxt</code></p>
                                 </td>
                                 <td align="left" valign="top" width="11%" headers="d4255e2377 d4255e2294 ">
                                    <p><code class="codeph">OUT</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2377 d4255e2297 ">
                                    <p>Enlistment context to be created</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p class="subhead3">Returns</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Returns <code class="codeph">ORAMTSERR_NOERROR</code> on success. 
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Usage Notes</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>This call sets up an enlistment context for a nonpooled connection. This call must be started just after the caller establishes the OCI connection to the database. Once created, this context can be passed into <code class="codeph">OraMTSJoinTxn()</code> calls. Prior to deleting the OCI connection, <code class="codeph">OraMTSEnlCtxRel()</code> must be called to delete the enlistment context. 
                              </p>
                           </li>
                           <li>
                              <p>Callers must: </p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Allocate a nonpooled connection through OCI. </p>
                                 </li>
                                 <li>
                                    <p>Create an enlistment context by calling <code class="codeph">OraMTSEnlCtxGet()</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Enlist the connection by calling <code class="codeph">OraMTSJoinTxn()</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Perform database work. </p>
                                 </li>
                                 <li>
                                    <p>De-enlist the connection by calling <code class="codeph">OraMTSJoinTxn()</code> with a <code class="codeph">NULL</code> transaction pointer.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Attempt to commit or terminate work.</p>
                                 </li>
                                 <li>
                                    <p>Release the enlistment context by calling <code class="codeph">OraMTSEnlCtxRel()</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Release the nonpooled OCI connection and delete its associated OCI environment handle. </p>
                                 </li>
                              </ul>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="NTMTS217"></a><a id="NTMTS218"></a><a id="NTMTS219"></a><a id="NTMTS220"></a><a id="NTMTS221"></a><a id="NTMTS216"></a><div class="props_rev_3"><a id="GUID-34590C40-3CE6-4E66-A4FF-844AC20509A6" name="GUID-34590C40-3CE6-4E66-A4FF-844AC20509A6"></a><h4 id="NTMTS-GUID-34590C40-3CE6-4E66-A4FF-844AC20509A6" class="sect4"><span class="enumeration_section">4.3.8 </span>OraMTSEnlCtxRel()
                  </h4>
                  <div>
                     <div class="section">
                        <p>Eliminates a previously set up enlistment context for a nonpooled OCI connection.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Syntax</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">DWORD OraMTSEnlCtxRel(void* pCtxt); </pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Parameters</p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-34590C40-3CE6-4E66-A4FF-844AC20509A6__GUID-0B669A66-68BC-4A72-B4F1-C80D67A92ED9">
                        <p class="titleintable">Table 4-7 OraMTSEnlCtxRel() Parameters</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="OraMTSEnlCtxRel() Parameters" summary="OraMTSEnlCtxRel() parameters. Column 1 lists the parameter, column 2 indicates if the parameter has an IN or OUT binding, and column 3 contains a description of the parameter." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="13%" id="d4255e2539">Parameter</th>
                                 <th align="left" valign="bottom" width="13%" id="d4255e2542">IN/OUT</th>
                                 <th align="left" valign="bottom" width="74%" id="d4255e2545">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="13%" id="d4255e2550" headers="d4255e2539 ">
                                    <p><code class="codeph">pCtxt</code></p>
                                 </td>
                                 <td align="left" valign="top" width="13%" headers="d4255e2550 d4255e2542 "><pre class="oac_no_warn" dir="ltr">IN</pre></td>
                                 <td align="left" valign="top" width="74%" headers="d4255e2550 d4255e2545 ">
                                    <p>Enlistment context to eliminate</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p class="subhead3">Returns</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Returns <code class="codeph">ORAMTSERR_NOERROR</code> on success. 
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Usage Notes</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Before dropping a nonpooled OCI connection, a client must call <code class="codeph">OraMTSEnlCtxRel()</code> to eliminate any enlistment context it may have created for that connection. The enlistment context can maintain OCI handles allocated off the connection's OCI environment handle. This makes it imperative that the environment handle is not deleted for the associated enlistment context.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="NTMTS223"></a><a id="NTMTS224"></a><a id="NTMTS225"></a><a id="NTMTS226"></a><a id="NTMTS227"></a><a id="NTMTS222"></a><div class="props_rev_3"><a id="GUID-52FF1F1D-E70D-4319-A47A-78AC263E2C29" name="GUID-52FF1F1D-E70D-4319-A47A-78AC263E2C29"></a><h4 id="NTMTS-GUID-52FF1F1D-E70D-4319-A47A-78AC263E2C29" class="sect4"><span class="enumeration_section">4.3.9 </span>OraMTSJoinTxn() 
                  </h4>
                  <div>
                     <div class="section">
                        <p>Enlists a nonpooled OCI connection in an MS DTC transaction. </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Syntax</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">DWORD OraMTSJoinTxn(void*  pCtxt, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void*  pTrans);</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Parameters</p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-52FF1F1D-E70D-4319-A47A-78AC263E2C29__GUID-9BA39F70-BB4B-475B-A7F7-AAF4AA8AABEC">
                        <p class="titleintable">Table 4-8 OraMTSJoinTxn() Parameters</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="OraMTSJoinTxn() Parameters" summary="OraMTSJoinTxn() parameters. Column 1 lists the parameter, column 2 indicates if the parameter has an IN or OUT binding, and column 3 contains a description of the parameter." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="23%" id="d4255e2678">Parameter</th>
                                 <th align="left" valign="bottom" width="23%" id="d4255e2681">IN</th>
                                 <th align="left" valign="bottom" width="53%" id="d4255e2684">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d4255e2689" headers="d4255e2678 ">
                                    <p><code class="codeph">pCtxt</code></p>
                                 </td>
                                 <td align="left" valign="top" width="23%" headers="d4255e2689 d4255e2681 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d4255e2689 d4255e2684 ">
                                    <p>Enlistment context for the OCI connection</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="23%" id="d4255e2701" headers="d4255e2678 ">
                                    <p><code class="codeph">pTrans</code></p>
                                 </td>
                                 <td align="left" valign="top" width="23%" headers="d4255e2701 d4255e2681 ">
                                    <p><code class="codeph">IN</code></p>
                                 </td>
                                 <td align="left" valign="top" width="53%" headers="d4255e2701 d4255e2684 ">
                                    <p>Reference to the MS DTC transaction object</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p class="subhead3">Returns</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Returns <code class="codeph">ORAMTSERR_NOERROR</code> on success. 
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Usage Notes</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Clients use this call with nonpooled OCI connections to enlist connections in MS DTC-coordinated transactions. The client passes in the wide reference to the enlistment context representing the OCI connection, along with a reference to an MS DTC transaction object. If <code class="codeph">pTrans</code> is <code class="codeph">NULL</code>, the OCI connection is de-enlisted from any MS DTC transaction in which it is currently enlisted. You can enlist a previously-enlisted OCI connection in a different MS DTC transaction.
                              </p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="NTMTS229"></a><a id="NTMTS230"></a><a id="NTMTS231"></a><a id="NTMTS228"></a><div class="props_rev_3"><a id="GUID-22472D28-1D06-4244-99F3-DF6464F691FE" name="GUID-22472D28-1D06-4244-99F3-DF6464F691FE"></a><h4 id="NTMTS-GUID-22472D28-1D06-4244-99F3-DF6464F691FE" class="sect4"><span class="enumeration_section">4.3.10 </span>OraMTSTransTest() 
                  </h4>
                  <div>
                     <div class="section">
                        <p>Tests if you are running inside a Microsoft Transaction Server-started transaction.</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Syntax</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">BOOL OraMTSTransTest();</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Returns</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Returns <code class="codeph">true</code> if running inside a Microsoft Transaction Server transaction. 
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Usage Notes</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Microsoft Transaction Server transactional components use <code class="codeph">OraMTSTransTest()</code> to check if a component is running within the context of a Microsoft Transaction Server transaction. Note that this call can only test Microsoft Transaction Server-started transactions. Transactions started by directly calling the MS DTC are not detected.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="NTMTS233"></a><a id="NTMTS234"></a><a id="NTMTS235"></a><a id="NTMTS236"></a><a id="NTMTS237"></a><a id="NTMTS238"></a><a id="NTMTS232"></a><div class="props_rev_3"><a id="GUID-D87897DB-DD3E-44BA-83E5-656EB3CB075D" name="GUID-D87897DB-DD3E-44BA-83E5-656EB3CB075D"></a><h4 id="NTMTS-GUID-D87897DB-DD3E-44BA-83E5-656EB3CB075D" class="sect4"><span class="enumeration_section">4.3.11 </span>OraMTSOCIErrGet() 
                  </h4>
                  <div>
                     <div class="section">
                        <p>Retrieves the OCI error code and message text, if any, from the last <code class="codeph">OraMTS</code> function operation, typically <code class="codeph">OraMTSSvcGet()</code> or <code class="codeph">OraMTSJoinTxn()</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Syntax</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section"><pre class="oac_no_warn" dir="ltr">BOOL OraMTSOCIErrGet(DWORD* dwErr, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LPCHAR lpcEMsg, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD* lpdLen);</pre></div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Parameters</p>
                     </div>
                     <!-- class="section" -->
                     <div class="tblformal" id="GUID-D87897DB-DD3E-44BA-83E5-656EB3CB075D__GUID-6AC40903-3AE5-4649-BFC3-C9C04C2EF8C7">
                        <p class="titleintable">Table 4-9 OraMTSOCIErrGet() Parameters</p>
                        <table cellpadding="4" cellspacing="0" class="Formal" title="OraMTSOCIErrGet() Parameters" summary="OraMTSOCIErrGet() parameters. Column 1 lists the parameter, column 2 indicates if the parameter has an IN or OUT binding, and column 3 contains a description of the parameter." width="100%" frame="hsides" border="1" rules="rows">
                           <thead>
                              <tr align="left" valign="top">
                                 <th align="left" valign="bottom" width="14%" id="d4255e2909">Parameter</th>
                                 <th align="left" valign="bottom" width="10%" id="d4255e2912">IN/OUT</th>
                                 <th align="left" valign="bottom" width="76%" id="d4255e2915">Description</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d4255e2920" headers="d4255e2909 ">
                                    <p><code class="codeph">dwErr</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e2920 d4255e2912 ">
                                    <p><code class="codeph">-</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2920 d4255e2915 ">
                                    <p>Error code</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d4255e2932" headers="d4255e2909 ">
                                    <p><code class="codeph">lpcEMsg</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e2932 d4255e2912 ">
                                    <p><code class="codeph">-</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2932 d4255e2915 ">
                                    <p>Buffer for the error message, if any</p>
                                 </td>
                              </tr>
                              <tr align="left" valign="top">
                                 <td align="left" valign="top" width="14%" id="d4255e2944" headers="d4255e2909 ">
                                    <p><code class="codeph">lpdLen</code></p>
                                 </td>
                                 <td align="left" valign="top" width="10%" headers="d4255e2944 d4255e2912 ">
                                    <p><code class="codeph">-</code></p>
                                 </td>
                                 <td align="left" valign="top" width="76%" headers="d4255e2944 d4255e2915 ">
                                    <p>Set to the actual number of message bytes</p>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                     <!-- class="inftblhruleinformal" -->
                     <div class="section">
                        <p class="subhead3">Returns </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p>Returns <code class="codeph">true</code> if an OCI error is encountered. Otherwise, <code class="codeph">false</code> is returned. If <code class="codeph">true</code> is returned and <code class="codeph">lpcEMsg</code> and <code class="codeph">lpdLen</code> are valid, and there is a stashed error message, up to <code class="codeph">lpdLen</code> bytes are copied into <code class="codeph">lpcEMsg</code>. <code class="codeph">lpdLen</code> is set to the actual number of message bytes.     
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p class="subhead3">Usage Notes</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <p><a href="program.html#GUID-D87897DB-DD3E-44BA-83E5-656EB3CB075D__BEJEFACA">Example 4-2</a> illustrates how <code class="codeph">OraMTSOCIErrGet()</code> retrieves the OCI error code and OCI error message text, if any, from the last <code class="codeph">OraMTSSvc()</code> operation on this thread.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-D87897DB-DD3E-44BA-83E5-656EB3CB075D__BEJEFACA">
                        <p class="titleinexample">Example 4-2 Retrieving the OCI Error Code and Message Text</p><pre class="oac_no_warn" dir="ltr">DWORD dwStat = OraMTSSvcGet("hr",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"invalid_password",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"fin_prod",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"db",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;mysvch,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;myenvh, 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ORAMTS_CFLG_ALLDEFAULT);

if (dwStat != ORAMTS_ERR_NOERROR)
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD   dwOCIErr;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char    errBuf[MAX_PATH];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD   errBufLen = sizeof(effBuf);

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (OraMTSOCIErrGet(&amp;dwOCIErr, &amp;errBuf, &amp;errBufLen))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("OCIError %d: %s"\n);
&nbsp;&nbsp;&nbsp;}</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div><a id="NTMTS239"></a><div class="props_rev_3"><a id="GUID-19CAEBCB-68FD-413B-9814-842FDC67FEA3" name="GUID-19CAEBCB-68FD-413B-9814-842FDC67FEA3"></a><h3 id="NTMTS-GUID-19CAEBCB-68FD-413B-9814-842FDC67FEA3" class="sect3"><span class="enumeration_section">4.4 </span>ODBC Integration with Microsoft Transaction Server Overview
               </h3>
               <div>
                  <p>This topic describes how to use Oracle ODBC Driver with Microsoft Transaction Server and a Oracle Database. No changes to OCI code are necessary for ODBC to operate successfully.</p>
               </div><a id="NTMTS240"></a><div class="props_rev_3"><a id="GUID-87A40BFC-C926-4B65-AAE8-56A2F56327D2" name="GUID-87A40BFC-C926-4B65-AAE8-56A2F56327D2"></a><h4 id="NTMTS-GUID-87A40BFC-C926-4B65-AAE8-56A2F56327D2" class="sect4"><span class="enumeration_section">4.4.1 </span>Setting the Connection Attribute
                  </h4>
                  <div>
                     <div class="section">
                        <p>To use Microsoft Transaction Server with either Oracle ODBC Driver 11.1 or Microsoft Oracle ODBC driver, set the connection attribute using the <code class="codeph">SQLSetConnectAttr</code> function to call the parameter <code class="codeph">SQL_ATTR_ENLIST_IN_DTC</code> in the ODBC code. This enables you to receive connection pooling and implicit transaction support. 
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="NTMTS241"></a><div class="props_rev_3"><a id="GUID-0906441B-1F50-471B-A519-E39C84FFF10D" name="GUID-0906441B-1F50-471B-A519-E39C84FFF10D"></a><h4 id="NTMTS-GUID-0906441B-1F50-471B-A519-E39C84FFF10D" class="sect4"><span class="enumeration_section">4.4.2 </span>Using Oracle ODBC Driver
                  </h4>
                  <div>
                     <div class="section">
                        <p>The ODBC Driver Manager distributed with ODBC 3.0 is a Resource Dispenser that supports connection pooling. Oracle ODBC Driver release 11.1 integrates with the ODBC 3.0 Driver Manager by supporting the <code class="codeph">SQLSetConnectAttr(...,..., SQL_ATTR_ENLIST_IN_DTC)</code> call to enlist or de-enlist the ODBC connection used in MS DTC-coordinated transactions.
                        </p>
                        <p>Use the Oracle ODBC Driver 11.1 with:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Applications you develop</p>
                           </li>
                           <li>
                              <p>The sample banking application that Microsoft provides with Microsoft Transaction Server.</p>
                           </li>
                        </ul>
                        <p>To configure Oracle ODBC Driver, follow these steps:<a id="d4255e3196" class="indexterm-anchor"></a></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Choose <span class="bold">Start</span> &gt; <span class="bold">Settings</span> &gt; <span class="bold">Control Panel</span>.</span><div>
                              <p>The Control Panel window appears.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Double-click <span class="bold">ODBC</span>.</span><div>
                              <p>The ODBC Data Source Administrator dialog box appears.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Choose the <span class="bold">File DSN</span> tab.</span></li>
                        <li class="stepexpand" id="GUID-0906441B-1F50-471B-A519-E39C84FFF10D__BEJJDHDA"><span>To make Oracle ODBC Driver work with Microsoft sample banking application demo, follow these steps. Otherwise, skip this step.</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>Back up Microsoft <code class="codeph">mtssamples.dsn</code> file. This file is located in <span class="italic"><code class="codeph">ROOTDRIVE</code></span>:\<code class="codeph">program files\common files\odbc\data sources</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Select <a id="d4255e3252" class="indexterm-anchor"></a><a id="d4255e3256" class="indexterm-anchor"></a><code class="codeph">mtssamples.dsn</code> and click <span class="bold">Remove</span>.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Click <span class="bold">Yes</span> when prompted.
                                    </p>
                                    <p>This deletes the configuration file that enables the Microsoft Transaction Server sample application demo to use the Microsoft ODBC driver.</p>
                                 </li>
                              </ul>
                              <p>If you don't intend to use the demo, click <span class="bold">Add to create a new File data source name (DSN)</span>.
                              </p>
                              <p>The Create New Data Source wizard appears.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Select <span class="bold">Oracle</span> in <span class="italic"><code class="codeph">HOME_NAME</code></span>.</span></li>
                        <li class="stepexpand"><span>Click <span class="bold">Advanced</span>.</span></li>
                        <li class="stepexpand"><span>Add the following information in the keywords and values field:</span><div><pre class="oac_no_warn" dir="ltr">SERVER=<span class="italic">database_alias</span>
USERNAME=hr 
PASSWORD=<span class="italic">hr_password</span>
</pre><p>where:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p><code class="codeph">SERVER</code> is the The database alias used by the demo to access the database <code class="codeph">mtsdemo</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">USERNAME</code> is the database username for this application, such as <code class="codeph">hr</code>.
                                    </p>
                                 </li>
                                 <li>
                                    <p><code class="codeph">PASSWORD</code>	 is the database password for username <code class="codeph">hr</code>.
                                    </p>
                                 </li>
                              </ul>
                              <p>Verify that the <code class="codeph">hr</code> schema contains the <code class="codeph">account</code> and <code class="codeph">receipt</code> tables.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Click <span class="bold">OK</span>.</span></li>
                        <li class="stepexpand"><span>Click <span class="bold">Next</span> to continue with the Create New Data Source wizard.</span></li>
                        <li class="stepexpand"><span>For the Microsoft sample application, enter <code class="codeph">mtssamples.dsn</code> (Microsoft ODBC name). This name must exactly match the name you removed in Step <a href="program.html#GUID-0906441B-1F50-471B-A519-E39C84FFF10D__BEJJDHDA">4</a>.</span><div>
                              <p>For applications you develop, enter the name of the DSN file that will be used.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Complete the remaining Create New Data Source wizard pages.</span></li>
                        <li class="stepexpand"><span>Click<span class="bold"> OK</span> to exit the ODBC Data Source Administrator dialog box.</span></li>
                        <li class="stepexpand"><span>Exit the Control Panel window.</span></li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-0906441B-1F50-471B-A519-E39C84FFF10D__GUID-AC9F103F-A15C-4E84-95D5-592E88171517">
                           <p class="notep1">See Also:</p>
                           <p></p>
                           <p>Microsoft Transaction Server SDK for information </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="NTMTS242"></a><div class="props_rev_3"><a id="GUID-823D62C9-2CB7-4F06-BA9A-2B6215961E88" name="GUID-823D62C9-2CB7-4F06-BA9A-2B6215961E88"></a><h4 id="NTMTS-GUID-823D62C9-2CB7-4F06-BA9A-2B6215961E88" class="sect4"><span class="enumeration_section">4.4.3 </span>Using Microsoft Oracle ODBC Driver
                  </h4>
                  <div>
                     <div class="section">
                        <p>As an alternative to the Oracle ODBC driver, you can use the Microsoft Oracle ODBC Driver. You should be aware that you would not be able to integrate with Oracle Provider for OLE DB and Oracle Data Provider for .NET if using the Microsoft driver. Also, you will not receive the performance benefits of the Oracle ODBC driver, API support for integration, or Oracle client support services.</p>
                        <p>After enabling the Microsoft Oracle ODBC Driver, perform these additional steps to configure the Microsoft Oracle ODBC Driver: </p>
                        <p>To configure the Microsoft Oracle ODBC Driver:<a id="d4255e3450" class="indexterm-anchor"></a><a id="d4255e3454" class="indexterm-anchor"></a><a id="d4255e3456" class="indexterm-anchor"></a></p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Install Oracle Required Support Files (RSF) and SQL*Net 2.3 or later on the computer where the Microsoft Oracle ODBC Driver is operating.</span></li>
                        <li class="stepexpand"><span>Run the <span class="italic"><code class="codeph">ORACLE_BASE</code></span><code class="codeph">\</code><span class="italic"><code class="codeph">ORACLE_HOME</code></span>\<code class="codeph">oramts\samples\ sql\omtssamp.sql</code> script. </span></li>
                        <li class="stepexpand"><span>Use SQL*Net Easy Config to set up a database alias connection. This alias is used in the <code class="codeph">mtssamples.dsn</code> file. </span></li>
                        <li class="stepexpand"><span>If you installed the RSFs in a home with Oracle Net installed, be sure to set the following registry parameter at <code class="codeph">HKEY_LOCAL_MACHINE\SOFTWARE\ORACLE</code>:<a id="d4255e3491" class="indexterm-anchor"></a></span><div><pre class="oac_no_warn" dir="ltr">ORAOCI = ORA73.DLL
</pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-823D62C9-2CB7-4F06-BA9A-2B6215961E88__GUID-F6CA7E39-91E8-430F-B316-5C3E3D0BA6A7">
                           <p class="notep1">See Also:</p>
                           <p>"Setting Up MTS to Access Oracle" in the Microsoft Transaction Server online Help for instructions on enabling the Microsoft Oracle ODBC Driver</p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>