<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Managing Recovery Scenarios</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide for Microsoft Windows">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-services-microsoft-transaction-server.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-08-05T10:28:43-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E90597-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      
      <link rel="prev" href="install.html" title="Previous" type="text/html">
      <link rel="next" href="program.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OracleÂ® Services for Microsoft Transaction Server">
    <meta name="dcterms.isVersionOf" content="NTMTS">
    <meta name="dcterms.release" content="Release 18">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="install.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="program.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Managing Recovery Scenarios</li>
            </ol>
            <a id="GUID-7CBD0319-E78A-4CF5-8FBF-E13363DB2DDA" name="GUID-7CBD0319-E78A-4CF5-8FBF-E13363DB2DDA"></a><a id="NTMTS003"></a>
            
            <h2 id="NTMTS-GUID-7CBD0319-E78A-4CF5-8FBF-E13363DB2DDA" class="sect2"><span class="enumeration_chapter">3 </span> Managing Recovery Scenarios
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>These topics describe how to create and schedule <a href="glossary.html#GUID-10C5A220-53B1-4AE6-AD1F-12B8C90EDB91"><span class="xrefglossterm">Microsoft Transaction Server</span></a>-related Oracle transaction recovery. 
               </p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="managing-recovery-scenarios.html#GUID-336D86BD-E97F-4132-B2DB-42072B4F5521">Microsoft Transaction Server Configuration Requirements</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-scenarios.html#GUID-69D36197-A5ED-4B6D-8C16-EBC2977018D0">Microsoft Transaction Server Transaction Recovery Overview</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-scenarios.html#GUID-36DF2E88-4B9A-4EEF-8BFA-A65EE0D70A30">Scheduling Automatic Microsoft Transaction Server Transaction Recovery</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-scenarios.html#GUID-DA02FA5F-52D9-4873-A6C7-89877E1F4CBB">Viewing Microsoft Transaction Server In-Doubt Transactions</a></p>
                  </li>
                  <li>
                     <p><a href="managing-recovery-scenarios.html#GUID-D7866844-CAD3-4C8F-94DB-0DDB6A09B9D7">Modifying Registry Values for Oracle Fail Safe Configurations</a></p>
                  </li>
               </ul>
            </div><a id="NTMTS134"></a><div class="props_rev_3"><a id="GUID-336D86BD-E97F-4132-B2DB-42072B4F5521" name="GUID-336D86BD-E97F-4132-B2DB-42072B4F5521"></a><h3 id="NTMTS-GUID-336D86BD-E97F-4132-B2DB-42072B4F5521" class="sect3"><span class="enumeration_section">3.1 </span>Microsoft Transaction Server Configuration Requirements
               </h3>
               <div>
                  <p>You must configure the Microsoft Transaction Server and Oracle Database environments after installing or migrating <a href="glossary.html#GUID-58343E80-D149-4152-BAAE-2964138B9599"><span class="xrefglossterm">Oracle Services for Microsoft Transaction Server (OraMTS)</span></a>.
                  </p>
                  <p>Configuration is not required on the Windows computer if a Microsoft Transaction Server is installed on a computer.</p>
                  <p>To configure the Microsoft Transaction Server, perform the following tasks on the computer where the Oracle Database is installed:</p>
                  <ol>
                     <li>
                        <p>Run the <code class="codeph">oramtsadmin.sql</code> script against the database to create the Microsoft Transaction Server administrative user account (the default username is <code class="codeph">mtssys</code>).
                        </p>
                     </li>
                     <li>
                        <p>Schedule automatic transaction recovery.</p>
                        <p>See <span class="q">"<a href="managing-recovery-scenarios.html#GUID-36DF2E88-4B9A-4EEF-8BFA-A65EE0D70A30">Scheduling Automatic Microsoft Transaction Server Transaction Recovery</a>"</span></p>
                     </li>
                     <li>
                        <p>If you have an Oracle Fail Safe configuration, modify the registry values before or after running the <code class="codeph">oramtsadmin.sql</code> script.
                        </p>
                        <p>See <span class="q">"<a href="managing-recovery-scenarios.html#GUID-D7866844-CAD3-4C8F-94DB-0DDB6A09B9D7">Modifying Registry Values for Oracle Fail Safe Configurations</a>"</span>.
                        </p>
                     </li>
                  </ol>
               </div>
            </div><a id="NTMTS135"></a><div class="props_rev_3"><a id="GUID-69D36197-A5ED-4B6D-8C16-EBC2977018D0" name="GUID-69D36197-A5ED-4B6D-8C16-EBC2977018D0"></a><h3 id="NTMTS-GUID-69D36197-A5ED-4B6D-8C16-EBC2977018D0" class="sect3"><span class="enumeration_section">3.2 </span>Microsoft Transaction Server Transaction Recovery Overview
               </h3>
               <div>
                  <p>Distributed transaction capabilities are required to use Microsoft Transaction Server with Oracle database. Microsoft Transaction Server-related Oracle transactions become in-doubt transactions when any of the following fail:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Microsoft Transaction Server application</p>
                     </li>
                     <li>
                        <p>Network</p>
                     </li>
                     <li>
                        <p><a href="glossary.html#GUID-37C64380-2031-4103-8965-394C4A30A352"><span class="xrefglossterm">Microsoft Distributed Transaction Coordinator (MS DTC)</span></a></p>
                     </li>
                  </ul>
                  <p>An <a href="glossary.html#GUID-07D10977-6118-407A-935F-0CE4A2240EDD"><span class="xrefglossterm">Oracle MTS Recovery Service</span></a> resolves in-doubt transactions on the computer that started the failed transaction. An Oracle MTS Recovery Service is automatically installed with Oracle Services For Microsoft Transaction Server. Only one Oracle MTS Recovery Service can be installed for each computer. A scheduled recovery job on each Microsoft Transaction Server-enabled database permits the Oracle MTS Recovery Service to resolve in-doubt transactions.
                  </p>
                  <p>The Oracle MTS Recovery Service resolves an in-doubt Microsoft Transaction Server transaction in the following order:</p>
                  <ol>
                     <li>
                        <p>The DBMS recovery job detects an in-doubt MTS-related transaction. </p>
                     </li>
                     <li>
                        <p>The DBMS recovery job extracts the recovery service's endpoint address from the XID of the in-doubt transaction and requests the recovery service for the outcome of the MTS/MS DTC transaction. </p>
                     </li>
                     <li>
                        <p>The recovery service requests its MS DTC for transaction outcome.</p>
                     </li>
                     <li>
                        <p>The recovery service reports transaction outcome to the DBMS job process. </p>
                     </li>
                     <li>
                        <p>The DBMS recovery job commits or terminates the in-doubt transaction.</p>
                     </li>
                  </ol>
               </div>
            </div><a id="NTMTS136"></a><div class="props_rev_3"><a id="GUID-36DF2E88-4B9A-4EEF-8BFA-A65EE0D70A30" name="GUID-36DF2E88-4B9A-4EEF-8BFA-A65EE0D70A30"></a><h3 id="NTMTS-GUID-36DF2E88-4B9A-4EEF-8BFA-A65EE0D70A30" class="sect3"><span class="enumeration_section">3.3 </span>Scheduling Automatic Microsoft Transaction Server Transaction Recovery
               </h3>
               <div>
                  <div class="section">
                     <p>OraMTS uses server-based recovery to resolve in-doubt transactions originated by MSDTC. To do this, the OraMTS administrator must be able to access the Windows middle-tier node through <code class="codeph">UTL_HTTP</code>. <code class="codeph">oramtsadmin.sql</code> grants execute privileges on <code class="codeph">UTL_HTTP</code> to the OraMTS administrator, as shown in <span class="q">"<a href="managing-recovery-scenarios.html#GUID-3174BE06-2129-4374-BE91-75A938CA0B1D">Configuring Automatic Transaction Recovery</a>"</span></p>
                     <div class="infoboxnote" id="GUID-36DF2E88-4B9A-4EEF-8BFA-A65EE0D70A30__GUID-5F70FAB3-F0B1-402E-AB7F-635EE9857D6F">
                        <p class="notep1">Note:</p>
                        <p>Starting with Oracle version 11<span class="italic">g</span>, the DBA needs to create an access control list (ACL) as shown in <span class="q">"<a href="managing-recovery-scenarios.html#GUID-CF187131-A946-44B0-A1D9-6E5290D5F5B8">Creating an Access Control List (ACL)</a>"</span>.
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="NTMTS305"></a><a id="NTMTS304"></a><div class="props_rev_3"><a id="GUID-CF187131-A946-44B0-A1D9-6E5290D5F5B8" name="GUID-CF187131-A946-44B0-A1D9-6E5290D5F5B8"></a><h4 id="NTMTS-GUID-CF187131-A946-44B0-A1D9-6E5290D5F5B8" class="sect4"><span class="enumeration_section">3.3.1 </span>Creating an Access Control List (ACL)
                  </h4>
                  <div>
                     <div class="section">
                        <p>For Oracle database version 11<span class="italic">g</span> and later, the DBA must create an access control list (ACL) that grants the OraMTS administrator the privilege to make out-bound HTTP connections. <a href="managing-recovery-scenarios.html#GUID-CF187131-A946-44B0-A1D9-6E5290D5F5B8__BGBJBGBF">Example 3-1</a> demonstrates this:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-CF187131-A946-44B0-A1D9-6E5290D5F5B8__BGBJBGBF">
                        <p class="titleinexample">Example 3-1 Creating an ACL List and Adding OraMTS Administrator to it</p><pre class="oac_no_warn" dir="ltr">BEGIN
   -- Create the new ACL, naming it "OraMTSadmin.xml", with a description.
   -- This provides the OraMTS administrative user e.g. MTSADMIN user FOO
   -- the privilege to connect
   DBMS_NETWORK_ACL_ADMIN.CREATE_ACL('OraMTSadmin.xml',
                                    'Allow usage to the UTL network packages',
                                    'FOO', TRUE, 'connect');
   -- Now grant privilege to resolve DNS names to the OraMTS administrative user
   DBMS_NETWORK_ACL_ADMIN.ADD_PRIVILEGE('OraMTSadmin.xml' ,
                                        'FOO', TRUE,'resolve');
  -- Specify which hosts this ACL applies to, in this case we are allowing
  -- access to all hosts. if one knew the list of all Windows middle-tier,
  -- these could be added one by one.
   DBMS_NETWORK_ACL_ADMIN.ASSIGN_ACL('OraMTSadmin.xml','*');
 END;
</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="NTMTS306"></a><div class="props_rev_3"><a id="GUID-3174BE06-2129-4374-BE91-75A938CA0B1D" name="GUID-3174BE06-2129-4374-BE91-75A938CA0B1D"></a><h4 id="NTMTS-GUID-3174BE06-2129-4374-BE91-75A938CA0B1D" class="sect4"><span class="enumeration_section">3.3.2 </span>Configuring Automatic Transaction Recovery
                  </h4>
                  <div>
                     <div class="section">
                        <p>Automatic transaction recovery is performed by scheduling a database job. A database job for in-doubt transactions must be scheduled for each database participating in Microsoft Transaction Server transactions. </p>
                        <p>Transaction recovery is configured by running the <code class="codeph">oramtsadmin.sql</code> script, which triggers <code class="codeph">utl_oramts.sql</code> and <code class="codeph">prvtoramts.plb</code> scripts to create the PL/SQL package <code class="codeph">utl_oramts</code>. The database view <code class="codeph">oramts_2pc_pending</code> is also created to show in-doubt transactions related to Microsoft Transaction Server transactions.
                        </p>
                        <p>The <code class="codeph">oramtsadmin.sql</code> script:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Creates the Microsoft Transaction Server administrator user account.</p>
                           </li>
                           <li>
                              <p>Automatically schedules database jobs for transaction recovery every one minute.</p>
                              <p>When the database job is run, it checks for unresolved global transactions in the database that are related to Microsoft Transaction Server. Information in the <a href="glossary.html#GUID-5D96D160-162E-4297-A2E2-08B00B26C3FF"><span class="xrefglossterm">transaction identifiers (XIDs)</span></a> of the in-doubt transactions identifies the computer on which the transaction was started. The Oracle MTS Recovery Service on that computer resolves the transaction.
                              </p>
                           </li>
                           <li>
                              <p>Schedules post-recovery cleanup every half hour.</p>
                           </li>
                        </ul>
                        <p>Schedule automatic transaction recovery in the database by performing these tasks:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="managing-recovery-scenarios.html#GUID-2389C3DE-9CA7-4F5F-BE29-7EDD015272CF">Setting and Starting Up Database Job-Queue Processes</a></p>
                           </li>
                           <li>
                              <p><a href="managing-recovery-scenarios.html#GUID-E5EA00F3-E804-417F-818C-C3849E91C0B9">Creating and Scheduling Automatic Transaction Recovery </a></p>
                           </li>
                        </ul>
                     </div>
                     <!-- class="section" -->
                  </div><a id="NTMTS137"></a><div class="props_rev_3"><a id="GUID-2389C3DE-9CA7-4F5F-BE29-7EDD015272CF" name="GUID-2389C3DE-9CA7-4F5F-BE29-7EDD015272CF"></a><h5 id="NTMTS-GUID-2389C3DE-9CA7-4F5F-BE29-7EDD015272CF" class="sect5"><span class="enumeration_section">3.3.2.1 </span>Setting and Starting Up Database Job-Queue Processes
                     </h5>
                     <div>
                        <div class="section">
                           <p>The <code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter specifies the maximum number of job slaves started on an instance.
                           </p>
                           <p>To set and start up job-queue processes:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Ensure that you have <code class="codeph">SYSDBA</code> privileges.</span></li>
                           <li class="stepexpand"><span>Go to the computer on which the Oracle Database is installed.</span></li>
                           <li class="stepexpand"><span>Start SQL*Plus:</span><div><pre class="oac_no_warn" dir="ltr">C:\&gt; sqlplus /NOLOG
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Connect to the database as <code class="codeph">SYSDBA</code>:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; CONNECT / AS SYSDBA
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Set the <code class="codeph">JOB_QUEUE_PROCESSES</code> initialization parameter:</span><div><pre class="oac_no_warn" dir="ltr"><a id="d3122e589" class="indexterm-anchor"></a><a id="d3122e591" class="indexterm-anchor"></a><a id="d3122e595" class="indexterm-anchor"></a><a id="d3122e599" class="indexterm-anchor"></a>JOB_QUEUE_PROCESSES = 1
</pre><p>The default value for this parameter is <code class="codeph">0</code>. Set this parameter to a value greater than <code class="codeph">1</code> if there are many destinations to which to propagate the messages.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Shut down the Oracle Database:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SHUTDOWN
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Restart the Oracle Database:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; STARTUP
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Exit SQL*Plus:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; EXIT</pre></div>
                           </li>
                        </ol>
                     </div>
                  </div><a id="NTMTS138"></a><div class="props_rev_3"><a id="GUID-E5EA00F3-E804-417F-818C-C3849E91C0B9" name="GUID-E5EA00F3-E804-417F-818C-C3849E91C0B9"></a><h5 id="NTMTS-GUID-E5EA00F3-E804-417F-818C-C3849E91C0B9" class="sect5"><span class="enumeration_section">3.3.2.2 </span>Creating and Scheduling Automatic Transaction Recovery 
                     </h5>
                     <div>
                        <div class="section">
                           <p>The <code class="codeph">oramtsadmin.sql</code> script creates the Microsoft Transaction Server administrator user account with the default username <code class="codeph">mtssys</code>. The Microsoft Transaction Server transaction recovery jobs run under the administrator user account. 
                           </p>
                           <p>The <code class="codeph">oramtsadmin.sql</code> script runs the <code class="codeph">utl_oramts.sql</code> script to grant the following <a id="d3122e704" class="indexterm-anchor"></a>privileges and roles to the administrator user account:
                           </p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a id="d3122e713" class="indexterm-anchor"></a><a id="d3122e715" class="indexterm-anchor"></a><code class="codeph">CREATE SESSION</code> role
                                 </p>
                              </li>
                              <li>
                                 <p><a id="d3122e724" class="indexterm-anchor"></a><a id="d3122e726" class="indexterm-anchor"></a><code class="codeph">SELECT_CATALOG_ROLE</code> role
                                 </p>
                              </li>
                              <li>
                                 <p><a id="d3122e735" class="indexterm-anchor"></a><a id="d3122e737" class="indexterm-anchor"></a><code class="codeph">FORCE_ANY_TRANSACTION</code> privilege 
                                 </p>
                              </li>
                              <li>
                                 <p><a id="d3122e746" class="indexterm-anchor"></a><a id="d3122e748" class="indexterm-anchor"></a><code class="codeph">DBMS_JOBS</code> package, on which <code class="codeph">EXECUTE</code> privileges are granted
                                 </p>
                              </li>
                              <li>
                                 <p><a id="d3122e760" class="indexterm-anchor"></a><a id="d3122e762" class="indexterm-anchor"></a><code class="codeph">DBMS_TRANSACTION</code> package, on which <code class="codeph">EXECUTE</code> privileges are granted 
                                 </p>
                              </li>
                           </ul>
                           <p>To create and schedule automatic transaction recovery:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>Ensure that you have <code class="codeph">SYSDBA</code> privileges. </span></li>
                           <li class="stepexpand"><span>Log on to the computer where the Oracle Database is installed.</span></li>
                           <li class="stepexpand"><span>Start SQL*Plus:</span><div><pre class="oac_no_warn" dir="ltr">C:\&gt; sqlplus /NOLOG 
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Connect to the database as <code class="codeph">SYSDBA</code>:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; CONNECT / AS SYSDBA
</pre></div>
                           </li>
                           <li class="stepexpand" id="GUID-E5EA00F3-E804-417F-818C-C3849E91C0B9__i1007354"><span>Run the <code class="codeph">oramtsadmin.sql</code> script:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; @<span class="italic">ORACLE_BASE</span>\<span class="italic">ORACLE_HOME</span>\oramts\admin\oramtsadmin.sql;<a id="d3122e814" class="indexterm-anchor"></a><a id="d3122e818" class="indexterm-anchor"></a><a id="d3122e822" class="indexterm-anchor"></a>
</pre><p>You are prompted for the Microsoft Transaction Server administrator username and password. You can accept the default username of <code class="codeph">mtssys</code> and password of <code class="codeph">mtssys</code>, or change them.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>If you did change the password in step <a href="managing-recovery-scenarios.html#GUID-E5EA00F3-E804-417F-818C-C3849E91C0B9__i1007354">5</a>, you can change it using this script:<a id="d3122e841" class="indexterm-anchor"></a><a id="d3122e845" class="indexterm-anchor"></a></span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; ALTER USER <span class="italic">USERNAME</span> IDENTIFIED BY <span class="italic">new_password</span>;
</pre><p>To change the username after completing this task, drop the user, rerun the <code class="codeph">oramtsadmin.sql</code> script, and specify a different username when prompted.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Exit SQL*Plus:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; EXIT
</pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <p>A single PL/SQL package, <code class="codeph">utl_oramts</code>, is created in the Microsoft Transaction Server administrator's schema. <code class="codeph">utl_oramts</code> exposes these public procedures and creates this view:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><a href="managing-recovery-scenarios.html#GUID-434F4828-A695-4042-B4C9-F0F9060EF4FB">utl_oramts.show_indoubt Procedure</a></p>
                              </li>
                              <li>
                                 <p><a href="managing-recovery-scenarios.html#GUID-5116A835-5246-49ED-9B58-F1AECFA6AF3F">utl_oramts.recover_automatic Procedure </a></p>
                              </li>
                              <li>
                                 <p><a href="managing-recovery-scenarios.html#GUID-BCDF4421-4456-4712-91D0-0CB97A010557">utl_oramts.forget_RMs Procedure </a></p>
                              </li>
                              <li>
                                 <p><a href="managing-recovery-scenarios.html#GUID-D9F9ABBC-9502-43FD-8E2D-38AB97B8D000">oramts_2pc_pending View</a></p>
                              </li>
                           </ul>
                        </div>
                        <!-- class="section" -->
                     </div><a id="NTMTS140"></a><a id="NTMTS139"></a><div class="props_rev_3"><a id="GUID-434F4828-A695-4042-B4C9-F0F9060EF4FB" name="GUID-434F4828-A695-4042-B4C9-F0F9060EF4FB"></a><h6 id="NTMTS-GUID-434F4828-A695-4042-B4C9-F0F9060EF4FB" class="sect6"><span class="enumeration_section">3.3.2.2.1 </span>utl_oramts.show_indoubt Procedure
                        </h6>
                        <div>
                           <div class="section">
                              <p>Use this procedure to view Microsoft Transaction Server in-doubt transactions in the database. This procedure uses the <code class="codeph">dbms_output</code> package to display results. 
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3">Description</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p>This procedure requires <code class="codeph">SERVEROUTPUT</code> set to <code class="codeph">ON</code>.
                              </p><pre class="oac_no_warn" dir="ltr">SQL&gt; SET SERVEROUTPUT ON

SQL&gt; EXECUTE utl_oramts.show_indoubt;
</pre><p>The following information appears:</p><pre class="oac_no_warn" dir="ltr">=========================================================
currently indoubt transactions
=========================================================
formatid   	: 21255235
gtrid      		: C2229A505904974D81FB7316B147325900000000
bqual      	: 5BAB6A6B55CD294AA20335839110829C0100000000901944700050
local txid 	: 142.11.202
tx state		   : prepared
protocol   	: HTTP
endpoint   	: middletier-1@foo.com:2030
=========================================================
formatid   	: 21255235
gtrid      		: 259DF9C8DFC5574F8876F0DF4E15CCAD00000000
bqual      	: 2C8DCED5B9816244BA2B73CC013EEB870100000000901944700050
local txid 	: 2.18.185
tx state   	: prepared
protocol   	: HTTP
endpoint   	: middletier-2@foo.com:2030</pre></div>
                           <!-- class="section" -->
                        </div>
                     </div><a id="NTMTS141"></a><div class="props_rev_3"><a id="GUID-5116A835-5246-49ED-9B58-F1AECFA6AF3F" name="GUID-5116A835-5246-49ED-9B58-F1AECFA6AF3F"></a><h6 id="NTMTS-GUID-5116A835-5246-49ED-9B58-F1AECFA6AF3F" class="sect6"><span class="enumeration_section">3.3.2.2.2 </span>utl_oramts.recover_automatic Procedure 
                        </h6>
                        <div>
                           <div class="section">
                              <p>This procedure is run by the transaction recovery job. An automatic database job is scheduled for <code class="codeph">utl_oramts.recover_automatic</code>. When the job is run, it checks for unresolved global transactions in the database that are related to Microsoft Transaction Server. Information in the XIDs of the in-doubt transactions identifies the computer on which the transaction started. The Oracle MTS Recovery Service is contacted and resolves the transactions.
                              </p>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div><a id="NTMTS142"></a><div class="props_rev_3"><a id="GUID-BCDF4421-4456-4712-91D0-0CB97A010557" name="GUID-BCDF4421-4456-4712-91D0-0CB97A010557"></a><h6 id="NTMTS-GUID-BCDF4421-4456-4712-91D0-0CB97A010557" class="sect6"><span class="enumeration_section">3.3.2.2.3 </span>utl_oramts.forget_RMs Procedure 
                        </h6>
                        <div>
                           <div class="section">
                              <p>Use this procedure to request the transaction manager (MS DTC) to forget resolved transactions. This procedure is run by the post-recovery cleanup job.</p>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div><a id="NTMTS144"></a><a id="NTMTS145"></a><a id="NTMTS146"></a><a id="NTMTS147"></a><a id="NTMTS148"></a><a id="NTMTS149"></a><a id="NTMTS150"></a><a id="NTMTS143"></a><div class="props_rev_3"><a id="GUID-D9F9ABBC-9502-43FD-8E2D-38AB97B8D000" name="GUID-D9F9ABBC-9502-43FD-8E2D-38AB97B8D000"></a><h6 id="NTMTS-GUID-D9F9ABBC-9502-43FD-8E2D-38AB97B8D000" class="sect6"><span class="enumeration_section">3.3.2.2.4 </span>oramts_2pc_pending View
                        </h6>
                        <div>
                           <div class="section">
                              <p>The view <code class="codeph">oramts_2pc_pending</code> is created by executing <code class="codeph">oramtsadmin.sql</code>. <code class="codeph">oramts_2pc_pending</code> shows in-doubt transactions in the database. This view consists of the following columns:
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3">Formatid </p>
                              <p>This is the <code class="codeph">formatid</code> of the global transaction in the database.
                              </p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3">global_transaction_id </p>
                              <p>This is the transaction identifier of the Oracle global transaction corresponding to the Microsoft Transaction Server transaction. In fact, this is the globally unique identifier (GUID) of the Microsoft Transaction Server transaction.</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3">branch_id</p>
                              <p>This shows the branch identifier of the Oracle transaction. A single Microsoft Transaction Server transaction can have multiple Oracle global transactions. This depends on the number of Microsoft Transaction Server/COM+ components that span the same Microsoft Transaction Server transaction. All these transactions have the small global transaction identifier, but different branch identifiers.</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3">local_tx_id</p>
                              <p>A local Oracle transaction corresponds to each Microsoft Transaction Server transaction. This column shows the identifier corresponding to this local transaction.</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3">state</p>
                              <p>This shows the state of the transaction: pending, heuristically committed, heuristically terminated, and so on.</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3">protocol</p>
                              <p>This is the protocol that the transaction recovery job in the database uses to communicate with the Oracle MTS Recovery Service.</p>
                           </div>
                           <!-- class="section" -->
                           <div class="section">
                              <p class="subhead3">endpoint </p>
                              <p>This is the endpoint of the Windows computer on which the Microsoft Transaction Server transaction originated. For HTTP connections, this translates to a hostname and port number.</p>
                           </div>
                           <!-- class="section" -->
                        </div>
                     </div>
                  </div>
               </div>
            </div><a id="NTMTS151"></a><div class="props_rev_3"><a id="GUID-DA02FA5F-52D9-4873-A6C7-89877E1F4CBB" name="GUID-DA02FA5F-52D9-4873-A6C7-89877E1F4CBB"></a><h3 id="NTMTS-GUID-DA02FA5F-52D9-4873-A6C7-89877E1F4CBB" class="sect3"><span class="enumeration_section">3.4 </span>Viewing Microsoft Transaction Server In-Doubt Transactions
               </h3>
               <div>
                  <div class="section">
                     <p>To view Microsoft Transaction Server&#x2013;related in-doubt transactions in the database, use SQL*Plus to query the view <code class="codeph">oramts_2pc_pending</code>:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Start SQL*Plus with the Microsoft Transaction Server administrator user account:</span><div><pre class="oac_no_warn" dir="ltr">C:\&gt; sqlplus <span class="italic">mtsadmin_user</span><span class="italic">/ mtsadmin_password</span>
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Enter the following command:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; SELECT * FROM oramts_2pc_pending;
</pre><p>This displays the computer on which the in-doubt transaction originated.</p>
                        </div>
                     </li>
                  </ol>
               </div>
            </div><a id="NTMTS152"></a><div class="props_rev_3"><a id="GUID-D7866844-CAD3-4C8F-94DB-0DDB6A09B9D7" name="GUID-D7866844-CAD3-4C8F-94DB-0DDB6A09B9D7"></a><h3 id="NTMTS-GUID-D7866844-CAD3-4C8F-94DB-0DDB6A09B9D7" class="sect3"><span class="enumeration_section">3.5 </span>Modifying Registry Values for Oracle Fail Safe Configurations
               </h3>
               <div>
                  <div class="section">
                     <p>In typical configurations, the MS DTC and Oracle MTS Recovery Service run on the same computer. This ensures that the required information for transaction recovery is available to the Oracle-Microsoft Transaction Server integration layer. </p>
                     <p>In configurations where the Microsoft Transaction Server application is part of a Windows cluster (for example, the application can fail over to another node or host in the cluster), the <a id="d3122e1326" class="indexterm-anchor"></a>MS DTC runs as a cluster-wide resource. All cluster nodes use a single instance of the MS DTC running on any cluster node.
                     </p>
                     <p>If you have an Oracle Fail Safe configuration, make sure the following registry information is replicated on all nodes in the cluster participating in Microsoft Transaction Server transactions:</p>
                     <p>To modify registry values for Oracle Fail Safe configurations:</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Go to the computer on which the MS DTC and Oracle MTS Recovery Service are installed.</span></li>
                     <li class="stepexpand"><span>Start the registry from the command prompt:</span><div><pre class="oac_no_warn" dir="ltr">C:\&gt; regedt32
</pre><p>The Registry Editor window appears.</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Go to <code class="codeph">HKEY_LOCAL_MACHINE</code>\<code class="codeph">Software</code>\<code class="codeph">Oracle</code>\<code class="codeph">OracleMTSRecoveryService</code>.</span></li>
                     <li class="stepexpand"><span>Copy the registry information appearing here to all nodes in the cluster.</span></li>
                     <li class="stepexpand"><span>Reboot the computer on which you added the key.</span></li>
                  </ol>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>