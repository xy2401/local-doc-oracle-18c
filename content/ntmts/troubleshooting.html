<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Troubleshooting Oracle Microsoft Transaction Server</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide for Microsoft Windows">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-services-microsoft-transaction-server.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-08-05T10:28:43-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1996, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E90597-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      
      <link rel="prev" href="perf-tuning.html" title="Previous" type="text/html">
      <link rel="next" href="glossary.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OracleÂ® Services for Microsoft Transaction Server">
    <meta name="dcterms.isVersionOf" content="NTMTS">
    <meta name="dcterms.release" content="Release 18">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="perf-tuning.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="glossary.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Troubleshooting Oracle Microsoft Transaction Server</li>
            </ol>
            <a id="GUID-754AA79E-2BE8-4387-909A-51DE307019C8" name="GUID-754AA79E-2BE8-4387-909A-51DE307019C8"></a><a id="NTMTS007"></a>
            
            <h2 id="NTMTS-GUID-754AA79E-2BE8-4387-909A-51DE307019C8" class="sect2"><span class="enumeration_chapter">6 </span> Troubleshooting Oracle Microsoft Transaction Server
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>These topics provide information on troubleshooting Oracle Microsoft Transaction Server.</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="troubleshooting.html#GUID-67B0598B-4B76-406D-BABF-179712100102">Tracking Oracle Services for Microsoft Transaction Server Performance</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshooting.html#GUID-87BE2E3C-4C06-48FA-9261-4BD98D4EADFB">Correcting Oracle Net Changes that Impact Connection Pooling</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshooting.html#GUID-8AEC13C6-7F10-45C8-962B-F594A307F475">Designing an Application that Uses Multiple Databases</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshooting.html#GUID-9AED22AC-9536-4429-9402-B29DE136875F">Working with Different Types of Connection Pooling</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshooting.html#GUID-3325C636-3DEC-4438-AB0F-9194406316A1">Working with In-Doubt Transactions</a></p>
                  </li>
                  <li>
                     <p><a href="troubleshooting.html#GUID-A6D12268-614D-4260-8FB1-F748DC1A16E0">Dropping the Microsoft Transaction Server Administrative User Account</a></p>
                  </li>
               </ul>
            </div><a id="NTMTS255"></a><a id="NTMTS254"></a><div class="props_rev_3"><a id="GUID-67B0598B-4B76-406D-BABF-179712100102" name="GUID-67B0598B-4B76-406D-BABF-179712100102"></a><h3 id="NTMTS-GUID-67B0598B-4B76-406D-BABF-179712100102" class="sect3"><span class="enumeration_section">6.1 </span>Tracking Oracle Services for Microsoft Transaction Server Performance
               </h3>
               <div>
                  <p>Trace files record information about Oracle Services for Microsoft Transaction Server performance. This information includes:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Any errors</p>
                     </li>
                     <li>
                        <p>Enlistment requests and outcomes</p>
                     </li>
                     <li>
                        <p>Prepare, commit, and terminate requests and their outcomes</p>
                     </li>
                  </ul>
                  <p>Registry parameters handle tracing within <code class="codeph">oramts.dll</code>, which performs the following tasks:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>It implements the API for integrating the Oracle Database with Microsoft Transaction Server.</p>
                     </li>
                     <li>
                        <p>It works as a resource dispenser to provide pooled <a href="glossary.html#GUID-5F4766B7-BFBF-44D2-901B-2BB62EDBB694"><span class="xrefglossterm">Oracle Call Interface (OCI)</span></a> connections.
                        </p>
                     </li>
                     <li>
                        <p>It enables clients with nonpooled OCI connections to enlist in transactions started by <a href="glossary.html#GUID-37C64380-2031-4103-8965-394C4A30A352"><span class="xrefglossterm">Microsoft Distributed Transaction Coordinator (MS DTC)</span></a>.
                        </p>
                     </li>
                     <li>
                        <p>It communicates with Oracle Services for Microsoft Transaction Server to enlist the Oracle Database in transactions started by MS DTC.</p>
                     </li>
                  </ul>
                  <p>The MTS-based COM components can acquire connections to both dedicated and shared Oracle servers of a database. The components can then attempt to perform distributed updates, using data manipulation language, on another database using pre-existing database links between these databases. While the distributed updates from shared servers succeed, those from dedicated servers fail.</p>
                  <p>Registry parameters that handle tracing are automatically set in <code class="codeph">\\</code><span class="italic"><code class="codeph">HKEY_LOCAL_MACHINE</code></span><code class="codeph">\SOFTWARE\ORACLE\</code><span class="italic"><code class="codeph">HOMEID</code></span> during the installation of Oracle Services for Microsoft Transaction Server. 
                  </p>
                  <p>Restart all applications using Oracle Services for Microsoft Transaction Server. Further, if you have modified parameters related to the tracing of the <code class="codeph">OracleMTSRecoveryService</code>, restart the Windows service.
                  </p>
                  <p><a href="troubleshooting.html#GUID-67B0598B-4B76-406D-BABF-179712100102__g1007015" title="This table lists the trace registry parameter values. Column 1 lists the level. Column 2 contains the description of the value of the parameter.">Table 6-1</a> shows the range of <code class="codeph">ORAMTS_CP_TRACE_LEVEL</code> trace values.
                  </p>
                  <div class="tblformal" id="GUID-67B0598B-4B76-406D-BABF-179712100102__g1007015">
                     <p class="titleintable">Table 6-1 ORAMTS_CP_TRACE_LEVEL Trace Registry Parameter Values</p>
                     <table cellpadding="4" cellspacing="0" class="Formal" title="ORAMTS_CP_TRACE_LEVEL Trace Registry Parameter Values" summary="This table lists the trace registry parameter values. Column 1 lists the level. Column 2 contains the description of the value of the parameter." width="100%" frame="hsides" border="1" rules="rows">
                        <thead>
                           <tr align="left" valign="top">
                              <th align="left" valign="bottom" width="11%" id="d10230e217">Level</th>
                              <th align="left" valign="bottom" width="89%" id="d10230e220">Description</th>
                           </tr>
                        </thead>
                        <tbody>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="11%" id="d10230e225" headers="d10230e217 ">
                                 <p>0</p>
                              </td>
                              <td align="left" valign="top" width="89%" headers="d10230e225 d10230e220 ">
                                 <p>Disables tracing. If the registry parameter is not set in the registry or as an environment variable, then tracing is disabled. This is equivalent to setting the level to <code class="codeph">0</code>.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="11%" id="d10230e235" headers="d10230e217 ">
                                 <p>1</p>
                              </td>
                              <td align="left" valign="top" width="89%" headers="d10230e235 d10230e220 ">
                                 <p>Traces errors only</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="11%" id="d10230e242" headers="d10230e217 ">
                                 <p>2</p>
                              </td>
                              <td align="left" valign="top" width="89%" headers="d10230e242 d10230e220 ">
                                 <p>Traces important events in addition to errors</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="11%" id="d10230e249" headers="d10230e217 ">
                                 <p>3</p>
                              </td>
                              <td align="left" valign="top" width="89%" headers="d10230e249 d10230e220 ">
                                 <p>This level is not supported; if you set this parameter to <code class="codeph">3</code>, level 2 tracing is enabled.
                                 </p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="11%" id="d10230e259" headers="d10230e217 ">
                                 <p>4</p>
                              </td>
                              <td align="left" valign="top" width="89%" headers="d10230e259 d10230e220 ">
                                 <p>Traces function entry/exit, important events, and errors</p>
                              </td>
                           </tr>
                           <tr align="left" valign="top">
                              <td align="left" valign="top" width="11%" id="d10230e266" headers="d10230e217 ">
                                 <p>5</p>
                              </td>
                              <td align="left" valign="top" width="89%" headers="d10230e266 d10230e220 ">
                                 <p>Traces reference counting function and constructor/destructor entry/exit</p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <!-- class="inftblhruleinformal" -->
                  <div class="infoboxnote" id="GUID-67B0598B-4B76-406D-BABF-179712100102__GUID-A857AF0C-A8EE-4189-99FD-20EDA012A781">
                     <p class="notep1">Note:</p>
                     <p>The <a href="glossary.html#GUID-07D10977-6118-407A-935F-0CE4A2240EDD"><span class="xrefglossterm">Oracle MTS Recovery Service</span></a> also generates trace file output in the <span class="italic"><code class="codeph">ORACLE_BASE</code></span><code class="codeph">\</code><span class="italic"><code class="codeph">ORACLE_HOME</code></span><code class="codeph">\</code><code class="codeph">oramts</code><code class="codeph">\</code><code class="codeph">trace</code> directory.<a id="d10230e297" class="indexterm-anchor"></a><a id="d10230e301" class="indexterm-anchor"></a></p>
                  </div>
               </div>
            </div><a id="NTMTS257"></a><div class="props_rev_3"><a id="GUID-87BE2E3C-4C06-48FA-9261-4BD98D4EADFB" name="GUID-87BE2E3C-4C06-48FA-9261-4BD98D4EADFB"></a><h3 id="NTMTS-GUID-87BE2E3C-4C06-48FA-9261-4BD98D4EADFB" class="sect3"><span class="enumeration_section">6.2 </span>Correcting Oracle Net Changes that Impact Connection Pooling
               </h3>
               <div>
                  <div class="section">
                     <p>The connection pool provided by the OraMTS layer, <code class="codeph">oramts.dll</code>, uses a connection's <a href="glossary.html#GUID-E2212B15-F7B2-4FFD-AA05-69DD0F664C0E"><span class="xrefglossterm">net service name</span></a> to identify pooled connections for an application. If changes are made to the net service name, and pooled connections are available, the application using the connection pool must be stopped and restarted. These changes can include altering the host or the database system identifier (SID) for the net service name in the <code class="codeph">tnsnames.ora</code> file.
                     </p>
                     <p>These changes ensure that all currently pooled connections corresponding to the old net service name are destroyed and any new pooled connections use the changes made to the net service name. This includes any application hosting <a href="glossary.html#GUID-10C5A220-53B1-4AE6-AD1F-12B8C90EDB91"><span class="xrefglossterm">Microsoft Transaction Server</span></a> components.
                     </p>
                     <p>To empty connection pools, perform the following:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>If the application is an <span class="italic">out-of-process</span> Microsoft Transaction Server component (<span class="italic">server package</span>), run the following application:
                           </p><pre class="oac_no_warn" dir="ltr">C:\&gt; mtxstop
</pre><p>This empties the connection pools.</p>
                        </li>
                        <li>
                           <p>If the application is an <span class="italic">in-process</span> Microsoft Transaction Server component (<span class="italic">library package</span>), terminate the application. This also empties the connection pool.
                           </p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="NTMTS259"></a><a id="NTMTS258"></a><div class="props_rev_3"><a id="GUID-8AEC13C6-7F10-45C8-962B-F594A307F475" name="GUID-8AEC13C6-7F10-45C8-962B-F594A307F475"></a><h3 id="NTMTS-GUID-8AEC13C6-7F10-45C8-962B-F594A307F475" class="sect3"><span class="enumeration_section">6.3 </span>Designing an Application that Uses Multiple Databases
               </h3>
               <div>
                  <div class="section">
                     <p>Oracle clients can establish connections to a database in two ways:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Typical Oracle clients establish connections to a database using a dedicated server configuration. In a dedicated server configuration, one client corresponds to one Oracle server process. </p>
                        </li>
                        <li>
                           <p>For scalability under heavy loads, Oracle clients have the option of using a shared server configuration. In a shared server configuration, a single Oracle server process can be shared by more than one client connection. </p>
                        </li>
                     </ul>
                     <p>Microsoft Transaction Server communicates with the database through distributed transactions. In a dedicated server configuration, you cannot use distributed updates (<a href="glossary.html#GUID-55C6C624-B2B6-4977-94B3-ED063910A47B"><span class="xrefglossterm">data manipulation language</span></a> statements across database links) from other databases. However, if the original connection to the database is established using shared server configurations, the distributed updates from other databases succeed. 
                     </p>
                     <p>To use data manipulation language statements in shared server configurations, set the following parameter in the <a id="d10230e471" class="indexterm-anchor"></a><a id="d10230e475" class="indexterm-anchor"></a><a id="d10230e477" class="indexterm-anchor"></a><a id="d10230e481" class="indexterm-anchor"></a><code class="codeph">tnsnames.ora</code><code class="codeph"> </code>file:
                     </p><pre class="oac_no_warn" dir="ltr">SERVER=dedicated
</pre><p>This forces the Oracle Net listener to provide a dedicated connection. <a href="troubleshooting.html#GUID-8AEC13C6-7F10-45C8-962B-F594A307F475__CACFFFCE">Figure 6-1</a> shows this process.
                     </p>
                     <div class="figure" id="GUID-8AEC13C6-7F10-45C8-962B-F594A307F475__CACFFFCE">
                        <p class="titleinfigure">Figure 6-1 Distributed DML Statements from MTS Applications</p><img src="img/ntmts012.gif" alt="Description of Figure 6-1 follows" title="Description of Figure 6-1 follows" longdesc="img_text/ntmts012.html"><br><a href="img_text/ntmts012.html">Description of "Figure 6-1 Distributed DML Statements from MTS Applications"</a></div>
                     <!-- class="figure" -->
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="NTMTS261"></a><a id="NTMTS262"></a><a id="NTMTS263"></a><a id="NTMTS260"></a><div class="props_rev_3"><a id="GUID-9AED22AC-9536-4429-9402-B29DE136875F" name="GUID-9AED22AC-9536-4429-9402-B29DE136875F"></a><h3 id="NTMTS-GUID-9AED22AC-9536-4429-9402-B29DE136875F" class="sect3"><span class="enumeration_section">6.4 </span>Working with Different Types of Connection Pooling
               </h3>
               <div>
                  <div class="section">
                     <p class="subhead2">Oracle Net Connection Pooling</p>
                     <p> Oracle Net connection pooling is a server-side feature that is implemented only if the Oracle Database is configured for shared server support. Oracle Net connection pooling enables you to minimize the number of physical network connections to a shared server. This is achieved by sharing a dispatcher's set of connections among multiple client processes. </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Microsoft Transaction Server Connection Pooling</p>
                     <p>Microsoft Transaction Server provides a resource pooling infrastructure that enables certain resources to be pooled, such as memory and database connections.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">OCI Connection Pooling</p>
                     <p>OCI connection pooling layer works with MTS resource pooling to provide pooled Oracle client/server sessions. The OCI connection pooling layer also caches Oracle Net connections to reduce client/server session setup time.</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="NTMTS264"></a><div class="props_rev_3"><a id="GUID-3325C636-3DEC-4438-AB0F-9194406316A1" name="GUID-3325C636-3DEC-4438-AB0F-9194406316A1"></a><h3 id="NTMTS-GUID-3325C636-3DEC-4438-AB0F-9194406316A1" class="sect3"><span class="enumeration_section">6.5 </span>Working with In-Doubt Transactions
               </h3>
               <div>
                  <p>Oracle uses distributed transactions in the following configurations:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Distributed database configurations, such as distributed updates using database links</p>
                     </li>
                     <li>
                        <p>External transaction managers, such as Tuxedo and MS DTC, for coordinating transaction outcome </p>
                     </li>
                  </ul>
                  <p>The <a id="d10230e608" class="indexterm-anchor"></a>two-phase commit protocol completes these transactions. During phase one, the transaction manager (TM) requests the various resource managers involved in the TM's transaction to prepare the underlying distributed transactions. In phase two, the TM determines whether it commits or terminates the transaction, and requests the resource managers to commit or terminate the underlying transaction. If a resource manager fails to receive the phase two notification, the underlying distributed transaction becomes in-doubt. 
                  </p>
                  <p>To integrate Oracle with Microsoft Transaction Server, <a id="d10230e613" class="indexterm-anchor"></a>distributed transactions are used in the database. Distributed transactions correspond to transactions coordinated by the MS DTC. A distributed transaction can become in-doubt when the transaction cannot commit or terminate (phase two of the two-phase commit). This occurs when the Microsoft Transaction Server application server process, database, or network fails.
                  </p>
                  <div class="infoboxnotealso" id="GUID-3325C636-3DEC-4438-AB0F-9194406316A1__GUID-EEE1E364-9F11-4102-8AFA-1E72B171B470">
                     <p class="notep1">See Also:</p>
                     <p><a href="managing-recovery-scenarios.html#GUID-7CBD0319-E78A-4CF5-8FBF-E13363DB2DDA"> Managing Recovery Scenarios</a></p>
                  </div>
               </div>
            </div><a id="NTMTS265"></a><div class="props_rev_3"><a id="GUID-A6D12268-614D-4260-8FB1-F748DC1A16E0" name="GUID-A6D12268-614D-4260-8FB1-F748DC1A16E0"></a><h3 id="NTMTS-GUID-A6D12268-614D-4260-8FB1-F748DC1A16E0" class="sect3"><span class="enumeration_section">6.6 </span>Dropping the Microsoft Transaction Server Administrative User Account
               </h3>
               <div>
                  <div class="section">
                     <p>The Microsoft Transaction Server administrative user account is created by running the <code class="codeph">oramtsadmin.sql</code> script. If you later change the database with which Microsoft Transaction Server is coordinating transactions, you can drop the administrative user account schema from the previous database.
                     </p>
                     <p>To drop the Microsoft Transaction Server administrative user account:</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand"><span>Start SQL*Plus:</span><div><pre class="oac_no_warn" dir="ltr">c:\&gt; sqlplus /NOLOG
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Connect to the database as <code class="codeph">SYSDBA</code>:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; CONNECT / AS SYSDBA
</pre></div>
                     </li>
                     <li class="stepexpand"><span>Enter the following command to drop administrative user account schema:</span><div><pre class="oac_no_warn" dir="ltr">SQL&gt; DROP USER <span class="italic">mtsadmin_username</span> CASCADE;
</pre><p>where <span class="italic"><code class="codeph">mtsadmin_username</code></span><code class="codeph"> </code>is the Microsoft Transaction Server administrative user account (default is <code class="codeph">mtssys</code>).
                           </p>
                        </div>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-A6D12268-614D-4260-8FB1-F748DC1A16E0__GUID-C816008B-A1E9-42D8-8482-B78A6E821090">
                        <p class="notep1">See Also:</p>
                        <p>See <a href="managing-recovery-scenarios.html#GUID-7CBD0319-E78A-4CF5-8FBF-E13363DB2DDA"> Managing Recovery Scenarios</a> for information on creating the Microsoft Transaction Server administrative user account for the new database
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>