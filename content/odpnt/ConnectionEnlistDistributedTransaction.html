<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>EnlistDistributedTransaction</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide for Microsoft Windows">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-data-provider-net.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-08-24T00:49:54-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E90593-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      
      <link rel="prev" href="ConnectionCreateCommand.html" title="Previous" type="text/html">
      <link rel="next" href="ConnectionEnlistTransaction.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OracleÂ® Data Provider for .NET">
    <meta name="dcterms.isVersionOf" content="ODPNT">
    <meta name="dcterms.release" content="Release 18">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="ConnectionCreateCommand.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="ConnectionEnlistTransaction.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="odp-dot-net-classes.html" property="item" typeof="WebPage"><span property="name">Oracle Data Provider for .NET Classes</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="OracleConnectionClass.html" property="item" typeof="WebPage"><span property="name">OracleConnection Class</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="ConnectionPublicMethods.html" property="item" typeof="WebPage"><span property="name">OracleConnection Public Methods</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">EnlistDistributedTransaction</li>
            </ol>
            <a id="GUID-6EB031E2-D457-4142-A112-9A8590905AF7" name="GUID-6EB031E2-D457-4142-A112-9A8590905AF7"></a><a id="ODPNT926"></a><a id="ODPNT927"></a><a id="ODPNT928"></a><a id="ODPNT929"></a><a id="ODPNT930"></a><a id="ODPNT931"></a><a id="ODPNT925"></a>
            
            <h2 id="ODPNT-GUID-6EB031E2-D457-4142-A112-9A8590905AF7" class="sect2"><span class="enumeration_section">6.4.6.8 </span>EnlistDistributedTransaction
            </h2>
         </header>
         <div class="ind">
            <div>
               <div class="section">
                  <p>This method enables applications to explicitly enlist in a specific distributed transaction after a connection has been opened. </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1">Declaration</p>
               </div>
               <!-- class="section" -->
               <div class="section"><pre class="oac_no_warn" dir="ltr">// C#
public void EnlistDistributedTransaction(ITransaction <span class="italic">transaction</span>);
</pre></div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1">Parameters</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><span class="italic"><code class="codeph">transaction</code></span></p>
                        <p>An <code class="codeph">ITransaction</code> interface.
                        </p>
                     </li>
                  </ul>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1">Exceptions</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p><code class="codeph">InvalidOperationException</code> - The connection is part of a local transaction or the connection is closed. 
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1">Remarks</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p><code class="codeph">EnlistDistributedTransaction</code> enables objects to enlist in a specific transaction that is passed to the method. The <code class="codeph">ITransaction</code> interface can be obtained by applying an (<code class="codeph">ITransaction</code>) cast to the <code class="codeph">ContexUtil.Transaction</code> property within the component that started the distributed transaction.
                  </p>
                  <p>The connection must be open before calling this method or an <code class="codeph">InvalidOperationException</code> is thrown.
                  </p>
                  <p>If a connection is part of a local transaction that was started implicitly or explicitly while attempting to enlist in a distributed transaction, the local transaction is rolled back and an exception is thrown.</p>
                  <p>By default, distributed transactions roll back, unless the method-level <code class="codeph">AutoComplete</code> declaration is set.
                  </p>
                  <p>Invoking the commit on the <code class="codeph">ITranasction</code> raises an exception.
                  </p>
                  <p>Invoking the rollback on the <code class="codeph">ITransaction</code> method and calling <code class="codeph">ContextUtil.SetComplete</code> on the same distributed transaction raises an exception.
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1">Remarks (.NET Stored Procedure)</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p>Using this method causes a Not Supported exception.</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1">Example</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p><span class="bold">Application:</span></p><pre class="oac_no_warn" dir="ltr">// C#
 
/* This is the class that will utilize the Enterprise Services 
   component.  This module needs to be built as an executable.
   
   The Enterprise Services Component DLL must be built first 
   before building this module. 
   In addition, the DLL needs to be referenced appropriately 
   when building this application. 
*/
 
using System;
using System.EnterpriseServices;
using DistribTxnSample;
 
class DistribTxnSample_App
{
  static void Main()
  {
    DistribTxnSample_Comp comp = new DistribTxnSample_Comp();
    comp.DoWork();
  }
}
</pre><p><span class="bold">Component:</span></p><pre class="oac_no_warn" dir="ltr">// C#
 
/* This module needs to be
   1) built as a component DLL/Library
   2) built with a strong name
   
  This library must be built first before the application is built.
*/ 
 
using System;
using System.Data;
using Oracle.DataAccess.Client; 
using System.EnterpriseServices;
 
namespace DistribTxnSample
{
  [Transaction(TransactionOption.RequiresNew)]
  public class DistribTxnSample_Comp : ServicedComponent
  {
    public void DoWork()
    {   
      string constr = 
        "User Id=scott;Password=tiger;Data Source=oracle;enlist=false";
      OracleConnection con = new OracleConnection(constr);
      con.Open();
 
      // Enlist in a distrubuted transaction
      con.EnlistDistributedTransaction((ITransaction)ContextUtil.Transaction);
 
      // Update EMP table
      OracleCommand cmd = con.CreateCommand();
      cmd.CommandText = "UPDATE emp set sal = sal + .01";
      cmd.ExecuteNonQuery();
 
      // Commit
      ContextUtil.SetComplete();
 
      // Dispose OracleConnection object
      con.Dispose();
    }
  }
}
</pre><div class="infoboxnotealso" id="GUID-6EB031E2-D457-4142-A112-9A8590905AF7__GUID-EFF2966D-1F4F-4995-975B-BA1E8DBA94F4">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="intro003.html#GUID-2A5A5F0B-E6C9-45AF-9477-FBD55F7FCDC5">Oracle.DataAccess.Client and Oracle.ManagedDataAccess.Client Namespaces</a>"</span></p>
                        </li>
                        <li>
                           <p><a href="OracleConnectionClass.html#GUID-A8BFA792-97D6-423B-9548-80CA0652174E">OracleConnection Class</a></p>
                        </li>
                        <li>
                           <p><a href="ConnectionMembers.html#GUID-4DE91FF2-45DB-4996-904A-96B37B467EC3">OracleConnection Members</a></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="ConnectionEnlistTransaction.html#GUID-6FCB0092-9D08-4E2A-A552-EF9F85BC470C">EnlistTransaction</a>"</span></p>
                        </li>
                        <li>
                           <p><a href="http://msdn.microsoft.com/library" target="_blank"><code class="codeph">http://msdn.microsoft.com/library</code></a> for detailed information about this Microsoft .NET Framework feature
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
               <!-- class="section" -->
            </div>
         </div>
      </article>
   </body>
</html>