<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Continuous Query Notification Support</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide for Microsoft Windows">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-data-provider-net.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-08-24T00:49:54-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E90593-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      
      <link rel="prev" href="featAQ.html" title="Previous" type="text/html">
      <link rel="next" href="featSafeType.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OracleÂ® Data Provider for .NET">
    <meta name="dcterms.isVersionOf" content="ODPNT">
    <meta name="dcterms.release" content="Release 18">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="featAQ.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="featSafeType.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="features.html" property="item" typeof="WebPage"><span property="name">Features of Oracle Data Provider for .NET</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Continuous Query Notification Support </li>
            </ol>
            <a id="GUID-11ED5CC0-9DDE-4285-BC33-73D517E97629" name="GUID-11ED5CC0-9DDE-4285-BC33-73D517E97629"></a><a id="ODPNT0025"></a>
            
            <h2 id="ODPNT-GUID-11ED5CC0-9DDE-4285-BC33-73D517E97629" class="sect2"><span class="enumeration_section">3.18 </span>Continuous Query Notification Support 
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Oracle Data Provider for .NET provides a notification framework that supports Continuous Query Notification, enabling applications to receive client-side notifications when there is a change in a query result set, schema objects, or the state of the database, even if no Oracle Data Provider for .NET database connection exists. Using Continuous Query Notification, an application can maintain the validity of the client-side cache (for example, the ADO.NET <code class="codeph">DataSet</code>) easily. Continuous Query Notification was previously known as Database Change Notification.
               </p>
               <div class="infoboxnote" id="GUID-11ED5CC0-9DDE-4285-BC33-73D517E97629__GUID-450F52A6-9157-44A4-B1E9-CC1148B617AB">
                  <p class="notep1">Note:</p>
                  <p>Continuous Query Notification is not supported in a .NET stored procedure.</p>
               </div>
               <p>Using the notification framework, applications can specify a query result set as a registered query for notification request on the database, and create this notification registration to maintain the validity of the query result set. When there is a change on the database that could affect the client-side cache's query results, the notification framework notifies the application. </p>
               <div class="infoboxnote" id="GUID-11ED5CC0-9DDE-4285-BC33-73D517E97629__GUID-A7184215-C98B-410F-9248-6F4D957F37BE">
                  <p class="notep1">Note:</p>
                  <p>The content of a change notification is referred to as an <span class="italic">invalidation message</span>. It indicates that the query result set is now invalid and provides information about the changes.
                  </p>
               </div>
               <p>Based on the information provided by the invalidation message, the application can then act accordingly. For example, the application might need to refresh its own copy of the data for the registered query that is stored locally in the application.</p>
               <div class="infoboxnote" id="GUID-11ED5CC0-9DDE-4285-BC33-73D517E97629__GUID-059B626F-7F8A-4B41-9B14-14E719734BAB">
                  <p class="notep1">Note:</p>
                  <p>If a registered object is dropped from the database and a new one is created with the same name in the same schema, re-registration is required to receive notifications for the newly created object.</p>
               </div>
               <div class="infoboxnotealso" id="GUID-11ED5CC0-9DDE-4285-BC33-73D517E97629__GUID-79C5A6BD-ADFA-4F1F-AEBE-701044033DAC">
                  <p class="notep1">See Also:</p>
               </div>
               <p>Firewalls, such as Windows Firewall, may be set up to block TCP network ports, which blocks incoming database notifications. Ensure the firewall is configured so that database applications can use the designated port for Continuous Query Notification.</p>
               <p>Beginning with Oracle Database 11<span class="italic">g</span> and ODP.NET 11<span class="italic">g</span> (11.1), Continuous Query Notification queries can be query-based (default) or object-based. The query-based registrations allow ODP.NET to notify applications when the selected rows have changed in the database. The object-based registrations allow ODP.NET to notify applications for any changes that occur in the table(s) containing the selected rows.
               </p>
               <p>Query-based registrations have two modes: guaranteed mode and best-effort mode. In guaranteed mode, any continuous query notification ensures that a change occurred to something contained in the queried result set. However, if a query is complex, then it cannot be registered in guaranteed mode. Best-effort mode is used in such cases.</p>
               <p>Best-effort mode simplifies the query for query-based registration. No notifications are lost from the simplification. However, the simplification may cause false positives, as the simpler version's query result could change when the original query result would not.There still remain some restrictions on which queries can have best-effort mode query-based registrations. In such cases, developers can use object-based registrations, which can register most query types. Object-based registrations generate notifications when the query object changes, even if the actual query result does not. This also means that object-based registrations are more prone to false positives than query-based registrations. Developers should be aware of the relative strengths and weaknesses of each continuous query notification option and choose the one that best suits their requirements.</p>
               <p>If a large number of rows are modified at once, consuming significant shared pool resources, the application will not receive any change notifications with specific row information that had undergone changes. Rather, it will receive a notification with <code class="codeph">OracleNotificationEventArgs.Info</code> property set to <code class="codeph">OracleNotificationInfo.Error</code>.
               </p>
               <p>This section contains the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="featChange.html#GUID-3D46F708-E842-4A4F-8549-B6FF544B5FE4">Continuous Query Notification Classes</a></p>
                  </li>
                  <li>
                     <p><a href="featChange.html#GUID-168F6A1D-4532-43DB-8DC5-23C3C498E106">Supported Operations</a></p>
                  </li>
                  <li>
                     <p><a href="featChange.html#GUID-03FA722E-99CA-453E-943D-CBD40BE946FA">Requirements of Notification Registration</a></p>
                  </li>
                  <li>
                     <p><a href="featChange.html#GUID-468A8E19-1639-487B-9136-F2CAD438FEEC">Using Continuous Query Notification</a></p>
                  </li>
                  <li>
                     <p><a href="featChange.html#GUID-FDBAA32C-A4D1-41AD-AC92-8ED8D250DA2C">Best Practice Guidelines and Performance Considerations</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-11ED5CC0-9DDE-4285-BC33-73D517E97629__GUID-69F09874-3398-429C-8E58-D11EABDCB9B3">
                  <p class="notep1">See Also:</p>
                  <p></p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><span class="q">"<a href="InstallConfiguringPort.html#GUID-95E53037-AEAA-4AFD-A8C5-CA25A3555D40">Configuring a Port to Listen for Database Notifications</a>"</span></p>
                     </li>
                     <li>
                        <p><a href="../ntqrf/postinstallation-configuration-tasks-on-windows.html#NTQRF060" target="_blank"><span class="italic">Oracle Database Platform Guide for Microsoft Windows</span></a> for details on configuring the Windows Firewall
                        </p>
                     </li>
                     <li>
                        <p><a href="../adfns/cqn.html#ADFNS018" target="_blank"><span><cite>Oracle Database Development Guide</cite></span></a> for more information on Continuous Query Notification
                        </p>
                     </li>
                  </ul>
               </div>
            </div><a id="ODPNT412"></a><div class="props_rev_3"><a id="GUID-3D46F708-E842-4A4F-8549-B6FF544B5FE4" name="GUID-3D46F708-E842-4A4F-8549-B6FF544B5FE4"></a><h3 id="ODPNT-GUID-3D46F708-E842-4A4F-8549-B6FF544B5FE4" class="sect3"><span class="enumeration_section">3.18.1 </span>Continuous Query Notification Classes 
               </h3>
               <div>
                  <p>The following classes are associated with Continuous Query Notification Support:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">OracleDependency</code></p>
                        <p>Represents a dependency between an application and an Oracle database based on the database events which the application is interested in. It contains information about the dependency and provides the mechanism to notify the application when specified database events occurs. The <code class="codeph">OracleDependency</code> class is also responsible for creating the notification listener to listen for database notifications. There is only one database notification listener for each application domain. This notification listener terminates when the application process terminates.
                        </p>
                        <p>The dependency between the application and the database is not established when the <code class="codeph">OracleDependency</code> object is created. The dependency is established when the command that is associated with this <code class="codeph">OracleDependency</code> object is executed. That command execution creates a continuous query notification registration in the database.
                        </p>
                        <p>When a change has occurred in the database, the <code class="codeph">HasChanges</code> property of the <code class="codeph">OracleDependency</code> object is set to true. Furthermore, if an event handler was registered with the <code class="codeph">OnChange</code> event of the <code class="codeph">OracleDependency</code> object, the registered event handler function will be invoked.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">OracleNotificationRequest</code></p>
                        <p>Represents a notification request to be registered in the database. It contains information about the request and the properties of the notification. </p>
                     </li>
                     <li>
                        <p><code class="codeph">OracleNotificationEventArgs</code></p>
                        <p>Represents the <a href="glossary.html#GUID-9A7BAE90-4B28-4D73-BE69-854EC8F4F46C"><span class="xrefglossterm">invalidation message</span></a> generated for a notification when a specified database event occurs and contains details about that database event. 
                        </p>
                        <div class="infoboxnotealso" id="GUID-3D46F708-E842-4A4F-8549-B6FF544B5FE4__GUID-FDADDA15-EDF4-47ED-A9CA-224B746E0893">
                           <p class="notep1">See Also:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="OracleDependencyClass.html#GUID-D28FE392-A5D9-4921-822D-9E898CFCB361">OracleDependency Class</a>"</span></p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="OracleNotificationRequestClass.html#GUID-D1057A54-2A97-4623-A500-A8C459632150">OracleNotificationRequest Class</a>"</span></p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="OracleNotificationEventArgsClass.html#GUID-25873C2A-840D-4D22-A111-E3E0D2A5F82D">OracleNotificationEventArgs Class</a>"</span></p>
                              </li>
                           </ul>
                        </div>
                     </li>
                  </ul>
               </div>
            </div><a id="ODPNT413"></a><div class="props_rev_3"><a id="GUID-168F6A1D-4532-43DB-8DC5-23C3C498E106" name="GUID-168F6A1D-4532-43DB-8DC5-23C3C498E106"></a><h3 id="ODPNT-GUID-168F6A1D-4532-43DB-8DC5-23C3C498E106" class="sect3"><span class="enumeration_section">3.18.2 </span>Supported Operations
               </h3>
               <div>
                  <p>The ODP.NET notification framework in conjunction with Continuous Query Notification supports the following activities:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Creating a notification registration by:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Creating an <code class="codeph">OracleDependency</code> instance and binding it to an <code class="codeph">OracleCommand</code> instance.
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Grouping multiple notification requests into one registration by:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Using the <code class="codeph">OracleDependency.AddCommandDependency</code> method.
                              </p>
                           </li>
                           <li>
                              <p>Setting the <code class="codeph">OracleCommand.Notification</code> request using the same <code class="codeph">OracleNotificationRequest</code> instance.
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Registering for Continuous Query Notification by:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Executing the <code class="codeph">OracleCommand</code>. If either the notification property is null or <code class="codeph">NotificationAutoEnlist</code> is false, the notification will not be made.
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Removing notification registration by:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Using the <code class="codeph">OracleDependency.RemoveRegistration</code> method.
                              </p>
                           </li>
                           <li>
                              <p>Setting the <code class="codeph">Timeout</code> property in the <code class="codeph">OracleNotificationRequest</code> instance before the registration is created.
                              </p>
                           </li>
                           <li>
                              <p>Setting the <code class="codeph">IsNotifiedOnce</code> property to <code class="codeph">true</code> in the <code class="codeph">OracleNotificationRequest</code> instance before the registration is created. The registration is removed once a database notification is sent.
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Ensuring Change Notification Persistence by:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Specifying whether or not the invalidation message is queued persistently in the database before delivery. If an invalidation message is to be stored persistently in the database, then the change notification is guaranteed to be sent. If an invalidation message is stored in an in-memory queue, the change notification can be received faster, however, it could be lost upon database shutdown or crashes.</p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Retrieving notification information including:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The changed object name.</p>
                           </li>
                           <li>
                              <p>The schema name of the changed object.</p>
                           </li>
                           <li>
                              <p>Database events that cause the notification, such as insert, delete, and so on. </p>
                           </li>
                           <li>
                              <p>The <code class="codeph">RowID</code> of the modified object row.
                              </p>
                              <p>In Oracle SQL, the <code class="codeph">ROWIDTOCHAR(ROWID)</code> and <code class="codeph">ROWIDTONCHAR(ROWID)</code> functions convert a <code class="codeph">ROWID</code> value to <code class="codeph">VARCHAR2</code> and <code class="codeph">NVARCHAR</code> data types, respectively. If these functions are used within a SQL statement, <code class="codeph">ROWID</code>s are not returned in the <code class="codeph">OracleNotificationEventArgs</code> object that is passed to the continuous query notification callback.
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Defining the listener port number.</p>
                        <p>By default, the static <code class="codeph">OracleDependency.Port</code> property is set to <code class="codeph">-1</code>. This indicates that the ODP.NET listens on a port that is randomly picked when ODP.NET registers a continuous query notification request for the first time during the execution of an application.
                        </p>
                        <p>ODP.NET creates only one listener that listens on one port within an application domain. Once ODP.NET starts the listener, the port number cannot be changed; Changes to the static <code class="codeph">OracleDependency.Port</code> property will generate an error if a listener has already been created.
                        </p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-168F6A1D-4532-43DB-8DC5-23C3C498E106__GUID-F2450F2B-FEB6-4B9D-8C6F-59C7852A1FFE">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="OracleCommandClass.html#GUID-7C1D5BCC-0268-4F1B-A583-F401F30EB9C0">OracleCommand Class</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="CommandNotification.html#GUID-901CB17E-9AA9-4559-8D05-1DCE6379C17A">Notification</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="CommandNotificationAutoEnlist.html#GUID-DC81618E-3E73-453F-BC07-B460E0475067">NotificationAutoEnlist</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="OracleDependencyClass.html#GUID-D28FE392-A5D9-4921-822D-9E898CFCB361">OracleDependency Class</a>"</span></p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="OracleNotificationEventArgsClass.html#GUID-25873C2A-840D-4D22-A111-E3E0D2A5F82D">OracleNotificationEventArgs Class</a>"</span></p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div><a id="ODPNT414"></a><div class="props_rev_3"><a id="GUID-03FA722E-99CA-453E-943D-CBD40BE946FA" name="GUID-03FA722E-99CA-453E-943D-CBD40BE946FA"></a><h3 id="ODPNT-GUID-03FA722E-99CA-453E-943D-CBD40BE946FA" class="sect3"><span class="enumeration_section">3.18.3 </span>Requirements of Notification Registration
               </h3>
               <div>
                  <p>The connected user must have the <code class="codeph">CHANGE</code> <code class="codeph">NOTIFICATION</code> privilege to create a notification registration. 
                  </p>
                  <p>This SQL statement grants the <code class="codeph">CHANGE</code> <code class="codeph">NOTIFICATION</code> privilege:
                  </p><pre class="oac_no_warn" dir="ltr">grant change notification to <span class="italic">user name</span>
</pre><p>This SQL statement revokes the <code class="codeph">CHANGE</code> <code class="codeph">NOTIFICATION</code> privilege: 
                  </p><pre class="oac_no_warn" dir="ltr">revoke change notification from <span class="italic">user name</span>
</pre></div>
            </div><a id="ODPNT415"></a><div class="props_rev_3"><a id="GUID-468A8E19-1639-487B-9136-F2CAD438FEEC" name="GUID-468A8E19-1639-487B-9136-F2CAD438FEEC"></a><h3 id="ODPNT-GUID-468A8E19-1639-487B-9136-F2CAD438FEEC" class="sect3"><span class="enumeration_section">3.18.4 </span>Using Continuous Query Notification
               </h3>
               <div>
                  <p>This section describes what the application should do, and the flow of the process, when an application uses Continuous Query Notification to receive notifications for any changes in the registered query result set. </p>
               </div><a id="ODPNT416"></a><div class="props_rev_3"><a id="GUID-E1A6A9D2-161F-4147-A419-078E70CCD4D6" name="GUID-E1A6A9D2-161F-4147-A419-078E70CCD4D6"></a><h4 id="ODPNT-GUID-E1A6A9D2-161F-4147-A419-078E70CCD4D6" class="sect4"><span class="enumeration_section">3.18.4.1 </span>Application Steps 
                  </h4>
                  <div>
                     <div class="section">
                        <p>The application should do the following: </p>
                        <ol>
                           <li>
                              <p>Create an <code class="codeph">OracleDependency</code> instance. 
                              </p>
                           </li>
                           <li>
                              <p>Assign an event handler to the <code class="codeph">OracleDependency.OnChange</code> event property if the application wishes to have an event handler invoked when database changes are detected. Otherwise, the application can choose to poll on the <code class="codeph">HasChanges</code> property of the <code class="codeph">OracleDependency</code> object. This event handler is invoked when the change notification is received. 
                              </p>
                           </li>
                           <li>
                              <p>Set the port number for the listener to listen on. The application can specify the port number for one notification listener to listen on. If the application does not specify a port number, a random one is used by the listener.</p>
                           </li>
                           <li>
                              <p>Bind the <code class="codeph">OracleDependency</code> instance to an <code class="codeph">OracleCommand</code> instance that contains the actual query to be executed. Internally, the Continuous Query Notification request (an <code class="codeph">OracleNotificationRequest</code> instance) is created and assigned to the <code class="codeph">OracleCommand.Notification</code> property.
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="ODPNT417"></a><div class="props_rev_3"><a id="GUID-ED1976AF-BB1D-44C9-9790-00D8866E6873" name="GUID-ED1976AF-BB1D-44C9-9790-00D8866E6873"></a><h4 id="ODPNT-GUID-ED1976AF-BB1D-44C9-9790-00D8866E6873" class="sect4"><span class="enumeration_section">3.18.4.2 </span>Flow of Notification Process
                  </h4>
                  <div>
                     <div class="section">
                        <ol>
                           <li>
                              <p>When the command associated with the notification request is executed, the notification registration is created in the database. The command execution must return a result set, or contain one or more <code class="codeph">REF</code> cursors for a PL/SQL stored procedure.
                              </p>
                           </li>
                           <li>
                              <p>ODP.NET starts the application listener on the first successful notification registration.</p>
                           </li>
                           <li>
                              <p>When a change related to the registration occurs in the database, the application is notified through the event delegate assigned to the <code class="codeph">OracleDependency.OnChange</code> event property, or the application can poll the <code class="codeph">OracleDependency.HasChanges</code> property.
                              </p>
                           </li>
                        </ol>
                        <p>The following example demonstrates the continuous query notification feature.</p><pre class="oac_no_warn" dir="ltr">// Database Setup
// NOTE: unless the following SQL command is executed, 
// ORA-29972 will be obtained from running this sample
/*
grant change notification to scott;
*/
using System;
using System.Threading;
using System.Data;
using Oracle.DataAccess.Client;
using Oracle.DataAccess.Types;
 
//This sample shows the continuous query notification feature in ODP.NET.
//Application specifies to get a notification when emp table is updated.
//When emp table is updated, the application will get a notification 
//through an event handler.
namespace NotificationSample 
{
  public class MyNotificationSample 
  {
    public static bool IsNotified = false;
 
    public static void Main(string[] args) 
    {
      //To Run this sample, make sure that the change notification privilege
      //is granted to scott.
      string constr = "User Id=scott;Password=tiger;Data Source=oracle";
      OracleConnection con = null;
      OracleDependency dep = null;
 
      try
      {
        con = new OracleConnection(constr);
        OracleCommand    cmd = new OracleCommand("select * from emp", con);
        con.Open();
 
        // Set the port number for the listener to listen for the notification
        // request
        OracleDependency.Port = 1005; 
 
        // Create an OracleDependency instance and bind it to an OracleCommand
        // instance.
        // When an OracleDependency instance is bound to an OracleCommand
        // instance, an OracleNotificationRequest is created and is set in the
        // OracleCommand's Notification property. This indicates subsequent 
        // execution of command will register the notification.
        // By default, the notification request is using the Database Change
        // Notification.
        dep = new OracleDependency(cmd);
 
        // Add the event handler to handle the notification. The 
        // OnMyNotification method will be invoked when a notification message
        // is received from the database
        dep.OnChange += 
          new OnChangeEventHandler(MyNotificationSample.OnMyNotificaton);
 
        // The notification registration is created and the query result sets 
        // associated with the command can be invalidated when there is a 
        // change.  When the first notification registration occurs, the 
        // notification listener is started and the listener port number 
        // will be 1005.
        cmd.ExecuteNonQuery();
 
        // Updating emp table so that a notification can be received when
        // the emp table is updated.
        // Start a transaction to update emp table
        OracleTransaction txn = con.BeginTransaction();
        // Create a new command which will update emp table
        string updateCmdText = 
          "update emp set sal = sal + 10 where empno = 7782";
        OracleCommand updateCmd = new OracleCommand(updateCmdText, con);
        // Update the emp table
        updateCmd.ExecuteNonQuery();
        //When the transaction is committed, a notification will be sent from
        //the database
        txn.Commit();
      }
      catch (Exception e)
      {
        Console.WriteLine(e.Message);
      }
 
      con.Close();
      // Loop while waiting for notification
      while(MyNotificationSample.IsNotified == false)
      {
        Thread.Sleep(100);
      }
    }
 
    public static void OnMyNotificaton(object src, 
      OracleNotificationEventArgs arg)
    {
      Console.WriteLine("Notification Received");
      DataTable changeDetails = arg.Details;
      Console.WriteLine("Data has changed in {0}", 
        changeDetails.Rows[0]["ResourceName"]);
      MyNotificationSample.IsNotified = true;
    }
  }
}
</pre></div>
                     <!-- class="section" -->
                  </div>
               </div>
            </div><a id="ODPNT418"></a><div class="props_rev_3"><a id="GUID-FDBAA32C-A4D1-41AD-AC92-8ED8D250DA2C" name="GUID-FDBAA32C-A4D1-41AD-AC92-8ED8D250DA2C"></a><h3 id="ODPNT-GUID-FDBAA32C-A4D1-41AD-AC92-8ED8D250DA2C" class="sect3"><span class="enumeration_section">3.18.5 </span>Best Practice Guidelines and Performance Considerations
               </h3>
               <div>
                  <p>This section provides guidelines for working with Continuous Query Notification and the ODP.NET notification framework, and discusses the performance impacts.Every change notification registration consumes database memory, storage or network resources, or some combination thereof. The resource consumption further depends on the volume and size of the <a href="glossary.html#GUID-9A7BAE90-4B28-4D73-BE69-854EC8F4F46C"><span class="xrefglossterm">invalidation message</span></a>. In order to scale well with a large number of mid-tier clients, Oracle recommends that the client implement these best practices:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Few and mostly read-only tables</p>
                        <p>There should be few registered objects, and these should be mostly read-only, with very infrequent invalidations. If an object is extremely volatile, then a large number of invalidation notifications are sent, potentially requiring a lot of space (in memory or on disk) in the invalidation queue. This is also true if a large number of objects are registered.</p>
                     </li>
                     <li>
                        <p>Few rows updated for each table </p>
                        <p>Transactions should update (or insert or delete) only a small number of rows within the registered tables. Depending on database resources, a whole table could be invalidated if too many rows are updated within a single transaction, for a given table. </p>
                        <p>This policy helps to contain the size of a single invalidation message, and reduces disk storage for the invalidation queue.</p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-FDBAA32C-A4D1-41AD-AC92-8ED8D250DA2C__GUID-F63F87A6-83FB-4A0E-B8C6-E29CF5D9F8FF">
                     <p class="notep1">See Also:</p>
                     <p><a href="../adfns/cqn.html#ADFNS018" target="_blank"><span><cite>Oracle Database Development Guide</cite></span></a> for further information on Continuous Query Notification
                     </p>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>