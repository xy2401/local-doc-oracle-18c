<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Cancel</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide for Microsoft Windows">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-data-provider-net.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-08-24T00:49:54-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E90593-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      
      <link rel="prev" href="CommandPublicMethods.html" title="Previous" type="text/html">
      <link rel="next" href="CommandClone.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OracleÂ® Data Provider for .NET">
    <meta name="dcterms.isVersionOf" content="ODPNT">
    <meta name="dcterms.release" content="Release 18">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="CommandPublicMethods.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="CommandClone.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="odp-dot-net-classes.html" property="item" typeof="WebPage"><span property="name">Oracle Data Provider for .NET Classes</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="OracleCommandClass.html" property="item" typeof="WebPage"><span property="name">OracleCommand Class</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="CommandPublicMethods.html" property="item" typeof="WebPage"><span property="name">OracleCommand Public Methods</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Cancel</li>
            </ol>
            <a id="GUID-AA7F3329-7359-44BF-AF57-A39319270397" name="GUID-AA7F3329-7359-44BF-AF57-A39319270397"></a><a id="ODPNT599"></a><a id="ODPNT600"></a><a id="ODPNT601"></a><a id="ODPNT602"></a><a id="ODPNT598"></a>
            
            <h2 id="ODPNT-GUID-AA7F3329-7359-44BF-AF57-A39319270397" class="sect2"><span class="enumeration_section">6.2.5.1 </span>Cancel
            </h2>
         </header>
         <div class="ind">
            <div>
               <div class="section">
                  <p>This method attempts to cancel a command that is currently executing on a particular connection. </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1">Declaration</p>
               </div>
               <!-- class="section" -->
               <div class="section"><pre class="oac_no_warn" dir="ltr">// C#
public override void Cancel();</pre></div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1">Implements</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p><code class="codeph">IDbCommand.Cancel</code></p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1">Remarks</p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p>If cancellation of the command succeeds, an exception is thrown. If cancellation is not successful, no exception is thrown. If there is no command being executed at the time of the <code class="codeph">Cancel</code> invocation, <code class="codeph">Cancel</code> does nothing. Invoking the <code class="codeph">Cancel</code> method does not guarantee that the command executing at the time will always be cancelled. The execution may complete before it can be terminated. In such cases, no exception is thrown. 
                  </p>
                  <p>When multiple <code class="codeph">OracleCommand</code> objects share the same connection, only one command can be executed on that connection at any one time. When it is invoked, the <code class="codeph">Cancel</code> method attempts to cancel the statement currently running on the connection that the <code class="codeph">OracleCommand</code> object is using to execute the command. However, when multiple <code class="codeph">OracleCommand</code> objects execute statements on the same connection simultaneously, issuing a <code class="codeph">Cancel</code> method invocation may cancel any of the issued commands. This is because the command designated for cancellation may complete before the <code class="codeph">Cancel</code> invocation is effective. If this happens, a command executed by a different <code class="codeph">OracleCommand</code> could be cancelled instead.
                  </p>
                  <p>There are several ways to avoid this non-deterministic situation that the <code class="codeph">Cancel</code> method can cause:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The application can create just one <code class="codeph">OracleCommand</code> object for each connection. Doing so assures that the <code class="codeph">Cancel</code> invocation only cancels commands executed by the <code class="codeph">OracleCommand</code> object using a particular connection. 
                        </p>
                     </li>
                     <li>
                        <p>Command executions in the application are synchronized between <code class="codeph">OracleCommand</code> objects that use the same connection. 
                        </p>
                     </li>
                  </ul>
                  <p>These suggestions do not apply if <code class="codeph">Cancel</code> is not used in the application.
                  </p>
                  <p>Because the termination on the currently running execution is non-deterministic, it is recommended that any <span class="italic">non-atomic</span> SQL or PL/SQL execution be started within a transaction. When the command execution successfully terminates with an exception of <code class="codeph">ORA-01013:</code> <code class="codeph">user</code> <code class="codeph">requested</code> <code class="codeph">cancel</code> <code class="codeph">of</code> <code class="codeph">current</code> <code class="codeph">operation</code>, the transaction can be rolled back for data integrity. Other possible exceptions thrown after a command cancellation occurs include <code class="codeph">ORA-00936</code> and <code class="codeph">ORA-00604.</code> Examples of non-atomic execution are collections of DML command executions that are executed one-by-one and multiple DML commands that are part of a PL/SQL stored procedure or function.
                  </p>
               </div>
               <!-- class="section" -->
               <div class="section">
                  <p class="subhead1">Example</p>
               </div>
               <!-- class="section" -->
               <div class="section"><pre class="oac_no_warn" dir="ltr">// C#
 
// This example shows how command executions can be cancelled in a 
// deterministic way even if multiple commands are executed on a single 
// connection.  This is accomplished by synchronizing threads through events.
// Since the Cancel method terminates the currently running operation on the
// connection, threads must be serialized if multiple threads are using the 
// same connection to execute server round-trip incurring operations.
// Furthermore, the example shows how the execution and cancel threads should
// be synchronized so that nth iteration of the command execution does not
// inappropriately cancel the (n+1)th command executed by the same thread.
 
using System;
using System.Data;
using Oracle.DataAccess.Client;
using System.Threading;
 
class CancelSample
{
  private OracleCommand cmd;
  Thread t1, t2;
  // threads signal following events when assigned operations are completed
 
  private AutoResetEvent ExecuteEvent = new AutoResetEvent(false);
  private AutoResetEvent CancelEvent = new AutoResetEvent(false);
  private AutoResetEvent FinishedEvent = new AutoResetEvent(false);
  AutoResetEvent[] ExecuteAndCancel = new AutoResetEvent[2];
 
  // Default constructor
  CancelSample()
  {
    cmd = new OracleCommand("select * from all_objects",
      new OracleConnection("user id=scott;password=tiger;data source=oracle"));
    ExecuteAndCancel[0] = ExecuteEvent;
    ExecuteAndCancel[1] = CancelEvent;
  }
 
  // Constructor that takes a particular command and connection
  CancelSample(string command, OracleConnection con)
  {
    cmd = new OracleCommand(command, con);
    ExecuteAndCancel[0] = ExecuteEvent;
    ExecuteAndCancel[1] = CancelEvent;
  }
 
  // Execution of the command
  public void Execute()
  {
    OracleDataReader reader = null;
    try
    {
      Console.WriteLine("Execute.");
      reader = cmd.ExecuteReader();
      Console.WriteLine("Execute Done.");
      reader.Close();
    }
    catch(Exception e)
    {
      Console.WriteLine("The command has been cancelled.", e.Message);
    }
    Console.WriteLine("ExecuteEvent.Set()");
    ExecuteEvent.Set();
  }
 
  // Canceling of the command
  public void Cancel()
  {
    try
    {
      // cancel query if it takes longer than 100 ms to finish execution
      System.Threading.Thread.Sleep(100);
      Console.WriteLine("Cancel.");
      cmd.Cancel();
    }
    catch (Exception e)
    {
      Console.WriteLine(e.ToString());
    }
    Console.WriteLine("Cancel done.");
    Console.WriteLine("CancelEvent.Set()");
    CancelEvent.Set();
  }
 
  // Execution of the command with a potential of cancelling
  public void ExecuteWithinLimitedTime()
  {
    for (int i = 0; i &lt; 5; i++)
    {
      Monitor.Enter(typeof(CancelSample));
      try
      {
        Console.WriteLine("Executing " + this.cmd.CommandText);
        ExecuteEvent.Reset();
        CancelEvent.Reset();
        t1 = new Thread(new ThreadStart(this.Execute));
        t2 = new Thread(new ThreadStart(this.Cancel));
        t1.Start();
        t2.Start();
      }
      finally
      {
        WaitHandle.WaitAll(ExecuteAndCancel);
        Monitor.Exit(typeof(CancelSample));
      }
    }
    FinishedEvent.Set();
  }
  [MTAThread]
  static void Main()
  {
    try
    {
      AutoResetEvent[] ExecutionCompleteEvents = new AutoResetEvent[3];
 
      // Create the connection that is to be used by three commands
      OracleConnection con = new OracleConnection("user id=scott;" +
        "password=tiger;data source=oracle");
      con.Open();
 
      // Create instances of CancelSample class
      CancelSample test1 = new CancelSample("select * from all_objects", con);
      CancelSample test2 = new CancelSample("select * from all_objects, emp", 
                                            con);
      CancelSample test3 = new CancelSample("select * from all_objects, dept", 
                                            con);
 
      // Create threads for each CancelSample object instance
      Thread t1 = new Thread(new ThreadStart(test1.ExecuteWithinLimitedTime));
      Thread t2 = new Thread(new ThreadStart(test2.ExecuteWithinLimitedTime));
      Thread t3 = new Thread(new ThreadStart(test3.ExecuteWithinLimitedTime));
 
      // Obtain a handle to an event from each object
      ExecutionCompleteEvents[0] = test1.FinishedEvent;
      ExecutionCompleteEvents[1] = test2.FinishedEvent;
      ExecutionCompleteEvents[2] = test3.FinishedEvent;
      
      // Start all threads to execute three commands using a single connection
      t1.Start();
      t2.Start();
      t3.Start();
 
      // Wait for all three commands to finish executing/canceling before
      //closing the connection
      WaitHandle.WaitAll(ExecutionCompleteEvents);
      con.Close();
    }
    catch (Exception e)
    {
      Console.WriteLine(e.ToString());
    }
  }
}</pre><div class="infoboxnotealso" id="GUID-AA7F3329-7359-44BF-AF57-A39319270397__GUID-5D5EDA51-71B4-4320-AD65-6AED1FC77B78">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="intro003.html#GUID-2A5A5F0B-E6C9-45AF-9477-FBD55F7FCDC5">Oracle.DataAccess.Client and Oracle.ManagedDataAccess.Client Namespaces</a>"</span></p>
                        </li>
                        <li>
                           <p><a href="OracleCommandClass.html#GUID-7C1D5BCC-0268-4F1B-A583-F401F30EB9C0">OracleCommand Class</a></p>
                        </li>
                        <li>
                           <p><a href="OracleCommandMembers.html#GUID-675EB077-B6E5-4922-AA2B-407AC5DDCD66">OracleCommand Members</a></p>
                        </li>
                        <li>
                           <p><a href="http://msdn.microsoft.com/library" target="_blank"><code class="codeph">http://msdn.microsoft.com/library</code></a> for detailed information about this Microsoft .NET Framework feature
                           </p>
                        </li>
                     </ul>
                  </div>
               </div>
               <!-- class="section" -->
            </div>
         </div>
      </article>
   </body>
</html>