<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Limitations and Restrictions on ODP.NET Within .NET Stored Procedure</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Developer's Guide ">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Developer's Guide for Microsoft Windows">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="oracle-data-provider-net.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-08-24T00:49:54-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2002, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E90593-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      
      <link rel="prev" href="extenBoth.html" title="Previous" type="text/html">
      <link rel="next" href="extenPorting.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="OracleÂ® Data Provider for .NET">
    <meta name="dcterms.isVersionOf" content="ODPNT">
    <meta name="dcterms.release" content="Release 18">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="extenBoth.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="extenPorting.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Developer's Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="extensions.html" property="item" typeof="WebPage"><span property="name">Oracle Data Provider for .NET Stored Procedures</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Limitations and Restrictions on ODP.NET Within .NET Stored Procedure</li>
            </ol>
            <a id="GUID-5DCCC745-E0AB-40C1-B642-1B8DBB19171A" name="GUID-5DCCC745-E0AB-40C1-B642-1B8DBB19171A"></a><a id="ODPNT448"></a>
            
            <h2 id="ODPNT-GUID-5DCCC745-E0AB-40C1-B642-1B8DBB19171A" class="sect2"><span class="enumeration_section">5.2 </span>Limitations and Restrictions on ODP.NET Within .NET Stored Procedure
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This section covers important concepts that apply when Oracle Data Provider for .NET is used within a .NET stored procedure.</p>
               <div class="infoboxnote" id="GUID-5DCCC745-E0AB-40C1-B642-1B8DBB19171A__GUID-9A7411BD-42D0-4177-8FA3-8EBD4CD38C41">
                  <p class="notep1">Note:</p>
                  <p>ODP.NET, Managed Driver does not support .NET stored procedures.</p>
               </div>
            </div><a id="ODPNT449"></a><div class="props_rev_3"><a id="GUID-1EEA95D7-268F-44FC-B98E-E7FEB621D08A" name="GUID-1EEA95D7-268F-44FC-B98E-E7FEB621D08A"></a><h3 id="ODPNT-GUID-1EEA95D7-268F-44FC-B98E-E7FEB621D08A" class="sect3"><span class="enumeration_section">5.2.1 </span>Implicit Database Connection
               </h3>
               <div>
                  <p>Within a .NET stored procedure, an implicit database connection is available for use to access Oracle data. This implicit database connection should be used rather than establishing a user connection because the <a href="glossary.html#GUID-60BB003F-660A-4DDC-AEE7-5832C1B3E8B6"><span class="xrefglossterm">implicit database connection</span></a> is already established by the caller of the .NET stored procedure, thereby minimizing resource usage.
                  </p>
                  <p>To obtain an <code class="codeph">OracleConnection</code> object in a .NET stored procedure that represents the implicit database connection, set the <code class="codeph">ConnectionString</code> property of the <code class="codeph">OracleConnection</code> object to <code class="codeph">"context</code> <code class="codeph">connection=true"</code> and invoke the <code class="codeph">Open</code> method. No connection string attributes can be used with <code class="codeph">"context</code> <code class="codeph">connection=true"</code>, except the <code class="codeph">Statement</code> <code class="codeph">Cache</code> <code class="codeph">Size</code> attribute.
                  </p>
                  <p>The availability of the implicit database connection can be checked at run time through the static <code class="codeph">OracleConnection.IsAvailable</code> property. This property always returns <code class="codeph">true</code> when Oracle Data Provider for .NET is used within a .NET stored procedure. Otherwise, <code class="codeph">false</code> is returned.
                  </p>
                  <div class="infoboxnote" id="GUID-1EEA95D7-268F-44FC-B98E-E7FEB621D08A__GUID-645C3398-42B3-4BD1-957A-3499D83C67A1">
                     <p class="notep1">Note:</p>
                     <p>DBLinks are not supported in .NET stored procedures.</p>
                  </div>
                  <p>Only one implicit database connection is available within a .NET stored procedure invocation. To establish more connections in addition to the implicit database connection, an explicit connection must be created. When the <code class="codeph">Close</code> method is invoked on the <code class="codeph">OracleConnection</code> that represents the implicit database connection, the connection is not actually closed. Therefore, the <code class="codeph">Open</code> method of the same or another <code class="codeph">OracleConnection</code> object can be invoked to obtain the connection that represents the implicit database connection.
                  </p>
                  <p>The implicit database connection can only be acquired by the <code class="codeph">Open</code> method invocation by a native Oracle thread that initially invokes the .NET stored procedure. However, threads spawned from the native Oracle thread can use implicit database connections that are obtained by the native Oracle thread.
                  </p>
                  <div class="infoboxnotealso" id="GUID-1EEA95D7-268F-44FC-B98E-E7FEB621D08A__GUID-6FAC49AE-96A2-4A15-8F86-B6628AE015FB">
                     <p class="notep1">See Also:</p>
                     <p><span class="q">"<a href="ConnectionIsAvailable.html#GUID-89352DFD-EDA6-4C8D-9118-3B10F7B292B3">IsAvailable</a>"</span></p>
                  </div>
               </div>
            </div><a id="ODPNT451"></a><a id="ODPNT452"></a><a id="ODPNT450"></a><div class="props_rev_3"><a id="GUID-2F4EF336-10C0-4231-81BE-641547C69E14" name="GUID-2F4EF336-10C0-4231-81BE-641547C69E14"></a><h3 id="ODPNT-GUID-2F4EF336-10C0-4231-81BE-641547C69E14" class="sect3"><span class="enumeration_section">5.2.2 </span>Transaction Support
               </h3>
               <div>
                  <div class="section">
                     <p>The .NET stored procedure execution automatically inherits the current transaction on the implicit database connection. No explicit transaction can be started, committed, or rolled back inside a .NET stored procedure on a Context connection. However, explicit transaction can be started, committed, or rolled back inside a .NET stored procedure on a Client connection.</p>
                     <p>For example, <code class="codeph">OracleConnection.BeginTransaction</code> is not allowed inside a .NET stored procedure for a context connection, but is allowed for a client connection. .NET stored procedures do not support distributed transactions. If you have enlisted a client connection in a distributed transaction and call a .NET stored procedure or function, an error occurs.
                     </p>
                     <p>If a .NET stored procedure or function performs operations on the database that are required to be part of a transaction, the transaction must be started prior to calling the .NET stored procedure. Any desired commit or rollback must be performed after returning from the .NET stored procedure or function.</p>
                     <p>The following example consists of a client application and a .NET stored procedure, <code class="codeph">InsertRecordSP</code>, that inserts an employee record into an <code class="codeph">EMP</code> table.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Example (.NET Stored Procedure)</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section"><pre class="oac_no_warn" dir="ltr">using System;
using System.Data;
using Oracle.DataAccess.Client;
// This class represents an Oracle .NET stored procedure that inserts
// an employee record into an EMP table of SCOTT schema.
public class InsertRecordSP
{
    // This procedure will insert a row into the emp database
    // For simplicity we are using only two parameters, the rest are hard coded
    public static void InsertRecord( int EmpNo, string EmpName )
    {
        if(OracleConnection.IsAvailable == true )
        {
            OracleConnection conn = new OracleConnection(
                "context connection=true");
            conn.Open();
            // Create new command object from connection context
            OracleCommand Cmd = conn.CreateCommand();
            Cmd.CommandText = "INSERT INTO EMP( EMPNO, ENAME, JOB," +
                "MGR, HIREDATE, SAL, COMM, DEPTNO ) " +
                "VALUES ( :1, :2, 'ANALYST', 7566, " +
                "'06-DEC-04', 5000, 0, 20 )";
            Cmd.Parameters.Add( ":1", OracleDbType.Int32,
                EmpNo, ParameterDirection.Input );
            Cmd.Parameters.Add( ":2", OracleDbType.Varchar2,
                EmpName, ParameterDirection.Input );
            Cmd.ExecuteNonQuery();
        }
    }
}</pre></div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Example (Client Application)</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>The example enters new employee, Bernstein, employee number 7950, into the <code class="codeph">EMP</code> table.
                     </p><pre class="oac_no_warn" dir="ltr">// C#
// This sample demonstrates how to start the transaction with ODP.NET client 
// application and execute an Oracle .NET stored procedure that performs
// a DML operation. Since .NET stored procedure inherits the current
// transaction from the implicit database connection,  DML operation 
// in .NET stored procedure will not be in auto-committed mode.
// Therefore, it is up to the client application to do a COMMIT or ROLLBACK
// after returning from .NET stored procedure
using System;
using System.Data;
using Oracle.DataAccess.Client;
// In this class we are starting a transaction on the client side and
// executing a .NET stored procedure, which inserts a record into EMP
// table and then verifies record count before and after COMMIT statement
class TransactionSample
{
    static void Main(string[] args)
    {
        OracleConnection Conn = null;
        OracleTransaction Txn = null;
        OracleCommand Cmd = null;
        try
        {
            Console.WriteLine( "Sample: Open DB connection in non auto-committed " 
               + "mode," +
                "DML operation performed by .NET stored " +
                "procedure doesn't have an effect before COMMIT " +
                "is called." );
            // Create and Open oracle connection
            Conn = new OracleConnection();
            Conn.ConnectionString = "User Id=scott;Password=tiger;" +
                "Data Source=oracle;";
            Conn.Open();
            // Start transaction
            Txn = Conn.BeginTransaction( IsolationLevel.ReadCommitted );
            // Create command object
            Cmd = new OracleCommand();
            Cmd.Connection = Conn;
            Cmd.CommandType = CommandType.StoredProcedure;
            Cmd.CommandText = "InsertRecord"; // .NET Stored procedure
            // Parameter settings
            OracleParameter EmpNoPrm = Cmd.Parameters.Add(
                "empno", OracleDbType.Int32 );
            EmpNoPrm.Direction = ParameterDirection.Input;
            EmpNoPrm.Value = 7950;
            OracleParameter EmpNamePrm = Cmd.Parameters.Add(
                "ename", OracleDbType.Varchar2, 10 );
            EmpNamePrm.Direction = ParameterDirection.Input;
            EmpNamePrm.Value = "Bernstein";
            // Execute .NET stored procedure
            Cmd.ExecuteNonQuery();
            Console.WriteLine( "Number of record(s) before COMMIT {0}",
                RecordCount() );
            Txn.Commit();
            Console.WriteLine( "Number of record(s) after COMMIT {0}",
                RecordCount() );
        }
        catch( OracleException OE )
        {
            Console.WriteLine( OE.Message );
        }
        finally
        {
            // Cleanup objects
            if( null != Txn )
                Txn.Dispose();
            if( null != Cmd )
                Cmd.Dispose();
            if( null != Conn &amp;&amp; Conn.State == ConnectionState.Open )
                Conn.Close();
        }
    }
    static int RecordCount()
    {
        int EmpCount = 0;
        OracleConnection Conn = null;
        OracleCommand Cmd = null;
        try
        {
            Conn = new OracleConnection( "User Id=scott;Password=tiger;" +
                "Data Source=oracle;" );
            Conn.Open();
            Cmd = new OracleCommand( "SELECT COUNT(*) FROM EMP", Conn );
            Object o = Cmd.ExecuteScalar();
            EmpCount = Convert.ToInt32(o.ToString());
        }
        catch( OracleException OE )
        {
            Console.WriteLine( OE.Message );
        }
        finally
        {
            if( null != Cmd )
                Cmd.Dispose();
        }
        return EmpCount;
       }
      }</pre></div>
                  <!-- class="section" -->
               </div>
            </div><a id="ODPNT453"></a><div class="props_rev_3"><a id="GUID-103A33F9-3777-46F7-BB44-ED33B5FC538B" name="GUID-103A33F9-3777-46F7-BB44-ED33B5FC538B"></a><h3 id="ODPNT-GUID-103A33F9-3777-46F7-BB44-ED33B5FC538B" class="sect3"><span class="enumeration_section">5.2.3 </span>Unsupported SQL Commands
               </h3>
               <div>
                  <div class="section">
                     <p>Transaction controls commands such as <code class="codeph">COMMIT</code>, <code class="codeph">ROLLBACK</code>, and <code class="codeph">SAVEPOINT</code> are not supported in a .NET stored procedure.
                     </p>
                     <p>Data definition commands such as <code class="codeph">CREATE</code> and <code class="codeph">ALTER</code> are not supported with an implicit database connection, but they are supported with an explicit user connection in a .NET stored procedure.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="ODPNT454"></a><div class="props_rev_3"><a id="GUID-4684F6F7-CB2D-4734-A8DB-CD36436E8AA6" name="GUID-4684F6F7-CB2D-4734-A8DB-CD36436E8AA6"></a><h3 id="ODPNT-GUID-4684F6F7-CB2D-4734-A8DB-CD36436E8AA6" class="sect3"><span class="enumeration_section">5.2.4 </span>Oracle User-Defined Type (UDT) Support 
               </h3>
               <div>
                  <div class="section">
                     <p>UDTs are not supported within a context connection but they are supported with a client connection. UDTs are not supported as parameters to .NET stored procedures. </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>