<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="The Oracle Multimedia PL/SQL Web Toolkit Photo Album sample application is a media upload and retrieval Web application using Oracle Multimedia object types. This application uses the PL/SQL Gateway and PL/SQL Web Toolkit.">
      <meta name="description" content="The Oracle Multimedia PL/SQL Web Toolkit Photo Album sample application is a media upload and retrieval Web application using Oracle Multimedia object types. This application uses the PL/SQL Gateway and PL/SQL Web Toolkit.">
      <title>Oracle Multimedia PL/SQL Photo Album Sample Application</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="User's Guide ">
      <meta property="og:description" content="The Oracle Multimedia PL/SQL Web Toolkit Photo Album sample application is a media upload and retrieval Web application using Oracle Multimedia object types. This application uses the PL/SQL Gateway and PL/SQL Web Toolkit.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="User's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="multimedia-users-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-07T03:26:44-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="1999, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E84257-02">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      
      <link rel="prev" href="oracle-multimedia-application-development.html" title="Previous" type="text/html">
      <link rel="next" href="oracle-multimedia-code-wizard-sample-application-plsql-gateway.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Multimedia User's Guide">
    <meta name="dcterms.isVersionOf" content="IMURG">
    <meta name="dcterms.release" content="Release 18">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="oracle-multimedia-application-development.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="oracle-multimedia-code-wizard-sample-application-plsql-gateway.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">User's Guide </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Oracle Multimedia PL/SQL Photo Album Sample Application</li>
            </ol>
            <a id="GUID-4F64BE39-7F90-4B17-838F-3BF9163D729E" name="GUID-4F64BE39-7F90-4B17-838F-3BF9163D729E"></a><a id="IMURG11832"></a><a id="IMURG3000"></a>
            
            <h2 id="IMURG-GUID-4F64BE39-7F90-4B17-838F-3BF9163D729E" class="sect2"><span class="enumeration_chapter">3 </span>Oracle Multimedia PL/SQL Photo Album Sample Application
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The Oracle Multimedia PL/SQL Web Toolkit Photo Album sample application is a media upload and retrieval Web application using Oracle Multimedia object types. This application uses the PL/SQL Gateway and PL/SQL Web Toolkit.</p>
               <p>This application assumes the following:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p>You are familiar with developing PL/SQL applications using the PL/SQL Gateway and PL/SQL Web Toolkit.</p>
                  </li>
                  <li>
                     <p>You have installed and configured the Oracle Multimedia PL/SQL Web Toolkit Photo Album sample application.</p>
                  </li>
               </ul>
               <p>You can install the Oracle Multimedia PL/SQL Web Toolkit Photo Album sample application from the Oracle Database Examples media, which is available for download from the Oracle Technology Network (OTN). After installing the Oracle Database Examples media, the sample application files and README.txt file are located at:</p>
               <p><span class="italic"><code class="codeph">&lt;ORACLE_HOME&gt;</code></span><code class="codeph">/ord/http/demo/plsqlwtk</code> (on Linux and UNIX)
               </p>
               <p><span class="italic"><code class="codeph">&lt;ORACLE_HOME&gt;</code></span><code class="codeph">\ord\http\demo\plsqlwtk</code> (on Windows)
               </p>
               <p>This chapter describes how to run the PL/SQL Web Toolkit Photo Album sample application. See the <code class="codeph">README.txt</code> file for this sample application for additional requirements and instructions on installing and configuring this sample application.
               </p>
               <p>This chapter includes these sections:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-0E12A997-540D-44B4-BC2B-12A978857EB9" title="This topic describes the setup process for the Oracle Multimedia PL/SQL Web Toolkit Photo Album sample application.">Overview of the PL/SQL Photo Album Sample Application</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-06A7A9F4-F7C9-4536-BE20-B79273727691" title="This topic describes how to run the PL/SQL Photo Album application.">Running the PL/SQL Photo Album Sample Application</a></p>
                  </li>
                  <li>
                     <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-D07ABFB7-0A88-4CCC-9E46-8A85B1E0B3D2" title="The PL/SQL Photo Album application is implemented as a set of PL/SQL procedures and functions, organized in a single PL/SQL package.">Description of the PL/SQL Photo Album Sample Application</a></p>
                  </li>
               </ul>
               <div class="infoboxnotealso" id="GUID-4F64BE39-7F90-4B17-838F-3BF9163D729E__GUID-649E00E3-DE51-4583-B6E0-5B9B9CAEBA64">
                  <p class="notep1">See Also:</p>
                  <p><a href="oracle-multimedia-code-wizard-sample-application-plsql-gateway.html#GUID-27A7994A-7D2C-474E-B759-EAC45C65CBDD" title="The Oracle Multimedia Code Wizard sample application for the PL/SQL Gateway creates PL/SQL procedures for the PL/SQL Gateway to upload and retrieve multimedia data stored in a database using Oracle Multimedia object types.">Oracle Multimedia Code Wizard Sample Application for the PL/SQL Gateway</a> for a sample application that creates media upload and retrieval procedures for the PL/SQL Gateway
                  </p>
               </div>
            </div><a id="IMURG3100"></a><div class="props_rev_3"><a id="GUID-0E12A997-540D-44B4-BC2B-12A978857EB9" name="GUID-0E12A997-540D-44B4-BC2B-12A978857EB9"></a><h3 id="IMURG-GUID-0E12A997-540D-44B4-BC2B-12A978857EB9" class="sect3"><span class="enumeration_section">3.1 </span>Overview of the PL/SQL Photo Album Sample Application
               </h3>
               <div>
                  <p>This topic describes the setup process for the Oracle Multimedia PL/SQL Web Toolkit Photo Album sample application. </p>
                  <div class="section">
                     <p>The Oracle Multimedia PL/SQL Web Toolkit Photo Album sample application demonstrates how to perform the following operations:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Use the Oracle Multimedia image object type to upload, retrieve, and process media data stored in Oracle Database.</p>
                        </li>
                        <li>
                           <p>Combine the image metadata methods of Oracle Multimedia with the XML document management capabilities of Oracle XML DB and the full-text indexing and search features of Oracle Text to create a solution that can extract, store, and search metadata that is embedded in binary image files.</p>
                        </li>
                        <li>
                           <p>Collect new metadata from a user, format the metadata into an XML document, and store the document in the binary image using the Oracle Multimedia image object type.</p>
                        </li>
                     </ul>
                     <p>When installed, this photo album application creates several schema objects that are important to the following discussion. These objects include the <code class="codeph">photos</code> table, which is defined by the following CREATE TABLE statement:
                     </p><pre class="oac_no_warn" dir="ltr">CREATE TABLE photos( id           NUMBER PRIMARY KEY,
                     description  VARCHAR2(40) NOT NULL,
                     metaORDImage XMLTYPE,
                     metaEXIF     XMLTYPE,
                     metaIPTC     XMLTYPE,
                     metaXMP      XMLTYPE,
                     image        ORDSYS.ORDIMAGE,
                     thumb        ORDSYS.ORDIMAGE )
--
-- store full-size and thumbnail images as SecureFiles LOBS
--
LOB(image.source.localdata)  STORE AS SECUREFILE
LOB(thumb.source.localdata)  STORE AS SECUREFILE
--
-- and bind the XMLType columns to the Oracle Multimedia metadata schemas
XMLType COLUMN metaORDImage
  STORE AS SecureFile CLOB
  XMLSCHEMA "http://xmlns.oracle.com/ord/meta/ordimage"
  ELEMENT "ordImageAttributes"
XMLType COLUMN metaEXIF
  STORE AS SecureFile CLOB
  XMLSCHEMA "http://xmlns.oracle.com/ord/meta/exif"
  ELEMENT "exifMetadata"
XMLType COLUMN metaIPTC
  STORE AS SecureFile CLOB
  XMLSCHEMA "http://xmlns.oracle.com/ord/meta/iptc"
  ELEMENT "iptcMetadata"
XMLType COLUMN metaXMP
  STORE AS SecureFile CLOB
  XMLSCHEMA "http://xmlns.oracle.com/ord/meta/xmp"
  ELEMENT "xmpMetadata";
</pre><p>The data types for the <code class="codeph">image</code> and <code class="codeph">thumb</code> columns are defined as Oracle Multimedia image object types. These columns are used to store the full-size images and the generated thumbnail images, respectively. The LOB storage clauses direct the database to store the full-size and thumbnail images in SecureFiles LOBs, which are the highest performing storage option for binary data.
                     </p>
                     <p>The table also defines four columns of type <code class="codeph">XMLType</code> to store XML documents that contain four different kinds of image metadata. Each column is bound to a specific Oracle Multimedia metadata schema. Each metadata schema defines precisely the data model of the metadata document. These schemas are registered with Oracle XML DB when the database is created. The column definitions specify that the database uses unstructured storage to manage the XML metadata documents. Some advantages of using unstructured storage to manage XML include fast retrieval of the complete document and the ability to use XMLIndex indexes to improve the performance of XPath-based queries.
                     </p>
                     <p>When installed, this photo album application also creates other schema objects. These schema objects include two types of indexes that accelerate metadata searches: a <code class="codeph">CONTEXT</code> text index and an <code class="codeph">XMLIndex</code> index.
                     </p>
                     <p>The <code class="codeph">CONTEXT</code> type is a text index over all columns that contain descriptive information about the image. These columns include <code class="codeph">PHOTOS.DESCRIPTION</code>, which is a VARCHAR2  data type, and these four <code class="codeph">XMLType</code> columns: <code class="codeph">PHOTOS.METAIPTC</code>, <code class="codeph">PHOTOS.METAEXIF</code>, <code class="codeph">PHOTOS.METAXMP</code>,  and <code class="codeph">PHOTOS.METAORDIMAGE</code>. The <code class="codeph">CONTEXT</code> text index is used to accelerate metadata searches by implementing the photo album search feature that enables users to search for photographs by keyword or phrase.
                     </p>
                     <p>The <code class="codeph">CONTEXT</code> text index is created by the following statements. (This example assumes that this photo album application has been installed in the SCOTT schema.)
                     </p><pre class="oac_no_warn" dir="ltr">-- Create preference PA_CTXIDX.
ctx_ddl.create_preference('SCOTT.PA_CTXIDX', 'MULTI_COLUMN_DATASTORE');
 
-- Create a multicolumn datastore.
ctxcols := 'description, '                   ||
            'SCOTT.photo_album.getClob(METAIPTC), ' ||
            'SCOTT.photo_album.getClob(METAEXIF), ' ||
            'SCOTT.photo_album.getClob(METAXMP), '  ||
            'SCOTT.photo_album.getClob(METAORDIMAGE)';
ctx_ddl.set_attribute( ctxpref, 'COLUMNS', ctxcols );
 
 
-- Create the CONTEXT text index.
create  index pa_ctx_idx on photos(description)
indextype is ctxsys.context
parameters ( 'DATASTORE SCOTT.PA_CTXIDX' );
</pre><p>The <code class="codeph">XMLIndex</code> index is used to accelerate metadata searches by permitting users to search only certain types of image metadata and limiting the search to specific portions of an XML document. For example, the following statements create three indexes of type <code class="codeph">XMLIndex</code> to speed up existsNode( ) queries on columns of type <code class="codeph">XMLType</code>:
                     </p><pre class="oac_no_warn" dir="ltr">create index pa_path_iptc_idx  on photos( metaIptc )
 indextype is XDB.XMLIndex;
 
create index pa_path_exif_idx  on photos( metaExif )
 indextype is XDB.XMLIndex;
 
create index pa_path_xmp_idx  on photos( metaXMP )
 indextype is XDB.XMLIndex;
</pre><p>During the installation, as prescribed by the PL/SQL Gateway, a document upload table is defined by the following CREATE TABLE statement:</p><pre class="oac_no_warn" dir="ltr">CREATE TABLE PHOTOS_UPLOAD( name           VARCHAR2(256) UNIQUE NOT NULL,
                            mime_type      VARCHAR2(128),
                            doc_size       NUMBER,
                            dad_charset    VARCHAR2(128),
                            last_updated   DATE,
                            content_type   VARCHAR2(128),
                            blob_content   BLOB )
-- 
-- store BLOBs as SecureFiles LOBs
-- 
LOB(blob_content)  STORE AS SECUREFILE;
</pre><p>Each image uploaded using the PL/SQL Gateway is stored in the <code class="codeph">PHOTOS_UPLOAD</code> table. An upload procedure (<code class="codeph">insert_new_photo</code>) automatically moves the uploaded image from the specified <code class="codeph">PHOTOS_UPLOAD</code> table to the photo album applications table called <code class="codeph">photos</code>.
                     </p>
                     <div class="infoboxnotealso" id="GUID-0E12A997-540D-44B4-BC2B-12A978857EB9__GUID-016E40F6-FD4C-45AD-92BD-E9982C6464FE">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../adxdb/indexes-for-XMLType-data.html#ADXDB4332" target="_blank"><span class="italic">Oracle XML DB Developer's Guide</span></a> for more information about XML DB and <code class="codeph">XMLIndex</code> indexes
                              </p>
                           </li>
                           <li>
                              <p><a href="../ccapp/indexing-with-oracle-text.html#CCAPP0300" target="_blank"><span class="italic">Oracle Text Application Developer's Guide</span></a> for more information about creating and using text indexing
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="IMURG11561"></a><div class="props_rev_3"><a id="GUID-06A7A9F4-F7C9-4536-BE20-B79273727691" name="GUID-06A7A9F4-F7C9-4536-BE20-B79273727691"></a><h3 id="IMURG-GUID-06A7A9F4-F7C9-4536-BE20-B79273727691" class="sect3"><span class="enumeration_section">3.2 </span>Running the PL/SQL Photo Album Sample Application
               </h3>
               <div>
                  <p>This topic describes how to run the PL/SQL Photo Album application.</p>
                  <div class="section">
                     <p>After you have completed the setup tasks and have built the PL/SQL Photo Album application, including creating a database access descriptor (DAD) entry (as described in the <code class="codeph">README.txt</code> file), you are ready to run this application.
                     </p>
                     <p>In the address field of your Web browser, enter the following URL:</p><pre class="oac_no_warn" dir="ltr"><span class="italic"><code class="codeph">&lt;protocol&gt;</code></span><span class="italic"><code class="codeph">&lt;hostname:port-number&gt;</code></span>/photoalbum
</pre></div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>In the <span class="italic"><code class="codeph">&lt;protocol&gt;</code></span> field, enter <code class="codeph">http://</code>.</span></li>
                     <li><span>In the <span class="italic"><code class="codeph">&lt;hostname:port-number&gt;</code></span> field, enter the host name and port number of the system where your HTTP server is running.</span></li>
                  </ol>
                  <div class="section">
                     <p>When first invoked, this photo album application displays any images that are currently stored in the album. By default, the photo album is empty when first installed. To upload a new photograph, select <span class="bold">Upload photo</span>. Enter a description of the photograph and the name of the image file, or browse to its directory location. Then, click <span class="bold">Upload photo</span>. 
                     </p>
                     <p>The contents of the photo album are displayed, along with a picture of the new photograph. Click the thumbnail image to view the full-size version of the photograph. When this photo album application displays the text <span class="bold">view image</span> instead of its thumbnail image, the image format that was uploaded was not recognized by Oracle Multimedia. Click <span class="bold">view image</span> to display the full-size image.
                     </p>
                     <p>You can now begin to load your photo album application with your favorite photographs.</p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="IMURG11563"></a><a id="IMURG11842"></a><a id="IMURG11562"></a><div class="props_rev_3"><a id="GUID-D07ABFB7-0A88-4CCC-9E46-8A85B1E0B3D2" name="GUID-D07ABFB7-0A88-4CCC-9E46-8A85B1E0B3D2"></a><h3 id="IMURG-GUID-D07ABFB7-0A88-4CCC-9E46-8A85B1E0B3D2" class="sect3"><span class="enumeration_section">3.3 </span>Description of the PL/SQL Photo Album Sample Application
               </h3>
               <div>
                  <p>The PL/SQL Photo Album application is implemented as a set of PL/SQL procedures and functions, organized in a single PL/SQL package.</p>
                  <p>These PL/SQL procedures and functions combine several database features to create the application. Oracle Multimedia is used to store and process image data. It is also used to extract metadata from images and embed new metadata into images. The XMLType feature is used to store and process the XML metadata documents. Oracle Text indexes are used to accelerate two kinds of metadata searches. Finally, the PL/SQL Web Toolkit is used to create HTML pages and deliver media content.</p>
                  <p>The user interface for the PL/SQL Photo Album application consists of a set of Web pages. You can use these Web pages to perform a set of tasks. The tasks and the Web pages are introduced in this topic and described in further detail in the following sections.</p>
                  <p>You can explore this photo album application using the navigation bar near the top of each Web task page. The leftmost entry of the navigation bar displays the name of the current Web page. On the right, there are links to other Web pages you can access from the current page. Each Web task page contains a link to the <span class="bold">View album</span> page, which is the home page for the application.
                  </p>
                  <div class="section">
                     <p class="subhead2">Pages in the PL/SQL Photo Album Sample Application</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p>The following topics, which are summarized here, describe each page in the PL/SQL Photo Album application:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-E6FA8523-413E-4737-8874-0430131007A1" title="You can use the View album page of the photo album application to browse the contents of a photo album and to access other photo album capabilities.">Browsing the Photo Album</a></p>
                           <p>Use the <span class="bold">View album</span> page to display thumbnail-size versions of all the images in the photo album and a description link positioned under each thumbnail image. When you select a thumbnail image, the full-size image is displayed. When you select the description link for an image, all the metadata for that image is displayed. The <span class="bold">View album</span> page is the home page for the application.
                           </p>
                        </li>
                        <li>
                           <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36" title="You can use the Upload photo page of the photo album application to add more content to a photo album.">Adding Images to the Photo Album</a></p>
                           <p>Use the <span class="bold">Upload photo</span> page to display a simple form to collect a description for a new image, and the directory path to the location of the image on the local computer. When you click the <span class="bold">Upload photo</span> button, the browser sends the image to the Web server and the image is stored in the database.
                           </p>
                        </li>
                        <li>
                           <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-09F9D8F8-BF81-4629-A38C-B7117C0B11F1" title="You can use the View album and Search album pages of the photo album application to search for content in a photo album.">Searching for Images by Keyword or Phrase</a></p>
                           <p>Use the <span class="bold">Search album</span> page to display a search album form to collect keywords or phrases to initiate full-text searches through all image metadata. The application queries the database for all images with metadata that contains the specified keywords or phrases. The search results are displayed as a set of thumbnail images. The search album form is also available from the <span class="bold">View album</span> page.
                           </p>
                        </li>
                        <li>
                           <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-4C50B58A-C37F-48FC-AB5C-677CE9462267" title="You can use the View entry page of the photo album application to display full-size images and their descriptions in a photo album.">Viewing Full-Size Images</a></p>
                           <p>Use the <span class="bold">View entry</span> page to display the full-size image of a specified photograph, including any description text that was entered for that image when it was uploaded.
                           </p>
                        </li>
                        <li>
                           <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-94411C18-4C28-47B4-93EE-051B184D23F6" title="You can use the View metadata page of the photo album application to display the metadata for images in a photo album.">Examining Image Metadata</a></p>
                           <p>Use the <span class="bold">View metadata</span> page to display all the metadata that was extracted from the image when it was uploaded. Up to four types of metadata can be displayed.
                           </p>
                        </li>
                        <li>
                           <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-BB242CCE-D27B-4B1E-9505-A561852C60DC" title="You can use the Write XMP metadata page of the photo album application to add or revise the XMP metadata for images in a photo album.">Writing New XMP Metadata to Images</a></p>
                           <p>Use the <span class="bold">Write XMP metadata</span> page to display a form to collect input for five metadata attributes. These attributes are formatted into an XML document that is embedded within the binary image. The new XMP metadata overwrites any existing XMP metadata.
                           </p>
                        </li>
                        <li>
                           <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-0705422A-8967-4DA9-B778-C942AB86EB90" title="You can use the Search metadata page of the photo album application to search for specific metadata for images in a photo album.">Searching for Images That Contain Specific Metadata Attributes</a></p>
                           <p>Use the <span class="bold">Search metadata</span> page to collect input and perform advanced metadata searches. You can specify the type of metadata to be searched. Optionally, you can also limit the search to a specific XML tag within the specified document. The search results are displayed as a set of thumbnail images.
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-D07ABFB7-0A88-4CCC-9E46-8A85B1E0B3D2__GUID-FBA9C2D8-5360-4DEB-87DA-7FB96F83CEE2">
                        <p class="notep1">See Also:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="../adxdb/query-and-update-XML.html#ADXDB0400" target="_blank"><span class="italic">Oracle XML DB Developer's Guide</span></a> for more information about querying and updating XML metadata
                              </p>
                           </li>
                           <li>
                              <p><a href="../ccapp/indexing-with-oracle-text.html#CCAPP0300" target="_blank"><span class="italic">Oracle Text Application Developer's Guide</span></a> for more information about text indexing
                              </p>
                           </li>
                           <li>
                              <p><a href="../adfns/web-applications.html#ADFNS015" target="_blank"><span class="italic">Oracle Database Advanced Application Developer's Guide</span></a> for more information about developing PL/SQL Web applications
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div><a id="IMURG11572"></a><a id="IMURG11573"></a><a id="IMURG11574"></a><a id="IMURG11575"></a><a id="IMURG11576"></a><a id="IMURG11571"></a><div class="props_rev_3"><a id="GUID-E6FA8523-413E-4737-8874-0430131007A1" name="GUID-E6FA8523-413E-4737-8874-0430131007A1"></a><h4 id="IMURG-GUID-E6FA8523-413E-4737-8874-0430131007A1" class="sect4"><span class="enumeration_section">3.3.1 </span>Browsing the Photo Album
                  </h4>
                  <div>
                     <p>You can use the <span class="bold">View album</span> page of the photo album application to browse the contents of a photo album and to access other photo album capabilities.
                     </p>
                     <div class="section">
                        <p>The home page for this photo album application, <span class="bold">View album</span>, displays the contents of the photo album as thumbnail images in four-column format. Each thumbnail image is also a link to the <span class="bold">View entry</span> page. When you click a thumbnail image link, the application displays the full-size image on a View entry page. Included under each thumbnail image on the <span class="bold">View album</span> page is the image description that was entered when the image was uploaded to the album. The description is also a link to the <span class="bold">View metadata</span> page where all the metadata for this photograph can be examined.
                        </p>
                        <p>Near the top of the <span class="bold">View album</span> page, there is a text entry field (in the shape of a rectangular box) that accepts user input for a full-text search through all the photo album metadata. The <span class="bold">Search</span> button to the right of the text field initiates the search. The search results are displayed on the <span class="bold">Search album</span> page.
                        </p>
                        <p>At the top of the <span class="bold">View album</span> page, there is a navigation bar, which includes links to other photo album pages. From the <span class="bold">View album</span> page, you can navigate to the <span class="bold">Search metadata</span> page or the <span class="bold">Upload photo</span> page.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-E6FA8523-413E-4737-8874-0430131007A1__CIHHBGEH">Figure 3-1</a> shows the <span class="bold">View album</span> page for an album that contains several images.
                        </p>
                        <div class="figure" id="GUID-E6FA8523-413E-4737-8874-0430131007A1__CIHHBGEH">
                           <p class="titleinfigure">Figure 3-1 View album Page with Uploaded Images</p><img src="img/view_album.gif" alt="Description of Figure 3-1 follows" title="Description of Figure 3-1 follows" longdesc="img_text/view_album.html"><br><a href="img_text/view_album.html">Description of "Figure 3-1 View album Page with Uploaded Images"</a></div>
                        <!-- class="figure" -->
                        <p>The PL/SQL procedures <code class="codeph">view_album</code>, <code class="codeph">print_album</code>, <code class="codeph">print_image_link</code>, and <code class="codeph">deliver_media</code> are the primary application components that implement the <span class="bold">View album</span> page. The <code class="codeph">view_album</code> procedure is a public procedure that takes a single optional argument. By default, the argument has a <code class="codeph">NULL</code> value. Or, it can have the value of the string entered in the text entry field on the <span class="bold">Search album</span> page. When the search argument is <code class="codeph">NULL</code>, the SELECT statement retrieves the <code class="codeph">id,</code><code class="codeph">description</code>, and <code class="codeph">thumb</code> columns for all entries in the <code class="codeph">photos</code> table. When the search string is not <code class="codeph">NULL</code>, the SELECT statement uses the CONTAINS operator to restrict the result set to only images with metadata that matches the search string.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-E6FA8523-413E-4737-8874-0430131007A1__CHDHCGGA">Example 3-1</a> contains some relevant lines of code in the <code class="codeph">view_album</code> procedure.
                        </p>
                        <p>The SELECT statement is bound to the cursor variable <code class="codeph">album_cur</code> and passed to the procedure <code class="codeph">print_album</code>, which creates the HTML output.
                        </p>
                        <p>The <code class="codeph">print_album</code> procedure uses the HTP and HTF packages from the PL/SQL Web Toolkit to create the HTML tags that format the output into a four-column table. Each cell in the table contains two links or anchor tags. The first link is to the <span class="bold">View entry</span> page, which displays the full-size version of the image. This anchor is implemented by PHOTO_ALBUM.VIEW_ENTRY, and passes <code class="codeph">entry_id</code> as a query string input argument. If the thumbnail image has a nonzero length, then procedure <code class="codeph">print_image_link</code> is called to create an HTML <code class="codeph">&lt;img&gt;</code> tag that is the content (the thumbnail image) of the anchor link. The string <code class="codeph">thumb</code> and the <code class="codeph">entry_id</code> are passed to procedure <code class="codeph">print_image_link</code>, along with the image description, and the height and width of the thumbnail image. These values are used to create the <code class="codeph">&lt;img&gt;</code> tag. 
                        </p>
                        <p>If an image is in a format that Oracle Multimedia does not support, the application cannot create a thumbnail version of the image. In this case, the content of the anchor link is the text <span class="bold">view image</span>. 
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-E6FA8523-413E-4737-8874-0430131007A1__CHDHACIA">Example 3-2</a> contains some relevant lines of code in the <code class="codeph">print_album</code> procedure.
                        </p>
                        <p>The procedure <code class="codeph">print_image_link</code> uses the <code class="codeph">height</code> and <code class="codeph">width</code> arguments to populate the <code class="codeph">height</code> and <code class="codeph">width</code> attributes of the <code class="codeph">&lt;img&gt;</code> tag. The <code class="codeph">description</code> argument is used to create text for the <code class="codeph">alt</code> attribute. If the <code class="codeph">description</code> argument is empty, a default string is constructed. Finally, the <code class="codeph">src</code> attribute is set to the URL PHOTO_ALBUM.DELIVER_MEDIA with two query string arguments, <code class="codeph">media</code> and <code class="codeph">entry_id</code>. The <code class="codeph">media</code> argument controls whether the thumbnail or full-size version of the image is delivered. The <code class="codeph">entry_id</code> argument identifies the image to be delivered. 
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-E6FA8523-413E-4737-8874-0430131007A1__CHDGCDEH">Example 3-3</a> contains some relevant lines of code in the <code class="codeph">print_image_link</code> procedure.
                        </p>
                        <p>The procedure <code class="codeph">deliver_media</code> fetches the image content from the database.  The <code class="codeph">If-Modified-Since</code> HTTP request header is compared to the last modification time of the image. If the image has not been modified, a response is sent that the browser can display the image from its cache. Otherwise, the image MIME type and last modified time are sent to the Web server, along with the image content.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-E6FA8523-413E-4737-8874-0430131007A1__CHDICAEI">Example 3-4</a> contains some relevant lines of code in the <code class="codeph">deliver_media</code> procedure.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-E6FA8523-413E-4737-8874-0430131007A1__CHDHCGGA">
                        <p class="titleinexample">Example 3-1 Procedure view_album</p><pre class="oac_no_warn" dir="ltr">   --
   -- no search criteria so fetch all entries
   --
   IF search IS NULL THEN
     OPEN album_cur FOR
       SELECT id, description, thumb
       FROM photos
       ORDER BY id;
     print_album( album_cur, 'The photo album is empty.' );
     CLOSE album_cur;
   ELSE
   --    -- use the full-text index to select entries matching the search criteria
   --
     OPEN album_cur FOR
       SELECT id, description, thumb
       FROM photos
       WHERE CONTAINS( description, trim(search) ) &gt; 0
       ORDER BY id;
     print_album( album_cur, 'No photos were found.' );
     CLOSE album_cur;
   END IF; 
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-E6FA8523-413E-4737-8874-0430131007A1__CHDHACIA">
                        <p class="titleinexample">Example 3-2 Procedure print_album</p><pre class="oac_no_warn" dir="ltr">       -- escape the description text
       sc_description := htf.escape_sc( entry.description );
 
       --
       -- Display the thumbnail image as an anchor tag which can be used
       -- to display the full-size image. If the image format is not
       -- supported by Oracle Multimedia, then a thumbnail would not have been
       -- produced when the image was uploaded, so use the text '[view
       -- image]' instead of the thumbnail.
       --
 
       htp.print( '&lt;td headers="c' || colIdx || '" align="center" &gt;
                   &lt;a href="PHOTO_ALBUM.VIEW_ENTRY?entry_id=' ||
                   entry.id || '"&gt;' );
       IF entry.thumb.contentLength &gt; 0
       THEN
           print_image_link( 'thumb', entry.id, sc_description,
                             entry.thumb.height, entry.thumb.width );
       ELSE
           htp.prn( '[view image]' );
       END IF;
       htp.print( '&lt;/a&gt;' );
 
       -- Create link to the metadata
       htp.prn('&lt;br&gt;');
       htp.anchor( curl=&gt;'PHOTO_ALBUM.VIEW_METADATA?entry_id=' || entry.id,
                   ctext=&gt;sc_description );
       htp.prn('&lt;/td&gt;');
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-E6FA8523-413E-4737-8874-0430131007A1__CHDGCDEH">
                        <p class="titleinexample">Example 3-3 Procedure print_image_link</p><pre class="oac_no_warn" dir="ltr"> -- add height and width to tag if non zero
 IF height &gt; 0 AND width &gt; 0 THEN
   attributes := attributes || ' height=' || height || ' width=' || width;
 END IF;
 
 -- create an alt text if none given
 IF alt IS NULL THEN
   IF type = 'thumb' THEN
     alt2 := 'thumb-nail image ';
   ELSE
     alt2 := 'full-size image ';
   END IF;
   alt2 := alt2 || 'for album entry ' || entry_id;
 ELSE
   alt2 := alt;
 END IF;
 
 htp.img( curl=&gt;'PHOTO_ALBUM.DELIVER_MEDIA?media=' || type ||
                  ampersand || 'entry_id=' || entry_id,
            calt=&gt;alt2, cattributes=&gt;attributes ); 
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-E6FA8523-413E-4737-8874-0430131007A1__CHDICAEI">
                        <p class="titleinexample">Example 3-4 Procedure deliver_media</p><pre class="oac_no_warn" dir="ltr">   --
   -- Fetch the thumbnail or full-size image from the database.
   --
   IF media = 'thumb'
   THEN
       SELECT thumb INTO local_image FROM photos WHERE id = entry_id;
   ELSE
       SELECT image INTO local_image FROM photos WHERE id = entry_id;
   END IF;
 
   --
   -- Check update time if browser sent If-Modified-Since header
   --
   IF ordplsgwyutil.cache_is_valid( local_image.getUpdateTime() )
   THEN
     owa_util.status_line( ordplsgwyutil.http_status_not_modified );
     RETURN;
   END IF;
 
   --
   -- Set the MIME type and deliver the image to the browser.
   --
   owa_util.mime_header( local_image.mimeType, FALSE );
   ordplsgwyutil.set_last_modified( local_image.getUpdateTime() );
   owa_util.http_header_close();
 
   IF owa_util.get_cgi_env( 'REQUEST_METHOD' ) &lt;&gt; 'HEAD' THEN
     wpg_docload.download_file( local_image.source.localData );
   END IF; </pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="oracle-multimedia-photo-album-sample-application.html#GUID-0E12A997-540D-44B4-BC2B-12A978857EB9" title="This topic describes the setup process for the Oracle Multimedia PL/SQL Web Toolkit Photo Album sample application.">Overview of the PL/SQL Photo Album Sample Application</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="IMURG11578"></a><a id="IMURG11579"></a><a id="IMURG11580"></a><a id="IMURG11577"></a><div class="props_rev_3"><a id="GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36" name="GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36"></a><h4 id="IMURG-GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36" class="sect4"><span class="enumeration_section">3.3.2 </span>Adding Images to the Photo Album
                  </h4>
                  <div>
                     <p>You can use the <span class="bold">Upload photo</span> page of the photo album application to add more content to a photo album.
                     </p>
                     <div class="section">
                        <p>The <span class="bold">Upload photo</span> page is used to add new images to the photo album. The page displays a form with two text entry fields. In the <span class="bold">Description:</span> field, you can optionally enter a word or short phrase that describes the image. In the <span class="bold">File name:</span> field, enter the name of the image file or click <span class="bold">Browse...</span> to locate the image file to be uploaded. The <span class="bold">Upload photo</span> button under the <span class="bold">File name:</span> field starts the upload operation. When the image is successfully uploaded, the <span class="bold">View album</span> page appears. From that page, you can display the contents of the photo album.
                        </p>
                        <p>At the top of the <span class="bold">Upload photo</span> page, there is a navigation bar, which includes links to other photo album pages. From the <span class="bold">Upload photo </span>page, you can return to the <span class="bold">View album</span> page or select the <span class="bold">Search metadata</span> page.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36__CIHHHGFD">Figure 3-2</a> shows an <span class="bold">Upload photo</span> page with all the entry fields completed.
                        </p>
                        <div class="figure" id="GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36__CIHHHGFD">
                           <p class="titleinfigure">Figure 3-2 Completed Upload photo Page</p><img src="img/upload_photo.gif" alt="Description of Figure 3-2 follows" title="Description of Figure 3-2 follows" longdesc="img_text/upload_photo.html"><br><a href="img_text/upload_photo.html">Description of "Figure 3-2 Completed Upload photo Page"</a></div>
                        <!-- class="figure" -->
                        <p>The PL/SQL procedures <code class="codeph">view_upload_form</code>, <code class="codeph">print_upload_form</code>, and <code class="codeph">insert_new_photo</code> are the primary application components that implement the <span class="bold">Upload photo</span> page. Together, view_upload_form and print_upload_form create the HTML page that is displayed. The page contains a form tag, a portion of which is shown in <a href="oracle-multimedia-photo-album-sample-application.html#GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36__CHDHEIFI">Example 3-5</a>. The target of the form is PHOTO_ALBUM.INSERT_NEW_PHOTO.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36__CHDHEIFI">Example 3-5</a> contains some relevant lines of code in the <code class="codeph">print_upload_form</code> procedure.
                        </p>
                        <p>Procedure <code class="codeph">insert_new_photo</code> receives the form, processes the inputs, and stores the new image in the database.
                        </p>
                        <p>First, the <code class="codeph">insert_new_photo</code> procedure checks that a file name was entered into the upload form. The image size, MIME type, and BLOB locator for the image content are selected from the document upload table, and the size is checked to ensure that the image is not of zero length. If the <code class="codeph">description</code> field is blank, a description is created using the file name. 
                        </p>
                        <p>Next, the ORDSYS.ORDIMAGE( ) constructor is called to initialize the <code class="codeph">thumb</code> and <code class="codeph">image</code> ORDImage object type columns with an empty BLOB for the new row to be stored in the <code class="codeph">photos</code> table. A SQL SELECT FOR UPDATE statement fetches the newly initialized thumbnail image and full-size image object type columns for updating. A DBMS_LOB.COPY operation loads the image from the upload table into the <code class="codeph">image</code> ORDImage object type column.
                        </p>
                        <p>The ORDImage object method setProperties( ) reads the image and sets the image object attributes. Because some browsers cannot display some image formats inline, in this sample application, BMP formatted images are converted to a JPEG image format (for images with more than 8 bits of color), or a GIFF image format (for images with less than 9 bits of color) by calling the <code class="codeph">get_preferred_format</code> function. A processCopy( ) operation is performed on the full-size image to create the thumbnail image.
                        </p>
                        <p>The ORDImage object getMetadata( ) method is called to extract all supported types of image metadata. The root element of each XML document in the return vector is examined to discover the metadata type so that the documents can be stored in the correct columns.</p>
                        <p>Then, a SQL UPDATE statement stores the full-size image, the thumbnail image, and the image metadata documents in the database. Procedure <code class="codeph">sync_indexes</code> is called to force an update of the text indexes. Finally, the form data input is deleted from the document upload table. A success message is returned to the browser, and the browser is redirected to the <span class="bold">View album</span> page.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36__CHDHDFAG">Example 3-6</a> contains some relevant lines of code in the <code class="codeph">insert_new_photo</code> procedure.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36__CHDHEIFI">
                        <p class="titleinexample">Example 3-5 Procedure print_upload_form</p><pre class="oac_no_warn" dir="ltr">&lt;form action="PHOTO_ALBUM.INSERT_NEW_PHOTO"
method="post"
enctype="multipart/form-data"&gt;
database. 
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-492D2DC3-29D7-4496-AD70-9879D3A44E36__CHDHDFAG">
                        <p class="titleinexample">Example 3-6 Procedure insert_new_photo</p><pre class="oac_no_warn" dir="ltr">   --
   -- Make sure a file name has been provided. If not, display an error
   -- message, then re-display the form.
   --
   IF new_photo IS NULL OR LENGTH( new_photo ) = 0
   THEN
       print_page_header;
       print_error( 'Please supply a file name.' );
       print_upload_form;
       print_page_trailer( TRUE );
       return;
   END IF;
 
   --
   -- Get the length, MIME type and the BLOB of the new photo from the
   -- upload table.
   --
   SELECT doc_size,
          mime_type,
          blob_content
   INTO   upload_size,
          upload_mime_type,
          upload_blob
   FROM photos_upload
   WHERE name = new_photo;
 
   --
   -- Make sure we have a valid file. 
   --
   IF upload_size = 0
   THEN
       print_page_header;
       print_heading( 'Error message' );
       htp.print( '&lt;hr size="-1"&gt;&lt;p&gt;Please supply a valid image file.&lt;/p&gt;' );
       print_upload_form;
       print_page_trailer( TRUE );
       return;
   END IF;
 
   --
   -- If the description is blank, then use the file name.
   --
   IF c_description IS NULL
   THEN
       c_description := new_photo;
       pos := INSTR( c_description, '/', -1 );
       IF pos &gt; 0
       THEN
           c_description := SUBSTR( c_description, pos + 1 );
       END IF;
       c_description := SUBSTR( 'Image from file: ' ||
                        c_description || '.', 1, 40 );
   END IF;
   --
   -- Insert a new row into the table, returning the newly allocated sequence
   -- number.
   INSERT INTO photos ( id, description, metaExif, metaIPTC, metaXMP,
                        image, thumb )
   VALUES ( photos_sequence.nextval, c_description, NULL, NULL, NULL,
                ORDSYS.ORDIMAGE(), ORDSYS.ORDIMAGE() )
   RETURN id
   INTO new_id;
 
   --
   -- Fetch the newly initialized full-size and thumbnail image objects.
   --
   SELECT image,
          thumb
   INTO new_image,
        new_thumb
   FROM photos
   WHERE id = new_id
   FOR UPDATE;
 
   --
   -- Load the photo from the upload table into the image object.
   --
   DBMS_LOB.COPY( new_image.source.localData, upload_blob, upload_size );
   new_image.setLocal(); 
   --
   -- Set the properties. If the image format is not recognized, then
   -- the exception handler will set the MIME type and length from the
   -- upload table.
   --
   BEGIN
       new_image.setProperties();
   EXCEPTION
       WHEN OTHERS THEN
            new_image.contentLength := upload_size;
            new_image.mimeType := upload_mime_type;
   END;
 
   --
   -- Some image formats are supported by Oracle Multimedia but cannot be 
   -- displayed inline by a browser. The BMP format is one example.
   -- Convert the image to a GIF or JPEG based on number of colors in the
   -- image.
   --
   IF new_image.contentFormat IS NOT NULL AND
      ( new_image.mimeType = 'image/bmp' OR
        new_image.mimeType = 'image/x-bmp' )
   THEN
       BEGIN
           new_image.process(
                        'fileFormat=' ||
                        get_preferred_format( new_image.contentFormat ) ); 
       EXCEPTION
           WHEN OTHERS THEN
               NULL;
       END;
   END IF;
 
   --
   -- Try to copy the full-size image and process it to create the thumbnail.
   -- This may not be possible if the image format is not recognized.
   --
   BEGIN
       new_image.processCopy( thumb_scale, new_thumb );
   EXCEPTION
       WHEN OTHERS THEN
           new_thumb.deleteContent();
           new_thumb.contentLength := 0;
   END;
  --
   -- fetch the metadata and sort the results
   --
   BEGIN
     metav := new_image.getMetadata( 'ALL' );
     FOR i IN 1..metav.count() LOOP
       meta_root := metav(i).getRootElement();
       CASE meta_root
         WHEN 'ordImageAttributes' THEN xmlORD := metav(i);
         WHEN 'xmpMetadata'  THEN xmlXMP  := metav(i);
         WHEN 'iptcMetadata' THEN xmlIPTC := metav(i);
         WHEN 'exifMetadata' THEN xmlEXIF := metav(i);
         ELSE NULL;
       END CASE;
     END LOOP;
   EXCEPTION
     WHEN OTHERS THEN
       NULL;
   END;
 
   --
   -- Update the full-size and thumbnail images in the database.
   -- Update metadata columns 
   --
   UPDATE photos
   SET image = new_image,
       thumb = new_thumb,
       metaORDImage = xmlORD,
       metaEXIF = xmlEXIF,
       metaIPTC = xmlIPTC,
       metaXMP = xmlXMP
   WHERE id = new_id;
 
   --    -- update the text indexes
   --    sync_indexes;
 
   --
   -- Delete the row from the upload table.
   --
   DELETE FROM photos_upload WHERE name = new_photo;
   COMMIT;
 
   --
   -- Redirect browser to display full album.
   --    print_page_header(
       '&lt;meta http-equiv="refresh" content="2;url=PHOTO_ALBUM.VIEW_ALBUM"&gt;' );
   print_heading( 'Photo successfully uploaded into photo album' );</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="IMURG11582"></a><a id="IMURG11581"></a><div class="props_rev_3"><a id="GUID-09F9D8F8-BF81-4629-A38C-B7117C0B11F1" name="GUID-09F9D8F8-BF81-4629-A38C-B7117C0B11F1"></a><h4 id="IMURG-GUID-09F9D8F8-BF81-4629-A38C-B7117C0B11F1" class="sect4"><span class="enumeration_section">3.3.3 </span>Searching for Images by Keyword or Phrase 
                  </h4>
                  <div>
                     <p>You can use the <span class="bold">View album</span> and <span class="bold">Search album</span> pages of the photo album application to search for content in a photo album.
                     </p>
                     <div class="section">
                        <p>You can use the <span class="bold">View album</span> and <span class="bold">Search album</span> pages to perform a keyword or phrase search of the metadata stored in the photo album. On either of these pages, enter the keyword or phrase in the <span class="bold">Full text search:</span> text entry field and click <span class="bold">Search</span>. This photo album application uses the <code class="codeph">CONTEXT</code> text index to locate images that have metadata containing the text you entered. If the search is successful, the thumbnail versions of the matching images are displayed in a four-column table. Select the thumbnail image to view the full-size version, or select the description link below the thumbnail image to view the metadata for the image. If the search fails, the message "No photos were found" is displayed.
                        </p>
                        <p>At the top of the <span class="bold">Search album</span> page, there is a navigation bar, which includes links to other photo album pages. From the <span class="bold">Search album</span> page, you can return to the <span class="bold">View album</span> page or select the <span class="bold">Search metadata</span> or <span class="bold">Upload photo</span> pages.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-09F9D8F8-BF81-4629-A38C-B7117C0B11F1__CIHFJDFB">Figure 3-3</a> shows a <span class="bold">Search album</span> page that contains the results of a successful search operation.
                        </p>
                        <div class="figure" id="GUID-09F9D8F8-BF81-4629-A38C-B7117C0B11F1__CIHFJDFB">
                           <p class="titleinfigure">Figure 3-3 Search album Page Showing Results</p><img src="img/search_album.gif" alt="Description of Figure 3-3 follows" title="Description of Figure 3-3 follows" longdesc="img_text/search_album.html"><br><a href="img_text/search_album.html">Description of "Figure 3-3 Search album Page Showing Results"</a></div>
                        <!-- class="figure" -->
                        <p>Full-text searching of the photo album is implemented by the <code class="codeph">view_album</code> procedure.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="oracle-multimedia-photo-album-sample-application.html#GUID-E6FA8523-413E-4737-8874-0430131007A1" title="You can use the View album page of the photo album application to browse the contents of a photo album and to access other photo album capabilities.">Browsing the Photo Album</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="IMURG11584"></a><a id="IMURG11585"></a><a id="IMURG11583"></a><div class="props_rev_3"><a id="GUID-4C50B58A-C37F-48FC-AB5C-677CE9462267" name="GUID-4C50B58A-C37F-48FC-AB5C-677CE9462267"></a><h4 id="IMURG-GUID-4C50B58A-C37F-48FC-AB5C-677CE9462267" class="sect4"><span class="enumeration_section">3.3.4 </span>Viewing Full-Size Images
                  </h4>
                  <div>
                     <p>You can use the <span class="bold">View entry</span> page of the photo album application to display full-size images and their descriptions in a photo album.
                     </p>
                     <div class="section">
                        <p>When you select a thumbnail image, the application directs you to the <span class="bold">View entry</span> page. This page displays the description of the image and the full-size version of the image.
                        </p>
                        <p>At the top of the <span class="bold">View entry</span> page, there is a navigation bar, which includes links to other photo album pages. From the <span class="bold">View entry</span> page, you can return to the <span class="bold">View album</span> page, or select any of the <span class="bold">View metadata</span>, <span class="bold">Write metadata</span>, <span class="bold">Search metadata</span>, or <span class="bold">Upload photo</span> pages.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-4C50B58A-C37F-48FC-AB5C-677CE9462267__CIHCJGJD">Figure 3-4</a> shows a <span class="bold">View entry</span> page that contains the description and the full-size version of an image.
                        </p>
                        <div class="figure" id="GUID-4C50B58A-C37F-48FC-AB5C-677CE9462267__CIHCJGJD">
                           <p class="titleinfigure">Figure 3-4 View entry Page with a Full-Size Image</p><img src="img/view_entry.gif" alt="Description of Figure 3-4 follows" title="Description of Figure 3-4 follows" longdesc="img_text/view_entry.html"><br><a href="img_text/view_entry.html">Description of "Figure 3-4 View entry Page with a Full-Size Image"</a></div>
                        <!-- class="figure" -->
                        <p>The PL/SQL procedures <code class="codeph">view_entry</code>, <code class="codeph">print_image_link</code>, and <code class="codeph">deliver_media</code> are the primary application components that implement the <span class="bold">View entry</span> page. The procedure <code class="codeph">view_entry</code> takes a single parameter, <code class="codeph">entry_id</code>, which uniquely locates the image in the <code class="codeph">photos</code> table. The description and image object are fetched from the <code class="codeph">photos</code> table. The procedure <code class="codeph">print_image_link</code> creates the HTML <code class="codeph">&lt;img&gt;</code> tag, and then calls procedure <code class="codeph">deliver_media</code> to fetch the image content.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-4C50B58A-C37F-48FC-AB5C-677CE9462267__CHDCGHCC">Example 3-7</a> contains some relevant lines of code in the <code class="codeph">view_entry</code> procedure.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-4C50B58A-C37F-48FC-AB5C-677CE9462267__CHDCGHCC">
                        <p class="titleinexample">Example 3-7 Procedure view_entry</p><pre class="oac_no_warn" dir="ltr">   --
   -- Fetch the row.
   --
   BEGIN
     SELECT htf.escape_sc(description), image
     INTO sc_description, photo
     FROM photos
     WHERE id = entry_id;
     EXCEPTION
     WHEN no_data_found THEN
       print_error( 'Image &lt;b&gt;' || htf.escape_sc(entry_id) ||
                    '&lt;/b&gt; was not found.&lt;/p&gt;' );
       print_page_trailer( TRUE );
       return;
   END;
 
   print_image_link( 'image', entry_id, sc_description,
                      photo.height, photo.width );</pre></div>
                     <!-- class="example" -->
                  </div>
                  <div>
                     <div class="relinfo">
                        <p><strong>Related Topics</strong></p>
                        <ul>
                           <li><a href="oracle-multimedia-photo-album-sample-application.html#GUID-E6FA8523-413E-4737-8874-0430131007A1" title="You can use the View album page of the photo album application to browse the contents of a photo album and to access other photo album capabilities.">Browsing the Photo Album</a></li>
                        </ul>
                     </div>
                  </div>
                  
               </div><a id="IMURG11587"></a><a id="IMURG11588"></a><a id="IMURG11589"></a><a id="IMURG11586"></a><div class="props_rev_3"><a id="GUID-94411C18-4C28-47B4-93EE-051B184D23F6" name="GUID-94411C18-4C28-47B4-93EE-051B184D23F6"></a><h4 id="IMURG-GUID-94411C18-4C28-47B4-93EE-051B184D23F6" class="sect4"><span class="enumeration_section">3.3.5 </span>Examining Image Metadata
                  </h4>
                  <div>
                     <p>You can use the <span class="bold">View metadata</span> page of the photo album application to display the metadata for images in a photo album.
                     </p>
                     <div class="section">
                        <p>You can use the <span class="bold">View metadata</span> page to examine all the metadata for a specific image. Typically, you access this page from the <span class="bold">View album</span> page by selecting the description link below a thumbnail image. You can also access this page by selecting the <span class="bold">View metadata</span> link from the navigation bar. The <span class="bold">View metadata</span> page displays the thumbnail version of the image. To the right of the thumbnail image, there is a list of the metadata documents for this image. Each entry in the list is a link that takes you to the metadata document on the <span class="bold">View metadata</span> page.
                        </p>
                        <p>At the top of the <span class="bold">View metadata</span> page, there is a navigation bar, which includes links to other photo album pages. From the <span class="bold">View metadata</span> page, you can return to the <span class="bold">View album</span> page, or select any of the <span class="bold">View entry</span>, <span class="bold">Write metadata</span>, <span class="bold">Search metadata</span>, or <span class="bold">Upload photo</span> pages.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-94411C18-4C28-47B4-93EE-051B184D23F6__CIHCFJBI">Figure 3-5</a> shows a <span class="bold">View metadata</span> page that contains two types of metadata (XMP and ORDIMAGE) for an image.
                        </p>
                        <div class="figure" id="GUID-94411C18-4C28-47B4-93EE-051B184D23F6__CIHCFJBI">
                           <p class="titleinfigure">Figure 3-5 View metadata Page with Metadata for an Uploaded Image</p><img src="img/view_metadata.gif" alt="Description of Figure 3-5 follows" title="Description of Figure 3-5 follows" longdesc="img_text/view_metadata.html"><br><a href="img_text/view_metadata.html">Description of "Figure 3-5 View metadata Page with Metadata for an Uploaded Image"</a></div>
                        <!-- class="figure" -->
                        <p>The PL/SQL procedures <code class="codeph">view_metadata</code> and <code class="codeph">print_metadata</code> are the primary application components that implement the <span class="bold">View metadata</span> page. The procedure <code class="codeph">view_metadata</code> is passed the argument <code class="codeph">entry_id</code>, which uniquely identifies the image in the <code class="codeph">photos</code> table. A SELECT statement retrieves all the <code class="codeph">XMLtype</code> metadata columns for the specified entry. If the metadata column is not <code class="codeph">NULL</code>, procedure <code class="codeph">print_metadata</code> is called to display the XML document inside an HTML <code class="codeph">&lt;pre&gt;</code> tag. 
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-94411C18-4C28-47B4-93EE-051B184D23F6__CHDBADEC">Example 3-8</a> contains some relevant lines of code in the <code class="codeph">view_metadata</code> procedure.
                        </p>
                        <p>The <code class="codeph">print_metadata</code> procedure accepts an XMLType document as an argument. It uses the getClobVal( ) method to access the document as a CLOB. The content of the CLOB is read in a loop and formatted in the HTML page using the <code class="codeph">htp.prints</code> procedure. The <code class="codeph">htp.prints</code> procedure escapes the '&lt;' and '&gt;' characters so that they are rendered properly by the Web browser. 
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-94411C18-4C28-47B4-93EE-051B184D23F6__CHDBEGHF">Example 3-9</a> contains some relevant lines of code in the <code class="codeph">print_metadata</code> procedure.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-94411C18-4C28-47B4-93EE-051B184D23F6__CHDBADEC">
                        <p class="titleinexample">Example 3-8 Procedure view_metadata</p><pre class="oac_no_warn" dir="ltr">   --
   -- Fetch the row.
   --
   SELECT metaOrdImage, metaEXIF, metaIPTC, metaXMP
   INTO   metaO, metaE, metaI, metaX
   FROM   photos
   WHERE  id = entry_id;
 
   -- display the EXIF metadata
   IF metaE IS NOT NULL THEN
     htp.print( '&lt;span class="bigBlue" id="exifMetadata"&gt;EXIF&lt;/span&gt;' );
     htp.print( '&lt;br&gt;&lt;pre&gt;' );
     print_metadata( metaE );      htp.print( '&lt;/pre&gt;' );
   END IF;
</pre></div>
                     <!-- class="example" -->
                     <div class="example" id="GUID-94411C18-4C28-47B4-93EE-051B184D23F6__CHDBEGHF">
                        <p class="titleinexample">Example 3-9 Procedure print_metadata</p><pre class="oac_no_warn" dir="ltr">   metaClob := meta.getClobVal();
   len := dbms_lob.getLength( metaClob );
   IF bufSize &gt; len THEN
     bufSize := len;
   END IF;
   WHILE len &gt; 0 LOOP
     dbms_lob.read( metaClob, bufSize, pos, buf );
     htp.prints( buf );
     pos := pos + bufSize;
     len := len - bufSize;
   END LOOP;</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="IMURG11591"></a><a id="IMURG11592"></a><a id="IMURG11590"></a><div class="props_rev_3"><a id="GUID-BB242CCE-D27B-4B1E-9505-A561852C60DC" name="GUID-BB242CCE-D27B-4B1E-9505-A561852C60DC"></a><h4 id="IMURG-GUID-BB242CCE-D27B-4B1E-9505-A561852C60DC" class="sect4"><span class="enumeration_section">3.3.6 </span>Writing New XMP Metadata to Images
                  </h4>
                  <div>
                     <p>You can use the <span class="bold">Write XMP metadata</span> page of the photo album application to add or revise the XMP metadata for images in a photo album.
                     </p>
                     <div class="section">
                        <p>You can use the <span class="bold">Write XMP metadata</span> page to write new or replace existing XMP metadata in an image. Oracle Multimedia provides support for writing XMP metadata only. You can access the <span class="bold">Write XMP metadata</span> page by selecting the <span class="bold">Write metadata</span> link in the navigation bar from either the <span class="bold">View entry</span> page or the <span class="bold">View metadata</span> page.
                        </p>
                        <p>The <span class="bold">Write XMP metadata</span> page displays the thumbnail version of the image to be modified. The page also displays an input form to collect metadata attributes in these five text entry fields:
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="bold">Title:</span> Specify a title for the photograph.
                              </p>
                           </li>
                           <li>
                              <p><span class="bold">Creator:</span> Enter the name of the person who took the photograph. This field is optional.
                              </p>
                           </li>
                           <li>
                              <p><span class="bold">Date:</span> Enter the date the photograph was taken. This field is optional.
                              </p>
                           </li>
                           <li>
                              <p><span class="bold">Description:</span>  Enter a description, such as the subject of the photograph. This field is optional.
                              </p>
                           </li>
                           <li>
                              <p><span class="bold">Copyright:</span>  Enter the month and year when the photograph was taken. This field is optional.
                              </p>
                           </li>
                        </ul>
                        <p>Click <span class="bold">Write it!</span> to send the form to the application and embed the metadata in XMP format in the image. 
                        </p>
                        <p>At the top of the <span class="bold">Write XMP metadata</span> page, there is a navigation bar, which includes links to other photo album pages. From the <span class="bold">Write XMP metadata</span> page, you can return to the <span class="bold">View album</span> page, or select any of the <span class="bold">View entry</span>, <span class="bold">View metadata</span>, <span class="bold">Search metadata</span>, or <span class="bold">Upload photo</span> pages.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-BB242CCE-D27B-4B1E-9505-A561852C60DC__CIHHIAHH">Figure 3-6</a> shows a <span class="bold">Write XMP metadata</span> page with completed entries for an image.
                        </p>
                        <div class="figure" id="GUID-BB242CCE-D27B-4B1E-9505-A561852C60DC__CIHHIAHH">
                           <p class="titleinfigure">Figure 3-6 Completed Write XMP metadata Page with XMP Metadata for an Uploaded Image</p><img src="img/write_metadata.gif" alt="Description of Figure 3-6 follows" title="Description of Figure 3-6 follows" longdesc="img_text/write_metadata.html"><br><a href="img_text/write_metadata.html">Description of "Figure 3-6 Completed Write XMP metadata Page with XMP Metadata for an Uploaded Image"</a></div>
                        <!-- class="figure" -->
                        <p>The PL/SQL procedure <code class="codeph">write_metadata</code> receives the form input fields from the browser. The procedure creates an XML document (as a string buffer) that is valid to the Oracle Multimedia XMP schema <code class="codeph">http://xmlns.oracle.com/ord/meta/xmp</code>. The string buffer is used to create an XMLType object.
                        </p>
                        <p>A SELECT FOR UPDATE statement retrieves the image to be modified. The Oracle Multimedia method putMetadata( ) is called to embed the XML document into the image. The modified image is stored back to the photos table. Finally, procedure <code class="codeph">sync_indexes</code> is called to update the text indexes. 
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-BB242CCE-D27B-4B1E-9505-A561852C60DC__CHDEDAAE">Example 3-10</a> contains some relevant lines of code in the <code class="codeph">write_metadata</code> procedure.
                        </p>
                        <p>The input data shown in <a href="oracle-multimedia-photo-album-sample-application.html#GUID-BB242CCE-D27B-4B1E-9505-A561852C60DC__CHDEDAAE">Example 3-10</a> would result in the storage of the following metadata in the image:
                        </p><pre class="oac_no_warn" dir="ltr">&lt;xmpMetadata xmlns="http://xmlns.oracle.com/ord/meta/xmp"
            xsi:schemaLocation="http://xmlns.oracle.com/ord/meta/xmp
            http://xmlns.oracle.com/ord/meta/xmp"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
 &lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
   &lt;rdf:Description about="" xmlns:dc="http://purl.org/dc/elements/1.1/"&gt;
     &lt;dc:title&gt;Story time&lt;/dc:title&gt;
     &lt;dc:creator&gt;father&lt;/dc:creator&gt;
     &lt;dc:date&gt;July 4, 2001&lt;/dc:date&gt;
     &lt;dc:description&gt;family reading&lt;/dc:description&gt;
     &lt;dc:copyright&gt;mother&lt;/dc:copyright&gt;
   &lt;/rdf:Description&gt;
 &lt;/rdf:RDF&gt;
&lt;/xmpMetadata&gt; </pre></div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-BB242CCE-D27B-4B1E-9505-A561852C60DC__CHDEDAAE">
                        <p class="titleinexample">Example 3-10 Procedure write_metadata</p><pre class="oac_no_warn" dir="ltr">   -- Create the XMP packet it must be schema valid
   -- to "http://xmlns.oracle.com/ord/meta/xmp"
   -- and contain an &lt;RDF&gt; element. This example uses
   -- the Dublin Core schema as implemented by Adobe XMP
   buf := '&lt;xmpMetadata xmlns="http://xmlns.oracle.com/ord/meta/xmp"
            xsi:schemaLocation="http://xmlns.oracle.com/ord/meta/xmp
            http://xmlns.oracle.com/ord/meta/xmp"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" &gt;
     &lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
     &lt;rdf:Description about="" xmlns:dc="http://purl.org/dc/elements/1.1/"&gt;
     &lt;dc:title&gt;' || htf.escape_sc(title) || '&lt;/dc:title&gt;';

   IF c_creator IS NOT NULL THEN
     buf := buf || '&lt;dc:creator&gt;' || htf.escape_sc(c_creator)
                || '&lt;/dc:creator&gt;';
   END IF;
   IF c_date IS NOT NULL THEN
     buf := buf || '&lt;dc:date&gt;' || htf.escape_sc(c_date)
                || '&lt;/dc:date&gt;';
   END IF;
   IF c_description IS NOT NULL THEN
     buf := buf || '&lt;dc:description&gt;' || htf.escape_sc(c_description)
                || '&lt;/dc:description&gt;';
   END IF;
   IF c_copyright IS NOT NULL THEN
     buf := buf || '&lt;dc:copyright&gt;' || htf.escape_sc(c_copyright)
                || '&lt;/dc:copyright&gt;';
   END IF;
   buf := buf || '
     &lt;/rdf:Description&gt;
     &lt;/rdf:RDF&gt;
     &lt;/xmpMetadata&gt;';
 
   xmp := XMLType.createXML(buf, 'http://xmlns.oracle.com/ord/meta/xmp'); 

   --    -- select image for update
   -- description is selected to force update of CTX index
   --
   SELECT image, description
   INTO img, des
   FROM photos
   WHERE id = entry_id
   FOR UPDATE;
 
   --
   -- write the metadata
   --
   img.putMetadata( xmp, 'XMP' );
 
   --
   -- save updated image and new metadata to table
   -- description updated to force update of CTX index
   --
   UPDATE photos
   SET image = img,
       metaXMP = xmp,
       description = des
   WHERE id = entry_id;
 
   -- update the text indexes
   sync_indexes;
</pre></div>
                     <!-- class="example" -->
                  </div>
               </div><a id="IMURG11594"></a><a id="IMURG11595"></a><a id="IMURG11593"></a><div class="props_rev_3"><a id="GUID-0705422A-8967-4DA9-B778-C942AB86EB90" name="GUID-0705422A-8967-4DA9-B778-C942AB86EB90"></a><h4 id="IMURG-GUID-0705422A-8967-4DA9-B778-C942AB86EB90" class="sect4"><span class="enumeration_section">3.3.7 </span>Searching for Images That Contain Specific Metadata Attributes
                  </h4>
                  <div>
                     <p>You can use the <span class="bold">Search metadata</span> page of the photo album application to search for specific metadata for images in a photo album.
                     </p>
                     <div class="section">
                        <p>You can use the <span class="bold">Search metadata</span> page to search a specific metadata type and to limit your search to a specific tag within a metadata document. You can access the <span class="bold">Search metadata</span> page by selecting the <span class="bold">Search metadata</span> link in the navigation bar of any photo album application Web page.
                        </p>
                        <p>The <span class="bold">Search metadata</span> page displays a form with four fields to define how the search is to be performed. Use the menu in the <span class="bold">Search in metadata:</span> field to select the type of metadata (<span class="bold">EXIF</span>, <span class="bold">IPTC</span>, or <span class="bold">XMP</span>) to be searched. When this field is changed, the fields <span class="bold">Search in tag:</span> and <span class="bold">Search method:</span> are initialized with values that are appropriate to the type of metadata search.
                        </p>
                        <p>Use the drop-down list in the <span class="bold">Search in tag:</span>  field to limit the search to a specific XML element within a metadata document. The list is populated with element names that are appropriate for the selected metadata type. When the value <span class="bold">--Any tag--</span> is showing, the search looks at all elements within the document type. When the <span class="bold">XMP</span> metadata type is selected, searches are limited to Description elements within the parent RDF element. If the metadata document is properly constructed, selecting <span class="bold">RDF/Description</span> in this field searches all relevant metadata within XMP documents.
                        </p>
                        <p>In the <span class="bold">Search method:</span> field, select <span class="bold">Contains</span> to specify a search where an element contains the search string. Select <span class="bold">Equals</span> to specify a search where element values are matched exactly to the search string. For searches in XMP metadata, only the <span class="bold">Contains</span> search method is available. 
                        </p>
                        <p>Finally, enter a keyword or phrase in the <span class="bold">Search string:</span> field and click <span class="bold">Search</span>. If the search is successful, the thumbnail versions of the matching images are displayed in a four-column table. Select the thumbnail image to view the full-size version of an image. Or, select the description link below the thumbnail image to view the metadata for the image. If the search fails, the message "No photos matched the search criteria." is displayed. 
                        </p>
                        <p>At the top of the <span class="bold">Search metadata</span> page, there is a navigation bar, which includes links to other photo album pages. From the <span class="bold">Search metadata</span> page, you can return to the <span class="bold">View album</span> page or select the <span class="bold">Upload photo</span> page.
                        </p>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-0705422A-8967-4DA9-B778-C942AB86EB90__CIHGBAIG">Figure 3-7</a> shows a <span class="bold">Search metadata</span> page that contains sample search criteria and results from a successful search operation.
                        </p>
                        <div class="figure" id="GUID-0705422A-8967-4DA9-B778-C942AB86EB90__CIHGBAIG">
                           <p class="titleinfigure">Figure 3-7 Completed Search metadata Page for an Uploaded Image</p><img src="img/search_metadata.gif" alt="Description of Figure 3-7 follows" title="Description of Figure 3-7 follows" longdesc="img_text/search_metadata.html"><br><a href="img_text/search_metadata.html">Description of "Figure 3-7 Completed Search metadata Page for an Uploaded Image"</a></div>
                        <!-- class="figure" -->
                        <p>The PL/SQL procedure <code class="codeph">search_metadata</code> receives the form input fields from the Web browser. The search parameters are used to build a query to find images that contain the desired metadata. The search is accomplished using the SQL function XMLExists. The XMLExists function is used to search an XML document for content that matches a given XQuery expression. The function returns <code class="codeph">TRUE</code> if the document matched the search, and <code class="codeph">FALSE</code> otherwise.
                        </p>
                        <p>For example, assume that the <code class="codeph">search_metadata</code> procedure receives input that specifies to search the <code class="codeph">caption</code> tag in IPTC metadata for an exact match of the word "farm". The query to accomplish this search is as follows:
                        </p><pre class="oac_no_warn" dir="ltr"> SELECT id, description, thumb
 FROM photos
 WHERE xmlexists('declare default element namespace ' ||
                 ' "http://xmlns.oracle.com/ord/meta/iptc"; $x' ||
                 '/iptcMetadata[//caption="farm"]' passing metaIptc as "x");
</pre><p>The XPath component of the XQuery expression,  <code class="codeph">'/iptcMetadata[//caption="farm"]'</code>, specifies a search for all <code class="codeph">&lt;caption&gt;</code> elements under the root element <code class="codeph">&lt;iptcMetadata&gt;</code> where the <code class="codeph">&lt;caption&gt;</code> content is <code class="codeph">"farm"</code>.
                        </p>
                        <div class="infoboxnotealso" id="GUID-0705422A-8967-4DA9-B778-C942AB86EB90__GUID-0C599E46-90C3-4C41-A83F-F27E069F9308">
                           <p class="notep1">See Also:</p>
                           <p><a href="../adxdb/xquery-and-XML-DB.html#ADXDB4238" target="_blank"><span class="italic">Oracle XML DB Developer's Guide</span></a> for more information about the XMLExists function
                           </p>
                        </div>
                        <p><a href="oracle-multimedia-photo-album-sample-application.html#GUID-0705422A-8967-4DA9-B778-C942AB86EB90__CHDGDFCD">Example 3-11</a> contains some relevant lines of code in the <code class="codeph">search_metadata</code> procedure.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <div class="example" id="GUID-0705422A-8967-4DA9-B778-C942AB86EB90__CHDGDFCD">
                        <p class="titleinexample">Example 3-11 Procedure search_metadata</p><pre class="oac_no_warn" dir="ltr">    -- Set up search variables for EXIF documents.
    IF mtype = 'exif' THEN
      IF op = 'equals' THEN
        xpath  := '/exifMetadata[//' || tag || '="' || c_search || '"]';
      ELSE  -- default to contains
        xpath  := '/exifMetadata//' || tag ||
                  '[contains(., "' || c_search || '")]';
      END IF;
 
      xquery := 'declare default element namespace ' ||
                ' "http://xmlns.oracle.com/ord/meta/exif"; $x' || xpath;
 
      OPEN album_cur FOR
        SELECT id, description, thumb
        FROM photos
        WHERE xmlexists(xquery passing metaExif as "x");
 
    -- Set up search variables for IPTC documents.
    ELSIF mtype = 'iptc' THEN
      IF op = 'equals' THEN
        xpath  := '/iptcMetadata[//' || tag || '="' || c_search || '"]';
      ELSE  -- default to contains
        xpath  := '/iptcMetadata//' || tag ||
                  '[contains(., "' || c_search || '")]';
      END IF;
 
      xquery := 'declare default element namespace ' ||
            ' "http://xmlns.oracle.com/ord/meta/iptc"; $x' || xpath;
 
      OPEN album_cur FOR
        SELECT id, description, thumb
        FROM photos
        WHERE xmlexists(xquery passing metaIptc as "x");
 
    -- Set up search variables for XMP documents.
    ELSIF mtype = 'xmp' THEN
      -- default to contains
      xpath  := '//rdf:Description//*[contains(., "'
                || c_search || '")]';
 
      -- Add rdf namespace prefix.
      xquery := 'declare namespace rdf = ' ||
             ' "http://www.w3.org/1999/02/22-rdf-syntax-ns#"; ' ||
             'declare default element namespace ' ||
             ' "http://xmlns.oracle.com/ord/meta/xmp"; $x' || xpath;
 
      OPEN album_cur FOR
        SELECT id, description, thumb
        FROM photos
        WHERE xmlexists(xquery passing metaXMP as "x");
 
    ELSE
      errorMsg := 'Search domain is invalid: ' || htf.escape_sc(mtype);
    END IF;
 
    print_search_form( mtype, tag, op, c_search );
    htp.print('&lt;hr size="-1"&gt;');
    print_album( album_cur, 'No photos matched the search criteria.' );</pre></div>
                     <!-- class="example" -->
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>