<!DOCTYPE html
  SYSTEM "about:legacy-compat">

<!-- saved from url=(0023)https://docs.oracle.com -->

<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Managing Oracle Streams Replication</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Replication Administrator’s Guide ">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Replication Administrator’s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.1.1">
      <link rel="alternate" href="streams-replication-administrators-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-01-24T23:25:23-08:00">
      
      <meta name="dcterms.dateCopyrighted" content="2003, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E83780-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
      <meta name="dcterms.release" content="Release 18">
      <link rel="prev" href="administering-oracle-streams.html" title="Previous" type="text/html">
      <link rel="next" href="comparing-and-converging-data.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Streams Replication Administrator's Guide">
    <meta name="dcterms.isVersionOf" content="STREP">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="administering-oracle-streams.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="comparing-and-converging-data.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Replication Administrator’s Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="administering-oracle-streams.html" property="item" typeof="WebPage"><span property="name">    Administering Oracle Streams Replication </span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem"> Managing Oracle Streams Replication</li>
            </ol>
            <a id="GUID-4F2BD66D-0B2B-4FC0-9A99-DDEB8B8B7C54" name="GUID-4F2BD66D-0B2B-4FC0-9A99-DDEB8B8B7C54"></a><a id="STREP013"></a>
            
            <h2 id="STREP-GUID-4F2BD66D-0B2B-4FC0-9A99-DDEB8B8B7C54" class="sect2"><span class="enumeration_chapter">12 </span> Managing Oracle Streams Replication
            </h2>
         </header>
         <div class="ind">
            <div>
               <p><a id="d52130e100" class="indexterm-anchor"></a><a id="d52130e106" class="indexterm-anchor"></a><a id="d52130e112" class="indexterm-anchor"></a>This chapter contains instructions for managing an Oracle Streams replication environment.
               </p>
               <p>This chapter contains these topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="managing-oracle-streams-replication.html#GUID-7F9C0ABD-B45B-4F22-AED1-FD475BE92DBB">About Managing Oracle Streams</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-replication.html#GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB">Tracking LCRs Through a Stream</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-replication.html#GUID-AA83B519-1C30-4961-9B71-7AE07CE48517">Splitting and Merging an Oracle Streams Destination</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-replication.html#GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72">Changing the DBID or Global Name of a Source Database</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-replication.html#GUID-BD253F79-7E78-46B8-8936-5AC9E5B4D1E1">Resynchronizing a Source Database in a Multiple-Source Environment</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-replication.html#GUID-BF084D6E-24E9-4E6F-BBEE-11540CF844CD">Performing Database Point-in-Time Recovery in an Oracle Streams Environment</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-replication.html#GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D">Running Flashback Queries in an Oracle Streams Replication Environment</a></p>
                  </li>
                  <li>
                     <p><a href="managing-oracle-streams-replication.html#GUID-52B85E39-2264-47E2-981A-63CA23C7380A">Recovering from Operation Errors</a></p>
                  </li>
               </ul>
            </div><a id="STREP433"></a><div class="props_rev_3"><a id="GUID-7F9C0ABD-B45B-4F22-AED1-FD475BE92DBB" name="GUID-7F9C0ABD-B45B-4F22-AED1-FD475BE92DBB"></a><h3 id="STREP-GUID-7F9C0ABD-B45B-4F22-AED1-FD475BE92DBB" class="sect3"><span class="enumeration_section">12.1 </span>About Managing Oracle Streams
               </h3>
               <div>
                  <p>After an Oracle Streams replication environment is in place, you can manage the Oracle Streams components at each database. Management includes administering the components. For example, you can set capture process parameters to modify the behavior of a capture process. Management also includes monitoring the Oracle Streams components and troubleshooting them if there are problems.</p>
                  <p>The following documentation provides instructions for managing Oracle Streams:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="../strms/toc.htm"><span class="italic">Oracle Streams Concepts and Administration</span></a> provides detailed instructions about managing Oracle Streams components.
                        </p>
                     </li>
                     <li>
                        <p><span class="italic">Oracle Streams Replication Administrator's Guide</span> (this document) provides instructions that are specific to an Oracle Streams replication environment.
                        </p>
                     </li>
                     <li>
                        <p>The online help for the Oracle Streams interface in Oracle Enterprise Manager Cloud Control provides information about managing Oracle Streams with Oracle Enterprise Manager Cloud Control.</p>
                     </li>
                  </ul>
               </div>
            </div><a id="STREP145"></a><div class="props_rev_3"><a id="GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB" name="GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB"></a><h3 id="STREP-GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB" class="sect3"><span class="enumeration_section">12.2 </span>Tracking LCRs Through a Stream
               </h3>
               <div>
                  <div class="section">
                     <p>A logical change record (LCR) typically flows through a stream in the following way:</p>
                     <ol>
                        <li>
                           <p>A database change is captured, formatted into an LCR, and enqueued. A capture process or a synchronous capture can capture database changes implicitly. An application or user can construct and enqueue LCRs to capture database changes explicitly.</p>
                        </li>
                        <li>
                           <p>One or more propagations send the LCR to other databases in the Oracle Streams environment.</p>
                        </li>
                        <li>
                           <p>One or more apply processes dequeue the LCR and process it.</p>
                        </li>
                     </ol>
                     <p>You can track an LCR through a stream using one of the following methods:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>When LCRs are captured by a capture process, you can set the <code class="codeph">message_tracking_frequency</code> capture process parameter to <code class="codeph">1</code> or another relatively low value.
                           </p>
                        </li>
                        <li>
                           <p>When LCRs are captured by a capture process or a synchronous capture, or when LCRs are constructed by an application, you can run the <code class="codeph">SET_MESSAGE_TRACKING</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package.
                           </p>
                        </li>
                     </ul>
                     <p>LCR tracking is useful if LCRs are not being applied as expected by one or more apply processes. When this happens, you can use LCR tracking to determine where the LCRs are stopping in the stream and address the problem at that location.</p>
                     <p>After using one of these methods to track LCRs, use the <code class="codeph">V$STREAMS_MESSAGE_TRACKING</code> view to monitor the progress of LCRs through a stream. By tracking an LCR through the stream, you can determine where the LCR is blocked. After LCR tracking is started, each LCR includes a tracking label.
                     </p>
                     <p>When LCR tracking is started using the <code class="codeph">message_tracking_frequency</code> capture process parameter, the tracking label is <span class="italic"><code class="codeph">capture_process_name:</code></span><code class="codeph">AUTOTRACK</code>, where <span class="italic"><code class="codeph">capture_process_name</code></span> is the name of the capture process. Only the first 20 bytes of the capture process name are used; the rest is truncated if it exceeds 20 bytes.
                     </p>
                     <p>The <code class="codeph">SET_MESSAGE_TRACKING</code> procedure enables you to specify a tracking label that becomes part of each LCR generated by the current session. Using this tracking label, you can query the <code class="codeph">V$STREAMS_MESSAGE_TRACKING</code> view to track the LCRs through the stream and see how they were processed by each Oracle Streams client. When you use the <code class="codeph">SET_MESSAGE_TRACKING</code> procedure, the following LCRs are tracked:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>When a capture process or a synchronous capture captures an LCR, and a tracking label is set for the session that made the captured database change, the tracking label is included in the LCR automatically. </p>
                        </li>
                        <li>
                           <p>When a user or application constructs an LCR and a tracking label is set for the session that constructs the LCR, the tracking label is included in the LCR automatically.</p>
                        </li>
                     </ul>
                     <p>To track LCRs through a stream, complete the following steps:</p>
                     <ol>
                        <li id="GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB__CEGJAAJB">
                           <p>Start LCR tracking.</p>
                           <p>You can start LCR tracking in one of the following ways:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Connect to database running the capture process and set the <code class="codeph">message_tracking_frequency</code> capture process parameter to <code class="codeph">1</code> or another relatively low value. After setting the capture process parameter, proceed to Step <a href="managing-oracle-streams-replication.html#GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB__CEGCBDHI">2</a>.
                                 </p>
                                 <p>See <a href="../strms/managing-oracle-streams-implicit-capture.html#STRMS630"><span class="italic">Oracle Streams Concepts and Administration</span></a> for information about setting capture process parameters.
                                 </p>
                                 <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for instructions about connecting to a database in SQL*Plus.
                                 </p>
                              </li>
                              <li>
                                 <p>Run the <code class="codeph">SET_MESSAGE_TRACKING</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package by completing the following steps:
                                 </p>
                              </li>
                           </ul>
                           <ol type="a">
                              <li>
                                 <p>In SQL*Plus, start a session. To use a tracking label for database changes captured by a capture process or synchronous capture, connect to the source database for the capture process or synchronous capture.</p>
                              </li>
                              <li id="GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB__BABCFBAA">
                                 <p>Begin message tracking:</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_MESSAGE_TRACKING(
    tracking_label =&gt; 'TRACK_LCRS');
END;
/
</pre><p>You can use any label you choose to track LCRs. This example uses the <code class="codeph">TRACK_LCRS</code> label.
                                 </p>
                                 <p>Information about the LCRs is tracked in memory, and the <code class="codeph">V$STREAMS_MESSAGE_TRACKING</code> dynamic performance view is populated with information about the LCRs.
                                 </p>
                              </li>
                              <li>
                                 <p>Optionally, to ensure that message tracking is set in the session, query the tracking label:</p><pre class="oac_no_warn" dir="ltr">SELECT DBMS_STREAMS_ADM.GET_MESSAGE_TRACKING() TRACKING_LABEL FROM DUAL;
</pre><p>This query should return the tracking label you specified in Step <a href="managing-oracle-streams-replication.html#GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB__BABCFBAA">1.b</a>:
                                 </p><pre class="oac_no_warn" dir="ltr">TRACKING_LABEL
--------------------------------------------------------------------------
TRACK_LCRS
</pre></li>
                           </ol>
                        </li>
                        <li id="GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB__CEGCBDHI">
                           <p>Make changes to the source database that will be captured by the capture process or synchronous capture that starts the stream, or construct and enqueue the LCRs you want to track. Typically, these LCRs are for testing purposes only. For example, you can insert several dummy rows into a table and then modify these rows. When the testing is complete, you can delete the rows.</p>
                        </li>
                        <li>
                           <p>Monitor the entire Oracle Streams environment to track the LCRs. To do so, query the <code class="codeph">V$STREAMS_MESSAGE_TRACKING</code> view at each database that processes the LCRs.
                           </p>
                           <p>For example, run the following query at each database:</p><pre class="oac_no_warn" dir="ltr">COLUMN COMPONENT_NAME HEADING 'Component|Name' FORMAT A10
COLUMN COMPONENT_TYPE HEADING 'Component|Type' FORMAT A12
COLUMN ACTION HEADING 'Action' FORMAT A11
COLUMN SOURCE_DATABASE_NAME HEADING 'Source|Database' FORMAT A10
COLUMN OBJECT_OWNER HEADING 'Object|Owner' FORMAT A6
COLUMN OBJECT_NAME HEADING 'Object|Name' FORMAT A10
COLUMN COMMAND_TYPE HEADING 'Command|Type' FORMAT A7
 
SELECT COMPONENT_NAME,
       COMPONENT_TYPE,
       ACTION,
       SOURCE_DATABASE_NAME,
       OBJECT_OWNER,
       OBJECT_NAME,
       COMMAND_TYPE
   FROM V$STREAMS_MESSAGE_TRACKING;
</pre><p>Ensure that you specify the correct tracking label in the <code class="codeph">WHERE</code> clause.
                           </p>
                           <p>These queries will show how the LCRs were processed at each database. If the LCRs are not being applied at destination databases, then these queries will show where in the stream the LCRs are stopping.</p>
                           <p>For example, the output at a source database with a synchronous capture is similar to the following:</p><pre class="oac_no_warn" dir="ltr">Component  Component                Source     Object Object     Command
Name       Type         Action      Database   Owner  Name       Type
---------- ------------ ----------- ---------- ------ ---------- -------
CAPTURE    SYNCHRONOUS  Create      HUB.EXAMPL HR     EMPLOYEES  UPDATE
           CAPTURE                  E.COM
CAPTURE    SYNCHRONOUS  Rule evalua HUB.EXAMPL HR     EMPLOYEES  UPDATE
           CAPTURE      tion        E.COM
CAPTURE    SYNCHRONOUS  Enqueue     HUB.EXAMPL HR     EMPLOYEES  UPDATE
           CAPTURE                  E.COM
</pre><p>The output at a destination database with an apply process is similar to the following:</p><pre class="oac_no_warn" dir="ltr">Component  Component                Source     Object Object     Command
Name       Type         Action      Database   Owner  Name       Type
---------- ------------ ----------- ---------- ------ ---------- -------
APPLY_SYNC APPLY READER Dequeue     HUB.EXAMPL HR     EMPLOYEES  UPDATE
_CAP                                E.COM
APPLY_SYNC APPLY READER Dequeue     HUB.EXAMPL HR     EMPLOYEES  UPDATE
_CAP                                E.COM
APPLY_SYNC APPLY READER Dequeue     HUB.EXAMPL HR     EMPLOYEES  UPDATE
_CAP                                E.COM
</pre><p>You can query additional columns in the <code class="codeph">V$STREAMS_MESSAGE_TRACKING</code> view to display more information. For example, the <code class="codeph">ACTION_DETAILS</code> column provides detailed information about each action.
                           </p>
                        </li>
                        <li>
                           <p>Stop message tracking. Complete one of the following actions based your choice in Step <a href="managing-oracle-streams-replication.html#GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB__CEGJAAJB">1</a>:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>If you set the <code class="codeph">message_tracking_frequency</code> capture process parameter in Step <a href="managing-oracle-streams-replication.html#GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB__CEGJAAJB">1</a>, then set this parameter back to its default value. The default is to track every two-millionth message.
                                 </p>
                                 <p>To set this capture process parameter back to its default value, connect to database running the capture process and set the <code class="codeph">message_tracking_frequency</code> capture process parameter to <code class="codeph">NULL</code>.
                                 </p>
                                 <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=STRMS630"><span class="italic">Oracle Streams Concepts and Administration</span></a> for information about setting capture process parameters.
                                 </p>
                              </li>
                              <li>
                                 <p>If you started message tracking in the current session, then stop message tracking in the session.</p>
                                 <p>To stop message tracking in the current session, set the <code class="codeph">tracking_label</code> parameter to <code class="codeph">NULL</code> in the <code class="codeph">SET_MESSAGE_TRACKING</code> procedure:
                                 </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.SET_MESSAGE_TRACKING(
    tracking_label =&gt; NULL,
    actions        =&gt; DBMS_STREAMS_ADM.ACTION_MEMORY);
END;
/
</pre></li>
                           </ul>
                        </li>
                     </ol>
                     <div class="infoboxnotealso" id="GUID-8E42FE9C-CCB4-41EC-AE36-28C3B21382FB__GUID-89B5DFF8-B3A6-408D-91C2-A7ABE7BE385B">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_CAPTURE_ADM.html#ARPLS306"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for information about the <code class="codeph">message_tracking_frequency</code> capture process parameter
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STREP144"></a><div class="props_rev_3"><a id="GUID-AA83B519-1C30-4961-9B71-7AE07CE48517" name="GUID-AA83B519-1C30-4961-9B71-7AE07CE48517"></a><h3 id="STREP-GUID-AA83B519-1C30-4961-9B71-7AE07CE48517" class="sect3"><span class="enumeration_section">12.3 </span>Splitting and Merging an Oracle Streams Destination
               </h3>
               <div>
                  <p>The following sections describe how to split and merge streams and provide examples that do so:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-oracle-streams-replication.html#GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D">About Splitting and Merging Oracle Streams</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-replication.html#GUID-8A092D48-84D2-46E3-A9A6-7322A650A9CC">Split and Merge Options</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-replication.html#GUID-EDA3F250-B91F-423F-ABB3-EB20595A3552">Examples That Split and Merge Oracle Streams</a></p>
                     </li>
                  </ul>
               </div><a id="STREP435"></a><a id="STREP436"></a><a id="STREP437"></a><a id="STREP438"></a><a id="STREP434"></a><div class="props_rev_3"><a id="GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D" name="GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D"></a><h4 id="STREP-GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D" class="sect4"><span class="enumeration_section">12.3.1 </span>About Splitting and Merging Oracle Streams
                  </h4>
                  <div>
                     <p>Splitting and merging an Oracle Streams destination is useful under the following conditions:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>A single capture process captures changes that are sent to two or more apply processes.</p>
                        </li>
                        <li>
                           <p>An apply process stops accepting changes captured by the capture process. The apply process might stop accepting changes if, for example, the apply process is disabled, the database that contains the apply process goes down, there is a network problem, the computer system running the database that contains the apply process goes down, or for some other reason.</p>
                        </li>
                     </ul>
                     <p>When these conditions are met, it is best to split the problem destination off from the other destinations. The reason to split the destination off depends on whether the configuration uses the combined capture and apply optimization:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>If the apply process at the problem destination is part of a combined capture and apply optimization and the destination is not split off, then performance will suffer when the destination becomes available again. In this case, the capture process must capture the changes that must now be applied at the destination previously split off. The other destinations will not receive more recent changes until the problem destination has caught up. However, if the problem destination is split off, then it can catch up to the other destinations independently, without affecting the other destinations.</p>
                        </li>
                        <li>
                           <p>If the apply process at the destination is not part of a combined capture and apply optimization, then captured changes that cannot be sent to the problem destination queue remain in the source queue, causing the source queue size to increase. Eventually, the source queue will spill captured logical change records (LCRs) to hard disk, and the performance of the Oracle Streams replication environment will suffer.</p>
                        </li>
                     </ul>
                     <p>Split and merge operations are possible in the following types of Oracle Streams replication environments:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Changes captured by a single capture process are sent to multiple remote destinations using propagations and are applied by apply processes at the remote destinations.</p>
                        </li>
                        <li>
                           <p>Changes captured by a single capture process are applied locally by multiple apply processes on the same database that is running the capture process.</p>
                        </li>
                        <li>
                           <p>Changes captured by a single capture process are sent to one or more remote destinations using propagations and are applied locally by one or more apply processes on the same database that is running the capture process.</p>
                        </li>
                     </ul>
                     <p>For environment with local capture and apply, split and merge operations are possible when the capture process and apply processes share the same queue, and when a propagation sends changes from the capture process's queue to an apply process's queue within the one database.</p>
                     <p><a href="managing-oracle-streams-replication.html#GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D__CEGIHGEF">Figure 12-1</a> shows an Oracle Streams replication environment that uses propagations to send changes to multiple destinations. In this example, destination database A is down.
                     </p>
                     <div class="figure" id="GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D__CEGIHGEF">
                        <p class="titleinfigure">Figure 12-1 Problem Destination in an Oracle Streams Replication Environment</p><img width="511" src="img/strep059.gif" alt="Description of Figure 12-1 follows" title="Description of Figure 12-1 follows" longdesc="img_text/strep059.html"><br><a href="img_text/strep059.html">Description of "Figure 12-1 Problem Destination in an Oracle Streams Replication Environment"</a></div>
                     <!-- class="figure" -->
                     <p>You can use the following data dictionary views to determine when there is a problem with a stream:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Query the <code class="codeph">V$BUFFERED_QUEUES</code> view to identify how many messages are in a buffered queue and how many of these messages have spilled to hard disk.
                           </p>
                        </li>
                        <li>
                           <p>When propagations are used, query the <code class="codeph">DBA_PROPAGATION</code> and <code class="codeph">V$PROPAGATION_SENDER</code> views to show the propagations in a database and the status of each propagation
                           </p>
                        </li>
                     </ul>
                     <p>To avoid degraded performance in this situation, split the stream that flows to the problem database off from the other streams flowing from the capture process. When the problem is corrected, merge the stream back into the other streams flowing from the capture process.</p>
                     <p>You can configure capture process parameters to split and merge a problem stream automatically, or you can split and merge a problem stream manually. Either way, the <code class="codeph">SPLIT_STREAMS</code>, <code class="codeph">MERGE_STREAMS_JOB</code>, and <code class="codeph">MERGE_STREAMS</code> procedures in the <code class="codeph">DBMS_STREAMS_ADM</code> package are used. The <code class="codeph">SPLIT_STREAMS</code> procedure splits off the stream for the problem destination from all of the other streams flowing from a capture process to other destinations. The <code class="codeph">SPLIT_STREAMS</code> procedure always clones the capture process and the queue. The <code class="codeph">SPLIT_STREAMS</code> procedure also clones the propagation in an environment that sends changes to remote destination databases. The cloned versions of these components are used by the stream that is split off. While the problem stream is split off, the streams to other destinations proceed as usual.
                     </p>
                     <p><a href="managing-oracle-streams-replication.html#GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D__CEGIIBEC">Figure 12-2</a> shows the cloned stream created by the <code class="codeph">SPLIT_STREAMS</code> procedure.
                     </p>
                     <div class="figure" id="GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D__CEGIIBEC">
                        <p class="titleinfigure">Figure 12-2 Splitting Oracle Streams</p><img width="511" src="img/strep060.gif" alt="Description of Figure 12-2 follows" title="Description of Figure 12-2 follows" longdesc="img_text/strep060.html"><br><a href="img_text/strep060.html">Description of "Figure 12-2 Splitting Oracle Streams"</a></div>
                     <!-- class="figure" -->
                     <p>When the problem destination becomes available again, the cloned stream begins to send captured changes to the destination database again.</p>
                     <p><a href="managing-oracle-streams-replication.html#GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D__CEGCEDJF">Figure 12-3</a> shows a destination database A that is up and running and a cloned capture process that is enabled at the capture database. The cloned stream begins to flow and starts to catch up to the original streams.
                     </p>
                     <div class="figure" id="GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D__CEGCEDJF">
                        <p class="titleinfigure">Figure 12-3 Cloned Stream Begins Flowing and Starts to Catch Up to One Original Stream</p><img width="510" src="img/strep061.gif" alt="Description of Figure 12-3 follows" title="Description of Figure 12-3 follows" longdesc="img_text/strep061.html"><br><a href="img_text/strep061.html">Description of "Figure 12-3 Cloned Stream Begins Flowing and Starts to Catch Up to One Original Stream"</a></div>
                     <!-- class="figure" -->
                     <p>When the cloned stream catches up to one of the original streams, one of the following procedures merges the streams:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The <code class="codeph">MERGE_STREAMS</code> procedure merges the stream that was split off back into the other streams flowing from the original capture process.
                           </p>
                        </li>
                        <li>
                           <p>The <code class="codeph">MERGE_STREAMS_JOB</code> procedure determines whether the streams are within the user-specified merge threshold. If they are, then the <code class="codeph">MERGE_STREAMS_JOB</code> procedure runs the <code class="codeph">MERGE_STREAMS</code> procedure. If the streams are not within the merge threshold, then the <code class="codeph">MERGE_STREAMS_JOB</code> procedure does nothing.
                           </p>
                        </li>
                     </ul>
                     <p>Typically, it is best to run the <code class="codeph">MERGE_STREAMS_JOB</code> procedure instead of running the <code class="codeph">MERGE_STREAMS</code> procedure directly, because the <code class="codeph">MERGE_STREAMS_JOB</code> procedure automatically determines whether the streams are ready to merge before merging them.
                     </p>
                     <p><a href="managing-oracle-streams-replication.html#GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D__CEGBEDJH">Figure 12-4</a> shows the results of running the <code class="codeph">MERGE_STREAMS</code> procedure. The Oracle Streams replication environment has its original components, and all of the streams are flowing normally.
                     </p>
                     <div class="figure" id="GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D__CEGBEDJH">
                        <p class="titleinfigure">Figure 12-4 Merging Oracle Streams</p><img width="510" src="img/strep062.gif" alt="Description of Figure 12-4 follows" title="Description of Figure 12-4 follows" longdesc="img_text/strep062.html"><br><a href="img_text/strep062.html">Description of "Figure 12-4 Merging Oracle Streams"</a></div>
                     <!-- class="figure" -->
                     <div class="infoboxnotealso" id="GUID-A04C292B-C8BD-4F6C-8BAC-5E5D6BD67E5D__GUID-CD757B63-1B62-4ACE-8CD8-0095BF2948CB">
                        <p class="notep1">See Also:</p>
                        <p><a href="../strms/combined-capture-and-apply-optimization.html#STRMS171"><span class="italic">Oracle Streams Concepts and Administration</span></a> for information about combined capture and apply
                        </p>
                     </div>
                  </div>
               </div><a id="STREP592"></a><div class="props_rev_3"><a id="GUID-8A092D48-84D2-46E3-A9A6-7322A650A9CC" name="GUID-8A092D48-84D2-46E3-A9A6-7322A650A9CC"></a><h4 id="STREP-GUID-8A092D48-84D2-46E3-A9A6-7322A650A9CC" class="sect4"><span class="enumeration_section">12.3.2 </span>Split and Merge Options
                  </h4>
                  <div>
                     <p>The following split and merge options are available:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="managing-oracle-streams-replication.html#GUID-CA711876-5519-4E84-9B69-C51E92F44847">Automatic Split and Merge</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-replication.html#GUID-F6234B8C-A2DC-4B49-AD94-79B153C27BDA">Manual Split and Automatic Merge</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-replication.html#GUID-1F82FEDD-13BA-4E07-9831-BC8ECF16A84B">Manual Split and Merge With Generated Scripts</a></p>
                        </li>
                     </ul>
                  </div><a id="STREP593"></a><div class="props_rev_3"><a id="GUID-CA711876-5519-4E84-9B69-C51E92F44847" name="GUID-CA711876-5519-4E84-9B69-C51E92F44847"></a><h5 id="STREP-GUID-CA711876-5519-4E84-9B69-C51E92F44847" class="sect5"><span class="enumeration_section">12.3.2.1 </span>Automatic Split and Merge
                     </h5>
                     <div>
                        <p>You can set two capture process parameters, <code class="codeph">split_threshold</code> and <code class="codeph">merge_theshold</code>, so that Oracle Streams performs split and merge operations automatically. When these parameters are set to specify automatic split and merge, an Oracle Scheduler job monitors the streams flowing from the capture process. When an Oracle Scheduler job identifies a problem with a stream, the job splits the problem stream off from the other streams flowing from the capture process. When a split operation is complete, a new Oracle Scheduler merge job monitors the split stream. When the problem is corrected, this job merges the stream back with the other streams.
                        </p>
                        <p>When the <code class="codeph">split_threshold</code> capture process parameter is set to <code class="codeph">INFINITE</code>, automatic splitting is disabled. When the <code class="codeph">split_threshold</code> parameter is not set to <code class="codeph">INFINITE</code>, automatic splitting is enabled. Automatic splitting only occurs when communication with an apply process has been lost for the number of seconds specified in the <code class="codeph">split_threshold</code> parameter. For example, communication with an apply process is lost when an apply process becomes disabled or a destination database goes down. Automatic splitting does not occur when one stream is processing changes slower than other streams.
                        </p>
                        <p>When a stream is split, a cloned capture process is created. The cloned capture process might be enabled or disabled after the split depending on whether the configuration uses the combined capture and apply optimization:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>If the apply process is part of a combined capture and apply optimization, then the cloned capture process is enabled. The cloned capture process does not capture any changes until the apply process is enabled and communication is established with the apply process.</p>
                           </li>
                           <li>
                              <p>If the apply process is not part of a combined capture and apply optimization, then the cloned capture process is disabled so that LCRs do not build up in a queue. When the apply process is enabled and the cloned stream can flow, you can start the cloned capture process manually.</p>
                           </li>
                        </ul>
                        <p>The split stream is merged back with the original streams automatically when the difference, in seconds, between <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> in the <code class="codeph">GV$STREAMS_CAPTURE</code> view of the cloned capture process and the original capture process is less than or equal to the value specified for the <code class="codeph">merge_threshold</code> capture process parameter. The <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> records the time when a captured change was recorded in the redo log. If the difference is greater than the value specified by this capture process parameter, then automatic merge does not begin, and the value is recorded in the <code class="codeph">LAG</code> column of the <code class="codeph">DBA_STREAMS_SPLIT_MERGE</code> view.
                        </p>
                        <p>When the capture process and the apply process for a stream run in different database instances, automatic split and merge is always possible for the stream. When a capture process and apply process for a stream run on the same database instance, automatic split and merge is possible only when all of the following conditions are met:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>The capture process and apply process use the same queue.</p>
                           </li>
                           <li>
                              <p>The apply process has no errors in its error queue.</p>
                           </li>
                           <li>
                              <p>The apply process is not an XStream outbound server.</p>
                           </li>
                           <li>
                              <p>The apply process is stopped.</p>
                           </li>
                           <li>
                              <p>No messages have spilled from the buffered queue to the hard disk.</p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-CA711876-5519-4E84-9B69-C51E92F44847__GUID-2A8E4021-A4EE-4135-A399-88997EFBB880">
                           <p class="notep1">See Also:</p>
                           <p></p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="managing-oracle-streams-replication.html#GUID-735E9738-BB78-426D-9321-25567EB49632">Splitting and Merging an Oracle Streams Destination Automatically</a>"</span> for an example
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../arpls/DBMS_CAPTURE_ADM.html#ARPLS306"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the capture process parameters
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../strms/monitoring-oracle-streams-implicit-capture.html#STRMS1603"><span class="italic">Oracle Streams Concepts and Administration</span></a> for information about monitoring automatic split and merge operations
                                 </p>
                              </li>
                              <li>
                                 <p><a href="../xstrm/toc.htm"><span class="italic">Oracle Database XStream Guide</span></a></p>
                              </li>
                           </ul>
                        </div>
                     </div>
                  </div><a id="STREP439"></a><div class="props_rev_3"><a id="GUID-F6234B8C-A2DC-4B49-AD94-79B153C27BDA" name="GUID-F6234B8C-A2DC-4B49-AD94-79B153C27BDA"></a><h5 id="STREP-GUID-F6234B8C-A2DC-4B49-AD94-79B153C27BDA" class="sect5"><span class="enumeration_section">12.3.2.2 </span>Manual Split and Automatic Merge
                     </h5>
                     <div>
                        <p>When you split streams manually with the <code class="codeph">SPLIT_STREAMS</code> procedure, the <code class="codeph">auto_merge_threshold</code> procedure parameter gives you the option of automatically merging the stream back to the original capture process when the problem at the destination is corrected. After the apply process for the problem stream is accepting changes, you can start the cloned capture process and wait for the cloned capture process to catch up to the original capture process. When the cloned capture process nearly catches up, the <code class="codeph">auto_merge_threshold</code> parameter setting determines whether the split stream is merged automatically or manually:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>When <code class="codeph">auto_merge_threshold</code> is set to a positive number, the <code class="codeph">SPLIT_STREAMS</code> procedure creates an Oracle Scheduler job with a schedule. The job runs the <code class="codeph">MERGE_STREAMS_JOB</code> procedure and specifies a merge threshold equal to the value specified in the <code class="codeph">auto_merge_threshold</code> parameter. You can modify the schedule for a job after it is created.
                              </p>
                              <p>In this case, the split stream is merged back with the original streams automatically when the difference, in seconds, between <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> in the <code class="codeph">GV$STREAMS_CAPTURE</code> view of the cloned capture process and the original capture process is less than or equal to the value specified for the <code class="codeph">auto_merge_threshold</code> parameter. The <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> records the time when a captured change was recorded in the redo log.
                              </p>
                           </li>
                           <li>
                              <p>When <code class="codeph">auto_merge_threshold</code> is set to <code class="codeph">NULL</code> or <code class="codeph">0</code> (zero), the split stream is not merged back with the original streams automatically. To merge the split stream with the original streams, run the <code class="codeph">MERGE_STREAMS_JOB</code> or <code class="codeph">MERGE_STREAMS</code> procedure manually.
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-F6234B8C-A2DC-4B49-AD94-79B153C27BDA__GUID-45AC3B41-495F-4344-8C6D-B1D5BAE0C596">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="managing-oracle-streams-replication.html#GUID-C5F2A44D-3A11-41FC-9D16-83926B5B6D96">Splitting an Oracle Streams Destination Manually and Merging It Automatically</a>"</span> for an example
                           </p>
                        </div>
                     </div>
                  </div><a id="STREP440"></a><div class="props_rev_3"><a id="GUID-1F82FEDD-13BA-4E07-9831-BC8ECF16A84B" name="GUID-1F82FEDD-13BA-4E07-9831-BC8ECF16A84B"></a><h5 id="STREP-GUID-1F82FEDD-13BA-4E07-9831-BC8ECF16A84B" class="sect5"><span class="enumeration_section">12.3.2.3 </span>Manual Split and Merge With Generated Scripts
                     </h5>
                     <div>
                        <p>The <code class="codeph">SPLIT_STREAMS</code> and <code class="codeph">MERGE_STREAMS</code> procedures can perform actions directly or generate a script that performs the actions when the script is run. Using a procedure to perform actions directly is simpler than running a script, and the split or merge operation is performed immediately. However, you might choose to generate a script for the following reasons:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>You want to review the actions performed by the procedure before splitting or merging streams.</p>
                           </li>
                           <li>
                              <p>You want to modify the script to customize its actions.</p>
                           </li>
                        </ul>
                        <p>For example, you might choose to modify the script if you want to change the rules in the rule set for the cloned capture process. In some Oracle Streams replication environments, only a subset of the changes made to the source database are sent to each destination database, and each destination database might receive a different subset of the changes. In such an environment, you can modify the rule set for the cloned capture process so that it only captures changes that are propagated by the cloned propagation.</p>
                        <p>The <code class="codeph">perform_actions</code> parameter in each procedure controls whether the procedure performs actions directly:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>To split or merge streams directly when you run one of these procedures, set the <code class="codeph">perform_actions</code> parameter to <code class="codeph">TRUE</code>. The default value for this parameter is <code class="codeph">TRUE</code>.
                              </p>
                           </li>
                           <li>
                              <p>To generate a script when you run one of these procedures, set the <code class="codeph">perform_actions</code> parameter to <code class="codeph">FALSE</code>, and use the <code class="codeph">script_name</code> and <code class="codeph">script_directory_object</code> parameters to specify the name and location of the script.
                              </p>
                           </li>
                        </ul>
                        <div class="infoboxnotealso" id="GUID-1F82FEDD-13BA-4E07-9831-BC8ECF16A84B__GUID-4DC5E3F8-85DC-4E73-A0FB-DFAA8F8F290F">
                           <p class="notep1">See Also:</p>
                           <p><span class="q">"<a href="managing-oracle-streams-replication.html#GUID-9D9C8E3C-7CA2-48CA-9277-C03356031899">Splitting and Merging an Oracle Streams Destination Manually With Scripts</a>"</span> for an example
                           </p>
                        </div>
                     </div>
                  </div>
               </div><a id="STREP441"></a><div class="props_rev_3"><a id="GUID-EDA3F250-B91F-423F-ABB3-EB20595A3552" name="GUID-EDA3F250-B91F-423F-ABB3-EB20595A3552"></a><h4 id="STREP-GUID-EDA3F250-B91F-423F-ABB3-EB20595A3552" class="sect4"><span class="enumeration_section">12.3.3 </span>Examples That Split and Merge Oracle Streams
                  </h4>
                  <div>
                     <p>The following sections provide instructions for splitting and merging streams:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="managing-oracle-streams-replication.html#GUID-735E9738-BB78-426D-9321-25567EB49632">Splitting and Merging an Oracle Streams Destination Automatically</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-replication.html#GUID-C5F2A44D-3A11-41FC-9D16-83926B5B6D96">Splitting an Oracle Streams Destination Manually and Merging It Automatically</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-replication.html#GUID-9D9C8E3C-7CA2-48CA-9277-C03356031899">Splitting and Merging an Oracle Streams Destination Manually With Scripts</a></p>
                        </li>
                     </ul>
                     <p>These examples make the following assumptions about the Oracle Streams replication environment:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>A single capture process named <code class="codeph">strms_capture</code> captures changes that are sent to three destination databases.
                           </p>
                        </li>
                        <li>
                           <p>The propagations that send these changes to the destination queues at the destination databases are the following:</p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><code class="codeph">strms_prop_a</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">strms_prop_b</code></p>
                              </li>
                              <li>
                                 <p><code class="codeph">strms_prop_c</code></p>
                              </li>
                           </ul>
                        </li>
                        <li>
                           <p>A queue named <code class="codeph">streams_queue</code> is the source queue for all three propagations.
                           </p>
                        </li>
                        <li>
                           <p>There is a problem at the destination for the <code class="codeph">strms_prop_a</code> propagation. This propagation cannot send messages to the destination queue.
                           </p>
                        </li>
                        <li>
                           <p>The other two propagations (<code class="codeph">strms_prop_b</code> and <code class="codeph">strms_prop_c</code>) are propagating messages normally.
                           </p>
                        </li>
                     </ul>
                     <div class="infoboxnotealso" id="GUID-EDA3F250-B91F-423F-ABB3-EB20595A3552__GUID-8ADEE611-6131-4F67-A591-72D1D9A9E146">
                        <p class="notep1">See Also:</p>
                        <p><a href="../arpls/DBMS_STREAMS_ADM.html#ARPLS599"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a> for more information about the <a href="../arpls/DBMS_STREAMS_ADM.html#ARPLS867"><code class="codeph">SPLIT_STREAMS</code> procedure</a> and the <a href="../arpls/DBMS_STREAMS_ADM.html#ARPLS866"><code class="codeph">MERGE_STREAMS</code> procedure</a></p>
                     </div>
                  </div><a id="STREP594"></a><div class="props_rev_3"><a id="GUID-735E9738-BB78-426D-9321-25567EB49632" name="GUID-735E9738-BB78-426D-9321-25567EB49632"></a><h5 id="STREP-GUID-735E9738-BB78-426D-9321-25567EB49632" class="sect5"><span class="enumeration_section">12.3.3.1 </span>Splitting and Merging an Oracle Streams Destination Automatically
                     </h5>
                     <div>
                        <div class="section">
                           <p>Before reviewing this example, see the following sections:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="managing-oracle-streams-replication.html#GUID-CA711876-5519-4E84-9B69-C51E92F44847">Automatic Split and Merge</a>"</span> for conceptual information
                                 </p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="managing-oracle-streams-replication.html#GUID-EDA3F250-B91F-423F-ABB3-EB20595A3552">Examples That Split and Merge Oracle Streams</a>"</span> for assumptions about the Oracle Streams replication environment in this example
                                 </p>
                              </li>
                           </ul>
                           <p>Complete the following steps to split and merge a stream automatically:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>In SQL*Plus, connect as the Oracle Streams administrator to the database with the capture process.</span><div>
                                 <p>See <a href="../admin/index.html"><span class="italic">Oracle Database Administrator's Guide</span></a> for instructions about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-735E9738-BB78-426D-9321-25567EB49632__CEGHBGIB"><span>Ensure that the following parameters are set properly for the <code class="codeph">strms_capture</code> capture process to enable automatic split and merge:</span><div>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p><code class="codeph">split_threshold</code>: Ensure that this parameter is not set to <code class="codeph">INFINITE</code>. The default setting for this parameter is <code class="codeph">1800</code> seconds.
                                       </p>
                                    </li>
                                    <li>
                                       <p><code class="codeph">merge_threshold</code>: Ensure that this parameter is not set to a negative value. The default setting for this parameter is <code class="codeph">60</code> seconds.
                                       </p>
                                    </li>
                                 </ul>
                                 <p>To check the settings for these parameters, query the <code class="codeph">DBA_CAPTURE_PARAMETERS</code> view. See <a href="../strms/monitoring-oracle-streams-implicit-capture.html#STRMS890"><span class="italic">Oracle Streams Concepts and Administration</span></a> for instructions.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>If you must reset one or both of the capture process parameters described in Step&nbsp;<a href="managing-oracle-streams-replication.html#GUID-735E9738-BB78-426D-9321-25567EB49632__CEGHBGIB">2</a>, then use Oracle Enterprise Manager Cloud Control or the <code class="codeph">SET_PARAMETER</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package to reset the parameters. See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=STRMS630"><span class="italic">Oracle Streams Concepts and Administration</span></a> for instructions about using the <code class="codeph">SET_PARAMETER</code> procedure.</span></li>
                           <li class="stepexpand" id="GUID-735E9738-BB78-426D-9321-25567EB49632__CEGGGAFB"><span>Monitor the <code class="codeph">DBA_STREAMS_SPLIT_MERGE</code> view periodically to check whether an automatic split and merge operation is in process.</span><div>
                                 <p>When an automatic split occurs, certain components, such as the capture process, queue, and propagation, are cloned, and each is given a system-generated name. The <code class="codeph">DBA_STREAMS_SPLIT_MERGE</code> view contains the name of each cloned component, and other information about the split and merge operation.
                                 </p>
                                 <p>Query the <code class="codeph">DBA_STREAMS_SPLIT_MERGE</code> view to determine whether a stream has been split off from the original capture process:
                                 </p><pre class="oac_no_warn" dir="ltr">COLUMN ORIGINAL_CAPTURE_NAME HEADING 'Original|Capture|Process' FORMAT A10
COLUMN ACTION_TYPE HEADING 'Action|Type' FORMAT A7
COLUMN STATUS_UPDATE_TIME HEADING 'Status|Update|Time' FORMAT A15
COLUMN STATUS HEADING 'Status' FORMAT A16
COLUMN JOB_NEXT_RUN_DATE HEADING 'Next Job|Run Date' FORMAT A20
 
SELECT ORIGINAL_CAPTURE_NAME,
       ACTION_TYPE,
       STATUS_UPDATE_TIME, 
       STATUS, 
       JOB_NEXT_RUN_DATE 
  FROM DBA_STREAMS_SPLIT_MERGE 
  ORDER BY STATUS_UPDATE_TIME DESC;
</pre><p>If a stream has been split off from the original capture process, then your output looks similar to the following:</p><pre class="oac_no_warn" dir="ltr">Original           Status
Capture    Action  Update                           Next Job
Process    Type    Time            Status           Run Date
---------- ------- --------------- ---------------- --------------------
DB$CAP     MERGE   01-APR-09 06.49 NOTHING TO MERGE 01-APR-09 06.54.29.0
                   .29.204804 AM                    00000 AM -07:00
DB$CAP     SPLIT   01-APR-09 06.49 SPLIT DONE       01-APR-09 06.47.59.0
                   .17.389146 AM                    00000 AM -07:00
</pre><p>This output shows that an automatic split was performed. The merge job was run at <code class="codeph">01-APR-09 06.49.29.204804 AM</code>, but the status shows <code class="codeph">NOTHING</code> <code class="codeph">TO</code> <code class="codeph">MERGE</code> because the split stream is not ready to merge yet. The <code class="codeph">SPLIT</code> <code class="codeph">DONE</code> status indicates that the stream was split off at the following date and time: <code class="codeph">01-APR-09 06.49.17.389146 AM</code>. 
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>After an automatic split is performed, correct the problem with the destination. The problem is corrected when the apply process at the destination database can accept changes from the cloned capture process. An Oracle Scheduler job performs an automatic merge when the problem is corrected.</span></li>
                           <li class="stepexpand"><span>If the cloned capture process is disabled, then start the cloned capture process. The cloned capture process is disabled only if the stream is not a combined capture and apply optimization. See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=STRMS217"><span class="italic">Oracle Streams Concepts and Administration</span></a> for instructions for starting a capture process.</span></li>
                        </ol>
                        <div class="section">
                           <p>The cloned capture process captures changes that satisfy its rule sets. These changes are sent to the apply process.</p>
                           <p>During this time, an Oracle Scheduler job runs the <code class="codeph">MERGE_STREAMS_JOB</code> procedure according to its schedule. The <code class="codeph">MERGE_STREAMS_JOB</code> procedure queries the <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> in the <code class="codeph">GV$STREAMS_CAPTURE</code> view. When the difference between <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> of the cloned capture process and the original capture process is less than or equal to the value of the <code class="codeph">merge_threshold</code> capture process parameter, the <code class="codeph">MERGE_STREAMS_JOB</code> procedure determines that the streams are ready to merge. The <code class="codeph">MERGE_STREAMS_JOB</code> procedure runs the <code class="codeph">MERGE_STREAMS</code> procedure automatically to merge the streams back together. 
                           </p>
                           <p>The <code class="codeph">LAG</code> column in the <code class="codeph">DBA_STREAMS_SPLIT_MERGE</code> view tracks the time in seconds that the cloned capture process lags behind the original capture process. The following query displays the lag time:
                           </p><pre class="oac_no_warn" dir="ltr">COLUMN ORIGINAL_CAPTURE_NAME HEADING 'Original Capture Process' FORMAT A25
COLUMN CLONED_CAPTURE_NAME HEADING 'Cloned Capture Process' FORMAT A25
COLUMN LAG HEADING 'Lag' FORMAT 999999999999999
 
SELECT ORIGINAL_CAPTURE_NAME,
       CLONED_CAPTURE_NAME,
       LAG
 FROM DBA_STREAMS_SPLIT_MERGE
 WHERE ACTION_TYPE = 'MERGE';
</pre><p>Your output looks similar to the following:</p><pre class="oac_no_warn" dir="ltr">Original Capture Process  Cloned Capture Process                 Lag
------------------------- ------------------------- ----------------
DB$CAP                    CLONED$_DB$CAP_5                      2048
</pre><p>This output shows that there is a lag of 2,048 seconds between the <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> values for the original capture process and the cloned capture process. When the cloned capture process is within the threshold, the merge job can start the <code class="codeph">MERGE_STREAMS</code> procedure. By default, the merge threshold is 60 seconds.
                           </p>
                           <p>The <code class="codeph">MERGE_STREAMS</code> procedure performs the following actions:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Stops the cloned capture process.</p>
                              </li>
                              <li>
                                 <p>Re-creates the original propagation called <code class="codeph">strms_prop_a</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Drops the cloned propagation.</p>
                              </li>
                              <li>
                                 <p>Drops the cloned capture process.</p>
                              </li>
                              <li>
                                 <p>Drops the cloned queue.</p>
                              </li>
                           </ul>
                           <p>Repeat the query in Step <a href="managing-oracle-streams-replication.html#GUID-735E9738-BB78-426D-9321-25567EB49632__CEGGGAFB">4</a> periodically to monitor the split and merge operation. After the merge operation is complete, the output for this query is similar to the following:
                           </p><pre class="oac_no_warn" dir="ltr">Original           Status
Capture    Action  Update                           Next Job
Process    Type    Time            Status           Run Date
---------- ------- --------------- ---------------- --------------------
DB$CAP     MERGE   01-APR-09 07.32 NOTHING TO MERGE 01-APR-09 07.37.04.0
                   .04.820795 AM                    00000 AM -07:00
DB$CAP     MONITOR 01-APR-09 07.32 MERGE DONE       01-APR-09 07.36.20.0
                   .04.434925 AM                    00000 AM -07:00
DB$CAP     SPLIT   01-APR-09 06.49 SPLIT DONE       01-APR-09 06.47.59.0
                   .17.389146 AM                    00000 AM -07:00
</pre><p>This output shows that the split stream was merged back into the original capture process at the following date an time: <code class="codeph">01-APR-09 07.32.04.434925 AM</code>. The next status shows <code class="codeph">NOTHING</code> <code class="codeph">TO</code> <code class="codeph">MERGE</code> because there are no remaining split streams.
                           </p>
                           <p>After the streams are merged, the Oracle Streams replication environment has the same components as it had before the split and merge operation. Information about the completed split and merge operation is stored in the <code class="codeph">DBA_STREAMS_SPLIT_MERGE_HIST</code> for future reference.
                           </p>
                           <div class="infoboxnotealso" id="GUID-735E9738-BB78-426D-9321-25567EB49632__GUID-DCC2AB96-BD4A-4CEA-A735-6FBF9C76329B">
                              <p class="notep1">See Also:</p>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=STRMS1603"><span class="italic">Oracle Streams Concepts and Administration</span></a> for information about monitoring automatic split and merge operations
                              </p>
                           </div>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STREP442"></a><div class="props_rev_3"><a id="GUID-C5F2A44D-3A11-41FC-9D16-83926B5B6D96" name="GUID-C5F2A44D-3A11-41FC-9D16-83926B5B6D96"></a><h5 id="STREP-GUID-C5F2A44D-3A11-41FC-9D16-83926B5B6D96" class="sect5"><span class="enumeration_section">12.3.3.2 </span>Splitting an Oracle Streams Destination Manually and Merging It Automatically
                     </h5>
                     <div>
                        <div class="section">
                           <p>Before reviewing this example, see the following sections:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="managing-oracle-streams-replication.html#GUID-F6234B8C-A2DC-4B49-AD94-79B153C27BDA">Manual Split and Automatic Merge</a>"</span> for conceptual information
                                 </p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="managing-oracle-streams-replication.html#GUID-EDA3F250-B91F-423F-ABB3-EB20595A3552">Examples That Split and Merge Oracle Streams</a>"</span> for assumptions about the Oracle Streams replication environment in this example
                                 </p>
                              </li>
                           </ul>
                           <p>The example in this section splits the stream manually and merges it automatically. That is, the <code class="codeph">perform_actions</code> parameter is set to <code class="codeph">TRUE</code> in the <code class="codeph">SPLIT_STREAMS</code> procedure. Also, the example merges the streams automatically at the appropriate time because the <code class="codeph">auto_merge_threshold</code> parameter is to set a positive number (60) in the <code class="codeph">SPLIT_STREAMS</code> procedure.
                           </p>
                           <p>Complete the following steps to split streams directly and merge streams automatically:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>In SQL*Plus, connect as the Oracle Streams administrator to the database with the capture process.</span><div>
                                 <p>See <a href="../admin/index.html"><span class="italic">Oracle Database Administrator's Guide</span></a> for instructions about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Run the following procedure to split the stream flowing through propagation <code class="codeph">strms_prop_a</code> from the other propagations flowing from the <code class="codeph">strms_capture</code> capture process:</span><div><pre class="oac_no_warn" dir="ltr">DECLARE
    schedule_name  VARCHAR2(30);
    job_name       VARCHAR2(30);
BEGIN
    schedule_name := 'merge_job1_schedule';
    job_name      := 'merge_job1';
  DBMS_STREAMS_ADM.SPLIT_STREAMS(
    propagation_name        =&gt; 'strms_prop_a',
    cloned_propagation_name =&gt; 'cloned_prop_a',
    cloned_queue_name       =&gt; 'cloned_queue',
    cloned_capture_name     =&gt; 'cloned_capture',
    perform_actions         =&gt; TRUE,
    auto_merge_threshold    =&gt; 60,
    schedule_name           =&gt; schedule_name,
    merge_job_name          =&gt; job_name);
END;
/
</pre><p>Running this procedure performs the following actions:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Creates a new queue called <code class="codeph">cloned_queue</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Creates a new propagation called <code class="codeph">cloned_prop_a</code> that propagates messages from the <code class="codeph">cloned_queue</code> queue to the existing destination queue used by the <code class="codeph">strms_prop_a</code> propagation. The cloned propagation <code class="codeph">cloned_prop_a</code> uses the same rule set as the original propagation <code class="codeph">strms_prop_a</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Stops the capture process <code class="codeph">strms_capture</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Queries the acknowledge SCN for the original propagation <code class="codeph">strms_prop_a</code>. The acknowledged SCN is the last SCN acknowledged by the apply process that applies the changes sent by the propagation. The <code class="codeph">ACKED_SCN</code> value in the <code class="codeph">DBA_PROPAGATION</code> view shows the acknowledged SCN for a propagation.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Creates a new capture process called <code class="codeph">cloned_capture</code>. The start SCN for <code class="codeph">cloned_capture</code> is set to the value of the acknowledged SCN for the <code class="codeph">strms_prop_a</code> propagation. The cloned capture process <code class="codeph">cloned_capture</code> uses the same rule set as the original capture process <code class="codeph">strms_capture</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Drops the original propagation <code class="codeph">strms_prop_a</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Starts the original capture process <code class="codeph">strms_capture</code> with the start SCN set to the value of the acknowledged SCN for the <code class="codeph">strms_prop_a</code> propagation.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Creates an Oracle Scheduler job named <code class="codeph">merge_job1</code> with a schedule named <code class="codeph">merge_job1_schedule</code>. Both the job and the schedule are owned by the user who ran the <code class="codeph">SPLIT_STREAMS</code> procedure. The schedule starts to run when the <code class="codeph">SPLIT_STREAMS</code> procedure completes. The system defines the initial schedule, but you can modify it in the same way that you would modify any Oracle Scheduler job. See <a href="../admin/scheduling-jobs-with-oracle-scheduler.html#ADMIN034"><span class="italic">Oracle Database Administrator's Guide</span></a> for instructions.
                                       </p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Correct the problem with the destination of <code class="codeph">cloned_prop_a</code>. The problem is corrected when the apply process at the destination database can accept changes from the cloned capture process.</span></li>
                           <li class="stepexpand"><span>While connected as the Oracle Streams administrator, start the cloned capture process by running the following procedure:</span><div><pre class="oac_no_warn" dir="ltr">exec DBMS_CAPTURE_ADM.START_CAPTURE('cloned_capture');
</pre></div>
                           </li>
                        </ol>
                        <div class="section">
                           <p>After the cloned capture process <code class="codeph">cloned_capture</code> starts running, it captures changes that satisfy its rule sets from the acknowledged SCN forward. These changes are propagated by the <code class="codeph">cloned_prop_a</code> propagation and processed by the apply process at the destination database.
                           </p>
                           <p>During this time, the Oracle Scheduler job runs the <code class="codeph">MERGE_STREAMS_JOB</code> procedure according to its schedule. The <code class="codeph">MERGE_STREAMS_JOB</code> procedure queries the <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> in the <code class="codeph">GV$STREAMS_CAPTURE</code> view. When the difference between <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> of the cloned capture process <code class="codeph">cloned_capture</code> and the original capture process <code class="codeph">strms_capture</code> is less than or equal 60 seconds, the <code class="codeph">MERGE_STREAMS_JOB</code> procedure determines that the streams are ready to merge. The <code class="codeph">MERGE_STREAMS_JOB</code> procedure runs the <code class="codeph">MERGE_STREAMS</code> procedure automatically to merge the streams back together. 
                           </p>
                           <p>The following query displays the <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> for the original capture process and cloned capture process:
                           </p><pre class="oac_no_warn" dir="ltr">COLUMN CAPTURE_NAME HEADING 'Capture|Name' FORMAT A17
COLUMN STATE HEADING 'State' FORMAT A20
COLUMN CREATE_MESSAGE HEADING 'Last Message|Create Time'
 
SELECT CAPTURE_NAME,
 STATE,
 TO_CHAR(CAPTURE_MESSAGE_CREATE_TIME, 'HH24:MI:SS MM/DD/YY') CREATE_MESSAGE
 FROM V$STREAMS_CAPTURE;
</pre><p>Your output looks similar to the following:</p><pre class="oac_no_warn" dir="ltr">Capture                                Last Message
Name              State                Create Time
----------------- -------------------- -----------------
DB$CAP            CAPTURING CHANGES    07:22:55 04/01/09
CLONED$_DB$CAP_5  CAPTURING CHANGES    06:50:39 04/01/09
</pre><p>This output shows that there is more than a 30 minute difference between the <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> values for the original capture process and the cloned capture process. When the cloned capture process is within the threshold, the merge job can start the <code class="codeph">MERGE_STREAMS</code> procedure. By default, the merge threshold is 60 seconds.
                           </p>
                           <p>The <code class="codeph">MERGE_STREAMS</code> procedure performs the following actions:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p>Stops the cloned capture process <code class="codeph">cloned_capture</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Re-creates the propagation called <code class="codeph">strms_prop_a</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Drops the cloned propagation <code class="codeph">cloned_prop_a</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Drops the cloned capture process <code class="codeph">cloned_capture</code>.
                                 </p>
                              </li>
                              <li>
                                 <p>Drops the cloned queue <code class="codeph">cloned_queue</code>.
                                 </p>
                              </li>
                           </ul>
                           <p>After the streams are merged, the Oracle Streams replication environment has the same components as it had before the split and merge operation. Information about the completed split and merge operation is stored in the <code class="codeph">DBA_STREAMS_SPLIT_MERGE_HIST</code> for future reference.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div><a id="STREP443"></a><div class="props_rev_3"><a id="GUID-9D9C8E3C-7CA2-48CA-9277-C03356031899" name="GUID-9D9C8E3C-7CA2-48CA-9277-C03356031899"></a><h5 id="STREP-GUID-9D9C8E3C-7CA2-48CA-9277-C03356031899" class="sect5"><span class="enumeration_section">12.3.3.3 </span>Splitting and Merging an Oracle Streams Destination Manually With Scripts
                     </h5>
                     <div>
                        <div class="section">
                           <p>Before reviewing this example, see the following sections:</p>
                        </div>
                        <!-- class="section" -->
                        <div class="section">
                           <ul style="list-style-type: disc;">
                              <li>
                                 <p><span class="q">"<a href="managing-oracle-streams-replication.html#GUID-1F82FEDD-13BA-4E07-9831-BC8ECF16A84B">Manual Split and Merge With Generated Scripts</a>"</span> for conceptual information
                                 </p>
                              </li>
                              <li>
                                 <p><span class="q">"<a href="managing-oracle-streams-replication.html#GUID-EDA3F250-B91F-423F-ABB3-EB20595A3552">Examples That Split and Merge Oracle Streams</a>"</span> for assumptions about the Oracle Streams replication environment in this example
                                 </p>
                              </li>
                           </ul>
                           <p>The example in this section splits and merges streams by generating and running scripts. That is, the <code class="codeph">perform_actions</code> parameter is set to <code class="codeph">FALSE</code> in the <code class="codeph">SPLIT_STREAMS</code> procedure. Also, the example merges the streams manually at the appropriate time because the <code class="codeph">auto_merge_threshold</code> parameter is set to <code class="codeph">NULL</code> in the <code class="codeph">SPLIT_STREAMS</code> procedure.
                           </p>
                           <p>Complete the following steps to use scripts to split and merge streams:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>In SQL*Plus, connect as the Oracle Streams administrator to the database with the capture process.</span><div>
                                 <p>See <a href="../admin/index.html"><span class="italic">Oracle Database Administrator's Guide</span></a> for instructions about connecting to a database in SQL*Plus.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>If it does not already exist, then create a directory object named <code class="codeph">db_dir</code> to hold the scripts generated by the procedures:</span><div><pre class="oac_no_warn" dir="ltr">CREATE DIRECTORY db_dir AS '/usr/db_files';
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Run the following procedure to generate a script to split the streams:</span><div><pre class="oac_no_warn" dir="ltr">DECLARE
    schedule_name  VARCHAR2(30);
    job_name       VARCHAR2(30);
BEGIN
  DBMS_STREAMS_ADM.SPLIT_STREAMS(
    propagation_name        =&gt; 'strms_prop_a',
    cloned_propagation_name =&gt; 'cloned_prop_a',
    cloned_queue_name       =&gt; 'cloned_queue',
    cloned_capture_name     =&gt; 'cloned_capture',
    perform_actions         =&gt; FALSE,
    script_name             =&gt; 'split.sql',
    script_directory_object =&gt; 'db_dir',
    auto_merge_threshold    =&gt; NULL,
    schedule_name           =&gt; schedule_name,
    merge_job_name          =&gt; job_name);
END;
/
</pre><p>Running this procedure generates the <code class="codeph">split.sql</code> script. The script contains the actions that will split the stream flowing through propagation <code class="codeph">strms_prop_a</code> from the other propagations flowing from the <code class="codeph">strms_capture</code> capture process.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Go to the directory used by the <code class="codeph">db_dir</code> directory object, and open the <code class="codeph">split.sql</code> script with a text editor.</span></li>
                           <li class="stepexpand"><span>Examine the script and make modifications, if necessary.</span></li>
                           <li class="stepexpand"><span>Save and close the script.</span></li>
                           <li class="stepexpand"><span>While connected as the Oracle Streams administrator in SQL*Plus, run the script:</span><div><pre class="oac_no_warn" dir="ltr">@/usr/db_files/split.sql
</pre><p>Running the script performs the following actions:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Runs the <code class="codeph">SET_UP_QUEUE</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package to create a queue called <code class="codeph">cloned_queue</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Runs the <code class="codeph">CREATE_PROPAGATION</code> procedure in the <code class="codeph">DBMS_PROPAGATION_ADM</code> package to create a propagation called <code class="codeph">cloned_prop_a</code>. This new propagation propagates messages from the <code class="codeph">cloned_queue</code> queue to the existing destination queue used by the <code class="codeph">strms_prop_a</code> propagation. The cloned propagation <code class="codeph">cloned_prop_a</code> uses the same rule set as the original propagation <code class="codeph">strms_prop_a</code>.
                                       </p>
                                       <p>The <code class="codeph">CREATE_PROPAGATION</code> procedure sets the <code class="codeph">original_propagation_name</code> parameter to <code class="codeph">strms_prop_a</code> and the <code class="codeph">auto_merge_threshold</code> parameter to <code class="codeph">NULL</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Runs the <code class="codeph">STOP_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package to stop the capture process <code class="codeph">strms_capture</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Queries the acknowledge SCN for the original propagation <code class="codeph">strms_prop_a</code>. The acknowledged SCN is the last SCN acknowledged by the apply process that applies the changes sent by the propagation. The <code class="codeph">ACKED_SCN</code> value in the <code class="codeph">DBA_PROPAGATION</code> view shows the acknowledged SCN for a propagation.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Runs the <code class="codeph">CREATE_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package to create a capture process called <code class="codeph">cloned_capture</code>. The start SCN for <code class="codeph">cloned_capture</code> is set to the value of the acknowledged SCN for the <code class="codeph">strms_prop_a</code> propagation. The cloned capture process <code class="codeph">cloned_capture</code> uses the same rule set as the original capture process <code class="codeph">strms_capture</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Runs the <code class="codeph">DROP_PROPAGATION</code> procedure in the <code class="codeph">DBMS_PROPAGATION_ADM</code> package to drop the original propagation <code class="codeph">strms_prop_a</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Runs the <code class="codeph">START_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package to start the original capture process <code class="codeph">strms_capture</code> with the start SCN set to the value of the acknowledged SCN for the <code class="codeph">strms_prop_a</code> propagation.
                                       </p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Correct the problem with the destination of <code class="codeph">cloned_prop_a</code>. The problem is corrected when the apply process at the destination database can accept changes from the cloned capture process.</span></li>
                           <li class="stepexpand"><span>While connected as the Oracle Streams administrator, start the cloned capture process by running the following procedure:</span><div><pre class="oac_no_warn" dir="ltr">exec DBMS_CAPTURE_ADM.START_CAPTURE('cloned_capture');
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Monitor the Oracle Streams replication environment until the cloned capture process catches up to, or nearly catches up to, the original capture process. Specifically, query the <code class="codeph">CAPTURE_MESSAGE_CREATION_TIME</code> column in the <code class="codeph">GV$STREAMS_CAPTURE</code> view for each capture process.</span><div>
                                 <p>Run the following query to check the <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> for each capture process periodically:
                                 </p><pre class="oac_no_warn" dir="ltr">SELECT CAPTURE_NAME,
       TO_CHAR(CAPTURE_MESSAGE_CREATE_TIME, 'HH24:MI:SS MM/DD/YY') 
   FROM GV$STREAMS_CAPTURE;
</pre><p>Do not move on to the next step until the difference between <code class="codeph">CAPTURE_MESSAGE_CREATE_TIME</code> of the cloned capture process <code class="codeph">cloned_capture</code> and the original capture process <code class="codeph">strms_capture</code> is relatively small.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Run the following procedure to generate a script to merge the streams:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.MERGE_STREAMS(
    cloned_propagation_name =&gt; 'cloned_prop_a',
    perform_actions         =&gt; FALSE,
    script_name             =&gt; 'merge.sql',
    script_directory_object =&gt; 'db_dir');
END;
/
</pre><p>Running this procedure generates the <code class="codeph">merge.sql</code> script. The script contains the actions that will merge the stream flowing through propagation <code class="codeph">cloned_prop_a</code> with the other propagations flowing from the <code class="codeph">strms_capture</code> capture process.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Go to the directory used by the <code class="codeph">db_dir</code> directory object, and open the <code class="codeph">merge.sql</code> script with a text editor.</span></li>
                           <li class="stepexpand"><span>Examine the script and make modifications, if necessary.</span></li>
                           <li class="stepexpand"><span>Save and close the script.</span></li>
                           <li class="stepexpand"><span>While connected as the Oracle Streams administrator in SQL*Plus, run the script:</span><div><pre class="oac_no_warn" dir="ltr">@/usr/db_files/merge.sql
</pre><p>Running the script performs the following actions:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>Runs the <code class="codeph">STOP_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package to stop the cloned capture process <code class="codeph">cloned_capture</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Runs the <code class="codeph">STOP_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package to stop the original capture process <code class="codeph">strms_capture</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Runs the <code class="codeph">CREATE_PROPAGATION</code> procedure in the <code class="codeph">DBMS_PROPAGATION_ADM</code> package to re-create the propagation called <code class="codeph">strms_prop_a</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Starts the original capture process <code class="codeph">strms_capture</code> from the lower SCN value of these two SCN values:
                                       </p>
                                       <ul style="list-style-type: disc;">
                                          <li>
                                             <p>The acknowledged SCN of the cloned propagation <code class="codeph">cloned_prop_a</code>.
                                             </p>
                                          </li>
                                          <li>
                                             <p>The lowest acknowledged SCN of the other propagations that propagate changes captured by the original capture process (propagations <code class="codeph">strms_prop_b</code> and <code class="codeph">strms_prop_c</code> in this example).
                                             </p>
                                          </li>
                                       </ul>
                                       <p>When the <code class="codeph">strms_capture</code> capture process is started, it might recapture changes that it already captured, or it might capture changes that were already captured by the cloned capture process <code class="codeph">cloned_capture</code>. In either case, the relevant apply processes will discard any duplicate changes they receive.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Runs the <code class="codeph">DROP_PROPAGATION</code> procedure in the <code class="codeph">DBMS_PROPAGATION_ADM</code> package to drop the cloned propagation <code class="codeph">cloned_prop_a</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Runs the <code class="codeph">DROP_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package to drop the cloned capture process <code class="codeph">cloned_capture</code>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>Runs the <code class="codeph">REMOVE_QUEUE</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package to drop the cloned queue <code class="codeph">cloned_queue</code>.
                                       </p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                        </ol>
                        <div class="section">
                           <p>After the script runs successfully, the streams are merged, and the Oracle Streams replication environment has the same components as it had before the split and merge operation. Information about the completed split and merge operation is stored in the <code class="codeph">DBA_STREAMS_SPLIT_MERGE_HIST</code> for future reference.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="STREP135"></a><div class="props_rev_3"><a id="GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72" name="GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72"></a><h3 id="STREP-GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72" class="sect3"><span class="enumeration_section">12.4 </span>Changing the DBID or Global Name of a Source Database
               </h3>
               <div>
                  <div class="section">
                     <p>Typically, database administrators change the <code class="codeph">DBID</code> and global name of a database when it is a clone of another database. You can view the <code class="codeph">DBID</code> of a database by querying the <code class="codeph">DBID</code> column in the <code class="codeph">V$DATABASE</code> dynamic performance view, and you can view the global name of a database by querying the <code class="codeph">GLOBAL_NAME</code> static data dictionary view. When you change the <code class="codeph">DBID</code> or global name of a source database, any existing capture processes that capture changes originating at this source database become unusable. The capture processes can be local capture processes or downstream capture processes that capture changes that originated at the source database. Also, any existing apply processes that apply changes from the source database become unusable. However, existing synchronous captures and propagations do not need to be re-created, although modifications to propagation rules might be necessary.
                     </p>
                     <p>If a capture process or synchronous capture is capturing changes to a source database for which you have changed the <code class="codeph">DBID</code> or global name, then complete the following steps:
                     </p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>Shut down the source database.</span></li>
                     <li><span>Restart the source database with <code class="codeph">RESTRICTED</code> <code class="codeph">SESSION</code> enabled using <code class="codeph">STARTUP</code> <code class="codeph">RESTRICT</code>.</span></li>
                     <li id="GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__i1019165"><span>Drop the capture process using the <code class="codeph">DROP_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package. The capture process can be a local capture process at the source database or a downstream capture process at a remote database. Synchronous captures do not need to be dropped.</span></li>
                     <li><span>At the source database, run the <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">SWITCH</code> <code class="codeph">LOGFILE</code> statement on the database.</span></li>
                     <li><span>If any changes have been captured from the source database, then manually resynchronize the data at all destination databases that apply changes originating at this source database. If the database never captured any changes, then this step is not necessary.</span></li>
                     <li><span>Modify any rules that use the source database name as a condition. The source database name should be changed to the new global name of the source database where appropriate in these rules. You might need to modify capture process rules, propagation rules, and apply process rules at the local database and at remote databases in the environment. Typically, synchronous capture rules do not contain a condition for the source database.</span></li>
                     <li id="GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__i1019170"><span>Drop the apply processes that apply changes from the capture process that you dropped in Step <a href="managing-oracle-streams-replication.html#GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__i1019165">3</a>. Use the <code class="codeph">DROP_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package to drop an apply process. Apply processes that apply changes captured by synchronous capture do not need to be dropped.</span></li>
                     <li id="GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__i1019318"><span>At each destination database that applies changes from the source database, re-create the apply processes you dropped in Step <a href="managing-oracle-streams-replication.html#GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__i1019170">7</a>. You might want to associate the each apply process with the same rule sets it used before it was dropped. See <a href="configuring-implicit-apply.html#GUID-7D393976-B22F-4CF1-901E-62451DEB64DB"> Configuring Implicit Apply</a> for instructions.</span></li>
                     <li id="GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__i1019397"><span>Re-create the capture process you dropped in Step <a href="managing-oracle-streams-replication.html#GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__i1019165">3</a>, if necessary. You might want to associate the capture process with the same rule sets used by the capture process you dropped in Step <a href="managing-oracle-streams-replication.html#GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__i1019165">3</a>. See <span class="q">"<a href="configuring-implicit-capture.html#GUID-7E8A69CC-8B44-4F51-AE7E-E812035BC54B">Configuring a Capture Process</a>"</span> for instructions.</span></li>
                     <li><span>At the source database, prepare database objects whose changes will be captured by the re-created capture process for instantiation. See <span class="q">"<a href="instantiation-and-oracle-streams-replication.html#GUID-CBDA09E8-D2E0-4E56-B7A7-E87BDC26FC5A">Preparing Database Objects for Instantiation at a Source Database</a>"</span>.</span></li>
                     <li><span>At each destination database that applies changes from the source database, set the instantiation SCN for all databases objects to which changes from the source database will be applied. See <span class="q">"<a href="instantiation-and-oracle-streams-replication.html#GUID-35E458F3-6293-47A8-AB12-FA7720E99AC0">Setting Instantiation SCNs at a Destination Database</a>"</span> for instructions.</span></li>
                     <li><span>Disable the restricted session using the <code class="codeph">ALTER</code> <code class="codeph">SYSTEM</code> <code class="codeph">DISABLE</code> <code class="codeph">RESTRICTED</code> <code class="codeph">SESSION</code> statement.</span></li>
                     <li><span>At each destination database that applies changes from the source database, start the apply processes you created in Step <a href="managing-oracle-streams-replication.html#GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__i1019318">8</a>.</span></li>
                     <li><span>At the source database, start the capture process you created in Step <a href="managing-oracle-streams-replication.html#GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__i1019397">9</a>.</span></li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-15E7DA26-5E2C-4C0A-9626-6041C75E6E72__GUID-C107B167-435A-45F8-A29E-F8CA34725CFA">
                        <p class="notep1">See Also:</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=SUTIL014"><span class="italic">Oracle Database Utilities </span></a>for more information about changing the <code class="codeph">DBID</code> of a database using the DBNEWID utility
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STREP162"></a><div class="props_rev_3"><a id="GUID-BD253F79-7E78-46B8-8936-5AC9E5B4D1E1" name="GUID-BD253F79-7E78-46B8-8936-5AC9E5B4D1E1"></a><h3 id="STREP-GUID-BD253F79-7E78-46B8-8936-5AC9E5B4D1E1" class="sect3"><span class="enumeration_section">12.5 </span>Resynchronizing a Source Database in a Multiple-Source Environment
               </h3>
               <div>
                  <div class="section">
                     <p>A multiple-source environment is one in which there is more than one source database for any of the shared data. If a source database in a multiple-source environment cannot be recovered to the current point in time, then you can use the method described in this section to resynchronize the source database with the other source databases in the environment. Some reasons why a database cannot be recovered to the current point in time include corrupted archived redo logs or the media failure of an online redo log group.</p>
                     <p>For example, a bidirectional Oracle Streams environment is one in which exactly two databases share the replicated database objects and data. In this example, assume that database A is the database that must be resynchronized and that database B is the other source database in the environment. To resynchronize database A in this bidirectional Oracle Streams environment, complete the following steps:</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>Verify that database B has applied all of the changes sent from database A. You can query the <code class="codeph">V$BUFFERED_SUBSCRIBERS</code> data dictionary view at database B to determine whether the apply process that applies these changes has any unapplied changes in its queue. See the example on viewing propagations dequeuing LCRs from each buffered queue in <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=STRMS164"><span class="italic">Oracle Streams Concepts and Administration</span></a> for an example of such a query. Do not continue until all of these changes have been applied.</span></li>
                     <li><span>Remove the Oracle Streams configuration from database A by running the <code class="codeph">REMOVE_STREAMS_CONFIGURATION</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package. See<a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS508"><span class="italic"> Oracle Database PL/SQL Packages and Types Reference </span></a>for more information about this procedure.</span></li>
                     <li><span>At database B, drop the apply process that applies changes from database A. Do not drop the rule sets used by this apply process because you will re-create the apply process in a subsequent step.</span></li>
                     <li><span>Complete the steps in <span class="q">"<a href="adding-to-an-oracle-streams-replication-environment.html#GUID-1F59FF2A-F015-4A9F-B006-C812ADE140B7">Adding a New Database to an Existing Multiple-Source Environment</a>"</span> to add database A back into the Oracle Streams environment.</span></li>
                  </ol>
               </div>
            </div><a id="STREP121"></a><div class="props_rev_3"><a id="GUID-BF084D6E-24E9-4E6F-BBEE-11540CF844CD" name="GUID-BF084D6E-24E9-4E6F-BBEE-11540CF844CD"></a><h3 id="STREP-GUID-BF084D6E-24E9-4E6F-BBEE-11540CF844CD" class="sect3"><span class="enumeration_section">12.6 </span>Performing Database Point-in-Time Recovery in an Oracle Streams Environment
               </h3>
               <div>
                  <p>Point-in-time recovery is the recovery of a database to a specified noncurrent time, SCN, or log sequence number. The following sections discuss performing point-in-time recovery in an Oracle Streams replication environment:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3">Performing Point-in-Time Recovery on the Source in a Single-Source Environment</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-replication.html#GUID-ABC4B432-DD47-46AF-8889-5C90D231A4AA">Performing Point-in-Time Recovery in a Multiple-Source Environment</a></p>
                     </li>
                     <li>
                        <p><a href="managing-oracle-streams-replication.html#GUID-8738698A-F47F-496A-80BE-4DB1F19F2BA5">Performing Point-in-Time Recovery on a Destination Database</a></p>
                     </li>
                  </ul>
                  <div class="infoboxnotealso" id="GUID-BF084D6E-24E9-4E6F-BBEE-11540CF844CD__GUID-B64669E4-AA38-4973-A3B4-9D10510281A5">
                     <p class="notep1">See Also:</p>
                     <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=BRADV"><span class="italic">Oracle Database Backup and Recovery User's Guide </span></a>for more information about point-in-time recovery
                     </p>
                  </div>
               </div><a id="STREP444"></a><div class="props_rev_3"><a id="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3" name="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3"></a><h4 id="STREP-GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3" class="sect4"><span class="enumeration_section">12.6.1 </span>Performing Point-in-Time Recovery on the Source in a Single-Source Environment
                  </h4>
                  <div>
                     <div class="section">
                        <p>A single-source Oracle Streams replication environment is one in which there is only one source database for shared data. If database point-in-time recovery is required at the source database in a single-source Oracle Streams environment, and any capture processes that capture changes generated at a source database are running, then you must stop these capture processes before you perform the recovery operation. Both local and downstream capture process that capture changes generated at the source database must be stopped. Typically, database administrators reset the log sequence number of a database during point-in-time recovery. The <code class="codeph">ALTER</code> <code class="codeph">DATABASE</code> <code class="codeph">OPEN</code> <code class="codeph">RESETLOGS</code> statement is an example of a statement that resets the log sequence number.
                        </p>
                        <p>The instructions in this section assume that the single-source replication environment has the following characteristics:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Only one capture process named <code class="codeph">strm01_capture</code>, which can be a local or downstream capture process
                              </p>
                           </li>
                           <li>
                              <p>Only one destination database with the global name <code class="codeph">dest.example.com</code></p>
                           </li>
                           <li>
                              <p>Only one apply process named <code class="codeph">strm01_apply</code> at the destination database 
                              </p>
                           </li>
                        </ul>
                        <p>If point-in-time recovery must be performed on the source database, then you can follow these instructions to recover as many transactions as possible at the source database by using transactions applied at the destination database. These instructions assume that you can identify the transactions applied at the destination database after the source point-in-time SCN and execute these transactions at the source database.</p>
                        <div class="infoboxnote" id="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__GUID-587F2698-431D-4A2D-A894-4C3BA57D26D2">
                           <p class="notep1">Note:</p>
                           <p>Oracle recommends that you set the apply process parameter <code class="codeph">commit_serialization</code> to <code class="codeph">FULL</code> when performing point-in-time recovery in a single-source Oracle Streams replication environment.
                           </p>
                        </div>
                        <p>Complete the following steps to perform point-in-time recovery on the source database in a single-source Oracle Streams replication environment:</p>
                        <ol>
                           <li id="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__CEGECDDA">
                              <p>Perform point-in-time recovery on the source database if you have not already done so. Note the point-in-time recovery SCN because it is needed in subsequent steps.</p>
                           </li>
                           <li>
                              <p>Ensure that the source database is in restricted mode.</p>
                           </li>
                           <li>
                              <p>Connect to the database running the capture process and list the rule sets used by the capture process.</p>
                              <p>To list the rule sets used by the capture process, run the following query:</p><pre class="oac_no_warn" dir="ltr">COLUMN CAPTURE_NAME HEADING 'Capture|Process|Name' FORMAT A15
COLUMN RULE_SET_OWNER HEADING 'Positive|Rule Owner' FORMAT A15
COLUMN RULE_SET_NAME HEADING 'Positive|Rule Set' FORMAT A15
COLUMN NEGATIVE_RULE_SET_OWNER HEADING 'Negative|Rule Owner' FORMAT A15
COLUMN NEGATIVE_RULE_SET_NAME HEADING 'Negative|Rule Set' FORMAT A15
 
SELECT CAPTURE_NAME, 
       RULE_SET_OWNER, 
       RULE_SET_NAME, 
       NEGATIVE_RULE_SET_OWNER, 
       NEGATIVE_RULE_SET_NAME
   FROM DBA_CAPTURE;
</pre><p>Make a note of the rule sets used by the capture process. You will need to specify these rule sets for the new capture process in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021736">12</a>.
                              </p>
                           </li>
                           <li>
                              <p>Connect to the destination database and list the rule sets used by the apply process.</p>
                              <p>To list the rule sets used by the capture process, run the following query:</p><pre class="oac_no_warn" dir="ltr">COLUMN APPLY_NAME HEADING 'Apply|Process|Name' FORMAT A15
COLUMN RULE_SET_OWNER HEADING 'Positive|Rule Owner' FORMAT A15
COLUMN RULE_SET_NAME HEADING 'Positive|Rule Set' FORMAT A15
COLUMN NEGATIVE_RULE_SET_OWNER HEADING 'Negative|Rule Owner' FORMAT A15
COLUMN NEGATIVE_RULE_SET_NAME HEADING 'Negative|Rule Set' FORMAT A15
 
SELECT APPLY_NAME, 
       RULE_SET_OWNER, 
       RULE_SET_NAME, 
       NEGATIVE_RULE_SET_OWNER, 
       NEGATIVE_RULE_SET_NAME
   FROM DBA_APPLY;
</pre><p>Make a note of the rule sets used by the apply process. You will need to specify these rule sets for the new apply process in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__CEGCFGIJ">10.k</a>.
                              </p>
                           </li>
                           <li>
                              <p>Stop the capture process using the <code class="codeph">STOP_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package.
                              </p>
                           </li>
                           <li id="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021755">
                              <p>At the source database, perform a data dictionary build:</p><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON
DECLARE
  scn  NUMBER;
BEGIN
  DBMS_CAPTURE_ADM.BUILD(
    first_scn =&gt; scn);
  DBMS_OUTPUT.PUT_LINE('First SCN Value = ' || scn);
END;
/
</pre><p>Note the SCN value returned because it is needed in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021736">12</a>.
                              </p>
                           </li>
                           <li>
                              <p>At the destination database, wait until all of the transactions from the source database in the apply process's queue have been applied. The apply processes should become idle when these transactions have been applied. You can query the <code class="codeph">STATE</code> column in both the <code class="codeph">V$STREAMS_APPLY_READER</code> and <code class="codeph">V$STREAMS_APPLY_SERVER</code>. The state should be <code class="codeph">IDLE</code> for the apply process in both views before you continue.
                              </p>
                           </li>
                           <li id="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021233">
                              <p>Perform a query at the destination database to determine the highest SCN for a transaction that was applied.</p>
                              <p>If the apply process is running, then perform the following query:</p><pre class="oac_no_warn" dir="ltr">SELECT HWM_MESSAGE_NUMBER FROM V$STREAMS_APPLY_COORDINATOR
  WHERE APPLY_NAME = 'STRM01_APPLY';
</pre><p>If the apply process is disabled, then perform the following query:</p><pre class="oac_no_warn" dir="ltr">SELECT APPLIED_MESSAGE_NUMBER FROM DBA_APPLY_PROGRESS
  WHERE APPLY_NAME = 'STRM01_APPLY';
</pre><p>Note the highest apply SCN returned by the query because it is needed in subsequent steps.</p>
                           </li>
                           <li>
                              <p>If the highest apply SCN obtained in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021233">8</a> is less than the point-in-time recovery SCN noted in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__CEGECDDA">1</a>, then proceed to Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021351">10</a>. Otherwise, if the highest apply SCN obtained in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021233">8</a> is greater than or equal to the point-in-time recovery SCN noted in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__CEGECDDA">1</a>, then the apply process has applied some transactions from the source database after point-in-time recovery SCN, and you must complete the following steps:
                              </p>
                              <ol type="a">
                                 <li>
                                    <p>Manually execute the transactions that were applied after the point-in-time SCN at the source database. When you execute these transactions at the source database, ensure that you set an Oracle Streams tag in the session so that the transactions will not be captured by the capture process. If no such Oracle Streams session tag is set, then these changes can be cycled back to the destination database. See <span class="q">"<a href="oracle-streams-tags.html#GUID-CAC7C09B-FE65-4274-8BC1-E3692F1995DD">Managing Oracle Streams Tags for the Current Session</a>"</span> for instructions.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Disable the restricted session at the source database.</p>
                                 </li>
                                 <li>
                                    <p>Proceed to Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021655">11</a>. Do not complete Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021351">10</a>.
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li id="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021351">
                              <p>If the highest apply SCN obtained in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021233">8</a> is less than the point-in-time recovery SCN noted in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__CEGECDDA">1</a>, then the apply process has not applied any transactions from the source database after point-in-time recovery SCN, and you must complete the following steps:
                              </p>
                              <ol type="a">
                                 <li>
                                    <p>Disable the restricted session at the source database.</p>
                                 </li>
                                 <li>
                                    <p>Ensure that the apply process is running at the destination database.</p>
                                 </li>
                                 <li>
                                    <p>Set the <code class="codeph">maximum_scn</code> capture process parameter of the original capture process to the point-in-time recovery SCN using the <code class="codeph">SET_PARAMETER</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package. 
                                    </p>
                                 </li>
                                 <li>
                                    <p>Set the start SCN of the original capture process to the oldest SCN of the apply process. You can determine the oldest SCN of a running apply process by querying the <code class="codeph">OLDEST_SCN_NUM</code> column in the <code class="codeph">V$STREAMS_APPLY_READER</code> dynamic performance view at the destination database. To set the start SCN of the capture process, specify the <code class="codeph">start_scn</code> parameter when you run the <code class="codeph">ALTER_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Ensure that the capture process writes information to the alert log by running the following procedure:</p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_CAPTURE_ADM.SET_PARAMETER(
    capture_name =&gt; 'strm01_capture',
    parameter    =&gt; 'write_alert_log', 
    value        =&gt; 'Y');
END;
/
</pre></li>
                                 <li>
                                    <p>Start the original capture process using the <code class="codeph">START_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Ensure that the original capture process has captured all changes up to the <code class="codeph">maximum_scn</code> setting by querying the <code class="codeph">CAPTURED_SCN</code> column in the <code class="codeph">DBA_CAPTURE</code> data dictionary view. When the value returned by the query is equal to or greater than the <code class="codeph">maximum_scn</code> value, the capture process should stop automatically. When the capture process is stopped, proceed to the next step.
                                    </p>
                                 </li>
                                 <li id="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1022225">
                                    <p>Find the value of the <code class="codeph">LAST_ENQUEUE_MESSAGE_NUMBER</code> in the alert log. Note this value because it is needed in subsequent steps.
                                    </p>
                                 </li>
                                 <li>
                                    <p>At the destination database, wait until all the changes are applied. You can monitor the applied changes for the apply process <code class="codeph">strm01_apply</code> by running the following queries at the destination database:
                                    </p><pre class="oac_no_warn" dir="ltr">SELECT DEQUEUED_MESSAGE_NUMBER
  FROM V$STREAMS_APPLY_READER
  WHERE APPLY_NAME = 'STRM01_APPLY' AND
        DEQUEUED_MESSAGE_NUMBER = <span class="italic"><code class="codeph">last_enqueue_message_number</code></span>;
</pre><p>Substitute the <code class="codeph">LAST_ENQUEUE_MESSAGE_NUMBER</code> found in the alert log in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1022225">10.h</a> for <span class="italic">last_enqueue_message_number</span> on the last line of the query. When this query returns a row, all of the changes from the capture database have been applied at the destination database.
                                    </p>
                                    <p>Also, ensure that the state of the apply process reader server and each apply server is <code class="codeph">IDLE</code>. For example, run the following queries for an apply process named <code class="codeph">strm01_apply</code>:
                                    </p><pre class="oac_no_warn" dir="ltr">SELECT STATE FROM V$STREAMS_APPLY_READER 
  WHERE APPLY_NAME = 'STRM01_APPLY';

SELECT STATE FROM V$STREAMS_APPLY_SERVER 
  WHERE APPLY_NAME = 'STRM01_APPLY';
</pre><p>When both of these queries return <code class="codeph">IDLE</code>, move on to the next step.
                                    </p>
                                 </li>
                                 <li>
                                    <p>At the destination database, drop the apply process using the <code class="codeph">DROP_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package.
                                    </p>
                                 </li>
                                 <li id="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__CEGCFGIJ">
                                    <p>At the destination database, create a new apply process. The new apply process should use the same queue and rule sets used by the original apply process.</p>
                                 </li>
                                 <li>
                                    <p>At the destination database, start the new apply process using the <code class="codeph">START_APPLY</code> procedure in the <code class="codeph">DBMS_APPLY_ADM</code> package.
                                    </p>
                                 </li>
                              </ol>
                           </li>
                           <li id="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021655">
                              <p>Drop the original capture process using the <code class="codeph">DROP_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package. 
                              </p>
                           </li>
                           <li id="GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021736">
                              <p>Create a new capture process using the <code class="codeph">CREATE_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package to replace the capture process you dropped in Step&nbsp;<a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021655">11</a>. Specify the SCN returned by the data dictionary build in Step <a href="managing-oracle-streams-replication.html#GUID-2C997159-A1F8-46F8-855F-DB2F0B12BDC3__i1021755">6</a> for both the <code class="codeph">first_scn</code> and <code class="codeph">start_scn</code> parameters. The new capture process should use the same queue and rule sets as the original capture process.
                              </p>
                           </li>
                           <li>
                              <p>Start the new capture process using the <code class="codeph">START_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package.
                              </p>
                           </li>
                        </ol>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STREP445"></a><div class="props_rev_3"><a id="GUID-ABC4B432-DD47-46AF-8889-5C90D231A4AA" name="GUID-ABC4B432-DD47-46AF-8889-5C90D231A4AA"></a><h4 id="STREP-GUID-ABC4B432-DD47-46AF-8889-5C90D231A4AA" class="sect4"><span class="enumeration_section">12.6.2 </span>Performing Point-in-Time Recovery in a Multiple-Source Environment
                  </h4>
                  <div>
                     <div class="section">
                        <p>A multiple-source environment is one in which there is more than one source database for any of the shared data. If database point-in-time recovery is required at a source database in a multiple-source Oracle Streams environment, then you can use another source database in the environment to recapture the changes made to the recovered source database after the point-in-time recovery.</p>
                        <p>For example, in a multiple-source Oracle Streams environment, one source database can become unavailable at time T2 and undergo point in time recovery to an earlier time T1. After recovery to T1, transactions performed at the recovered database between T1 and T2 are lost at the recovered database. However, before the recovered database became unavailable, assume that these transactions were propagated to another source database and applied. In this case, you can use this other source database to restore the lost changes to the recovered database.</p>
                        <p>Specifically, to restore changes made to the recovered database after the point-in-time recovery, you configure a capture process to recapture these changes from the redo logs at the other source database, a propagation to propagate these changes from the database where changes are recaptured to the recovered database, and an apply process at the recovered database to apply these changes.</p>
                        <p>Changes originating at the other source database that were applied at the recovered database between T1 and T2 also have been lost and must be recovered. To accomplish this, alter the capture process at the other source database to start capturing changes at an earlier SCN. This SCN is the oldest SCN for the apply process at the recovered database.</p>
                        <p>The following SCN values are required to restore lost changes to the recovered database:</p>
                     </div>
                     <!-- class="section" -->
                     <div class="section">
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><span class="bold">Point-in-time SCN</span>: The SCN for the point-in-time recovery at the recovered database.
                              </p>
                           </li>
                           <li>
                              <p><span class="bold">Instantiation SCN</span>: The SCN value to which the instantiation SCN must be set for each database object involved in the recovery at the recovered database while changes are being reapplied. At the other source database, this SCN value corresponds to one less than the <span class="italic">commit SCN</span> of the first transaction that was applied at the other source database and lost at the recovered database.
                              </p>
                           </li>
                           <li>
                              <p><span class="bold">Start SCN</span>: The SCN value to which the start SCN is set for the capture process created to recapture changes at the other source database. This SCN value corresponds to the <span class="italic">earliest SCN</span> at which the apply process at the other source database started applying a transaction that was lost at the recovered database. This capture process can be a local or downstream capture process that uses the other source database for its source database.
                              </p>
                           </li>
                           <li>
                              <p><span class="bold">Maximum SCN</span>: The SCN value to which the <code class="codeph">maximum_scn</code> parameter for the capture process created to recapture lost changes should be set. The capture process stops capturing changes when it reaches this SCN value. The current SCN for the other source database is used for this value.
                              </p>
                           </li>
                        </ul>
                        <p>You should record the point-in-time SCN when you perform point-in-time recovery on the recovered database. You can use the <code class="codeph">GET_SCN_MAPPING</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package to determine the other necessary SCN values.
                        </p>
                        <div class="infoboxnotealso" id="GUID-ABC4B432-DD47-46AF-8889-5C90D231A4AA__GUID-624B3B27-DD2E-4448-A80F-711F9AFD281F">
                           <p class="notep1">See Also:</p>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS552"><span class="italic">Oracle Database PL/SQL Packages and Types Reference </span></a>for more information about the <code class="codeph">GET_SCN_MAPPING</code> procedure
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div><a id="STREP446"></a><div class="props_rev_3"><a id="GUID-8738698A-F47F-496A-80BE-4DB1F19F2BA5" name="GUID-8738698A-F47F-496A-80BE-4DB1F19F2BA5"></a><h4 id="STREP-GUID-8738698A-F47F-496A-80BE-4DB1F19F2BA5" class="sect4"><span class="enumeration_section">12.6.3 </span>Performing Point-in-Time Recovery on a Destination Database
                  </h4>
                  <div>
                     <p>If database point-in-time recovery is required at a destination database in an Oracle Streams environment, then you must reapply the captured changes that had already been applied after the point-in-time recovery.</p>
                     <p>For each relevant capture process, you can choose either of the following methods to perform point-in-time recovery at a destination database in an Oracle Streams environment:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Reset the start SCN for the existing capture process that captures the changes that are applied at the destination database.</p>
                        </li>
                        <li>
                           <p>Create a new capture process to capture the changes that must be reapplied at the destination database.</p>
                        </li>
                     </ul>
                     <p>Resetting the start SCN for the capture process is simpler than creating a new capture process. However, if the capture process captures changes that are applied at multiple destination databases, then the changes are resent to all the destination databases, including the ones that did not perform point-in-time recovery. If a change is already applied at a destination database, then it is discarded by the apply process, but you might not want to use the network and computer resources required to resend the changes to multiple destination databases. In this case, you can create and temporarily use a new capture process and a new propagation that propagates changes only to the destination database that was recovered.</p>
                     <p>The following sections provide instructions for each task:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><a href="managing-oracle-streams-replication.html#GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731">Resetting the Start SCN for the Existing Capture Process to Perform Recovery</a></p>
                        </li>
                        <li>
                           <p><a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE">Creating a New Capture Process to Perform Recovery</a></p>
                        </li>
                     </ul>
                     <p>If there are multiple apply processes at the destination database where you performed point-in-time recovery, then complete one of the tasks in this section for each apply process.</p>
                     <p>Neither of these methods should be used if any of the following conditions are true regarding the destination database you are recovering:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>A propagation propagates persistent LCRs to the destination database. Both of these methods reapply only captured LCRs at the destination database, not persistent LCRs. </p>
                        </li>
                        <li>
                           <p>In a directed networks configuration, the destination database is used to propagate LCRs from a capture process to other databases, but the destination database does not apply LCRs from this capture process.</p>
                        </li>
                        <li>
                           <p>The oldest message number for an apply process at the destination database is lower than the first SCN of a capture process that captures changes for this apply process. The following query at a destination database lists the oldest message number (oldest SCN) for each apply process:</p><pre class="oac_no_warn" dir="ltr">SELECT APPLY_NAME, OLDEST_MESSAGE_NUMBER FROM DBA_APPLY_PROGRESS;
</pre><p>The following query at a source database lists the first SCN for each capture process:</p><pre class="oac_no_warn" dir="ltr">SELECT CAPTURE_NAME, FIRST_SCN FROM DBA_CAPTURE;
</pre></li>
                        <li>
                           <p>The archived log files that contain the intended start SCN are no longer available.</p>
                        </li>
                     </ul>
                     <p>If any of these conditions are true in your environment, then you cannot use the methods described in this section. Instead, you must manually resynchronize the data at all destination databases.</p>
                     <div class="infoboxnote" id="GUID-8738698A-F47F-496A-80BE-4DB1F19F2BA5__GUID-717DC2B1-89FA-43DE-BA0F-ACDF9034E7CB">
                        <p class="notep1">Note:</p>
                        <p>If you are using combined capture and apply in a single-source replication environment, and the destination database has undergone point-in-time recovery, then the Oracle Streams capture process automatically detects where to capture changes upon restart, and no extra steps are required for it. See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=STRMS171"><span class="italic">Oracle Streams Concepts and Administration</span></a> for more information.
                        </p>
                     </div>
                     <div class="infoboxnotealso" id="GUID-8738698A-F47F-496A-80BE-4DB1F19F2BA5__GUID-7D8FFB7B-AED8-4FC8-863A-211E4A25CD35">
                        <p class="notep1">See Also:</p>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=STRMS"><span class="italic">Oracle Streams Concepts and Administration </span></a>for more information about <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=STRMS123">SCN values relating to a capture process</a> and <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=STRMS105">directed networks</a></p>
                     </div>
                  </div><a id="STREP447"></a><div class="props_rev_3"><a id="GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731" name="GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731"></a><h5 id="STREP-GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731" class="sect5"><span class="enumeration_section">12.6.3.1 </span>Resetting the Start SCN for the Existing Capture Process to Perform Recovery
                     </h5>
                     <div>
                        <div class="section">
                           <p>If you decide to reset the start SCN for the existing capture process to perform point-in-time recovery, then complete the following steps:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>If the destination database is also a source database in a multiple-source Oracle Streams environment, then complete the actions described in <span class="q">"<a href="managing-oracle-streams-replication.html#GUID-ABC4B432-DD47-46AF-8889-5C90D231A4AA">Performing Point-in-Time Recovery in a Multiple-Source Environment</a>"</span>.</span></li>
                           <li class="stepexpand"><span>Drop the propagation that propagates changes from the source queue at the source database to the destination queue at the destination database. Use the <code class="codeph">DROP_PROPAGATION</code> procedure in the <code class="codeph">DBMS_PROPAGATION_ADM</code> package to drop the propagation. </span><div>
                                 <p>If you are using directed networks, and there are intermediate databases between the source database and destination database, then drop the propagation at each intermediate database in the path to the destination database, including the propagation at the source database.</p>
                                 <p>Do not drop the rule sets used by the propagations you drop.</p>
                                 <p>If the existing capture process is a downstream capture process that is configured at the destination database, then the downstream capture process is recovered to the same point-in-time as the destination database when you perform point-in-time recovery in Step <a href="managing-oracle-streams-replication.html#GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731__CHDDGEIH">3</a>. In this case, the remaining steps in this section after Step <a href="managing-oracle-streams-replication.html#GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731__CHDDGEIH">3</a> are not required. Ensure that the required redo log files are available to the capture process.
                                 </p>
                                 <div class="infoboxnote" id="GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731__GUID-E75A1756-B4F5-4519-84D2-38C16936D739">
                                    <p class="notep1">Note:</p>
                                    <p>You must drop the appropriate propagation(s). Disabling them is not sufficient. You will re-create the propagation(s) in Step&nbsp;<a href="managing-oracle-streams-replication.html#GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731__i1011315">7</a>, and dropping them now ensures that only LCRs created after resetting the start SCN for the capture process are propagated.
                                    </p>
                                 </div>
                                 <div class="infoboxnotealso" id="GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731__GUID-057C5A1F-AE0E-429A-8952-B870B3243B81">
                                    <p class="notep1">See Also:</p>
                                    <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=STRMS105"><span class="italic">Oracle Streams Concepts and Administration </span></a>for more information about directed networks
                                    </p>
                                 </div>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731__CHDDGEIH"><span>Perform the point-in-time recovery at the destination database.</span></li>
                           <li class="stepexpand" id="GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731__i1011297"><span>Query for the oldest message number (oldest SCN) from the source database for the apply process at the destination database. Make a note of the results of the query. The oldest message number is the earliest system change number (SCN) that might need to be applied.</span><div>
                                 <p>The following query at a destination database lists the oldest message number for each apply process:</p><pre class="oac_no_warn" dir="ltr">SELECT APPLY_NAME, OLDEST_MESSAGE_NUMBER FROM DBA_APPLY_PROGRESS;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>Stop the existing capture process using the <code class="codeph">STOP_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package.</span></li>
                           <li class="stepexpand"><span>Reset the start SCN of the existing capture process.</span><div>
                                 <p>To reset the start SCN for an existing capture process, run the <code class="codeph">ALTER_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package and set the <code class="codeph">start_scn</code> parameter to the value you recorded from the query in Step <a href="managing-oracle-streams-replication.html#GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731__i1011297">4</a>. For example, to reset the start SCN for a capture process named <code class="codeph">strm01_capture</code> to the value <code class="codeph">829381993</code>, run the following <code class="codeph">ALTER_CAPTURE</code> procedure:
                                 </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_CAPTURE_ADM.ALTER_CAPTURE(
    capture_name  =&gt;  'strm01_capture',
    start_scn     =&gt;  829381993);
END;
/
</pre></div>
                           </li>
                           <li class="stepexpand" id="GUID-8F3D4AB1-3E6B-433F-8F36-7A5AC1467731__i1011315"><span>If you are not using directed networks between the source database and destination database, then create a new propagation to propagate changes from the source queue to the destination queue using the <code class="codeph">CREATE_PROPAGATION</code> procedure in the <code class="codeph">DBMS_PROPAGATION_ADM</code> package. Specify any rule sets used by the original propagation when you create the propagation.</span><div>
                                 <p>If you are using directed networks, and there are intermediate databases between the source database and destination database, then create a new propagation at each intermediate database in the path to the destination database, including the propagation at the source database.</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Start the existing capture process using the <code class="codeph">START_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package.</span></li>
                        </ol>
                     </div>
                  </div><a id="STREP448"></a><div class="props_rev_3"><a id="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE" name="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE"></a><h5 id="STREP-GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE" class="sect5"><span class="enumeration_section">12.6.3.2 </span>Creating a New Capture Process to Perform Recovery
                     </h5>
                     <div>
                        <div class="section">
                           <p>If you decide to create a capture process to perform point-in-time recovery, then complete the following steps:</p>
                        </div>
                        <!-- class="section" -->
                        <ol>
                           <li class="stepexpand"><span>If the destination database is also a source database in a multiple-source Oracle Streams environment, then complete the actions described in <span class="q">"<a href="managing-oracle-streams-replication.html#GUID-ABC4B432-DD47-46AF-8889-5C90D231A4AA">Performing Point-in-Time Recovery in a Multiple-Source Environment</a>"</span>.</span></li>
                           <li class="stepexpand" id="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__CEGCGHAF"><span>If you are not using directed networks between the source database and destination database, then drop the propagation that propagates changes from the source queue at the source database to the destination queue at the destination database. Use the <code class="codeph">DROP_PROPAGATION</code> procedure in the <code class="codeph">DBMS_PROPAGATION_ADM</code> package to drop the propagation.</span><div>
                                 <p>If you are using directed networks, and there are intermediate databases between the source database and destination database, then drop the propagation that propagates LCRs between the last intermediate database and the destination database. You do not need to drop the propagations at the other intermediate databases nor at the source database.</p>
                                 <div class="infoboxnote" id="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__GUID-99D38FCF-2060-45B4-9230-C0D8EA7A787D">
                                    <p class="notep1">Note:</p>
                                    <p>You must drop the appropriate propagation. Disabling it is not sufficient.</p>
                                 </div>
                                 <div class="infoboxnotealso" id="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__GUID-3C9F33CD-972C-40EC-8654-6C9C0F928770">
                                    <p class="notep1">See Also:</p>
                                    <p><a href="../strms/oracle-streams-staging-and-propagation.html#STRMS105"><span class="italic">Oracle Streams Concepts and Administration </span></a>for more information about directed networks
                                    </p>
                                 </div>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Perform the point-in-time recovery at the destination database.</span></li>
                           <li class="stepexpand" id="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011342"><span>Query for the oldest message number (oldest SCN) from the source database for the apply process at the destination database. Make a note of the results of the query. The oldest message number is the earliest system change number (SCN) that might need to be applied.</span><div>
                                 <p>The following query at a destination database lists the oldest message number for each apply process:</p><pre class="oac_no_warn" dir="ltr">SELECT APPLY_NAME, OLDEST_MESSAGE_NUMBER FROM DBA_APPLY_PROGRESS;
</pre></div>
                           </li>
                           <li class="stepexpand" id="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011347"><span>Create a queue at the source database to be used by the capture process using the <code class="codeph">SET_UP_QUEUE</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package.</span><div>
                                 <p>If you are using directed networks, and there are intermediate databases between the source database and destination database, then create a queue at each intermediate database in the path to the destination database, including the new queue at the source database. Do not create a new queue at the destination database.</p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011350"><span>If you are not using directed networks between the source database and destination database, then create a new propagation to propagate changes from the source queue created in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011347">5</a> to the destination queue using the <code class="codeph">CREATE_PROPAGATION</code> procedure in the <code class="codeph">DBMS_PROPAGATION_ADM</code> package. Specify any rule sets used by the original propagation when you create the propagation.</span><div>
                                 <p>If you are using directed networks, and there are intermediate databases between the source database and destination database, then create a propagation at each intermediate database in the path to the destination database, including the propagation from the source database to the first intermediate database. These propagations propagate changes captured by the capture process you will create in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011362">7</a> between the queues created in&nbsp;Step&nbsp;<a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011347">5</a>.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand" id="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011362"><span>Create a new capture process at the source database using the <code class="codeph">CREATE_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package. Set the <code class="codeph">source_queue</code> parameter to the local queue you created in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011347">5</a> and the <code class="codeph">start_scn</code> parameter to the value you recorded from the query in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011342">4</a>. Also, specify any rule sets used by the original capture process. If the rule sets used by the original capture process instruct the capture process to capture changes that should not be sent to the destination database that was recovered, then you can create and use smaller, customized rule sets that share some rules with the original rule sets.</span></li>
                           <li class="stepexpand" id="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011370"><span>Start the capture process you created in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011362">7</a> using the <code class="codeph">START_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package.</span></li>
                           <li class="stepexpand" id="GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011375"><span>When the oldest message number of the apply process at the recovered database is approaching the capture number of the original capture process at the source database, stop the original capture process using the <code class="codeph">STOP_CAPTURE</code> procedure in the <code class="codeph">DBMS_CAPTURE_ADM</code> package. </span><div>
                                 <p>At the destination database, you can use the following query to determine the oldest message number from the source database for the apply process:</p><pre class="oac_no_warn" dir="ltr">SELECT APPLY_NAME, OLDEST_MESSAGE_NUMBER FROM DBA_APPLY_PROGRESS;
</pre><p>At the source database, you can use the following query to determine the capture number of the original capture process:</p><pre class="oac_no_warn" dir="ltr">SELECT CAPTURE_NAME, CAPTURE_MESSAGE_NUMBER FROM V$STREAMS_CAPTURE;
</pre></div>
                           </li>
                           <li class="stepexpand"><span>When the oldest message number of the apply process at the recovered database is beyond the capture number of the original capture process at the source database, drop the new capture process created in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011362">7</a>.</span></li>
                           <li class="stepexpand"><span>If you are not using directed networks between the source database and destination database, then drop the new propagation created in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011350">6</a>.</span><div>
                                 <p>If you are using directed networks, and there are intermediate databases between the source database and destination database, then drop the new propagation at each intermediate database in the path to the destination database, including the new propagation at the source database.</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>If you are not using directed networks between the source database and destination database, then remove the queue created in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011347">5</a>.</span><div>
                                 <p>If you are using directed networks, and there are intermediate databases between the source database and destination database, then drop the new queue at each intermediate database in the path to the destination database, including the new queue at the source database. Do not drop the queue at the destination database.</p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>If you are not using directed networks between the source database and destination database, then create a propagation that propagates changes from the original source queue at the source database to the destination queue at the destination database. Use the <code class="codeph">CREATE_PROPAGATION</code> procedure in the <code class="codeph">DBMS_PROPAGATION_ADM</code> package to create the propagation. Specify any rule sets used by the original propagation when you create the propagation.</span><div>
                                 <p>If you are using directed networks, and there are intermediate databases between the source database and destination database, then re-create the propagation from the last intermediate database to the destination database. You dropped this propagation in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__CEGCGHAF">2</a>.
                                 </p>
                              </div>
                           </li>
                           <li class="stepexpand"><span>Start the capture process you stopped in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011375">9</a>.</span></li>
                        </ol>
                        <div class="section">
                           <p>All of the steps after Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011370">8</a> can be deferred to a later time, or they can be done as soon as the condition described in Step <a href="managing-oracle-streams-replication.html#GUID-7F2A0BFE-822B-4EE6-A28A-4B97E2DA8FDE__i1011375">9</a> is met.
                           </p>
                        </div>
                        <!-- class="section" -->
                     </div>
                  </div>
               </div>
            </div><a id="STREP133"></a><div class="props_rev_3"><a id="GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D" name="GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D"></a><h3 id="STREP-GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D" class="sect3"><span class="enumeration_section">12.7 </span>Running Flashback Queries in an Oracle Streams Replication Environment
               </h3>
               <div>
                  <div class="section">
                     <p>Oracle Flashback Query enables you to view and repair historical data. You can perform queries on a database as of a certain clock time or system change number (SCN). In an Oracle Streams single-source replication environment, you can use Flashback Query at the source database and a destination database at a past time when the replicated database objects should be identical.</p>
                     <p>You can run the queries at corresponding SCNS at the source and destination databases to determine whether all of the changes to the replicated objects performed at the source database have been applied at the destination database. If there are apply errors at the destination database, then such a Flashback Query can show how the replicated objects looked at the time when the error was raised. This information could be useful in determining the cause of the error and the best way to correct the error.</p>
                     <p>Running a Flashback Query at each database can also check whether tables have certain rows at the corresponding SCNs. If the table data does not match at the corresponding SCNs, then there is a problem with the replication environment.</p>
                     <p>To run queries, the Oracle Streams replication environment must have the following characteristics:</p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>The replication environment must be a single-source environment, where changes to replicated objects are captured at only one database.</p>
                        </li>
                        <li>
                           <p>No modifications are made to the replicated objects in the Stream. That is, no transformations, subset rules (row migration), or apply handlers modify the LCRs for the replicated objects.</p>
                        </li>
                        <li>
                           <p>No DML or DDL changes are made to the replicated objects at the destination database.</p>
                        </li>
                        <li>
                           <p>Both the source database and the destination database must be configured to use Oracle Flashback, and the Oracle Streams administrator at both databases must be able to execute subprograms in the <code class="codeph">DBMS_FLASHBACK</code> package.
                           </p>
                        </li>
                        <li>
                           <p>The information in the undo tablespace must go back far enough to perform the query at each database. Oracle Flashback features use the Automatic Undo Management system to obtain historical data and metadata for a transaction. The <code class="codeph">UNDO_RETENTION</code> initialization parameter at each database must be set to a value that is large enough to perform the Flashback Query. 
                           </p>
                        </li>
                     </ul>
                     <p>Because Oracle Streams replication is asynchronous, you cannot use a past time in the Flashback Query. However, you can use the <code class="codeph">GET_SCN_MAPPING</code> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package to determine the SCN at the destination database that corresponds to an SCN at the source database.
                     </p>
                     <p>These instructions assume that you know the SCN for the Flashback Query at the source database. Using this SCN, you can determine the corresponding SCN for the Flashback Query at the destination database. To run these queries, complete the following steps:</p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li class="stepexpand" id="GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D__BABEHEHC"><span>At the destination database, ensure that the archived redo log file for the approximate time of the Flashback Query is available to the database. The <code class="codeph">GET_SCN_MAPPING</code> procedure requires that this redo log file be available.</span></li>
                     <li class="stepexpand"><span>In SQL*Plus, connect to the destination database as the Oracle Streams administrator.</span><div>
                           <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for instructions about connecting to a database in SQL*Plus.
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand" id="GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D__i1017192"><span>Run the <code class="codeph">GET_SCN_MAPPING</code> procedure. In this example, assume that the SCN for the source database is <code class="codeph">52073983</code> and that the name of the apply process that applies changes from the source database is <code class="codeph">strm01_apply</code>:</span><div><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON
DECLARE
  dest_scn   NUMBER;
  start_scn  NUMBER;
  dest_skip  DBMS_UTILITY.NAME_ARRAY;
BEGIN
  DBMS_STREAMS_ADM.GET_SCN_MAPPING(
    apply_name             =&gt; 'strm01_apply',
    src_pit_scn            =&gt; '52073983',
    dest_instantiation_scn =&gt; dest_scn,
    dest_start_scn         =&gt; start_scn,
    dest_skip_txn_ids      =&gt; dest_skip);
  IF dest_skip.count = 0 THEN
    DBMS_OUTPUT.PUT_LINE('No Skipped Transactions');
    DBMS_OUTPUT.PUT_LINE('Destination SCN: ' || dest_scn);
  ELSE
    DBMS_OUTPUT.PUT_LINE('Destination SCN invalid for Flashback Query.');
    DBMS_OUTPUT.PUT_LINE('At least one transaction was skipped.');
  END IF;
END;
/
</pre><p>If a valid destination SCN is returned, then proceed to Step <a href="managing-oracle-streams-replication.html#GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D__i1017206">4</a>. 
                           </p>
                           <p>If the destination SCN was not valid for Flashback Query because one or more transactions were skipped by the apply process, then the apply process parameter <code class="codeph">commit_serialization</code> was set to <code class="codeph">DEPENDENT_TRANSACTIONS</code>, and nondependent transactions have been applied out of order. There is at least one transaction with a source commit SCN less than <code class="codeph">src_pit_scn</code> that was committed at the destination database after the returned <code class="codeph">dest_instantiation_scn</code>. Therefore, tables might not be the same at the source and destination databases for the specified source SCN. You can choose a different source SCN and restart at Step <a href="managing-oracle-streams-replication.html#GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D__BABEHEHC">1</a>.
                           </p>
                        </div>
                     </li>
                     <li class="stepexpand" id="GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D__i1017206"><span>Run the Flashback Query at the source database using the source SCN.</span></li>
                     <li class="stepexpand" id="GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D__i1017210"><span>Run the Flashback Query at the destination database using the SCN returned in Step <a href="managing-oracle-streams-replication.html#GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D__i1017192">3</a>.</span></li>
                     <li class="stepexpand"><span>Compare the results of the queries in Steps <a href="managing-oracle-streams-replication.html#GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D__i1017206">4</a> and <a href="managing-oracle-streams-replication.html#GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D__i1017210">5</a> and take any necessary action.</span></li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-F76D1CF1-3DB8-4CDC-BEF6-F628A5865B8D__GUID-AD4A2FDA-C18C-4EA3-9652-37DB9B82159D">
                        <p class="notep1">See Also:</p>
                        <p></p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ADFNS1008"><span class="italic">Oracle Database Development Guide </span></a>for more information about Flashback&nbsp;Query
                              </p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS552"><span class="italic">Oracle Database PL/SQL Packages and Types Reference </span></a>for more information about the <code class="codeph">GET_SCN_MAPPING</code> procedure
                              </p>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div><a id="STREP149"></a><div class="props_rev_3"><a id="GUID-52B85E39-2264-47E2-981A-63CA23C7380A" name="GUID-52B85E39-2264-47E2-981A-63CA23C7380A"></a><h3 id="STREP-GUID-52B85E39-2264-47E2-981A-63CA23C7380A" class="sect3"><span class="enumeration_section">12.8 </span>Recovering from Operation Errors
               </h3>
               <div>
                  <p>You can recover from the following operations using the <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS865"><code class="codeph">RECOVER_OPERATION</code></a> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Split and merge operations using:</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Automatic split and merge operations invoked by the <code class="codeph">split_threshold</code> and <code class="codeph">merge_threshold</code> capture process parameters.
                              </p>
                           </li>
                           <li>
                              <p>Spit and merge operations that use the <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS867"><code class="codeph">SPLIT_STREAMS</code></a> and <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS881"><code class="codeph">MERGE_STREAMS_JOB</code></a> procedures in the <code class="codeph">DBMS_STREAMS_ADM</code> package.
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Change table configuration operations performed by the <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS72443"><code class="codeph">MAINTAIN_CHANGE_TABLE</code></a> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package.
                        </p>
                     </li>
                     <li>
                        <p>Replication configuration operations performed by the following procedures in the <code class="codeph">DBMS_STREAMS_ADM</code> package:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS825"><code class="codeph">MAINTAIN_GLOBAL</code></a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS826"><code class="codeph">MAINTAIN_SCHEMAS</code></a></p>
                           </li>
                           <li>
                              <p><a href="../arpls/DBMS_STREAMS_ADM.html#ARPLS863"><code class="codeph">MAINTAIN_SIMPLE_TTS</code></a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS827"><code class="codeph">MAINTAIN_TABLES</code></a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS864"><code class="codeph">MAINTAIN_TTS</code></a></p>
                           </li>
                           <li>
                              <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS831"><code class="codeph">PRE_INSTANTIATION_SETUP</code></a> and <a href="../arpls/DBMS_STREAMS_ADM.html#ARPLS830"><code class="codeph">POST_INSTANTIATION_SETUP</code></a></p>
                           </li>
                        </ul>
                     </li>
                  </ul>
                  <p>Information about the operation is stored in the following data dictionary views when the operation is in process:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><a href="../refrn/DBA_RECOVERABLE_SCRIPT.html#REFRN23545"><code class="codeph">DBA_RECOVERABLE_SCRIPT</code></a></p>
                     </li>
                     <li>
                        <p><a href="../refrn/DBA_RECOVERABLE_SCRIPT_HIST.html#REFRN23755"><code class="codeph">DBA_RECOVERABLE_SCRIPT_HIST</code></a></p>
                     </li>
                     <li>
                        <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=REFRN23548"><code class="codeph">DBA_RECOVERABLE_SCRIPT_PARAMS</code></a></p>
                     </li>
                     <li>
                        <p><a href="../refrn/DBA_RECOVERABLE_SCRIPT_BLOCKS.html#REFRN23546"><code class="codeph">DBA_RECOVERABLE_SCRIPT_BLOCKS</code></a></p>
                     </li>
                     <li>
                        <p><a href="../refrn/DBA_RECOVERABLE_SCRIPT_ERRORS.html#REFRN23547"><code class="codeph">DBA_RECOVERABLE_SCRIPT_ERRORS</code></a></p>
                     </li>
                  </ul>
                  <div class="infoboxnote" id="GUID-52B85E39-2264-47E2-981A-63CA23C7380A__GUID-AF82E4C5-2D9F-4C4A-BA72-7C230DF3E2B4">
                     <p class="notep1">Note:</p>
                     <p>If the <code class="codeph">perform_actions</code> parameter is set to <code class="codeph">FALSE</code> when one of the configuration procedures is run, and a script is used to configure the Oracle Streams replication environment, then these data dictionary views are not populated, and the <code class="codeph">RECOVER_OPERATION</code> procedure cannot be used for the operation.
                     </p>
                  </div>
                  <p>When the operation completes successfully, metadata about the operation is moved from the <code class="codeph">DBA_RECOVERABLE_SCRIPT</code> view to the <code class="codeph">DBA_RECOVERABLE_SCRIPT_HIST</code> view. The other views, <code class="codeph">DBA_RECOVERABLE_SCRIPT_PARAMS</code>, <code class="codeph">DBA_RECOVERABLE_SCRIPT_BLOCKS</code>, and <code class="codeph">DBA_RECOVERABLE_SCRIPT_ERRORS</code>, retain information about the operation until it is purged automatically after 30 days.
                  </p>
                  <p>When the operation encounters an error, you can use the <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS865"><code class="codeph">RECOVER_OPERATION</code></a> procedure in the <code class="codeph">DBMS_STREAMS_ADM</code> package to either roll the operation forward, roll the operation back, or purge the metadata about the operation. Specifically, the <code class="codeph">operation_mode</code> parameter in the <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS865"><code class="codeph">RECOVER_OPERATION</code></a> procedure provides the following options:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">FORWARD</code>: This option attempts to complete the operation from the point at which it failed. Before specifying this option, correct the conditions that caused the errors reported in the <code class="codeph">DBA_RECOVERABLE_SCRIPT_ERRORS</code> view.
                        </p>
                        <p>You can also use the <code class="codeph">FORWARD</code> option to obtain more information about what caused the error. To do so, run <code class="codeph">SET</code> <code class="codeph">SERVEROUTPUT</code> <code class="codeph">ON</code> in SQL*Plus and run the <code class="codeph">RECOVER_OPERATION</code> procedure with the appropriate script ID. The <code class="codeph">RECOVER_OPERATION</code> procedure shows the actions that lead to the error and the error numbers and messages.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">ROLLBACK</code>: This option rolls back all of the actions performed by the operation. If the rollback is successful, then this option also moves the metadata about the operation from the <code class="codeph">DBA_RECOVERABLE_SCRIPT</code> view to the <code class="codeph">DBA_RECOVERABLE_SCRIPT_HIST</code> view. The other views retain information about the operation for 30 days.
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">PURGE</code>: This option moves the metadata about the operation from the <code class="codeph">DBA_RECOVERABLE_SCRIPT</code> view to the <code class="codeph">DBA_RECOVERABLE_SCRIPT_HIST</code> view without rolling the operation back. The other views retain information about the operation for 30 days.
                        </p>
                     </li>
                  </ul>
                  <p>When a recovery operation is complete, information about the operation is stored in the <code class="codeph">DBA_RECOVERABLE_SCRIPT_HIST</code> view. The <code class="codeph">STATUS</code> column shows either <code class="codeph">EXECUTED</code> or <code class="codeph">PURGED</code> for each recovery operation.
                  </p>
                  <div class="infoboxnote" id="GUID-52B85E39-2264-47E2-981A-63CA23C7380A__GUID-3F4C5244-EA5E-4566-8D30-44E4F3F8DE41">
                     <p class="notep1">Note:</p>
                     <p>To run the <code class="codeph">RECOVER_OPERATION</code> procedure, both databases must be Oracle Database 10<span class="italic">g</span> Release 2 or later databases.
                     </p>
                  </div>
                  <div class="infoboxnotealso" id="GUID-52B85E39-2264-47E2-981A-63CA23C7380A__GUID-EBEA0B7F-9931-4BEA-B2FA-A8B6E766757D">
                     <p class="notep1">See Also:</p>
                     <p></p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p><span class="q">"<a href="simple-oracle-streams-replication-configuration.html#GUID-8FAAAEF7-0689-4A95-8BD4-D8630CE45FD5">Configuring Replication Using the DBMS_STREAMS_ADM Package</a>"</span> for more information about configuring an Oracle Streams replication environment with these procedures
                           </p>
                        </li>
                        <li>
                           <p><span class="q">"<a href="preparing-for-oracle-streams-replication.html#GUID-BB2E76CA-3645-4469-8750-4B276B8A955B">Tasks to Complete Before Configuring Oracle Streams Replication</a>"</span> for information about prerequisites that must be met before running these procedures
                           </p>
                        </li>
                        <li>
                           <p><a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ARPLS865"><span class="italic">Oracle Database PL/SQL Packages and Types Reference</span></a></p>
                        </li>
                     </ul>
                  </div>
               </div><a id="STREP273"></a><div class="props_rev_3"><a id="GUID-C0B06B85-5F3E-4E58-8979-6D62136BCBA6" name="GUID-C0B06B85-5F3E-4E58-8979-6D62136BCBA6"></a><h4 id="STREP-GUID-C0B06B85-5F3E-4E58-8979-6D62136BCBA6" class="sect4"><span class="enumeration_section">12.8.1 </span>Recovery Scenario
                  </h4>
                  <div>
                     <div class="section">
                        <p>This section contains a scenario in which the <code class="codeph">MAINTAIN_SCHEMAS</code> procedure stops because it encounters an error. Assume that the following procedure encountered an error when it was run at the capture database:
                        </p><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.MAINTAIN_SCHEMAS(
    schema_names                 =&gt; 'hr',
    source_directory_object      =&gt; 'SOURCE_DIRECTORY',
    destination_directory_object =&gt; 'DEST_DIRECTORY',
    source_database              =&gt; 'dbs1.example.com',
    destination_database         =&gt; 'dbs2.example.com',
    perform_actions              =&gt; TRUE,
    dump_file_name               =&gt; 'export_hr.dmp',
    capture_queue_table          =&gt; 'rep_capture_queue_table',
    capture_queue_name           =&gt; 'rep_capture_queue',
    capture_queue_user           =&gt; NULL,
    apply_queue_table            =&gt; 'rep_dest_queue_table',
    apply_queue_name             =&gt; 'rep_dest_queue',
    apply_queue_user             =&gt; NULL,
    capture_name                 =&gt; 'capture_hr',
    propagation_name             =&gt; 'prop_hr',
    apply_name                   =&gt; 'apply_hr',
    log_file                     =&gt; 'export_hr.clg',
    bi_directional               =&gt; FALSE,
    include_ddl                  =&gt; TRUE,
    instantiation                =&gt; DBMS_STREAMS_ADM.INSTANTIATION_SCHEMA);
END;
/
</pre><p>Complete the following steps to diagnose the problem and recover the operation:</p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>In SQL*Plus, connect to the capture database as the Oracle Streams administrator.</span><div>
                              <p>See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ADMIN00102"><span class="italic">Oracle Database Administrator's Guide</span></a> for instructions about connecting to a database in SQL*Plus.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand" id="GUID-C0B06B85-5F3E-4E58-8979-6D62136BCBA6__CIAHCFDA"><span>Determine the <code class="codeph">SCRIPT_ID</code> value for the operation by running the following query:</span><div><pre class="oac_no_warn" dir="ltr">SELECT SCRIPT_ID FROM DBA_RECOVERABLE_SCRIPT ORDER BY CREATION_TIME DESC;
</pre><p>This query assumes that the most recent configuration operation is the one that encountered errors. Therefore, if more than one <code class="codeph">SCRIPT_ID</code> is returned by the query, then use the first <code class="codeph">SCRIPT_ID</code> in the list.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand" id="GUID-C0B06B85-5F3E-4E58-8979-6D62136BCBA6__CEGIJAGA"><span>Query the <code class="codeph">DBA_RECOVERABLE_SCRIPT_ERRORS</code> data dictionary view to determine the error and specify the <code class="codeph">SCRIPT_ID</code> returned in Step <a href="managing-oracle-streams-replication.html#GUID-C0B06B85-5F3E-4E58-8979-6D62136BCBA6__CIAHCFDA">2</a> in the <code class="codeph">WHERE</code> clause.</span><div>
                              <p>For example, if the <code class="codeph">SCRIPT_ID</code> is <code class="codeph">F73ED2C9E96B27B0E030578CB10B2424</code>, then run the following query:
                              </p><pre class="oac_no_warn" dir="ltr">COLUMN SCRIPT_ID     HEADING 'Script ID'     FORMAT A35
COLUMN BLOCK_NUM     HEADING 'Block|Number' FORMAT 999999
COLUMN ERROR_MESSAGE HEADING 'Error Message' FORMAT A33

SELECT BLOCK_NUM, ERROR_MESSAGE 
  FROM DBA_RECOVERABLE_SCRIPT_ERRORS
  WHERE SCRIPT_ID = 'F73ED2C9E96B27B0E030578CB10B2424';
</pre><p>The query returns the following output:</p><pre class="oac_no_warn" dir="ltr">Block
Number Error Message
------- ---------------------------------
     12 ORA-39001: invalid argument value
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Query the <code class="codeph">DBA_RECOVERABLE_SCRIPT_BLOCKS</code> data dictionary view for the script ID returned in Step <a href="managing-oracle-streams-replication.html#GUID-C0B06B85-5F3E-4E58-8979-6D62136BCBA6__CIAHCFDA">2</a> and block number returned in Step <a href="managing-oracle-streams-replication.html#GUID-C0B06B85-5F3E-4E58-8979-6D62136BCBA6__CEGIJAGA">3</a> for information about the block in which the error occurred.</span><div>
                              <p>For example, if the script ID is <code class="codeph">F73ED2C9E96B27B0E030578CB10B2424</code> and the block number is <code class="codeph">12</code>, run the following query:
                              </p><pre class="oac_no_warn" dir="ltr">COLUMN FORWARD_BLOCK        HEADING 'Forward Block'               FORMAT A50
COLUMN FORWARD_BLOCK_DBLINK HEADING 'Forward Block|Database Link' FORMAT A13
COLUMN STATUS               HEADING 'Status'                      FORMAT A12

SET LONG 10000
SELECT FORWARD_BLOCK,
       FORWARD_BLOCK_DBLINK,
       STATUS
  FROM DBA_RECOVERABLE_SCRIPT_BLOCKS
  WHERE SCRIPT_ID = 'F73ED2C9E96B27B0E030578CB10B2424' AND
        BLOCK_NUM = 12;
</pre><p>The output contains the following information:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The <code class="codeph">FORWARD_BLOCK</code> column contains detailed information about the actions performed by the procedure in the specified block. If necessary, spool the output into a file. In this scenario, the <code class="codeph">FORWARD_BLOCK</code> column for block <code class="codeph">12</code> contains the code for the Data Pump export.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">FORWARD_BLOCK_DBLINK</code> column shows the database where the block is executed. In this scenario, the <code class="codeph">FORWARD_BLOCK_DBLINK</code> column for block <code class="codeph">12</code> shows <code class="codeph">DBS1.EXAMPLE.COM</code> because the Data Pump export was being performed on <code class="codeph">DBS1.EXAMPLE.COM</code> when the error occurred.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">STATUS</code> column shows the status of the block execution. In this scenario, the <code class="codeph">STATUS</code> column for block <code class="codeph">12</code> shows <code class="codeph">ERROR</code>.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Optionally, run the <code class="codeph">RECOVER_OPERATION</code> procedure operation at the capture database with <code class="codeph">SET</code> <code class="codeph">SERVEROUTPUT</code> <code class="codeph">ON</code> to display more information about the errors:</span><div><pre class="oac_no_warn" dir="ltr">SET SERVEROUTPUT ON
BEGIN
  DBMS_STREAMS_ADM.RECOVER_OPERATION(
    script_id       =&gt; 'F73ED2C9E96B27B0E030578CB10B2424',
    operation_mode  =&gt; 'FORWARD');
END;
/
</pre><p>With server output on, the actions that caused the error run again, and the actions and the resulting errors are displayed.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Interpret the output from the previous steps and diagnose the problem. The output returned in Step <a href="managing-oracle-streams-replication.html#GUID-C0B06B85-5F3E-4E58-8979-6D62136BCBA6__CEGIJAGA">3</a> provides the following information:</span><div>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>The unique identifier for the configuration operation is <code class="codeph">F73ED2C9E96B27B0E030578CB10B2424</code>. This value is the <code class="codeph">RAW</code> value returned in the <code class="codeph">SCRIPT_ID</code> field.
                                    </p>
                                 </li>
                                 <li>
                                    <p>Only one Oracle Streams configuration procedure is in the process of running because only one row was returned by the query. If multiple rows were returned by the query, then query the <code class="codeph">DBA_RECOVERABLE_SCRIPT</code> and <code class="codeph">DBA_RECOVERABLE_SCRIPT_PARAMS</code> views to determine which script ID applies to the configuration operation.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The cause in <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/database/oracle/oracle-database/18/strep&amp;id=ERRMG"><span class="italic">Oracle Database Error Messages</span></a> for the <code class="codeph">ORA-39001</code> error is the following: The user specified API parameters were of the wrong type or value range. Subsequent messages supplied by <code class="codeph">DBMS_DATAPUMP.GET_STATUS</code> will further describe the error.
                                    </p>
                                 </li>
                                 <li>
                                    <p>The query on the <code class="codeph">DBA_RECOVERABLE_SCRIPT_BLOCKS</code> view shows that the error occurred during Data Pump export.
                                    </p>
                                 </li>
                              </ul>
                              <p>The output from the queries shows that the <code class="codeph">MAINTAIN_SCHEMAS</code> procedure encountered a Data Pump error. Notice that the <code class="codeph">instantiation</code> parameter in the <code class="codeph">MAINTAIN_SCHEMAS</code> procedure was set to <code class="codeph">DBMS_STREAMS_ADM.INSTANTIATION_SCHEMA</code>. This setting means that the <code class="codeph">MAINTAIN_SCHEMAS</code> procedure performs the instantiation using a Data Pump export and import. A Data Pump export dump file is generated to complete the export/import.
                              </p>
                              <p>Data Pump errors usually are caused by one of the following conditions:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>One or more of the directory objects used to store the export dump file do not exist.</p>
                                 </li>
                                 <li>
                                    <p>The user running the procedure does not have access to specified directory objects.</p>
                                 </li>
                                 <li>
                                    <p>An export dump file with the same name as the one generated by the procedure already exists in a directory specified in the <code class="codeph">source_directory_object</code> or <code class="codeph">destination_directory_object</code> parameter.
                                    </p>
                                 </li>
                              </ul>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Query the <code class="codeph">DBA_RECOVERABLE_SCRIPT_PARAMS</code> data dictionary view at the capture database to determine the names of the directory objects specified when the <code class="codeph">MAINTAIN_SCHEMAS</code> procedure was run:</span><div><pre class="oac_no_warn" dir="ltr">COLUMN PARAMETER HEADING 'Parameter' FORMAT A30
COLUMN VALUE     HEADING 'Value'     FORMAT A45

SELECT PARAMETER,
       VALUE
       FROM DBA_RECOVERABLE_SCRIPT_PARAMS
       WHERE SCRIPT_ID = 'F73ED2C9E96B27B0E030578CB10B2424';
</pre><p>The query returns the following output:</p><pre class="oac_no_warn" dir="ltr">Parameter                      Value
------------------------------ ---------------------------------------------
SOURCE_DIRECTORY_OBJECT        SOURCE_DIRECTORY
DESTINATION_DIRECTORY_OBJECT   DEST_DIRECTORY
SOURCE_DATABASE                DBS1.EXAMPLE
DESTINATION_DATABASE           DBS2.EXAMPLE
CAPTURE_QUEUE_TABLE            REP_CAPTURE_QUEUE_TABLE
CAPTURE_QUEUE_OWNER            STRMADMIN
CAPTURE_QUEUE_NAME             REP_CAPTURE_QUEUE
CAPTURE_QUEUE_USER
APPLY_QUEUE_TABLE              REP_DEST_QUEUE_TABLE
APPLY_QUEUE_OWNER              STRMADMIN
APPLY_QUEUE_NAME               REP_DEST_QUEUE
APPLY_QUEUE_USER
CAPTURE_NAME                   CAPTURE_HR
APPLY_NAME                     APPLY_HR
PROPAGATION_NAME               PROP_HR
INSTANTIATION                  INSTANTIATION_SCHEMA
BI_DIRECTIONAL                 TRUE
INCLUDE_DDL                    TRUE
LOG_FILE                       export_hr.clg
DUMP_FILE_NAME                 export_hr.dmp
SCHEMA_NAMES                   HR
</pre></div>
                        </li>
                        <li class="stepexpand"><span>Ensure that the directory object specified for the <code class="codeph">source_directory_object</code> parameter exists at the source database, and ensure that the directory object specified for the <code class="codeph">destination_directory_object</code> parameter exists at the destination database. Check for these directory objects by querying the <code class="codeph">DBA_DIRECTORIES</code> data dictionary view.</span><div>
                              <p>For this scenario, assume that the <code class="codeph">SOURCE_DIRECTORY</code> directory object does not exist at the source database, and the <code class="codeph">DEST_DIRECTORY</code> directory object does not exist at the destination database. The Data Pump error occurred because the directory objects used for the export dump file did not exist.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Create the required directory objects at the source and destination databases using the SQL statement <code class="codeph">CREATE</code> <code class="codeph">DIRECTORY</code>. See <span class="q">"<a href="simple-oracle-streams-replication-configuration.html#GUID-6D874F68-7DE5-4987-8AEC-B0099BF3ED26">Creating the Required Directory Objects</a>"</span> for instructions.</span></li>
                        <li class="stepexpand"><span>Run the <code class="codeph">RECOVER_OPERATION</code> procedure at the capture database:</span><div><pre class="oac_no_warn" dir="ltr">BEGIN
  DBMS_STREAMS_ADM.RECOVER_OPERATION(
    script_id       =&gt; 'F73ED2C9E96B27B0E030578CB10B2424',
    operation_mode  =&gt; 'FORWARD');
END;
/
</pre><p>Notice that the <code class="codeph">script_id</code> parameter is set to the value determined in Step <a href="managing-oracle-streams-replication.html#GUID-C0B06B85-5F3E-4E58-8979-6D62136BCBA6__CEGIJAGA">3</a>, and the <code class="codeph">operation_mode</code> parameter is set to <code class="codeph">FORWARD</code> to complete the configuration. Also, the <code class="codeph">RECOVER_OPERATION</code> procedure must be run at the database where the configuration procedure was run.
                              </p>
                           </div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>