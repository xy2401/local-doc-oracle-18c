<!DOCTYPE html>
<html lang="en">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <!-- Part number: E92610-01 -->
    <!-- Published date: June 2018 -->
    <!-- See this link for directions on getting a part number: https://confluence.oraclecorp.com/confluence/display/DLPP/Archive+an+OBE -->
    <!-- Template date: 10/18/17 -->
    <title>Creating and Enabling Static and Dynamic Lockdown Profiles</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="robots" content="INDEX, FOLLOW">
    <meta name="description" content="Learn how to create and use static and dynamic lockdown profiles.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/normalize.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/obe-lite.css">
    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="js/jquery-ui-1.10.4.custom.js"></script>
    <script src="js/jquery.tocify.jd.js"></script>
    <script src="js/leftnav.js"></script>
  
    <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
    <meta name="dcterms.created" content="2018-08-03T18:46:38+00:00">
    <meta name="dcterms.title" content="Creating and Using Dynamic Lockdown Profiles">
    <meta name="dcterms.category" content="database">
    <meta name="dcterms.isVersionOf" content="OBEQR">
    <meta name="dcterms.product" content="en/database/oracle/oracle-database/18">
    <meta name="dcterms.identifier" content="E92610-01">
    <meta name="dcterms.release" content="Release 18">
  <script id="ssot-metadata" type="application/json"> {"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"18","element_name":"Release 18","display_in_url":true}}} </script>
    </head>
  <body>
    <header>
      <div class="w1024" style="min-height:55px; display:block;"> <a href="https://docs.oracle.com" class="oracle-logo"> <img src="./img/oracle_doc_logo.png" alt="Oracle Documentation" style="max-width: none;" height="22" width="236"></a> </div>
    </header>
    <!--end header-->
    <div id="content">
      <h1><img src="./img/obe_tag.png" alt="Oracle by Example branding" align="middle">Creating
        and Enabling Static and Dynamic Lockdown Profiles</h1>
      <div class="w1024" style="clear:both; position:relative; margin-top:40px;">
        <div class="navbackwide border-right"><!-- --></div>
        <div id="shownav" title="Show Navigation" tabindex="0"><span class="fa fa-list"></span></div>
        <div id="sidebar"><!-- -->
          <div class="left-nav-tut"><!-- -->
            <div id="hidenavw" title="Hide Navigation" tabindex="0"><span class="fa fa-close"></span></div>
            <div id="navbar" class="left-nav-w"><!-- -->
              <div id="toc" class="tocify"><!-- --></div>
            </div>
          </div>
        </div>
        <div id="bookContainer">
          <article>
            <section>
              <h2><img src="./img/32_begin.png" alt="section 0" class="num_circ" height="32" width="32">Before You Begin</h2>
              <p>This 15-minute tutorial shows you how to create static and
                dynamic lockdown profiles from base lockdown profiles and how to
                enable them in a container database (CDB) and pluggable
                databases (PDBs).</p>
              <h3>Background</h3>
              <p> Oracle Database 12c lockdown profiles are static lockdown
                profiles whereas Oracle Database 18c allows you to set dynamic
                lockdown profiles.</p>
              <h3>What Do You Need?</h3>
              <ul>
                <li>Familiarity with Oracle Database 12c lockdown profiles</li>
                <li>Oracle Database 18c installed</li>
                <li>A container database (CDB)</li>
                <li>The <a href="files/hr_root.sh" target="_blank">hr_root.sh </a>
                  shell script and the <a href="files/create_hr_root.sql" target="_blank">create_hr_root.sql,
                    </a><a href="files/create_hr_app.sql" target="_blank">create_hr_app.sql,
                    </a><a href="files/create_operations.sql" target="_blank">create_operations.sql,
                    </a><a href="files/create_sales.sql" target="_blank">create_sales.sql,
                    </a> and <a href="files/sync.sql" target="_blank">sync.sql</a>
                  SQL scripts downloaded to the <code> /home/oracle/labs </code>
                  directory with passwords updated in those scripts</li>
              </ul>
            </section>
            <hr>
            <section>
              <h2 id="section_1" role="button" style="text-align: left;"><img src="./img/32_1.png" alt="section 1" class="num_circ" height="32" width="32">Create
                a Base Lockdown Profile</h2>
              <ol>
                <li>Ensure that <code> tnsnames.ora </code> is updated with
                  entries for the <code>HR_ROOT, OPERATIONS </code> and <code>SALES
                    </code> PDBs.</li>
                <li>Verify the value of <code> ORACLE_HOME </code> on your
                  server. If necessary, update the <code>
                    /home/oracle/labs/hr_root.sh </code> shell script.</li>
                <li>Create the <code> HR_ROOT </code> application root and its
                  two application PDBs (<code>SALES </code> and <code>
                    OPERATIONS</code>) .
                  <pre><code>/home/oracle/labs/hr_root.sh</code></pre>
                </li>
                <li>Log in to <code> HR_ROOT. </code>
                  <pre><code>sqlplus hr_lock_mgr@HR_ROOT
Enter password: <em>password</em></code></pre>
                </li>
                <li>Create the <code> app_root_prof </code> lockdown profile.
                  <pre><code>DROP LOCKDOWN PROFILE app_root_prof;</code></pre>
                  <pre><code>CREATE LOCKDOWN PROFILE app_root_prof;</code></pre>
                  <pre><code>ALTER LOCKDOWN PROFILE app_root_prof
               DISABLE STATEMENT = ('alter system');</code></pre>
                  <pre><code>ALTER LOCKDOWN PROFILE app_root_prof
               ENABLE STATEMENT = ('alter system')
               CLAUSE = ('flush shared_pool','set');</code></pre>
                </li>
                <li>Set the <code> app_root_prof </code> lockdown profile in
                  the <code> HR_ROOT </code> application root.
                  <pre><code>ALTER SYSTEM SET pdb_lockdown = app_root_prof SCOPE = both;</code></pre>
                </li>
                <li>Verify that the lockdown profile was created in the
                  application root.
                  <pre><code>SHOW PARAMETER pdb_lockdown
NAME                    TYPE        VALUE
----------------------- ----------- ------------------------------
pdb_lockdown            string    APP_ROOT_PROF
</code></pre> </li>
              </ol>
            </section>
            <hr>
            <section>
              <h2 id="section_2" role="button" style="text-align: left;"><img src="./img/32_2.png" alt="section 2" class="num_circ" height="32" width="32">Create
                and Set a Static Lockdown Profile</h2>
              <ol>
                <li>For the <code> SALES </code> application PDB in the
                  application root, create the <code> static_sales_prof </code>
                  static application root lockdown profile from the <code>app_root_prof</code>
                  application root lockdown profile.
                  <pre><code>CREATE LOCKDOWN PROFILE static_sales_prof FROM app_root_prof;</code></pre>
                </li>
                <li>Update <code>static_sales_prof </code>to disallow the <code>
                    ALTER PLUGGABLE DATABASE </code> command.
                  <pre><code>ALTER LOCKDOWN PROFILE static_sales_prof
               DISABLE STATEMENT = ('alter pluggable database');</code></pre>
                </li>
                <li>Display the static lockdown profile. Read the list from <a href="files/code1.txt" target="_blank">code1</a> for typical
                  output.
                  <pre><code>SELECT profile_name, rule, clause, status FROM cdb_lockdown_profiles;
</code></pre>
                  <p class="note"> The rules from the base <code> app_root_prof
                    </code> lockdown profile are copied into the <code>
                      static_sales_prof </code> lockdown profile.</p>
                </li>
                <li>Log in to the <code> SALES </code> application PDB.
                  <pre><code>CONNECT hr_lock_mgr@SALES
</code>Enter password: <em>password</em></pre>
                </li>
                <li>Set the <code>static_sales_prof </code> lockdown profile.
                  <pre><code>ALTER SYSTEM SET pdb_lockdown = '' SCOPE = both;
ALTER SYSTEM SET pdb_lockdown = static_sales_prof SCOPE = both;</code></pre>
                </li>
                <li>Verify that the static lockdown profile is set in <code>
                    SALES. </code>
                  <pre><code>SHOW PARAMETER pdb_lockdown
NAME                 TYPE        VALUE
-------------------- ----------- ------------------------------
pdb_lockdown         string      STATIC_SALES_PROF
</code></pre> </li>
              </ol>
            </section>
            <hr>
            <section>
              <h2 id="section_3" role="button" style="text-align: left;"><img src="./img/32_3.png" alt="section 3" class="num_circ" height="32" width="32">Create
                and Set a Dynamic Lockdown Profile</h2>
              <ol>
                <li>Log in to the application PDB <code> OPERATIONS</code>.
                  <pre><code>CONNECT hr_lock_mgr@OPERATIONS
Enter password: <em>password</em></code></pre>
                </li>
                <li>Create a partitioned table. The purpose of this step is to
                  verify that you can still create a partitioned table, because
                  the restriction rule of the dynamic lockdown profile is the
                  partitioning feature.
                  <pre><code>CREATE TABLE sales ( SALESMAN_ID  NUMBER(5),
            SALESMAN_NAME VARCHAR2(30), SALES_STATE VARCHAR2(20))
            PARTITION BY LIST (SALES_STATE) AUTOMATIC
           (PARTITION P_CAL VALUES ('CALIFORNIA'));
Table created.</code></pre>
                </li>
                <li>Drop the table.
                  <pre><code>DROP TABLE sales;</code></pre>
                </li>
                <li>Log in to the application root.
                  <pre><code>CONNECT hr_lock_mgr@HR_ROOT
Enter password: <em>password</em></code></pre>
                </li>
                <li>For the <code> OPERATIONS </code> application PDB in the
                  application root, create the <code> dynamic_op_prof </code>
                  dynamic application root lockdown profile from the <code>
                    app_root_prof </code> application root lockdown profile.
                  <pre><code>CREATE LOCKDOWN PROFILE dynamic_op_prof INCLUDING app_root_prof;</code></pre>
                </li>
                <li>Update <code>dynamic_op_prof </code>to disallow the
                  partitioning feature.
                  <pre><code>ALTER LOCKDOWN PROFILE dynamic_op_prof DISABLE OPTION = ('PARTITIONING');</code></pre>
                </li>
                <li>Display the dynamic lockdown profile. Read from the list in
                  <a href="files/code2.txt" target="_blank">code2</a> for
                  typical output.
                  <pre><code>SELECT profile_name, rule, clause, status FROM cdb_lockdown_profiles;
</code></pre>
                  <p class="note"> The rules from the base <code> app_root_prof
                    </code> lockdown profile aren't copied into the <code>
                      dynamic_op_prof </code> lockdown profile. You will
                    observe that, however, they are effective.</p>
                </li>
                <li>Log in to the <code> OPERATIONS </code> application PDB.
                  <pre><code>CONNECT hr_lock_mgr@OPERATIONS
Enter password: <em>password</em></code></pre>
                </li>
                <li> Set the <code> dynamic_op_prof </code> dynamic lockdown
                  profile.
                  <pre><code>ALTER SYSTEM SET pdb_lockdown = '' SCOPE = both;
ALTER SYSTEM SET pdb_lockdown = dynamic_op_prof SCOPE = both;</code></pre>
                </li>
                <li>Verify that the static lockdown profile is set in <code>
                    OPERATIONS. </code>
                  <pre><code>SHOW PARAMETER pdb_lockdown
NAME                 TYPE       VALUE
-------------------- ----------- ------------------------------
pdb_lockdown         string      DYNAMIC_OP_PROF</code></pre>
                </li>
              </ol>
            </section>
            <hr>
            <section>
              <h2 id="section_4" role="button" style="text-align: left;"><img src="./img/32_4.png" alt="section 4" class="num_circ" height="32" width="32">Execute
                Commands Allowed and Disallowed by the Static Lockdown Profile</h2>
              <ol>
                <li>Log in to the <code> SALES </code> application PDB.
                  <pre><code>CONNECT hr_lock_mgr@SALES
Enter password: <em>password</em></code></pre>
                </li>
                <li>Execute the <code> ALTER SYSTEM SET </code> command that
                  sets <code> DDL_LOCK_TIMEOUT </code> to 30 seconds. The
                  command respects the rule inherited from <code>
                    app_root_prof. </code>
                  <pre><code>ALTER SYSTEM SET ddl_lock_timeout=30 scope=both;

System altered.</code></pre>
                </li>
                <li>Execute the <code> ALTER SYSTEM FLUSH SHARED_POOL </code>
                  command that flushes the shared pool. The command respects the
                  rule inherited from <code> app_root_prof. </code>
                  <pre><code>ALTER SYSTEM FLUSH SHARED_POOL;

System altered.
</code></pre> </li>
                <li>Execute the <code> ALTER SYSTEM CHECKPOINT </code> command
                  that completes a checkpoint between the database buffer cache
                  and the datafiles. The command respects the rule inherited
                  from <code> app_root_prof. </code>
                  <pre><code>ALTER SYSTEM CHECKPOINT;
ALTER SYSTEM CHECKPOINT
*
ERROR at line 1:
ORA-01031: insufficient privileges
</code></pre> </li>
                <li>Execute the <code> ALTER PLUGGABLE DATABASE </code>
                  command that alters the PDB by closing it in this case. The
                  command respects rules inherited from <code>
                    static_sales_prof. </code>
                  <pre><code>ALTER PLUGGABLE DATABASE CLOSE;
ALTER PLUGGABLE DATABASE CLOSE
*
ERROR at line 1:
ORA-01031: insufficient privileges
</code></pre></li>
                <li>Execute the <code> CREATE TABLE ... PARTITION </code>
                  command that creates a partitioned table requiring the
                  partitioning option enabled. There is no restriction in <code>
                    static_sales_prof </code> for this command to execute.
                  <pre><code>CREATE TABLE sales
      ( SALESMAN_ID  NUMBER(5), SALESMAN_NAME VARCHAR2(30),
        SALES_STATE VARCHAR2(20))
       PARTITION BY LIST (SALES_STATE) AUTOMATIC
        (PARTITION P_CAL VALUES ('CALIFORNIA'));
 
Table created.</code></pre>
                </li>
              </ol>
            </section>
            <hr>
            <section>
              <h2 id="section_5" role="button" style="text-align: left;"><img src="./img/32_5.png" alt="section 5" class="num_circ" height="32" width="32">Execute
                Commands Allowed and Disallowed by the Dynamic Lockdown Profile</h2>
              <ol>
                <li>Log in to the <code> OPERATIONS </code> application PDB.
                  <pre><code>CONNECT sys@OPERATIONS AS SYSDBA
Enter password: <em>password</em></code></pre>
                </li>
                <li>Execute the <code> ALTER SYSTEM SET </code> command that
                  sets <code> DDL_LOCK_TIMEOUT </code> to 30 seconds. The
                  command respects the rule inherited from <code>
                    app_root_prof. </code>
                  <pre><code>ALTER SYSTEM SET ddl_lock_timeout=30 scope=both;

System altered.</code></pre>
                </li>
                <li>Execute the <code> ALTER SYSTEM FLUSH SHARED_POOL </code>
                  command that flushes the shared pool. The command respects the
                  rule inherited from <code> app_root_prof. </code>
                  <pre><code>ALTER SYSTEM FLUSH SHARED_POOL;

System altered.
</code></pre> </li>
                <li>Execute the <code> ALTER SYSTEM CHECKPOINT </code> command
                  that completes a checkpoint between the database buffer cache
                  and the datafiles. The command respects the rule inherited
                  from <code> app_root_prof. </code>
                  <pre><code>ALTER SYSTEM CHECKPOINT;
ALTER SYSTEM CHECKPOINT
*
ERROR at line 1:
ORA-01031: insufficient privileges
</code></pre> </li>
                <li>Execute the <code> ALTER PLUGGABLE DATABASE </code>
                  command that alters the PDB by closing and reopening it in
                  this case. The command respects rules inherited from <code>
                    dynamic_op_prof. </code> There is no restriction in <code>
                    dynamic_op_prof </code> for the command to execute.
                  <pre><code>ALTER PLUGGABLE DATABASE CLOSE;
Pluggable database altered.</code></pre>
                  <pre><code>ALTER PLUGGABLE DATABASE OPEN;
Pluggable database altered.</code></pre>
                </li>
                <li>Execute the <code> CREATE TABLE ... PARTITION </code>
                  command that creates a partitioned table requiring the
                  partitioning option enabled. This command respects rules
                  inherited from <code> dynamic_op_prof.</code>
                  <pre><code>CREATE TABLE sales
      ( SALESMAN_ID  NUMBER(5), SALESMAN_NAME VARCHAR2(30),
        SALES_STATE VARCHAR2(20))
       PARTITION BY LIST (SALES_STATE) AUTOMATIC
        (PARTITION P_CAL VALUES ('CALIFORNIA'));
*
ERROR at line 1:
ORA-00439: feature not enabled: Partitioning
</code></pre></li>
              </ol>
            </section>
            <hr>
            <section>
              <h2 id="section_6" role="button" style="text-align: left;"><img src="./img/32_6.png" alt="section 6" class="num_circ" height="32" width="32">Update
                the Base Lockdown Profile</h2>
              <ol>
                <li>Log in to the <code> HR_ROOT </code> application root.
                  <pre><code>CONNECT hr_lock_mgr@HR_ROOT
Enter password: <em>password</em></code></pre>
                </li>
                <li>Update the base lockdown profile.
                  <pre><code>ALTER LOCKDOWN PROFILE	app_root_prof ENABLE STATEMENT = ('alter system')
               CLAUSE = ('checkpoint');
</code></pre> </li>
                <li>Display the rules of the static and dynamic lockdown
                  profiles. Read the list in <a href="files/code3.txt" target="_blank">code3</a>.
                  <pre><code>SELECT profile_name, rule, clause, status FROM cdb_lockdown_profiles;
</code></pre> </li>
                <li>Log in to the <code> SALES </code> application PDB.
                  <pre><code>CONNECT sys@SALES AS SYSDBA
Enter password: <em>password</em></code></pre>
                </li>
                <li>Execute the command allowed by the base lockdown profile.
                  The static lockdown profile doesn't inherit the new rule of
                  the base lockdown profile.
                  <pre><code>ALTER SYSTEM CHECKPOINT;
ALTER SYSTEM CHECKPOINT
*
ERROR at line 1:
ORA-01031: insufficient privileges
</code></pre> </li>
                <li>Log in to the <code> OPERATIONS </code> application PDB.
                  <pre><code>CONNECT sys@OPERATIONS AS SYSDBA
Enter password: <em>password</em></code></pre>
                </li>
                <li>Execute the command allowed by the base lockdown profile.
                  The dynamic lockdown profile inherits the new rule of the base
                  lockdown profile.
                  <pre><code>ALTER SYSTEM CHECKPOINT;

System altered.
</code></pre> </li>
              </ol>
            </section>
            <hr>
            <section>
              <h2 id="section_7" role="button" style="text-align: left;"><img style="width: 32px; height: 32px;" src="./img/32_7.png" alt="section 7" class="num_circ">Drop the
                Lockdown Profiles</h2>
              <ol>
                <li>Connect to <code> SALES </code> as <code> HR_LOCK_MGR</code>.
                  <pre><code>CONNECT hr_lock_mgr@SALES AS SYSDBA
Enter password: <em>password</em></code></pre>
                </li>
                <li>Unset the <code>static_sales_prof </code> static lockdown
                  profile in <code> SALES. </code>
                  <pre><code>ALTER SYSTEM SET pdb_lockdown = '' SCOPE = both;
</code></pre> </li>
                <li>Connect to <code> OPERATIONS </code> as <code>
                    HR_LOCK_MGR</code>.
                  <pre><code>CONNECT sys@OPERATIONS AS SYSDBA
Enter password: <em>password</em></code></pre>
                </li>
                <li>Unset the <code>dynamic_op_prof </code> dynamic lockdown
                  profile in <code> OPERATIONS. </code>
                  <pre><code>ALTER SYSTEM SET pdb_lockdown = '' SCOPE = both;
</code></pre> </li>
                <li>Connect to <code> HR_ROOT </code> and drop both lockdown
                  profiles.
                  <pre><code>CONNECT hr_root_mgr@HR_ROOT
Enter password: <em>password</em></code></pre>
                  <pre><code>DROP LOCKDOWN PROFILE static_sales_prof;</code></pre>
                  <pre><code>DROP LOCKDOWN PROFILE dynamic_op_prof;</code></pre>
                </li>
                <li>Unset the <code> app_root_prof </code> lockdown profile
                  and then drop it.
                  <pre><code>ALTER SYSTEM SET pdb_lockdown = '' SCOPE = both;</code></pre>
                  <pre><code>DROP LOCKDOWN PROFILE app_root_prof;</code></pre>
                </li>
                <li>Quit the session.
                  <pre><code>EXIT</code></pre>
                </li>
              </ol>
            </section>
          </article>
        </div>
        <br class="clearfloat">
      </div>
    </div>
    <!--close main-->
    <!--end content-->
    <div class="footer-container ">
      <div style="max-width: 994px; padding:10px 0 0 17px;">
        <footer class="footer-list">
          <ul>
            <li> <a href="https://www.oracle.com/corporate/index.html" target="_blank">About
                Oracle</a> </li>
            <li> <a href="https://www.oracle.com/us/corporate/contact/index.html" target="_blank">Contact Us</a> </li>
            <li> <a href="https://www.oracle.com/us/legal/index.html" target="_blank">Legal
                Notices</a> </li>
            <li> <a href="https://www.oracle.com/us/legal/terms/index.html" target="_blank">Terms
                of Use</a> </li>
            <li> <a href="https://www.oracle.com/us/legal/privacy/index.html" target="_blank">Your
                Privacy Rights</a> </li>
            <li><a href="https://www.oracle.com/pls/topic/lookup?ctx=cpyr&amp;id=en">Copyright
                © 2018, Oracle and/or its affiliates. All rights reserved.</a></li>
          </ul>
        </footer>
      </div>
      <script type="text/javascript" src="https://www.oracleimg.com/us/assets/metrics/ora_docs.js"></script>
    </div>
  </body>
</html>
